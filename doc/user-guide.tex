\documentclass[12pt]{report}
\usepackage{array}
\usepackage{ug_contact}
\usepackage{multirow,alltt,enumitem}
\usepackage{step}\usepackage{newtxmath}\usepackage[T1]{fontenc}
\usepackage[colorlinks=true, linkcolor=blue, citecolor=blue, linktoc=all]{hyperref}
\usepackage{bookmark}

\newcommand{\optionaltikz}[1]{#1}
% \renewcommand{\optionaltikz}[1]{}
\optionaltikz{
\usepackage{tikz}
}

\input{texinputs.tex}

\title{User guide for CONTACT,\\
       Rolling and sliding contact with friction}
\author{Dr.ir.\ E.A.H.\ Vollebregt}
\cprtext{\copyright\ \vtechcmcc.}
\date{\today}
\reportnumber{20-01, version `open-src' \magenta{(1.164)}}

\parindent 0mm
\parskip 1ex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Voor intern gebruik:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Voor uitlevering:
\renewcommand{\magenta}[1]{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% \newcommand{\allexamp}[1]{\magenta{#1}}
\newcommand{\allexamp}[1]{}

\newcommand{\var}[1]{\mbox{\tt #1}}
\newenvironment{inputvars}{\vspace{0.4\baselineskip}%note: using the array package

%\begin{tabular}{>{\raggedright}p{22mm}p{19mm}p{113mm}}\\[-1.5ex]}{
\begin{tabular}{>{\raggedright}p{22mm}p{19mm}p{113mm}}}{
\end{tabular}

}
\newcommand{\inpvar}[3]{{\small\tt #1} & $#2$ & #3 \\[1ex]}
\newcommand{\inpvarw}[3]{\mbox{{\small\tt #1}\hspace{-5mm}} & $#2$ & #3 \\[1ex]}
\newcommand{\inpbreak}{\end{inputvars}\begin{inputvars}}

\newenvironment{inputvarsml}{

\begin{tabular}{p{22mm}p{18mm}p{94mm}}\\[-1.5ex]}{
\end{tabular}

}

\begin{document}
\pagestyle{vtrep}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Logsheet
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\magenta{
\begin{vtlogsheet}
\vtlogentry{1.140}{EV}{15-12-2022}{Version for release v22.2}{}
%\vtlogentry{1.141}{EV}{02-03-2023}{Added {\tt S\_METHOD} for approximating
%        spline}{}
%\vtlogentry{1.142}{EV}{20-03-2023}{Correction format {\tt slcs}-file}{}
%\vtlogentry{1.143}{EV}{20-03-2023}{Added {\tt NPOT\_MAX}}{}
%\vtlogentry{1.144}{EV}{23-03-2023}{Added ${\tt D}=6,8,9$}{}
\vtlogentry{1.145}{EV}{14-04-2023}{Version for release v23.1}{}
\vtlogentry{1.146}{EV}{10-05-2023}{Added massless rail deflection ${\tt 
        F}_1=3$}{}
\vtlogentry{1.147}{EV}{19-06-2023}{Changed cntc\_getprofilevalues}{}
\vtlogentry{1.148}{EV}{31-07-2023}{Added configuration of debug outputs}{}
\vtlogentry{1.149}{EV}{11-08-2023}{Added ${\tt D}=7$ using initial contact
        position}{}
\vtlogentry{1.150}{EV}{16-08-2023}{Added comment on slice feature positions}{}
\vtlogentry{1.151}{EV}{23-08-2023}{Clear out-file upon new initialization}{}
\vtlogentry{1.152}{EV}{12-09-2023}{Delete arc-fit, add conversion formulas}{}
\vtlogentry{1.153}{EV}{04-10-2023}{Added wheel slices file}{}
\vtlogentry{1.154}{EV}{24-10-2023}{Add description of {\tt
        cntc\_getcpresults}}{}
\vtlogentry{1.155}{EV}{03-11-2023}{Version for release v23.2}{}
\vtlogentry{1.156}{EV}{10-11-2023}{Added wheel flat example}{}
\vtlogentry{1.157}{EV}{21-11-2023}{Added super grid with active window}{}
\vtlogentry{1.158}{EV}{28-11-2023}{Permit {\tt I}-digit in module 1}{}
\vtlogentry{1.159}{EV}{30-11-2023}{Extension of Cattaneo solution for
        radius $a$}{}
\vtlogentry{1.160}{EV}{01-12-2023}{Added spin center}{}
\vtlogentry{1.161}{EV}{11-12-2023}{Permit ${\tt T}=1,2$ in module 1}{}
\vtlogentry{1.162}{EV}{16-01-2024}{Changed PSFLRIN to PSFLCIN}{}
\vtlogentry{1.163}{EV}{19-03-2024}{Added force based proportional damping}{}
\vtlogentry{1.164}{EV}{03-04-2024}{Extended force based proportional damping}{}
\vtfilelocation{$<$svn-contc$>$/contact/doc}
\end{vtlogsheet}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inhoudsopgave
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tableofcontents

\clearpage
\chapter*{License}
\addcontentsline{toc}{chapter}{License}

This work is licensed under the Apache License v2.0. To view a copy of this
license, visit
\href{https://www.apache.org/licenses/LICENSE-2.0}{https://\-www.apache.org/licenses/LICENSE-2.0}.

% \chapter*{Contributors}
% Here are the people who have contributed to ... Thank you for making this
% guide more informative to the users of CONTACT.
% ...

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hoofdstukken
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Introduction}
\label{chp:introduction}

This report describes the usage of the computer program CONTACT for contact
mechanical simulations. CONTACT is an advanced simulation program for the
detailed study of three-dimensional frictional contacts. For instance to
investigate the behavior of the wheel/rail creep forces and the subsequent
wear and damage of railway wheels and rails \cite{Meymand2016a-review,
Vollebregt2021a-soa-paper}.

This program implements the famous theories for rolling contact by Prof.\
J.J.\ Kalker of Delft University of Technology. These were presented first
in \cite{Kalker1979a} and are described in full detail in
\cite{Kalker1990}. Extended introductions are given in \cite{Kalker2000}
and \cite{Vollebregt2011a-assessm}. Extensions by Vollebregt concern the
automated analysis of wheel/rail contacts \cite{Vollebregt2020b-wrgeom,
Vollebregt2020c-distr-force,Vollebregt2022b-cm2022,
Vollebregt2023a-iavsd2023}, the effects of third
body layers \cite{Vollebregt2014c-tractcurv,Vollebregt2019a-fra} and
falling friction \cite{Vollebregt2012a-quasistd}, together referred to as
`Extended CONTACT', and speedup by dedicated iterative solvers, e.g.\
\cite{Vollebregt2014a-fftprec,Zhao_Jing2015a-tangcg}.

\section{Prerequisites}

To understand this report and work with our program, a basic understanding
of the deformation of solid objects is needed. This involves the concepts
of stress and strain from continuum mechanics. Further one should know
about elastic, viscoelastic and plastic material behaviours, and of
corresponding material parameters such as Young's modulus and the yield
strength. Introductory texts on these matters are provided on
Wikipedia\footnote{{\tt en.wikipedia.org/wiki/solid\_mechanics}} and in
text books such as \cite{Bower2008} and \cite{Naghdi2001}.

In many cases, applications of CONTACT incorporate the motion of the contacting
bodies. Relevant background material on this is provided in text books on
mechanics. A solid foundation on statics and dynamics of rigid bodies is
provided for instance in \cite{Hibbeler2012}. The dynamics of deformable
objects are surveyed among others in \cite{Craig2006}. Reference texts on
multi-body dynamics are provided by \cite{Shabana2013,Shabana2008}. The
former of these is more general and pays attention to flexible bodies, the
latter is targeted more on railway applications.

\section{Purpose of CONTACT}

Contact mechanics concerns the interaction of deformable bodies. A key
aspect is that the contact area depends on the deformation of the bodies,
that depends on the contact area and contact stresses. The determination of
the contact area thus becomes an essential part of the problem.
This is contrary to what is usually the case in finite element analysis,
where the load and displacement are prescribed at different parts of the
boundary that are fixed and known beforehand.

Different types of contact problems may be identified. For instance
frictionless and frictional problems, stationary and instationary, and
concentrated or diversified. Concentrated contacts are those where the
contact area is small compared to the typical dimensions of the bodies,
and where the contacting bodies are `smooth edged' near the contact zone.

CONTACT is intended for concentrated contact problems. It solves the normal
pressures (`frictionless') and tangential (frictional) shear stresses
(tractions) for stationary and instationary problems (shift, rolling). This
is done for bodies of linearly elastic or viscoelastic materials. Both
bodies are considered homogeneous --although possibly of different--
materials.  The geometry of the bodies is free (non-Hertzian).  With
respect to kinematic parameters (overall motion), total forces, approach
and creepages may be prescribed.

After the surface loading (stresses) has been computed, the elastic field
inside the bodies may be calculated \cite{Kalker1986a,Wekken2019a-subsurf}.
This gives the elastic displacements, displacement gradients and strains,
and from those the stresses are deduced. In particular also the Von Mises
stress is calculated, which is important in plasticity calculations.

CONTACT can be operated in different ways:
\begin{itemize}
\item detailed study of one or a few relevant cases, using detailed inputs
        and outputs, using the plotting routines provided,
\item solving a large number of related cases, for instance for building up
        a table that can be used in another program,
\item incorporating the calculating part of CONTACT as a subroutine in your
        own computing software. The calculating part is provided as a
        library (dll for Windows, so for Linux) that can be interfaced from
        MATLAB, Python, Fortran and C.
\end{itemize}
The latter two options are relevant for wear calculations and for Vehicle
System Dynamics (VSD) simulation codes. Add-ons to GENSYS, NUCARS, SIMPACK
Rail \cite{Vollebregt2011b-iavsd2011} and Universal Mechanism\footnote{{\tt
www.gensys.se}, {\tt www.aar.com/nucars}, {\tt www.simpack.com}, {\tt 
www.universalmechanism.com}} have been realized and are provided on a
commercial basis.

\section{History of the program}

The program CONTACT already has a long history. Version 1 was written in
1982, and followed the program DUVOROL \cite{Kalker1979a,Tsjoeng1980}. Since
then there have been a number of versions. Several options were added, and
some have been deleted too. Also the manual was revised over and over again.

In 1986--90, the direct method for steady state rolling was added to the
program. This method is extensively described in \cite{Kalker1990}. The
corresponding program (PC version) was called CONPC90. In 1992--4 the code
has been restructured and modernized.  New features of that time include
fast solvers for the tangential contact problem
\cite{Vollebregt1995a-convexgs} and the extension to viscoelastic contact
problems (steady state rolling)
\cite{Wang_guangqiu1992b,Wang_guangqiu1993}. At that time, the program was
used for creating a table for the Hertzian creep-force law
\cite{Kalker1996b-usetab} and for the study of rough elastic contacts
\cite{Kalker1997}. Since then, the program has been distributed and
supported for a long time without significant new extensions being made.
This version is designated as CON93 or (Kalker's) CONTACT'93
\cite{Vollebregt1993f-con93}.

Since 2008 there has been renewed interest in this software and new
developments have been made. The code has been modernized once again,
simplifying its usage and improving its extendability. Also the robustness,
accuracy and speed of operation have been improved
\cite{Vollebregt2009a-cm2009}. The `Panagiotopoulos process' was found
completely reliable, whereupon the slower KOMBI algorithm was removed. A
first public version was published in 2009. Estimating that this could count
as the ninth incarnation, this version was designated (VORtech's) CONTACT
v9.1 \cite{Vollebregt2009b-userguide-v9}.

VORtech extended the range of applicability of CONTACT since 2009 by
incorporation of velocity dependent friction laws
\cite{Vollebregt2014c-tractcurv,Vollebregt2012a-quasistd}, effects of
roughness and contamination (`third body layer') 
\cite{Vollebregt2014c-tractcurv,Vollebregt2021a-soa-paper,
Vollebregt2019a-fra}, by making extensions for solving conformal
contact problems \cite{Vollebregt2018b-corrigendum,
Vollebregt2020c-distr-force,Vollebregt2014d-conformal}, and via new
enhanced solvers on the basis of Conjugate Gradients and FFTs 
\cite{Vollebregt2014a-fftprec,Zhao_Jing2015a-tangcg}. 

The software was transferred to the company Vtech CMCC in 2020, that now
continues this development and distribution. Research is being done to
extend CONTACT for rails and wheels with variable profile cross-section,
i.e.\ switches and crossings \cite{Vollebregt2023a-iavsd2023} and wheel
out-of-roundness. When such new functionality is achieved, this will be
included in future versions of this document.

\section{Structure of this report}

The remainder of this report is structured as follows.
\begin{itemize}
\item The operation of the program is described in Chapter
        \ref{chp:operation}. This concerns the interactive and batch usage,
        terminology with respect to `modules' and `cases' (e.g.\ time steps),
        and the `control integers' that steer the program's execution.
\item Chapter \ref{chp:module1} describes the input and output quantities
        for wheel/rail contact analysis.
\item Chapter \ref{chp:module3} describes the additional input and output
        quantities for basic contacts, such as material and friction data.
\item The usage of the stand-alone program is demonstrated further
        through the examples in Chapter \ref{chp:examples}. Chapter
        \ref{chp:matlab_plots} describes the Matlab scripts for
        visualization of the results.
\item The use of the CONTACT library is documented in Chapter
        \ref{chp:contact_library}.
\item Appendix \ref{chp:fileformats} specifies the files that are used.
\item Finally, Appendix \ref{chp:comput_model} presents a quick overview of
        the computational model used. For further details and background
        information the reader is referred to \cite{Kalker1990,Kalker2000,
        Vollebregt2020c-distr-force,Vollebregt2021a-soa-paper} and
        \cite{Vollebregt2011a-assessm}.
\end{itemize}

\magenta{
\paragraph{Experimental features}
The program has a number of `hidden' features, available only in the
development version. These are considered experimental and may be changed
or deleted in future versions. Such features are marked magenta in this
user guide.}

\section{Guidance to new users}

It is acknowledged that CONTACT is not the easiest program to get acquainted
with.
\begin{itemize}
\item The main problem is that there is little introductory material on
contact mechanics as a whole. The books by Johnson \cite{Johnson1985} and
Kalker \cite{Kalker1990} are excellent reference works, but present quite a
challenge to get familiar with the material. A more gentle introduction to
contact mechanical phenomena is provided by Popov \cite{Popov2010a-book},
whereas \cite{Vollebregt2021a-soa-paper} presents a review on the
creep forces. 
\item Further, there is a large diversity of situations to which the program
can be applied. This is impeding the definition of a simple work-flow or
the construction of simple plotting facilities.
\item Finally, there's the old-fashioned structure of input-file, with the
many `control digits' and switches that are involved.
\end{itemize}
In our opinion the usage of the program is not so hard {\em if\/} one knows
about contact mechanics terminology. It's easy to get familiar with the
input-file itself. For this the following steps are advised:
\begin{enumerate}
\item Quickly go over the contents of this user guide, particularly
Chapters \ref{chp:operation}, \ref{chp:module1} and \ref{chp:module3}.
\item Run the program for the examples that are provided and go through
their description in Chapter \ref{chp:examples} of this guide.
\item Put guide cards at Sections \ref{sec:controldigits} and
\ref{sec:inputfile} of this guide; this reference information is consulted
frequently.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Operation of the program
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Operation of the program}
\label{chp:operation}

\begin{figure}[p]
\centering
\psfig{figure=fig/contact_arch_exe,width=4.7in,trim=150 139 25 306,clip=}
\caption{\em Structure of a calculation using the Stand-alone CONTACT program.}
\label{fig:arch_exe}
\end{figure}

The basic structure of the CONTACT stand-alone program is illustrated
schematically in Figure \ref{fig:arch_exe}.

\section{Starting the program}

\subsection{Terminal-based, textual interface}
\label{sec:term_based}

The program CONTACT is a terminal-based program, with textual input from
an input-file and textual output to the terminal and several output-files.
Consequently the program is started at the command prompt in a DOS-box or
Linux terminal emulator window:
{\small\begin{verbatim}
   C:\Data\Carter2d\> contact.exe 2 carter2d
\end{verbatim}}
The later two arguments are optional. They prescribe the mode of operation
({\tt <imode>}) of the program and the experiment name, which is denoted
\verb+<experim>+ below. Note that this command line is hidden for the
end-user when using the CONTACT GUI (paragraph \ref{sec:contact_gui}).

When you start the program, you will first be asked whether you want to do
license operations, perform an actual run, or just want to check the input
with no computation.
\begin{alltt}\small
   Mode of operation of this program.

   IMODE=1: license management,
   IMODE=2: start from input file <EXPERIM>.inp,
   IMODE=3: check input file <EXPERIM>.inp,
\end{alltt}
% The program will use parallel computing (multi-threading) automatically when
% run on a multi-processor/core PC. This may be influenced via the
% \verb+OMP_NUM_THREADS+ environment variable. When set to {\tt 1}
% parallelisation is suppressed and only a single processor/core is used.

\subsection{Windows-based interface, the CONTACT GUI}
\label{sec:contact_gui}

The CONTACT GUI is a small auxiliary program by which CONTACT's command
line may be avoided. The main purpose of the GUI is to assist in selecting
an input file and starting the calculation. No facilities are provided to
create or edit the input-files themselves.

\begin{figure}[bt]
\centering
\psfig{figure=fig/screenshot-gui,width=4.4in}
\caption{\em Main window of the CONTACT GUI.}
\label{fig:screenshot_gui}
\end{figure}

The GUI can be started from the Windows desktop short-cut (if created) or
via the Windows Start menu. On Linux, the GUI is started using the script
{\tt start\_gui.sh} in a terminal window (see the installation instructions
in the file {\tt README.txt}). This opens a new session as illustrated in
Figure \ref{fig:screenshot_gui}. License management actions are provided in
the Help menu.

A typical run starts with selecting an existing input-file for CONTACT.
The base name of this file (excluding the {\tt .inp} filename extension) is
the experiment name for the run. Next, the CONTACT program may be activated
to check the input, using ${\tt imode}=3$ as described previously. Using
`Run Experiment', CONTACT is started for the actual calculations, using
${\tt imode}=2$. The message output will be displayed in the GUI as shown
in Figure \ref{fig:screenshot_gui}. Other output files are created as
well, that may be inspected for instance in MATLAB as indicated in
Figure \ref{fig:arch_exe}.

\subsection{License management}
\label{sec:license_mngmt}

CONTACT licenses are distributed via e-mail, providing the license ID
and activation password. These are used to {\bf activate} the software on
the user PC. This generates a request that's transmitted via the Internet
to a web-based licensing server, checked, and used to generate a license
file for the user PC. 

A license file is stored locally and used to check credentials each
time the program is run. The contents of the file can be viewed using the
{\bf print} option.

The license file is updated from time to time to let new details be added,
such as an extended duration. This is done automatically when the program
finds that a refresh is needed. It can be triggered manually using the {\bf
refresh} option.

License files for the stand-alone program are named
\verb+contact_<licenseid>.lic+. The library version uses 
\verb+clibrary_<licenseid>.lic+. They are stored in
the user profile folder (Windows: \verb+%USERPROFILE%+, Linux:
\verb+$HOME+). 

Further information is provided in a separate document `{\bf
licensing.pdf}' in the installation folder \cite{memo21004-licensing}.

\section{Multiple cases, sequences}
\label{sec:cases}

In a single run of CONTACT multiple contact problems may be solved. These
problems may be independent of each other or may form sequences.

A single case may be viewed as a single time instance. In this respect it
is important to know that CONTACT uses an elastostatic approach. The
contacting bodies may be accelerating or decelerating as a whole, yet 
the corresponding inertia terms are ignored from the stress balance.
By this approximation, the stresses inside the bodies are locally in
equilibrium at all times, and any stress waves inside the bodies will
be neglected.

Within this elastostatic approach, frictionless compression problems
need just a single time instance. There is no memory of any sort in these
problems. When a succession of loading steps is computed using different
cases, the outcome of each case is independent of the order in which the
cases are solved.

In frictional problems there is a dependency on time. This dependency
arises through the discretisation of the slip velocity 
between opposing particles of the two bodies in the contact zone. This
time dependency may be dealt with in three different ways:
\begin{enumerate}
\item Contact formation: it may be assumed that there were no surface
        tractions at all at the previous time instance $t'=t-\delta t$.
\item True sequence: the surface tractions of the previous time instance
        $t'$ may be defined through the solution of the previous case that
        was solved.
\item Steady state (rolling): the surface tractions of the previous time
        instance $t'$ may be required to be identical to the solution of
        the new case for time $t$, but acting on different parts of the two
        bodies' surfaces.
\end{enumerate}
It may be clear that cases of the first and third types may be solved by
themselves, whereas the second way requires that another case has been
solved before. A sequence of cases for a transient calculation should
therefore start with one case of contact formation or with a steady state
problem, before the actual transient cases are solved.

Even when two consecutive cases are independent of each other, the later
one may re-use information of the earlier one. For instance when you compute
the frictionless compression of two spheres by two normal problems. The
later case may re-use the discretisation parameters and influence
coefficients that have been computed by the earlier case. Moreover, the
solution of the earlier case may be used as an initial estimate for the
later case. In this way the computation time may be reduced.

%{\em (Currently the program CONTACT works on a single list of cases, with
%their relation somewhat hidden in the control integers. An idea is to make
%the relation between cases more visible by introducing more hierarchy in
%the input file. Transient calculations may be grouped into `sequences',
%and other cases may be grouped into `parameter sweeps'. This idea could be
%worked out revising the format of the input-file.)}

\section{The control integers}
\label{sec:controldigits}

The specification of each case is largely governed by so-called `control
digits'. These digits determine all kinds of things. Some specify the
problem, others determine the solution method and so on. They are referred
to by one letter or by a short word that describes their meaning. They are
also grouped together in control words. The following list
describes all possible values, and is very useful when you edit the
input-file by hand.

The primary control digits are {\tt P}, {\tt T}, {\tt N}, {\tt A}
and {\tt O}. The other digits are modified less frequently.

Do not be distracted by values that seem meaningless to you, they can be
very useful when you program your own modules.

\subsection{Modules}
\label{sec:modules}

The program CONTACT is built up using different `modules' (sub-programs)
that use a shared computational core, see Figure \ref{fig:arch_exe}. The
idea is that different usages of CONTACT require different `driver
routines', where different formats for the input file are required. So you
first indicate to CONTACT which module you use for a case, and then specify
the input which is read by the appropriate input-routine.

The modules that are available today are:
\begin{alltt}\small
 MODULE = 1: execute the WHEEL-RAIL processing program.
        = 3: execute the basic, HERTZIAN & NON-HERTZIAN program.
        = 0: STOP program execution.
\end{alltt}
Module 1 is targeted at wheel-rail contact analysis. This revolves around a
`half wheelset' on a `half track' (rail or roller). The module starts
from a wheelset at a given track location, uisng generic wheel and rail
profiles, locates the contact points, solves the contact patches, and then
converts the results to the global coordinate frame. 

Module 3 is a basic driver routine for Hertzian and non-Hertzian cases.
This skips over the contact search and creep calculation, which must be
performed by the user.

When there are no more cases to compute this is signalled to the program by
the artificial module number 0.

\subsection{Module 1 -- wheel-rail contact}

\begin{description}
\item[CPBTNFS, VLDCMZE, \magenta{X}HGIAOWR] -- the control words, compressed form
\end{description}
The following list is ordered the same as the letters in the control words.
The first digits concern the problem description, then follow the
preprocessing actions for the computational core and lastly the solution
methods and output options are described.

The first control word `{\bf CPBTNFS}' describes the main aspects of the
problem: the modes of operation regarding the configuration, time, the
normal and tangential problems, and regarding the subsurface stress
calculation.
\begin{description}
\item[C$_1$ - CONFIG] \label{c1-digit} : concerns the {\em 
        configuration\/} or {\em composition\/} of the problem:
\begin{description}
\item[0] -- half wheelset on half track, left wheel;
\item[1] -- half wheelset on half track, right wheel.
\item[4] -- half wheelset on roller, left wheel;
\item[5] -- half wheelset on roller, right wheel.
\end{description}
A configuration with a single wheel can be described using a left or a right
wheel.

\item[P - PVTIME]\label{p-digit} : the relation of the current to the
        {\em previous case\/} or {\em previous time instance\/}:
\begin{description}
\item[0$^*$] -- new time step; the resulting tractions \magenta{and forces}
                of the last calculated case are used as previous time
                instance for the calculation of the current case;
\magenta{
\item[1$^*$] -- new time step for the normal part only; the tangential
                tractions of the previous time instance are set to zero;
}
\item[2] -- new sequence; in transient cases (${\tt T}=1, 2$), the
        previous tractions vanish entirely (initiation of contact), in
        other cases (${\tt T}=0, 3$), they will not be used.
\item[3$^*$] -- new iteration; leave previous tractions \magenta{and forces }untouched.
\end{description}
$^*$ Previous tractions are relevant only in transient shifting or rolling,
${\tt T}=1$ or $2$. \magenta{Previous forces are relevant for the damping
model, ${\tt M}_2>0$.}

\item[B - BOUND]  \label{b-digit}  : selects the approach to be
        used for the normal problem, the {\em traction bound\/}:
\begin{description}
\item[0] -- full linearly elastic model and contact conditions;
\magenta{
\item[1] -- full linearly elastic model, extended with a thin, compressible
        elastic layer, with full contact conditions (\S \ref{sec:thin_sheet});
}
\item[2$^\dagger$$^*$] -- elliptical traction bound derived from Hertzian
        problem data (requires ${\tt IPOTCN}<0$);
\item[3$^\dagger$$^*$] -- parabolical traction bound derived from Hertzian
        problem data (requires ${\tt IPOTCN}<0$);
\item[4$^\dagger$$^*$] -- simple double half-elliptical contact area and
        pressure distribution (SDEC \cite{Piotrowski2017}, requires
        ${\tt IPOTCN}=-6, {\tt N}=1$);
\item[5$^\dagger$] -- non-Hertzian approximation of the normal contact problem
        using the Kik-Piotrowski approach with Ellipse Correction (KPEC,
        \S \ref{sec:fast_detailed}).
\item[6$^\dagger$] -- non-Hertzian approximation of the normal contact problem
        using a modified ANALYN method.
\end{description}
$^\dagger$ Options 2 to 6 are approximate by nature. They are primarily meant
to be used together with FASTSIM (${\tt M}=2, 3$).

$^*$ Options ${\tt B}=2$ to 4 are not yet available in module 1.

\item[T - TANG]  \label{t-digit}  : specifies the {\em type of problem\/}
        to be solved, especially concerning the {\em tangential part\/}:
\begin{description}
\item[0] -- frictionless compression: no tangential tractions
        required, normal problem only;
\item[1] -- frictional compression, shift, or transient rolling with
        material-fixed coordinates. One-step (initiation) or multi-step
        (continuation) depending on the {\tt P}-digit;
\item[2] -- transient rolling using moving (contact-fixed) coordinates,
        using the {\tt P}-digit to set the previous tractions;
\item[3] -- steady state rolling, using the so-called direct method.
\end{description}

\item[N$_1$ - NORM]  \label{n1-digit}  : specifies whether the {\em vertical\/}
        wheelset {\em position\/} or vertical {\em force\/} is prescribed:
\begin{description}
\item[0] -- vertical position \var{Z\_WS} prescribed;
\item[1] -- total vertical force \var{FZ} prescribed.
\end{description}

\magenta{
\item[F$_1$ - FORCE] \label{f1-digit} : specifies the type of {\em
        tangential forces\/} that are prescribed:
\begin{description}
\item[0] -- using prescribed wheel-set positions and velocities rather than
        tangential forces;
\item[1] -- total force \var{FX\_WS} prescribed instead of pitch velocity
        $\omega_{ws}=\var{VPITCH}$, that will be determined.
%\item[2] -- total moment \var{MY\_WS} prescribed instead of pitch velocity
%        $\omega_{ws}=\var{VPITCH}$, that will be determined.
\item[3] -- use of massless rail model with rail deflections {\tt DYDEFL},
        {\tt DZDEFL} that will be determined, instead of fully prescribed
        lateral/vertical rail positions. Currently available only in
        combination with ${\tt N}_1=1$.
\end{description}
}

\item[S - STRESS]\label{s-digit} : determines the operation of the subprogram
        STRESS for calculating {\em subsurface stresses\/} per case:
\begin{description}
\item[0] -- no subsurface stresses required for this case;
\item[1] -- compute the stresses in the points already stored in memory;
\item[2] -- read new control-digits for the subsurface calculation,
        compute stresses in the points already stored in memory;
\item[3] -- read new subsurface points, and compute subsurface
        stresses for these points.
\end{description}

\end{description}
The {\tt F}-digit is not yet available in module 1.
\magenta{(the ${\tt F}_1$-digit is experimental.)} 
This is described in the input for module 3 below.

The second control word `{\bf VLDCMZE}' is used to configure the different
aspects of the contact problem: materials, friction, discretization and
geometry.
\begin{description}
\item[V - VARFRC]   \label{v-digit} : concerns the {\em variation\/} of
{\em friction\/} across the rail profile:
\begin{description}
\item[0] -- a single set of inputs is used across the entire width of
        the rail;
\item[1] -- multiple sets of inputs are used, varying the coefficient of
        friction across the rail profile.
\magenta{
\item[2] -- multiple sets of inputs are used, per row of the potential contact.
}
\end{description}
\magenta{Option ${\tt V}=1$ is used in module 1 while ${\tt V}=2$ is used
for module 3. In module 3, friction is varied in lateral ($y$ or $s$)
direction.}

\item[L - FRCLAW]   \label{l-digit} : concerns the {\em friction law\/} to
be used:
\begin{description}
\item[0] -- Coulomb friction with static and kinetic friction coefficients;
\item[1] -- maintain the same friction method as in the previous case;
\magenta{
\item[2] -- friction law with linear/constant dependency on slip velocity;
\item[3] -- friction law with rational dependency on slip velocity;
}
\item[4] -- friction law with exponential dependency on slip velocity.
\magenta{
\item[5] -- friction law with exponential dependency on slip velocity,
        inputs according to Polach;}
\item[6] -- friction law with piecewise linear dependency on surface
        temperature;
\end{description}

\item[D$_1$ - DISCNS]   \label{d-digit-m1} : concerns the {\em type of grid\/}
        and its {\em discretisation\/}:
\begin{description}
\item[0, 1] -- maintain the same approach as used in the previous case;
\item[2] -- planar contact approach, \magenta{using the contact locus,
        weighted center and weighted angle (wgt-wgt-2), }with rigid
        slip/creepage on contact reference plane;
\magenta{
\item[3] -- planar contact approach, with rigid slip on actual wheel/rail
        surfaces;
}
\item[4] -- conformal contact approach with curved $(x,\tilde{s},
        \tilde{n})$-coordinates and corresponding rigid slip calculation;
\item[5] -- same as 2, using brute force, grid-based algorithm instead of
        contact locus.
\magenta{
\item[6] -- same as 5, using a larger grid supporting steep slopes, esp.\
        for guard rail contacts;
\item[7] -- same as 2, using a the initial contact point and local contact
        angle (icp-loc);
\item[8] -- same as 2, using a hard-coded oblique view direction;
\item[9] -- same as 5, using a hard-coded oblique view direction.
}
\end{description}
New inputs are read when ${\tt D}_1=2,\magenta{3,}4$ or $5$\magenta{, 
$6,8$ or $9$}.

\item[C$_3$ - INFLCF] \label{c3-digit} : concerns the material parameters
        and corresponding {\em influence coefficients\/}:
\begin{description}
\item[0, 1] -- maintain the same approach as used in the previous case;
\item[2] -- using analytical influence coefficients for the 
        half-space with piecewise constant tractions;
        read parameters from file and compute new influence coefficients;
\item[3] -- using analytical influence coefficients for the half-space with
        bilinear tractions; read parameters from file and compute new
        influence coefficients;
\item[4] -- using influence coefficients for conformal contact, based on the
        half-space with angle correction (Blanco-approach
        \cite{BlancoLorenzo2016,BlancoLorenzo2021a-inflcoef}, experimental).
\magenta{
\item[5] -- reserved for layered half-spaces.
}
\item[9$^*$] -- using numerical influence coefficients; read parameters and
                filename, read pre-computed influence coefficients
                from file.
\end{description}
$^*$ Option ${\tt C}_3=9$ is not available in module 1.

\item[M - MATER1] \label{m-digit} : type of {\em material model\/} to
        be used
\begin{description}
\item[0] -- purely elastic contact (\S \ref{sec:lin_elast});
\magenta{
\item[1] -- viscoelastic contact (\S \ref{sec:visc_elast});
}
\item[2] -- simplified theory with a single, user-defined flexibility value
        (modified Fastsim, \S \ref{sec:fastsim});
\item[3] -- simplified theory with three automatically computed flexibility
        values (modified Fastsim, \S \ref{sec:fastsim});
\item[4] -- elastic contact with interfacial layer and near-surface plastic
        deformation (\S \ref{sec:intfc_layer}).
\magenta{
\item[5] -- reserved for pseudo-viscous damping;
\item[6] -- reserved for two quarter-spaces with vertical gap in between.
}
\end{description}

\item[Z$_1$ - ZTRACK] \label{z1-digit}: concerns the {\em track\/} design {\em
        geometry\/}, rail profile and optional rail deviations:
\begin{description}
\item[0] -- maintain track dimensions, rail profile and deviations;
\item[1] -- read new track dimensions;
\item[2] -- read new rail deviations for the current side of the track;
\item[3] -- read new track dimensions, and read the profile and rail
        deviations for the current side of the track (dependent on 
        ${\tt C}_1$-digit).
\end{description}

\item[E$_1$ - EWHEEL] \label{e1-digit} : concerns the {\em wheelset
        geometry\/}, position and velocity data, and the wheel profile:
\begin{description}
\item[0] -- maintain wheelset geometry, position and velocity data, and the
        wheel profile;
\item[1] -- read new position data;
\item[2] -- read new position and velocity data;
\item[3] -- read new position and velocity data, new wheelset geometry,
        and read the wheel profile for the current side of the wheelset
        (dependent on ${\tt C}_1$-digit);
\item[4] -- read new position and velocity data, including flexible
        wheelset deviations;
\item[5] -- read new position and velocity data, new wheelset geometry,
        wheel profile, and read flexible wheelset deviations.
\end{description}

\magenta{
\item[M$_2$ - MATER2] \label{m2-digit} : type of {\em material model\/} to
        be used with respect to damping:
\begin{description}
\item[0] -- no damping;
\item[1] -- maintain the same approach and parameters as used in the
        previous case;
\item[2] -- read new input data, and activate the force based proportional
        damping method (\S \ref{sec:damping}).
\end{description}
}

\end{description}

The third control word `{\bf XHGIAOWR}' concerns the output of
the program and the flow of the calculations.
\begin{description}
\item[X - XFLOW] \label{x-digit} : govers the extent of {\em extra
        (debug)\/} grid data printed to the output-file:
\begin{description}
\item[0] -- no additional debug output needed for this case;
\item[1] -- read new input for configuration of debug outputs.
\end{description}

\item[H - HEAT]\label{h-digit} : determines the calculation of surface
        temperatures:
\begin{description}
\item[0] -- no surface temperature calculation required for this case;
\item[1] -- compute surface temperatures for parameters stored in memory;
\item[3] -- read new input data, and activate the surface temperature
        calculation for steady rolling.
\end{description}

\item[G - GAUSEI] \label{g-digit} : used for fine-tuning of the {\em iterative
        solvers\/}, particularly for the tangential problem.
\begin{description}
\item[0] -- use the default solver (SteadyGS when ${\tt T}=3$,
        otherwise use TangCG) with default $\omega$'s, read max.\
        iterations from input file;
\item[1] -- maintain the solver settings as used in the previous case;
\item[2] -- use ConvexGS at all times, read $\omega$'s from input file;
\item[3] -- use SteadyGS when possible (${\tt T}=3$), read $\omega$'s from
        input file.
\item[4] -- use the default solver, read parameters for slip velocity
        iteration (page \pageref{itm:slip_veloc}) from input file.
\item[5] -- use GDsteady when possible (${\tt T}=3$), read parameters
        from input file (experimental).
\end{description}

\item[I - IESTIM] \label{i-digit} : governs the {\em initial estimate\/}:
\begin{description}
\item[0] -- previous case does not provide a good initial estimate. Start
        from zero tractions and fill element division with a rough guess,
        based on the undeformed distance;
\magenta{
\item[1] -- use previous solution, regularize tractions. The element
        division of the previous case is used as initial estimate, and the
        tractions are adjusted to this state;
\item[2] -- use normal part of previous case only. The normal tractions are
        maintained, but all elements start with zero tangential tractions,
        in the adhesion area;
}
\item[3] -- previous case gives a good initial estimate. Use its tractions
        and element division (not touched).
\end{description}

\item[A - MATFIL, surface tractions] \label{a-digit} : governs the use of
        the {\em Matlab-file\/} {\tt <experim>.\-<case>\-.mat}:
\begin{description}
\item[0] -- the {\tt mat}-file is not created;
\item[1] -- the detailed results of the case are written to a Matlab-file
        {\tt <experim>.<case>.mat}, for points inside the contact area;
\item[2] -- the detailed results are written for all points of the potential
        contact area.
\end{description}
Note: a separate {\tt A}-digit is maintained to control the output
of the subsurface stress calculation, as described in Section
\ref{sec:subsurf_control}.

\item[O - OUTPUT, surface tractions] \label{o-digit} : governs the extent
        of the output to the {\em output-file\/} {\tt <experim>\-.out}:
\begin{description}
\item[0] -- no results are printed to the output-file (derived quantities
        {\em are\/} computed, and stored in internal memory for use in
        other calculations);
\item[1] -- minimum output is printed, just the global results;
\item[2] -- the global input and output quantities are printed;
\item[3] -- a picture is shown of the contact area and its division into
        adhesion and slip areas; in conformal contacts (${\tt D}_1=4$),
        the curved reference surface is printed;
\item[4] -- the wheel and rail profiles are printed as used in the
        calculations, after smoothing, in track coordinates;
\item[5] -- the detailed solution inside the contact area (tractions, slip,
        and other quantities of interest) is printed as well;
\item[6] -- the detailed solution is printed for all elements of the
        potential contact.
\end{description}
You may typically set ${\tt O}=2$ or 3 and ${\tt A}=0$ to get the global
results of all cases, and then use ${\tt A}=1$ for the cases that you want to
investigate in detail with the Matlab plot-programs.

Note: a separate {\tt O}-digit is maintained to control the output
of the subsurface stress calculation, as described in Section
\ref{sec:subsurf_control}.

\item[W - FLOW] \label{w-digit} : governs the extent of the {\em flow
        trace\/} to the screen and the output-file:
\begin{description}
\item[0] -- no flow trace printed, except the case number;
\item[\hspace{-4mm}1-6] -- number of iteration processes to show flow trace for: 
        (1) outer loop for total forces (module 1) and Panagiotopoulos'
        process (module 3), (2) the loop for friction dependent on slip
        velocity or temperature, (3) the NORM and TANG algorithms, 
        (4) New\-ton-Raph\-son procedures, (5) iterative procedures
        ConvexGS and SteadyGS, (6) iterative NormCG solver.
\item[9] -- full flow trace, including intermediate pictures of the element
        divisions.
\end{description}
Usually the levels 3 and 4 are most convenient.

\item[R - RETURN] \label{r-digit} : {\em return\/} to main program.

Modules 1 and 3 are organized so that you stay in one module until you
give a sign that you do not want so. This sign can be given with the
{\tt R}-digit. It is also possible to skip cases in the input-file.
\begin{description}
\magenta{
\item[0] -- calculate the solution, then stay in the same module for the
        next case;
}
\item[1] -- calculate the solution, return to the main program after this
        case;
\magenta{
\item[2] -- perform preprocessing actions only (skip this case), then stay
        in the same module for the next case;
}
\item[3] -- perform preprocessing actions only (skip this case), return to
        the main program after this case.
\end{description}

\end{description}

A fourth control word `{\bf PSFLCIN}' is used when ${\tt X}=1$, configuring
the debug outputs from different parts of the code. This consists primarily
of the level of output. Additional configuration may be added later on
subsequent lines.

\begin{description}
\item[XP - X\_PROFIL] : determines print-output from profile processing

\item[XS - X\_SMOOTH] : determines print-output from spline processing

\item[XF - X\_FORCE] : determines print-output from total force iteration

\item[XL - X\_LOCATE] : determines print-output from contact location

\item[XC - X\_CPATCH] : determines print-output on contact patches

\item[XI - X\_INFLCF] : determines print-output on influence coefficients

\item[XN - X\_NMBDG] : determines print-output from contact solvers
\begin{description}
\item[0-3] -- none;
\item[4] -- global problem inputs {\tt hs} and outputs {\tt igs}, {\tt ps},
        {\tt us} (?);
\item[5] -- intermediate results of the Panagiotopoulos' process (?);
\item[6] -- intermediate results of Veloc.dep iterations (?);
\item[7] -- intermediate results of NORM and TANG algorithms (?); print influence coefficients as well;
\item[8] -- intermediate results of Newton-Raphson loops (?);
\item[9] -- information per iteration of NormCG, TangCG, ConvexGS, SteadyGS (?).
\end{description}

\magenta{
\item[XR - X\_READLN] : determines print-output on readline
\begin{description}
\item[0] -- errors only;
\item[1] -- warnings, information messages;
\item[$\mathbf{\ge 4}$] copy inputs.
\end{description}
}

\end{description}

\subsection{Module 3 -- basic Hertzian and non-Hertzian contact}

The input for module 3 is largely the same as described for module 1 above.
Additional functionality is provided via the {\tt F}-digit, whereas the
functionality of the {\tt N}-digit is changed:

\begin{description}
\item[N$_3$ - NORM]  \label{n3-digit} : specifies whether the {\em normal
force\/} or {\em approach\/} is prescribed:
\begin{description}
\item[0] -- approach \var{PEN} (penetration) prescribed;
\item[1] -- total normal force \var{FN} prescribed.
\end{description}

\item[F$_3$ - FORCE] \label{f3-digit} : specifies the number of {\em
        tangential forces\/} that are prescribed:
\begin{description}
\item[0] -- creepages \var{CKSI} and \var{CETA} prescribed;
\item[1] -- total force \var{FX} and creepage \var{CETA} prescribed;
\item[2] -- total forces \var{FX} and \var{FY} prescribed.
\end{description}
\end{description}

In module 3, the {\tt D}-, {\tt Z}- and {\tt E}-digits are used to
describe the grid, geometry and rigid slip, like in module 1,
however, the meaning of these digits is different from the earlier
interpretation. 
\begin{description}
\item[D$_3$ - DISCNS] \label{d3-digit} : concerns the {\em potential contact
        area\/} and its {\em discretisation\/}:
\begin{description}
\item[0] -- maintain the potential contact area and discretisation of the
        previous case;
\item[1] -- form the discretisation from parameters in storage;
\item[2] -- read input parameters and form the discretisation correspondingly.
\end{description}

\item[Z$_3$ - RZNORM] \label{z3-digit} : concerns the right hand side of the
        normal problem, the {\em undeformed distance\/}:
\begin{description}
\item[0] -- maintain undeformed distance and planform of the previous case;
\item[1] -- form undeformed distance from parameters in storage;
\item[2] -- read new parameters and compute undeformed distance.
\end{description}

\item[E$_3$ - EXRHS] \label{e3-digit} : the {\em extra term\/} of the {\em
        rigid slip\/}, the right hand side of the tangential problem:
\begin{description}
\item[0] -- set the extra term equal to zero;
\item[1] -- maintain the extra term of the previous case;
\item[9] -- read a new extra term from the input (file).
\end{description}

\end{description}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Description of input quantities for WR-processing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Module 1: wheel/rail contact}
\label{chp:module1}

This chapter describes the input and output quantities of CONTACT that are
specific to module 1 for wheel/rail contact processing. The additional
inputs that are needed for generic non-Hertzian contact (module 3) are
described in Chapter \ref{chp:module3}.

\section{Overview of wheel/rail contact configurations}
\label{sec:wr_coords}

\paragraph{Track coordinates}

\begin{figure}[bt]
\centering
\psfig{figure=fig/world_coords,width=3.8in,trim=160 265 120 220,clip=}
\caption{\em Track viewed in world-fixed coordinates, illustrating rail
distance $d$, rail width $w$, gauge width $G$, and track inclination
(track cant, elevation) angle $\phi$ (adapted from \cite{Shabana2008}).}
\label{fig:world_coords}
\end{figure}

Wheel-rail contact analysis starts from a track as illustrated in Figure
\ref{fig:world_coords}. This shows the track plane resting on the two
rails, that may be inclined (canted) with respect to the overall horizontal
direction. 

\begin{figure}[bt]
\centering
\psfig{figure=fig/fc_coord_sys3,width=3.2in,trim=190 120 140 110,clip=}
\psfig{figure=fig/fc_coord_sys,width=3.2in,trim=150 90 90 70,clip=}
\caption{\em Left: perspective view, right: top view on the track,
        illustrating a track curve $\vecGamma(s)$ with `fixed curvilinear'
        track coordinates `$fc$' (red) versus `moving rectilinear' track
        coordinates `$tr$' (green).}
\label{fig:fc_coords}
\end{figure}

Figure \ref{fig:fc_coords} shows a world-fixed global reference system
`$isys$' with an arbitrary track section. The track center line is indicated by
$\vecGamma(s)$ and shown by the red curve. Curvilinear coordinates are
developed around this track curve. On the curve we have $x_{fc}=s, 
y_{fc}=z_{fc}=0$, and the origin $O_{fc}$ is placed at $s=0$. These
coordinates are fixed with respect to $isys$ and are called the
`fixed curvilinear' coordinate system `$fc$'.

A moving rectilinear `track coordinate system' `$tr$' is introduced for the
contact computation. The track origin is placed on the track
curve at the point closest to the wheelset center, see e.g.\ 
\cite{Malvezzi2008}. This position is denoted here as $s_{ws}$, with $s$
($s_1$, longitudinal) the parameter used to describe the track curve.

\begin{figure}[bt]
\centering
\psfig{figure=fig/track_coords,width=4.1in,trim=140 255 100 170,clip=}
\caption{\em CONTACT considers half of the track, either the left or the
        right side. When using the gauge point computation, the track
        coordinate system `$tr$' is placed at the center of the plane resting
        on the (inclined) rails in initial (design) configuration.}
\label{fig:track_coords}
\end{figure}

The moving track coordinate system $tr$ is defined further as shown in
Figure \ref{fig:track_coords}. The $x_{tr}$ direction (also: $x_{track}$) is
aligned with the track center line. Right-handed coordinates are used with
positive $z_{tr}$ pointing downwards.

\paragraph{Half wheelset on half track model}

Each `case' in CONTACT considers a half wheelset on a half track. The side
that's considered is governed by the CONFIG control digit (${\tt C}_1$,
page \pageref{c1-digit}).

Inside the program, calculations for the left side are solved using
an equivalent right side configuration. This shows up in print output for
the flow of computations that is given for this mirrored situation. The
mirroring is undone in the final print output and {\tt mat}-file showing
the results of the computation.

\paragraph{Gauge point computation}

\begin{figure}[bt]
\centering
\psfig{figure=fig/rail_coords,width=2.8in,trim=70 10 50 20,clip=}
\psfig{figure=fig/rail_irreg,width=2.8in,trim=70 10 50 20,clip=}
\caption{\em Left: initial (design) placement of the right rail profile in
        the track system using the gauge point. Right: actual
        (current) configuration with rotation $\Delta\phi_{r}>0$ and
        displacements $\Delta z_{r}, \Delta y_{r}>0$.}
\label{fig:rail_coords}
\end{figure}

In case the rails are placed symmetrically with respect to the track
origin, the position of the rail profile (datum) in the track system can
be computed automatically. This uses the gauge width between the inner
faces of the two rails (i.e.\ the grey stops in Figure
\ref{fig:track_coords}).  Figure \ref{fig:rail_coords} (left) shows the
right rail as it is seen in the track system. This rail has an installation
angle of $-2.9^\circ$ corresponding to a cant of $1:20$. The profile is
specified with respect to the rail origin $O_{rail}$ (datum, denoted also
$O_{r}$). It is first rotated for cant and then shifted up to just touch
the track plane and shifted left to touch the gauge stop. Note that
$O_{rail}$ may be associated with the highest point in the uncanted rail,
which need not be the highest point on the rail after cant is applied.

\paragraph{Absolute rail placement}

An alternative to the gauge point computation is to use absolute rail
placement. The rail profile is specified with respect to an origin $O_r$.
It is rotated for cant. After this, the origin $O_r$ is shifted to the
position $[0,y_{r(tr)},z_{r(tr)}]^T$ specified by the user. $y_{r(tr)}$
will be $<0$ on the left side and $>0$ for the right rail.

\paragraph{Track deviations}

Track irregularities may be defined that displace the rail with respect to
its initial (design) position and orientation, see Figure
\ref{fig:rail_coords}, right. The rail is rotated about its origin
$O_{rail}$ by roll angle $\Delta\phi_{r}$, and is shifted by $\Delta
y_{r},\Delta z_{r}$ with respect to the track origin, which isn't
affected by the irregularities. Note that the rail typically will not be
touching the track plane anymore.

These rail irregularities may be static/permanent, but may be due to track
flexibility too. In such a case, the corresponding velocities
$v_{y,r}=\Delta\dot{y}_{r}, \ldots$ may be specified also.

\magenta{
\paragraph{Massless rail model}

Rail deflections may be computed resulting from the lateral and
vertical contact forces.
\begin{eqnarray}\label{eq:cntc_defl}
   F_{y(tr)} - k^*_y \delta y_{defl} + F^*_y = 0 &\leftrightarrow&
   \delta y_{\defl} = \frac{F_{y(tr)} + F^*_y}{ k^*_y } , \\
   F_{z(tr)} - k^*_z \delta z_{defl} + F^*_z = 0 &\leftrightarrow&
   \delta z_{\defl} = \frac{F_{z(tr)} + F^*_z}{ k^*_z } .
\end{eqnarray}
Here $F_y^*, F_z^*$ are prescribed external forces on the rail.
This can be used to implement a massless rail with stiffness and damping:
\begin{equation}\label{eq:massless}
   F_{y(tr)}^{n+1} + F^{n+1}_{\defl,y} = 0, \;\;
   F^{n+1}_{\defl,y} = -k_y \delta y^{n+1}_{defl} - c_y \frac{\delta
        y^{n+1}_{defl} - \delta y^n_{defl}}{ \delta t }
\end{equation}
Here $F_{y(tr)}^{n+1}$ is the contact force on the rail, at the end of a
time step in a time integration procedure, $F_{\defl,y}$ the lateral force
from the ground on the rail, with balance equation $\sum F=0$.
Equation (\ref{eq:cntc_defl}) corresponds to (\ref{eq:massless}) with
\begin{equation}
   k^*_y = k_y + \frac{c_y}{\delta t}, \;\; 
   F^*_y = \frac{ c_y \delta y^n}{\delta t} .
\end{equation}
}

\paragraph{Roller rig configurations}

\begin{figure}[bt]
\centering
\psfig{figure=fig/rollerrig_coords,width=3.3in,trim=125 100 95 155,clip=}
\caption{\em Definition of track coordinates for the simulation of a roller
        rig: aligned with the rollers' axle, at a distance $r_{nom,r}$ above
        the rollers' center position.}
\label{fig:rollerrig_coord}
\end{figure}

For the simulation of roller rigs, it is assumed that the roller axle is
fixed in a frame, unable to move except for rotation about its axle. Track
coordinates are used largely similarly as above for wheelset on track
configurations, with slight differences as indicated in Figure
\ref{fig:rollerrig_coord}:
\begin{itemize}
\item The track plane is aligned with the rollers' axle, at the nominal
        roller radius $r_{nom,r}$ above the rollers' center position;
\item The reference point $(0,0)$ of the rail profile is placed in the
        track plane, without shifting to make the profile touching the
        track plane. Non-zero $z$-values in the profile are thus
        interpreted as offsets to the nominal rolling radius $r_{nom,r}$.
\end{itemize}
The cant angle is difficult to interpret in this configuration, and will be
ignored.

Figure \ref{fig:rollerrig_coord} concerns the initial (design)
configuration. In the actual (current) configuration, the rail profiles
may be rotated and displaced by rail deviations. This feature may also be
used to describe the motion of the roller rig as a whole, relative to the
frame in which it is contained.

\paragraph{Switches and crossings}

For the simulation of switches and crossings, so called `variable profiles'
may be used, that consist of multiple `slices' at different $s_{fc}$
positions along the track curve. CONTACT will read the slices and
interpolate to the actual position of the wheelset along the track curve.

\paragraph{Wheelset geometry}

Wheel profiles are specified relative to profile reference points
$O_{wheel}$ ($O_w$). In initial (design) configuration, the profile
reference is placed at $[0, \pm (d_{flng}/2-y_{fbpos}), r_{nom,w}]^T$ with
respect to the wheelset center (Figure \ref{fig:wheel_coord}, left). Here
$d_{flng}$ is the flange-back distance, and $y_{fbpos}$ is the position of
the flange back with respect to the profile reference. 

% It is convenient if the wheel origin is located at the tape circle line,
% with $[0,0]^T$ a point on the wheel profile, yet other choices are
% possible for the wheel origin also.
% Note that the nominal radius $r_{nom,w}$ concerns the distance from the axle
% to the profile reference point. This point doesn't have to lie in the surface
% per se.

\paragraph{Flexible wheel profile displacements}

Flexible wheelset deviations may be defined that displace the wheel
profile with respect to its design position and orientation.
Increments may be specified for all six position and orientation variables
to support axle and wheel bending and torsion. The corresponding velocities
may be specified as well.

\paragraph{Wheelset degrees of freedom}

\begin{figure}[bt]
\centering
\psfig{figure=fig/wheelset_def,width=2.6in,trim=180 20 118 50,clip=}
\hspace{10mm}
\psfig{figure=fig/wheelset_pos,width=2.6in,trim=180 20 135 10,clip=}
\caption{\em Left: illustration of the parameters used for the geometry of
        a half wheelset. Right: wheelset center (reference) position,
        and orientation with respect to the track system.}
\label{fig:wheel_coord}
\end{figure}

The position of a wheelset is characterized by the position of its center
along the track curve ($s_{ws}$, $fc$-coordinates), which is irrelevant to
CONTACT except for switches and crossings, and the position $y_{ws},
z_{ws}$ and orientation $[\phi_{ws}, \psi_{ws}, \theta_{ws}]$ with respect
to the $tr$ track reference (Figure \ref{fig:wheel_coord}, right). The
orientation is defined with Euler angles in roll--yaw--pitch convention:
starting with the axle parallel to the $y_{tr}$-direction, the wheelset is
rolled about its $x$-axis by $\phi_{ws}$, then yawed by $\psi_{ws}$ about
the new vertical axis $z_{wset}$ and then pitched by $\theta_{ws}$ about
the axle, i.e.\ the new $y_{wset}$-axis. After this the wheelset is shifted
to its position $[0,y_{ws},z_{ws}-r_{nom,w}]^T$.

\paragraph{Wheel out-of-roundness}

\begin{figure}[bt]
\centering
\psfig{figure=fig/wheel_theta1,width=2.2in,trim=200 40 150 45,clip=}
\hspace{10mm}
\psfig{figure=fig/wheel_theta2,width=2.2in,trim=200 40 150 45,clip=}
\caption{\em Left: definition of cylindrical coordinates $(\theta_{wc},
        y_{wc},r_{wc})$ on a wheel for wheel out-of-roundness. Right:
        rotation by the wheelset pitch angle $\theta_{ws}$.}
\label{fig:wheel_theta}
\end{figure}

Out-of-round wheels may be defined using cylindrical coordinates as
illustrated in Figure \ref{fig:wheel_theta}, left, with radius
$r_{wc}=r_{nom,w}+dr_{wc}$, with profile heights $dr$ given as a function
$dr_{wc}(\theta_{wc},y_{wc})$. This is provided to
CONTACT using multiple slices at different $\theta_{wc}$ positions
around the circumference. CONTACT will read the slices and interpolate
as needed to form a 3D surface for the contact calculation.

\paragraph{Single wheel-rail configuration}

Using the mechanisms outlined above, single wheel/rail configurations can
be computed as well.
\begin{itemize}
\item The gauge width computation of Figures \ref{fig:track_coords} and
        \ref{fig:rail_coords} is disabled using a negative value for the
        gauge measuring height, e.g.\ $g_{height}=-1$;
\item Next, the track center is associated with the rail profile reference
        using absolute rail placement with $y_{r(tr)}=z_{r(tr)}=0$;
\item Finally, the wheel profile marker is placed directly under the
        wheelset center (Figure \ref{fig:wheel_coord}), using
        $d_{flng}=2 y_{fbpos}$, such that $y_{wheel}=d_{flng}/2-y_{fbpos}=0$.
\end{itemize}

\paragraph{Kinematic configuration}

CONTACT focuses on contact problems instead of the balance (equilibrium)
or motion (dynamics) of the whole wheelset. Each case of the simulation
therefore concentrates on a single wheel/rail combination. When using
CONTACT from a vehicle dynamics simulation, the full position and velocity
states are typically prescribed beforehand. Alternatively, some
total forces may be specified also, which is particularly useful in
stand-alone calculations.

\section{Inputs regarding wheel and rail profiles}
\label{sec:profiles}

Wheel and rail profiles may be obtained from various sources, in different
formats and using different conventions. Different options are provided
to read existing files and transform into the form as needed by CONTACT.

\paragraph{Supported formats}

Constant rail profiles may be provided in SIMPACK {\tt prr}-format or Miniprof
{\tt ban}-format, with the format taken from the file extension, or as a
2-column table with $(y_i,z_i)$-values if another file extension is used.
Variable rail profiles may be provided in a slices-file with {\tt
slcs} file extension. Constant wheel profiles may be provided in SIMPACK
{\tt prw}-format or Miniprof {\tt whl}-format, with the actual format taken
from the file extension, or as a 2-column table if another file extension
is used. Out-of-round wheels may be provided in a slices-file with {\tt
slcw} file extension.
\begin{inputvars}
\inpvar{RFNAME}{\bunit{-}}{Input filename for a rail profile.}
\inpvar{WFNAME}{\bunit{-}}{Input filename for a wheel profile.}
\end{inputvars}

\paragraph{Form as needed by CONTACT}

Profiles are transformed into a canonical form to simplify usage and
processing in CONTACT. This form considers the wheel and rail on the right
side of the wheelset and track, with lateral $y$-coordinates increasing
towards the field side. Optional mirroring is provided for cases where
left side profiles are given in the actual files. 

The canonical form uses $\unit{mm}$ as the unit of length and has positive
$z$ pointing downwards. Optional scaling and mirroring are provided to
bring the data into this form. For rails, points will be ordered from the
track center to the field side, with $y_r$ coordinates in ascending order,
whereas for wheels, $y_w$ will be in descending order. This makes that going
through the points, the material stays on the right hand side.
The points are reordered automatically if needed to get them in the right
order.
\begin{inputvars}
\inpvar{MIRROR\_Y}{\bunit{-}}{Use the profile as is ($-1$ or $0$) or mirror
        $y$-values (1).}
\inpvar{MIRROR\_Z}{\bunit{-}}{Auto-detect whether mirroring of $z$-values is
        needed (0, default), use the profile as is ($-1$), or mirror its
        $z$-values (1).}
\inpvar{SCALE\_YZ}{\bunit{-}}{Scale factor for unit conversion, e.g.\ 
        ${\tt scale\_yz}=1000$ to convert profile values given in $\bunit{m}$
        to $\bunit{mm}$.} 
\end{inputvars}
SIMPACK profiles are processed first according to the options that are
specified in the {\tt prr}- or {\tt prw}-file (mirroring, reordering,
clipping), except smoothing. After this, the conversions specified in the
{\tt inp}-file are also applied, concerning mirroring, scaling, and
smoothing. Miniprof profiles have no options specified in the {\tt ban}-
and {\tt whl}-files themselves. They are subject to the conversions
specified in the {\tt inp}-file provided to CONTACT.

\paragraph{Curation of anomolous input data}

\begin{figure}[bt]
\centering
\psfig{figure=fig/profile_errors,width=4.8in,trim=150 70 130 30,clip=}
\caption{\em Challenging features that may occur in wheel and rail input
        profiles.}
\label{fig:profile_errors}
\end{figure}

Before the application of profile smoothing, CONTACT will try to detect and
resolve specific aspects in the input data. A number of possible situations is
shown in Figure \ref{fig:profile_errors}.
\begin{itemize}
\item Figure \ref{fig:profile_errors} (a) shows a profile containing a loop,
        with different segments crossing each other. CONTACT will detect
        such cases and reject the profile with an error code/error message.
\item Figure \ref{fig:profile_errors} (b) shows a `zig-zag pattern' that
        happens due to improper stitching of profile sections. The same
        point is repeated as the end-point of one section and the beginning
        of the next one, with slight offset in coordinate values. CONTACT
        will detect this pattern, delete the two points, and replace by the
        average of the two.
\item Figure \ref{fig:profile_errors} (d) shows irregular data in a wheel
        profile, at the bottom of the flange. This happens due to the
        measurement system producing mixed signals in this region.
        The feature may be kept in the profile as long as there's no
        contact at the bottom of the flange. Else, it may be attenuated or
        removed using profile smoothing.
\item Figure \ref{fig:profile_errors} (c) shows a wheel profile with an
        anomalous `dolphin nose shape'. This may have been introduced by
        discarding of points with apparent measurement error (cf.\ situation
        (d)) followed by agressive smoothing. CONTACT cannot detect and
        repair this situation.
\item Figure \ref{fig:profile_errors} (e) shows a local dent in the rail
        side face. It is up to the user to decide whether this feature
        is real and should be kept in the profile, or unwanted and to be
        corrected by smoothing.
\item Figure \ref{fig:profile_errors} (f) shows a sharp corner in a
        profile used for deep groove rolling. Similar corners may occur
        at the transition from a roller surface to the side faces, and
        should be maintained in the profile smoothing procedure.
\end{itemize}
The zig-zag pattern of Figure \ref{fig:profile_errors} (b) is detected on
the basis of changes in surface inclination. A zig-zag is found when both
$|\delta\alpha_i|$ and $|\delta\alpha_{i+1}|$ are larger than the threshold
$\Delta\alpha_{zig}$. 
\begin{inputvars}
\inpvar{ZIGTHRS}{\bunit{rad}}{Angle threshold $\Delta\alpha_{zig}$ for
        detection of the zig-zag pattern. Default $5/6\,\pi\unit{rad}$.
        Should be larger than $\pi/4$, set to $\ge\pi$ to disable zig-zag
        detection.}
\end{inputvars}
The situations of Figures \ref{fig:profile_errors} (d)--(f) are dealt with
by detecting sharp corners, called `kinks', in the input profile. A
distinction is made between `true kinks' that should be kept in the profile
and `roughness' that should be reduced by smoothing. The distinguishing
feature is that true kinks are isolated. A true kink consists of a change
in surface inclination $\delta\alpha_i$ larger than the high threshold,
with no change of inclination $\delta\alpha_j$ in nearby points exceeding
the low threshold. 
\begin{inputvars}
\inpvar{KINKHIGH}{\bunit{rad}}{Angle threshold $\Delta\alpha_{high}$ for
        kink pattern detection. Default $\pi/6\unit{rad}$. Set to $\ge\pi$
        to disable kink detection.}
\inpvar{KINKLOW}{\bunit{rad}}{Angle threshold $\Delta\alpha_{low}$ for
        neighbouring points at kink pattern detection. Default
        $\Delta\alpha_{high}/5$.}
\inpvar{KINKWID}{\bunit{mm}}{Half-width of winduw used for kink pattern
        detection. Default: checking profile points within $2\unit{mm}$ on
        either side of possible kink locations.}
\end{inputvars}

\paragraph{Profile smoothing}

Smoothing of the profiles may be needed to reduce measurement noise or to
suppress small scale features that raise contact pressures in a way
undesired to the purpose of one's simulation \cite{Vollebregt2022b-cm2022}.
Three different smoothing methods are currently provided:
\begin{enumerate}\setcounter{enumi}{-1}
\item An unweighted smoothing spline as presented in
        \cite{Vollebregt2020b-wrgeom}. This method is considered obsolete.
        It is superseded by the weighted splines, and kept in the program 
        chiefly for backward compatibility with earlier versions. 

        In this method, the required value of $\lambda$ depends on the
        number of points in the profile. If a five times higher sampling
        density is used, then $\lambda$ needs to be increased five times
        to get the same level of smoothing. For profiles with more or less
        uniform spacing of the points, this method may be replaced by method 1
        using
\begin{equation}
        \bar{\lambda}^{(2)}=\mathrm{mean}(\delta s_i)\cdot \lambda .
\end{equation}
\item The weighted smoothing spline with parameter $L_{filt}$ and second
        order penalty. Denoting the input profile points as $\vec{x}_i$,
        at arc-length position $s_i$, and the smoothing spline as
        $\vec{f}(s)$, this minimizes the following function:
\begin{equation}
   \sum_i w_i \left( \vec{x}_i - \vec{f}(s_i) \right)^2 + 
                \bar{\lambda}^{(2)} \int \vec{f}''(s)^2 \, ds , \;\;
        w_i = \delta s_i = \frac{s_{i+1}-s_{i-1}}{2} .
\end{equation}
        The first part describes the adjustments made to the input data,
        while the latter part places a penalty on the roughness (curvature)
        of the spline. 

        The value of $\bar{\lambda}^{(2)}$ is computed from the input
        $L_{filt}$ as 
\begin{equation}
        \bar{\lambda}^{(2)}=\left(\frac{L_{filt}}{2\pi}\right)^4 
                \;\;\leftrightarrow\;\;
                L_{filt} = 2\pi \left(\bar{\lambda}^{(2)}\right)^{1/4} .
\end{equation}
        By this approach, the spline
        acts like a low pass filter, diminishing fluctuations with
        wavelengths $L<L_{filt}$ and keeping fluctuations in the output
        with $L>L_{filt}$ \cite{Vollebregt2022b-cm2022}.
\item (Reserved for weighted B-spline smoothing with third order penalty.)
\begin{equation}
        \bar{\lambda}^{(3)}= \left(\frac{L_{filt}}{2\pi}\right)^6 
                \;\;\leftrightarrow\;\;
                L_{filt} = 2\pi \left(\bar{\lambda}^{(3)}\right)^{1/6} .
\end{equation}
%\item Arc-fit smoothing. This considers all points $i$ along the profile
%        one by one. For each $i$, it takes the input points $j$ in a window
%        $s_j\in s_i+[-\delta s_{max},\delta s_{max}]$, with $s$ the
%        arc-length parameter. Suitable weights $w_j$ are set, and a
%        circular arc is fitted using Karim\"aki's algorithm 
%        \cite{Karimaki1991}. The point $i$ is then projected on the
%        resulting circle.

%        The value of $\delta s_{max}$ is computed from the input as $\delta
%        s_{max}=0.8 L_{filt}$. This gives comparable smoothing performance
%        as the weighted spline, with slightly better results at sharp
%        curvature variations in the input profile \cite{Vollebregt2022b-cm2022}.
\end{enumerate}
\begin{inputvars}
\inpvar{ISMOOTH}{\bunit{-}}{Use smoothing method 0 (unweighted spline), 1
        (weighted with 2nd order penalty) or 2 (weighted with 3rd order
        penalty).}
\inpvar{LAMBDA}{\bunit{-}}{Input parameter $\lambda$ for the unweighted
        smoothing spline (${\tt ismooth}=0$), using $\lambda\le 0$ to
        disable smoothing.}
\inpvar{L\_FILT}{\bunit{mm}}{Wavelength $L_{filt}$ for which fluctuations
        are approximately halved by the weighted spline approaches
        (${\tt ismooth}=1, 2$). Set $L_{filt}\le 0$ to disable smoothing.}
\inpvar{SMOOTH}{\bunit{-/mm}}{A single parameter {\tt smooth} is used in
        the input, with $\lambda={\tt smooth}$ when ${\tt ismooth}=0$ and
        $L_{filt}={\tt smooth}$ when ${\tt ismooth}=1, 2$.}
\end{inputvars}

\paragraph{Rail slices-file}

A rail slices-file starts with configuration data, and then gives a list of
rail profiles with corresponding $s_{fc}$ positions along the track curve,
and concludes with information on `features' and corresponding `parts'
in lateral direction.
\begin{alltt}\small
% data for S+C benchmark, UK crossing '56E1-R245-1:9.25'

   0.000    1000.0   S_OFFSET [m], S_SCALE [mm/m]
     148             NSLC
       7    0    0   NFEAT, NKINK, NACCEL
       1             S_METHOD

%  - slice positions S_SLC [m] and filenames RFNAME per slice

 -75.00000   '../switch-benchmark/DataSet1_56E1_v2/Crossing/Crossing_1.txt'
 -49.33684   '../switch-benchmark/DataSet1_56E1_v2/Crossing/Crossing_2.txt'
 -24.66842   '../switch-benchmark/DataSet1_56E1_v2/Crossing/Crossing_3.txt'
  -0.99474   '../switch-benchmark/DataSet1_56E1_v2/Crossing/Crossing_4.txt'
          ...
\end{alltt}
\begin{inputvars}
\inpvar{S\_OFFSET}{\bunit{x}}{Offset $s_{ofs}$ added to input $s_{slc}$
        positions to align with track $s_{fc}$-coordinates as used in
        CONTACT, with dimension `$\unit{x}$' defined by the user.}
% \inpbreak
\inpvar{S\_SCALE}{\bunit{mm/x}}{Multiplication factor to convert input
        $s_{slc}$ positions to $\unit{mm}$.}
\inpvar{S\_SLC}{\bunit{x}}{Input $s_{slc}$-position of a slice along the
        track curve, converted to $fc$ coordinates as $s_{fc} = s_{scale}
        \cdot (s_{ofs} + s_{slc})$.}
\inpvar{S\_METHOD}{\bunit{-}}{Interpolation method used between successive
        slices. Method 1 is to use an interpolating spline, whereas method
        2 uses a more smooth approximation that does not pass through the
        data positions.}
\end{inputvars}
Note that the example has $s_{slc}$-positions in meters, converted to
millimeters using $s_{scale}=1000$. The slices must be given with
$s_{slc}$-positions in increasing order and at least $0.001\unit{mm}$ apart.

\begin{figure}[bt]
\centering
\psfig{figure=fig/uk_interrupt_v1,width=4.0in,trim=20 70 40 110,clip=}
\caption{\em Successive profile slices defining the geometry for a crossing,
        with geometrical features connected into `interpolation paths'.}
\label{fig:slcs_features}
\end{figure}

\paragraph{3D surface building}

The slices will each be resampled to a uniform spacing in order to define
`interpolation paths' in longitudinal direction. To obtain a good 3D
surface model, interpolation paths need to have smooth functions $y(s_{fc}),
z(s_{fc})$, and should therefore not run across sharp geometrical features.
This is steered by dividing slices laterally into different `parts' that are
resampled separately as illustrated in Figure \ref{fig:slcs_features}. The
break points in a slice, also called `features', are $s_f, f=1\cdots
n_{feat}$, with $s_f$ the `summed chord length' to the start of the slice
(see below) given in $\unit{mm}$.

\begin{alltt}\small
%  - S_F positions at geometrical features at start/end of each part per slice
%  S_SLC    S_F [mm],  F = 1 .. NFEAT
          ...
 0.08076     -1      -1       -1       -1       0.      30.27   999.
 0.11395     -1      -1       -1       -1       0.      29.93   999.
 0.11894      0.    18.00    34.51    54.51   110.53   141.01   999.
 0.12393      0.    22.00    36.99    60.49   116.98   147.21   999.
 0.12892      0.    25.74    40.48    66.96   122.92   153.63   999.
          ...
\end{alltt}
In cases where certain features do not occur in a slice, this is indicated
using a negative value for the corresponding $s_f$. This implicitly defines
`interruptions' of the profile in longitudinal direction.

The start and end of the profile are included in the definition of features,
permitting trimming of the input slices. No input is needed when
$n_{feat}\le 1$, using default values $s_1=0$ and $s_2=10^6\unit{mm}$
covering the whole profile. 

For a profile with $n$ points $(y_i,z_i)$ the summed chord length is computed
as
\begin{eqnarray}
    \delta y_i = y_{i+1}-y_i, \;
    \delta z_i = z_{i+1}-z_i, \;
    \delta s_i = \sqrt{ \delta y_i^2 + \delta z_i^2 }, \nonumber \\
    s_1 = 0, \; s_{i+1} = s_i + \delta s_i , \;\;
                i = 1 \cdots n-1.
\end{eqnarray}
This uses the numbering of the points as obtained after mirroring and
reordering, with point $1$ at the track center side of a rail profile
and at the field side of a wheel profile.

The file-structure for slices files is specified in Appendix
\ref{sec:spec_slcs}.

\paragraph{Wheel slices-file}

Wheel slices-files are structured similarly as rail slices files, except
that longitudinal $s_{fc}$ positions along the track curve are replaced
by angles $\theta_{wc}$ around the circumference of the wheel, and
vertical heights $z$ are replaced by radial heights $dr$ with respect to
the nominal radius.

The wheel surface is defined on the domain $\theta_{wc}=[-\pi,\pi)
\unit{rad}$ using periodical extension for evaluation at other values. The
slices file does not need to cover the domain fully, especially for
localized defects such as a wheel flat.  If data are given on a smaller
interval $[\theta_0, \theta_1]$ fully contained in $[-\pi,\pi)$, constant
extrapolation is used for $\theta_{wc}\in [-\pi,\theta_0)$ and
$\theta_{wc}\in(\theta_1,\pi)$. This works best with small derivatives
$\txtfpd{dr_{wc}}{\theta}$ at $\theta_0$ and $\theta_1$. 

If out-of-roundness exists around the whole circumference of the wheel,
as for polygonization, then the input data need to be extended periodically
by the user in order to create a wheel surface with smooth wrap-around
from $\pi$ to $-\pi$. Inputs should be given on a domain such as
$[\theta_0,\theta_1]=[-3.2,3.2] \unit{rad}$, fully encompassing the range
$[-\pi,\pi)$. Periodic extension means that $dr(\theta)=dr(\theta+2\pi)$ for
$\theta\in[\theta_0,-\pi)$ and $dr(\theta)=dr(\theta-2\pi)$ for
$\theta=[\pi,\theta_1)$.

\begin{inputvars}
\inpvar{TH\_OFFSET}{\bunit{x}}{Offset $\theta_{ofs}$ added to input 
        $\theta_{slc}$ positions to align with wheel 
        $\theta_{wc}$-coordinates as used in CONTACT, with dimension
        `$\unit{x}$' defined by the user.}
\inpvar{TH\_SCALE}{\bunit{rad/x}}{Multiplication factor to convert input
        $\theta_{slc}$ positions to $\unit{rad}$.}
\inpvar{TH\_SLC}{\bunit{x}}{Input $\theta_{slc}$-position of a slice along
        the wheel circumference, converted as $\theta_{wc} = \theta_{scale}
        \cdot (\theta_{ofs} + \theta_{slc})$.}
\inpvar{TH\_METHOD}{\bunit{-}}{Interpolation method used between successive
        slices. Method 1 is to use an interpolating spline, whereas method
        2 uses a more smooth approximation that does not pass through the
        data positions.}
\end{inputvars}
The slices must be given with $\theta_{slc}$-positions in increasing order
and at least $0.001\unit{rad}$ apart. Slice positions can be given in
degrees using $\theta_{scale}=\pi/180= 0.0174533$. 

% $0\le\theta_1-\theta_0\le 2\pi$. Constant extrapolation is used

\section{Track and roller geometry}
\label{sec:track_geom}

The track geometry consists of a rail profile, the track dimensions
and track deviations. New geometry is input when the control integer
ZTRACK is 1--3 (page \pageref{z1-digit}).

In the computation of wheelsets on tracks (configurations ${\tt C}_1=0,
1$), rails (profiles) are rotated by an installation angle which is $+{\tt
CANT}$ for a left and $-{\tt CANT}$ for a right rail. 
% An easy way of working is to define the profiles upright,
% without cant, with the rail origin centered in the rail surface.
After this the rail position is set using either the gauge width
computation or using absolute placement.

The gauge point computation is selected by setting a positive 
`gauge measuring height' $g_{height}>0$.
\begin{inputvars}
\inpvar{GAUGHT}{\bunit{mm}}{Height $g_{height}$ below the track plane at which
        the gauge width is measured.}
\inpvar{GAUGSQ}{-}{Reserved for selecting second or further gauge faces
        instead of the leftmost one (n.y.a.)}
\inpvar{GAUGWD}{\bunit{mm}}{Distance $g_{width}$ between the inner faces of the
        two rails.}
\inpvar{CANT}{\bunit{rad}}{Rail cant: rotation angle from track vertical
        ($z_{track}$) to rail vertical ($z_{rail}$), positive for
        inclination towards the track center.}
\end{inputvars}
The gauge computation is disabled and replaced by absolute rail placement
by setting $g_{height}\le 0$. The rail datum point (origin) is then placed
at the specfied position in the track $[0, y_{r(tr)}, z_{r(tr)}]^T$. 
\begin{inputvars}
\inpvar{RAILY0}{\bunit{mm}}{Position $y_{r(tr)}$ of the rail origin with
        respect to track coordinates.}
\inpvar{RAILZ0}{\bunit{mm}}{Position $z_{r(tr)}$ of the rail origin with
        respect to track coordinates.}
\end{inputvars}
{\tt RAILY0} will typically be $<0$ for the left rail and $>0$ for
the right rail. A value $y_{r(tr)}=0$ may be appropriate for a
configuration in which one wheel and one rail are used.

Zero cant is used in the computations for roller rigs (${\tt C}_1=4,5$).
Furthermore, the gauge computation is used there for the lateral
positioning of the profile only. In radial direction, the profile origin
$z_r=0$ is placed at the nominal radius $r_{nom,r}$ from the roller axle.
\begin{inputvars}
\inpvar{NOMRADR}{\bunit{mm}}{Nominal radius $r_{nom,r}$ of the rollers, i.e.\ the
        radius at which the profile heights $z_r$ are zero.}
\end{inputvars}

Rail irregularities provide offsets with respect to the ideal (design)
geometry. Track coordinates are used, such that $\Delta y>0$ is towards
the track center for a left rail, but to the field side when the right rail
is considered.
\begin{inputvars}
\inpvar{DYRAIL}{\bunit{mm}}{Offset $\Delta y_{rail}$ of the rail profile
        reference from the design to the actual position in track coordinates.}
\inpvar{DZRAIL}{\bunit{mm}}{Offset $\Delta z_{rail}$ of the rail profile
        reference with respect to the design position in track coordinates.}
\inpvar{DROLLR}{\bunit{rad}}{Rotation $\Delta \phi_{rail}$ of the rail profile,
        from design to actual orientation, in track coordinates,
        positive using the right-hand rule.}
\inpvar{VYRAIL}{\bunit{mm/s}}{Velocity $v_y^{rail}$ of the rail origin with
        respect to the design position in track coordinates.}
\inpvar{VZRAIL}{\bunit{mm/s}}{Velocity $v_z^{rail}$ of the rail origin with
        respect to the design position in track coordinates.}
\inpvar{VROLLR}{\bunit{rad/s}}{Angular velocity $v_\phi^{rail}$ of the rail
        origin with respect to the design orientation in track coordinates,
        positive using the right-hand rule.}
\end{inputvars}

\magenta{
The massless rail model of Equation (\ref{eq:cntc_defl}) is activated using
control digit ${\tt F}_1=3$, and takes the following inputs:
\begin{inputvars}
\inpvar{KYRAIL}{\bunit{N/mm}}{Effective lateral rail stiffness $k^*_y$.}
\inpvar{FYRAIL}{\bunit{N}}{Prescribed lateral force $F_y^*$ on the rail.}
\inpvar{KZRAIL}{\bunit{N/mm}}{Effective vertical rail stiffness $k^*_z$.}
\inpvar{FZRAIL}{\bunit{N}}{Prescribed vertical force $F_z^*$ on the rail.}
\end{inputvars}
}
 
\section{Wheelset geometry \& state}
\label{sec:wheelset_geom}

The wheelset geometry and state consist of the wheelset dimensions, the
wheel profile, and the position and velocity of the wheelset with respect
to the track. New data are input when the control integer EWHEEL is 1--5
as described on page \pageref{e1-digit}.
\begin{inputvars}
\inpvar{FBDIST}{\bunit{mm}}{Lateral distance $d_{flng}$ between the inner faces
        (flange backs) of the two wheels of the wheelset.}
\inpvar{FBPOS}{\bunit{mm}}{Lateral position $y_{fbpos}$ of the flange back with
        respect to the wheel profile origin $O_w$. (In the configuration of
        Figure \ref{fig:wheel_coord}, $y_{fbpos}$ could be $-70\unit{mm}$.)}
\inpvar{NOMRADW}{\bunit{mm}}{Nominal radius $r_{nom,w}$ of the wheel, i.e.\ the
        distance of the wheel profile reference point to the wheelset axle.}
\end{inputvars}

The contact geometry is governed by the position of the wheel with respect
to the rail. This is computed using the position of the wheelset center,
and the wheelset roll, yaw and pitch angles.
\begin{inputvars}
\inpvar{S\_WS}{\bunit{mm}}{Wheelset position $s_{ws}$ along the track center
        line, used mainly for output purposes. Note: $s=s_1$ refers here to
        the (longitudinal) rolling direction.}
\inpvar{Y\_WS}{\bunit{mm}}{Lateral position $y_{ws}$ of the wheelset center 
        in terms of track coordinates.}
\inpvar{Z\_WS}{\bunit{mm}}{Vertical position $z_{ws}$ of the wheelset center
        in terms of track coordinates, zero at the nominal position
        $z_{tr}=-r_{nom,w}$.}
\inpvar{ROLL}{\bunit{rad}}{Wheelset roll angle $\phi_{ws}$ with respect to the
        track plane.}
% \inpbreak
\inpvar{YAW}{\bunit{rad}}{Wheelset yaw angle $\psi_{ws}$ with respect to the
        track center line $x_{track}$.}
\inpvar{PITCH}{\bunit{rad}}{Wheelset pitch angle $\theta_{ws}$, i.e.\ rotation
        about the wheelset axle. This is of relevance primarily for
        out-of-round wheels using a wheel slices file.}
\end{inputvars}
Using the ${\tt N}_1$-digit, the total vertical force $F_z$ may be given as
part of the problem specification. In that case, the program will raise or
lower the wheelset ($z_{ws}$) as needed to achieve the desired force. The
wheelset roll angle will not be adjusted.

In the computation of roller rigs, the variable $s_{ws}$ is replaced by
$x_{ws}$, defined as follows:
\begin{inputvars}
\inpvar{X\_WS}{\bunit{mm}}{Longitudinal position $x_{ws}$ of the wheelset
        center in terms of track coordinates.}
\end{inputvars}
The orientation of roll, yaw and pitch angles is defined using the right
hand rule. For instance, the configuration of Figure \ref{fig:wheel_coord}
shows a positive roll angle $\phi_{ws}$, defined as the rotation about the
$x_{track}$-axis from the positive $z_{track}$- to positive $z_{wset}$-axis.
Likewise, the wheelset will tend to the right in the rear view of Figure
\ref{fig:wheel_coord} if a positive yaw angle is given. This shows up in
the results of the Manchester benchmark example (Figure
\ref{fig:mbench_prr}), where the contact patches on left and right wheels
shifted to positive and negative $x$-values, respectively.

The creepages for the contact problem are obtained from the wheelset
velocity. These are computed from the rates of change of the position
parameters.

\magenta{Extensions for ${\tt F}_1=1\text{--}2$ are under development,
prescribing $F_{x(ws)}$ or $M_{y(ws)}$ (on the rail!) instead of
$\omega_{ws}$. These are targeted mainly at small (relative) forces,
little precautions are taken to prevent solver divergence.}
\begin{inputvars}
\inpvar{VS\_WS}{\bunit{mm/s}}{Wheelset forward velocity $v_{s_1}=v_x$ along
        the track center line.}
\inpvar{VY\_WS}{\bunit{mm/s}}{Wheelset lateral velocity $v_y=\dot{y}_{ws}$ with
        respect to track coordinates.}
\inpvar{VZ\_WS}{\bunit{mm/s}}{Wheelset vertical velocity $v_z=\dot{z}_{ws}$ 
        in terms of track coor\-di\-nates.}
\inpvar{VROLL}{\bunit{rad/s}}{Wheelset rate of roll $\dot{\phi}_{ws}$.}
\inpvar{VYAW}{\bunit{rad/s}}{Wheelset yaw rate $\dot{\psi}_{ws}$.}
\inpvar{VPITCH}{\bunit{rad/s}}{Wheelset angular velocity $\omega_{ws}=
        \dot{\theta}_{ws}$. \magenta{Output when ${\tt F}_1=1$ or $2$.}}
\end{inputvars}
In the computation of curving scenarios, the track coordinate system
changes its forward direction by $1/r_{curv}\unit{rad/mm}$ for a curve
radius $r_{curv}$ in $\unit{mm}$. The yaw velocity is measured relative to
this changing orientation, producing $\dot{\psi}_{ws}=0$ (constant
$\psi_{ws}$) in steady curving.

In the computation of roller rigs, the forward velocity $v_x$ is assumed to
be negligible, and is replaced by the angular velocity of the rollers:
\begin{inputvars}
\inpvar{RPITCH}{\bunit{rad/s}}{Rollers' angular velocity $\omega_{rol}=
        \dot{\theta}_{rol}$.}
\end{inputvars}
According to the right hand rule, the pitch velocity $\omega_{ws}$ is
negative for forward rolling, whereas $\omega_{rol}$ is positive.

% CONTACT internally uses $\delta t^*=1\unit{s}$ irrespective of
% the actual time step $\delta t$ used in the multibody simulation. 
% No reference is made to the actual time in the simulation. 
In the computations using ${\tt T}=1$, transient contact using a
`material-fixed' contact grid, the velocities are replaced by the moved
distance per time step:
\begin{inputvars}
\inpvar{SHFT\_SWS}{\bunit{mm}}{Wheelset forward position increment
        $\Delta s_{ws}= v_x\delta t$.}
\inpvar{SHFT\_YWS}{\bunit{mm}}{Wheelset lateral position increment
        $\Delta y_{ws}= v_y\delta t$.}
\inpvar{SHFT\_ZWS}{\bunit{mm}}{Wheelset vertical position increment
        $\Delta z_{ws}=v_z\delta t$.}
\inpvar{SHFT\_ROL}{\bunit{rad}}{Wheelset roll angle increment
        $\Delta\phi_{ws}=\dot{\phi}_{ws}\delta t$.}
\inpvar{SHFT\_YAW}{\bunit{rad}}{Wheelset yaw angle increment
        $\Delta\psi_{ws}=\dot{\psi}_{ws}\delta t$.}
\inpvar{SHFT\_WPIT}{\bunit{rad}}{Wheelset pitch angle icrement
        $\Delta\theta_{ws}=\omega_{ws}\delta t$. \magenta{Output when 
        ${\tt F}_1=1$ or $2$.}}
\inpvar{SHFT\_RPIT}{\bunit{rad}}{Roller pitch angle increment
        $\Delta\theta_{rol}= \omega_{rol}\delta t$.}
\end{inputvars}
Flexible wheelset deviations provide offsets from the initial (design)
geometry to the actual (current) configuration. Wheelset coordinates are
used, such that $\Delta y>0$ is towards the wheelset center for a left
wheel, but to the field side when the right wheel is considered.
\begin{inputvars}
\inpvar{DXWHL .. \mbox{\hspace{4mm}DZWHL}}{\bunit{mm}}{Displacements 
        $\Delta x_{whl}, \Delta y_{whl}, \Delta z_{whl}$ of the wheel
        profile reference point from the design to the actual position
        in wheelset coordinates.}
\inpvar{DROLLW, \mbox{\hspace{4mm}DYAWW}, \mbox{\hspace{4mm}DPITCHW}}{
        \bunit{rad}}{Rotations $\Delta\phi_{whl}, \Delta\psi_{whl}, 
        \Delta\theta_{whl}$ of the wheel profile origin with respect to
        the design orientation in wheelset coordinates, positive using
        the right-hand rule.}
\inpvar{VXWHL .. \mbox{\hspace{4mm}VZWHL}}{\bunit{mm/s}}{Velocities 
        $\Delta v_x^{whl}, \Delta v_y^{whl}, \Delta v_z^{whl}$ of the
        wheel profile origin with respect to the design position in
        wheelset coordinates.}
\inpvar{VROLLW, \mbox{\hspace{4mm}VYAWW}, \mbox{\hspace{4mm}VPITCHW}}{
        \bunit{rad/s}}{Angular velocities $\Delta v_\phi^{whl}, 
        \Delta v_\psi^{whl}, \Delta v_\theta^{whl}$ of the wheel profile
        origin with respect to the design orientation in wheelset
        coordinates, positive using the right-hand rule.}
\end{inputvars}
 
\section{Identification of contact patches}
\label{sec:cpatches}

In module 1, CONTACT determines the regions of the wheel and rail where
virtual interpenetration occurs, producing the potential extent of 
contact patches. Multiple contact patches may be detected. Patches that lie
close together may be joined, to include interactions between them in the
actual contact solution. See Figure \ref{fig:site_b_cpatch} for a case with
a conformal contact situation, solved three times with different settings.

\begin{figure}[bt]
\centering
\psfig{figure=fig/siteB_cpatch_pln08,height=1.5in,trim=10 30 60 70,clip=}
\psfig{figure=fig/siteB_cpatch_pln12,height=1.5in,trim=50 30 60 70,clip=}
\psfig{figure=fig/siteB_cpatch_cnf30,height=1.5in,trim=50 30 60 70,clip=}
\caption{\em Illustration of `contact patches' with local coordinate
        systems used for the solution. Multiple `interpenetration regions'
        may be combined into a single `patch' if the distance and angle
        difference are smaller than the threshold values.}
\label{fig:site_b_cpatch}
\end{figure}

The separation or combination of contact patches is governed using three
threshold values for the distance $d$ between interpenetration areas,
$d_{turn}\ge d_{sep}\ge d_{comb}$, and one threshold $\alpha_{sep}$ for
the difference in contact reference angle. Two patches are processed
independently when $|\alpha_{cp1}- \alpha_{cp2}| > \alpha_{sep}$ or when
$d > d_{turn}$. Else,
\begin{itemize}
\item Two separate contact patches are used when $d_{sep} < d\le
        d_{turn}$, with contact reference angles $\alpha_{cp1}$ and
        $\alpha_{cp2}$ turned towards their weighted average;
\item One combined contact patch is used with a `blending approach'
        when $d_{comb}< d\le d_{sep}$, attenuating the cross-influence
        between the different parts;
\item One combined contact patch is used with full solution when $d\le
        d_{comb}$.
\end{itemize}
The blending approach is described in \cite{Vollebregt2020b-wrgeom,
Vollebregt2020c-distr-force}. The turning of contact angles is a further
extension, suppressing jump discontinuities in total forces at slight
changes in the input positions.
\begin{inputvars}
\inpvar{A\_SEP}{\bunit{rad}}{Threshold angle $\alpha_{sep}$ for the angle
        difference above which patches are processed separately.}
\inpvar{D\_SEP}{\bunit{mm}}{Threshold distance $d_{sep}$ above which patches
        are processed separately.}
\inpvar{D\_COMB}{\bunit{mm}}{Threshold distance $d_{comb}$ below which
        patches are combined fully, if not prohibited by the angle threshold.}
\inpvar{D\_TURN}{\bunit{mm}}{Threshold distance $d_{turn}$ below which
        reference angle turning is used for patches that are processed
        separately. Default $2 d_{sep}-d_{comb}$.}
\end{inputvars}
For each contact patch that remains after combination, CONTACT determines a
so-called {\em contact reference position\/}. In steady rolling (${\tt
T}=3$), this is the origin of the local coordinates used for solving the
contact problem \cite{Vollebregt2020b-wrgeom}. The contact reference is
determined by a heuristic rule to be centered within the contact patch in
a weighted sense. This may be different from the {\em initial contact
point\/} where the undeformed distance is minimum. 

In transient contact, the local coordinate system is based off the rail
profile reference $s_r=0$ in lateral direction. Longitudinally, a fixed
super-grid is used when ${\tt T}=1$, based at the start of the track curve
$s_{fc}=0$. For ${\tt T}=2$, the contact grid is based at the track
coordinate system $x_{tr}=0$.

In Figure \ref{fig:site_b_cpatch}, the contact reference position of each
contact patch is indicated by a black marker. In the output it is presented
in terms of the track-, rail- and wheel coordinates.\label{pg:contact_refpos}
\begin{inputvars}
\inpvar{XCP\_TR,..}{\bunit{mm}}{Position of the contact reference point in
        track coordinates.}
\inpvar{XCP\_R,..}{\bunit{mm}}{Position of the contact reference point on
        the rail profile.}
\inpvar{XCP\_W,..}{\bunit{mm}}{Position of the contact reference point with
        respect to the wheel profile.}
\inpvar{S\_R, S\_W}{\bunit{mm}}{$s$ ($s_2$) position of the contact reference
        point with respect to the profile origin measured along the curved
        rail or wheel surface.}
\inpvar{DELTTR}{\bunit{rad}}{Contact angle: rotation from the track $z$-axis
        to the contact $n$-axis. Typically positive for left wheel/rail pairs
        and negative at right wheel/rail pairs.}
\end{inputvars}
These values are all given with respect to right handed coordinate systems
with positive $y$ to the right. For a left-side wheel/rail pair, positive
$y_r$ is towards the track center, whereas for a wheel/rail pair on the
right side, positive $y_r$ is towards the field side.\footnote{This
convention was introduced in version v23.1.}

\section{Potential contact area and discretisation}
\label{sec:wr_potcon}

The actual solution of pressures and frictional stresses is implemented
using module 3 for basic contacts (Chapter \ref{chp:module3}). This is
activated separately for each contact patch identified in the contact
search phase.

A rectangular {\em potential contact area} is defined that encompasses the
actual contact area. Within module 1, this potential contact is determined
automatically. The parameters that must be set by the user concern the
discretisation parameters, defined as follows:
\begin{inputvars}
\inpvar{DX}{\bunit{mm}}{Size $\delta x$ of each grid element in longitudinal
        ($x_{track}$ or $x_{rail}$) direction.}
\inpvar{DS}{\bunit{mm}}{Size $\delta s$ of each grid element in lateral
        ($s = s_2$) direction tangent to the rail surface.}
\inpvar{DQREL}{\bunit{-}}{Relative size $c=\delta q/\delta x$ of the rolling
        distance $\delta q$ traversed per time step compared to the grid
        size $\delta x$.}
\end{inputvars}
The program automatically sets $c=1$ in the computation of steady rolling.
For transient rolling, the value 1 is also preferred
\cite{Vollebregt2009a-cm2009, Wekken2017a-wiggles}.

In module 1, CONTACT determines the undeformed distance function and the
rigid slip at each element of the grid, as needed for the detailed contact
calculation.
 
\section{Material \& friction description}

The calculations for each contact patch need information on the materials
(e.g.\ elastic half-space, simplified model), geometrical composition
(interfacial layer, conformal geometry) and on the friction description
(Coulomb friction, with velocity or temperature dependence). Additionally
there are parameters for the calculation of surface temperatures and
subsurface stresses, and for configuration of the solvers used. These
parameters are the same in module 1 as in module 3, and are discussed in
Chapter \ref{chp:module3}.

\section{Global outputs for module 1}
\label{sec:global_outpt1}

Global output quantities are written to the output file {\tt <experim>.out}
when the {\tt O}-digit is set to values $1-5$.

The global part of the output firstly contains a description of the problem
that is solved (${\tt O}\ge 2$), its control digits and the primary input
values that are used (except discretisation and geometry). Then several
output quantities are displayed for the wheel/rail pair as a whole: the
total forces as determined by the program, or the wheelset positions
\magenta{ and rates} that had to be found. 

With positive $z$ pointing downwards (Figure \ref{fig:wheel_coord}), the
rail (roller) is the output body $(a)=(1)$.
\begin{inputvars}
\inpvar{FX\_TR}{\bunit{N}}{Total force $F_{x_{tr}}$ {\em on\/} the rail in
        track longitudinal direction $x_{track}$.}
\inpvar{FY\_TR}{\bunit{N}}{Total force $F_{y_{tr}}$ on the rail in track
        lateral direction $y_{track}$.}
\inpvar{FZ\_TR}{\bunit{N}}{Total force $F_{z_{tr}}$ on the rail in track
        vertical direction $z_{track}$.}
\end{inputvars}
The forces are also rotated to the wheelset orientation:
\begin{inputvars}
\inpvar{FX\_WS}{\bunit{N}}{Total force $F_{x_{ws}}$ on the rail in wheelset
        longitudinal direction $x_{wset}$. \magenta{Input when ${\tt
        F}_1=1$.}}
%\inpbreak
\inpvar{FY\_WS}{\bunit{N}}{Total force $F_{y_{ws}}$ on the rail in wheelset
        lateral direction $y_{wset}$.}
\inpvar{FZ\_WS}{\bunit{N}}{Total force $F_{z_{ws}}$ on the rail in wheelset
        vertical direction $z_{wset}$.}
\end{inputvars}
\magenta{
Rail deflections $\delta y_{\defl}, \delta z_{\defl}$ are output when ${\tt
F}_1=3$:
\begin{inputvars}
\inpvar{DYDEFL}{\bunit{mm}}{Lateral shift $\delta y_{\defl}$ of the rail
        with respect to the input position according to the model of
        Equation (\ref{eq:cntc_defl}).}
\inpvar{DZDEFL}{\bunit{mm}}{Vertical shift $\delta z_{\defl}$ of the rail
        with respect to the input position according to the model of
        Equation (\ref{eq:cntc_defl}).}
\end{inputvars}
}
After the values for the wheel/rail pair as a whole, data are displayed for
all the contact patches that have been detected and solved. This concerns
firstly the contact reference point that was discussed in Section
\ref{sec:cpatches}. Next, there are the creepages and penetration, and the
forces {\tt FX}, {\tt FS} and moment {\tt MN} of each separate patch as
obtained from module 3 (Section \ref{sec:global_outpt}; {\tt FY} and {\tt
MZ} are renamed to {\tt FS}, {\tt MN} to emphasize that these are
given in contact local coordinate system).

\color{black}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Description of input quantities
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Inputs and outputs for module~3: basic contact}
\label{chp:module3}

`Basic contact' means that the user takes care of locating the potential
region where contact occurs, defining local coordinates with $z$ ($n$)
pointing into the upper body, $a=1$, and defining the contact problem using
this coordinate system. The inputs needed are then:
\begin{itemize}
\item The material composition of the two bodies (\S \ref{sec:matcns});
\item Frictional processes: (\S \ref{sec:fric_dscrp});
\item Definition of the potential contact and its grid discretization
        (\S \ref{sec:pot_con});
\item The undeformed distance (\S \ref{sec:ibase}) and relative motion
        between the surfaces (\S \ref{sec:kincns}).
\end{itemize}

\section{Material \& geometrical composition}
\label{sec:matcns}

The simplest material model used in CONTACT concerns the elastic
half-space (\S \ref{sec:lin_elast}). Various extensions are provided
that may change the material behavior,
\begin{itemize}
\item viscoelasticity (\S \ref{sec:visc_elast}), 
        simplified model (\S \ref{sec:fastsim}), 
        local plasticity (\S \ref{sec:intfc_layer}),
\end{itemize}
and/or geometrical composition,
\begin{itemize}
\item interfacial layer (\S \ref{sec:intfc_layer}), and
        conformal shapes (\S \ref{sec:num_infl}).
\end{itemize}

\subsection{Homogeneous elastic materials}
\label{sec:lin_elast}

The input parameters for elastic materials are:
\begin{inputvars}
\inpvar{GG(ia)}{\bunit{N/mm^2}}{Modulus of rigidity $G^{(a)}$ of body \var{ia},
        $G^{(a)} > 0$.}
\inpvar{POISS(ia)}{\bunit{-}}{Poisson's ratio $\nu^{(a)}$ of body \var{ia},
        $0\le\nu^{(a)}\le 0.5$.}
\end{inputvars}
The modulus of rigidity is also known as the (elastic) shear modulus. It is
related to the modulus of elasticity (Young's modulus) $E$ by
\begin{equation}
  G^{(a)} = \frac{E^{(a)}}{2(1+\nu^{(a)})}
\end{equation}

From these values the program computes the following combined quantities:
\begin{inputvars}
\inpvar{GA}{\bunit{N/mm^2}}{Combined modulus of rigidity $G$.}
\inpvar{NU}{\bunit{-}}{Combined Poisson's ratio $\nu$.}
\inpvar{AK}{\bunit{-}}{Difference parameter $K$.}
\end{inputvars}

These values are defined by
\begin{equation}\label{eq:combined_mater}
 \frac{1}{G} = \frac{1}{2} \left(
                \frac{1}{G^{(1)}} + \frac{1}{G^{(2)}} \right), \;\;
 \frac{\nu}{G} = \frac{1}{2} \left(
        \frac{\nu^{(1)}}{G^{(1)}} + \frac{\nu^{(2)}}{G^{(2)}} \right), \;\;
 \frac{K}{G} = \frac{1}{4} \left(
        \frac{1 - 2\nu^{(1)}}{G^{(1)}} + \frac{1 - 2\nu^{(2)}}{G^{(2)}} \right)
\end{equation}
They characterize the combined influence function $\mat{A}(\vec{x},\vec{x}')$
of the two bodies (equation (\ref{eq:u_int_A_p})).

\subsection{Heat related material parameters}
\label{sec:heat_param}

The input parameters for the calculation of surface temperatures ({\tt
H}-digit, page \pageref{h-digit}) are:
\begin{inputvars}
\inpvar{BKTEMP(ia)}{\bunit{\celc}}{(Initial) Bulk temperature $T_0^{(a)}$ of
        body \var{ia}.}
\inpvar{HEATCP(ia)}{\bunit{J/kg \celc}}{Specific heat capacity $c_p^{(a)}$
        of body \var{ia}.}
\inpvar{LAMBDA(ia)}{\bunit{W/mm \celc}\hspace{-10mm}}{Thermal conductivity 
        $\lambda^{(a)}$ of body \var{ia}.}
\inpvar{DENS(ia)}{\bunit{kg/mm^3}}{Density $\rho^{(a)}$ of body \var{ia}.}
\end{inputvars}
An additional parameter $\beta_{pl}$ is needed in models employing an
interfacial layer with plastic deformation (${\tt M}=4$,
\S\ref{sec:intfc_layer}). This parameter concerns the
partitioning of plastic work into heat and energy stored in the material.
\begin{inputvars}
\inpvar{BETAPL}{\bunit{-}}{Fraction of plastic work dissipated as heat.}
\end{inputvars}

\subsection{Viscoelastic materials}
\label{sec:visc_elast}

An extension has been made to viscoelastic materials, but only for steady
state rolling problems with rolling in positive $x$-direction (${\tt chi}=
\chi=0$).  The required influence coefficients are calculated
by numerical integration as described in \cite{Kalker1990}, appendix D,
with further information provided in \cite{Wang_guangqiu1992b,
Wang_guangqiu1993}.

The viscoelastic material model that is incorporated in CONTACT is the
Standard Linear Solid (SLS) model. This model adequately describes the
viscoelastic stress relaxation and creep phenomena for many linear
viscoelastic materials in the first order \cite{Roylance2001}.

For a standard creep test, the {\em creep compliance\/} is described with
the SLS as
\begin{equation}
\label{eq:SLS_creep_compliance}
  C_{crp}(t) = \varepsilon(t)/\sigma_0 = C_g + (C_r-C_g) (1 - e^{-t/\tauc}) .
\end{equation}
This employs the initial compliance $C_g$, the final compliance $C_r>C_g$
and the creep relaxation time $\tauc$.\footnote{The subscripts $_g$ and
$_r$ refer to the initial `glassy' and the final `rubbery' states of
the viscoelastic material \cite{Roylance2001}.}

For a standard stress relaxation test, the {\em relaxation modulus\/} is
described with the SLS as
\begin{equation}
\label{eq:SLS_stress_relaxation}
  E_{rel}(t) = \sigma(t)/\varepsilon_0 = E_r + (E_g-E_r) \, e^{-t/\taue}.
\end{equation}
This employs the initial Young's modulus $E_g$, the final Young's modulus
$E_r<E_g$ and the stress relaxation time $\taue$. 

Two mechanical analog network models that are equivalent and that are
closely linked to these two standard relaxation tests, are the Kelvin-Voigt
and Maxwell forms of the SLS, see Figure~\ref{fig:sls_voigt_maxwell_models}.
The element parameters are the spring stiffnesses and compliances $E=1/C\,
\bunit{N/mm^2}$ and the damper viscosity $\eta\,\bunit{N\,s/mm^2}$.
All material parameters, including the Poisson's ratio $\nu$, are assumed
to be constant over time.

\begin{figure}[bt]
\centering
\psfig{figure=fig/sls_voigt_model,width=2.3in,clip=}\hspace{15mm}
\psfig{figure=fig/sls_maxwell_model,width=2.3in,clip=}
\caption{\em Mechanical analog networks of the Standard Linear Solid (SLS)
        model of viscoelastic materials, featuring the equivalent
        Kelvin-Voigt (left) and Maxwell forms (right).}
\label{fig:sls_voigt_maxwell_models}
\end{figure}

Apart from the elastic parameters {\tt GG(ia)} and {\tt POISS(ia)} per body,
the extra input quantities in the program for viscoelastic materials are
\begin{inputvars}
\inpvar{FG(ia)}{\bunit{-}}{Ratio of Kelvin-Voigt spring compliance constants
        $C_g^{(a)}/C_v^{(a)}$ of body {\tt ia}, $C_g^{(a)}/C_v^{(a)} \geq 0$.}
\inpvar{TC(ia)}{\bunit{s}}{Creep relaxation time $\tauc^{(a)}$ of body {\tt ia},
        $\tauc^{(a)}\geq 0$.}
\end{inputvars}

The relations between the input quantities and the different model parameters
are summarized in Table~\ref{tbl:visc_inputs}. From these relations it
follows that
\begin{equation}
        f_g = \frac{E_g - E_r}{E_r} \;\;\leftrightarrow\;\;
%       f_g E_r = E_g - E_r \;\; \leftrightarrow\;\;
%       (1+f_g) E_r = E_g \;\;\leftrightarrow\;\;
        E_r = \frac{E_g}{1+f_g}, \;\;\mbox{and consequently}\;\;
        G_r = \frac{G_g}{1+f_g} .
% E_r = 100, E_g = 400 --> f = 3 --> E_r = 1/(1+3) E_g
\end{equation}
%\begin{equation}
%        f_g = \frac{E_g - E_r}{E_r} 
%            = \frac{1/C_g - 1/C_r}{1/C_r} 
%            = \frac{C_r/C_g - C_r/C_r}{C_r/C_r} 
%            = \frac{C_r/C_g - 1}{1} 
%            = \frac{C_r - C_g}{C_g} 
%% C_r = 0.010, C_g = 0.025 --> f = 0.075 / 0.025 = 3 --> E_r = 1/(1+3) E_g
%\end{equation}

\begin{table}[bt]
\centering
\begin{tabular}{|p{50mm}|c|c|c|}
  \hline
                   & \multicolumn{3}{|c|}{Inputs to CONTACT} \\
  Model parameters & {\tt GG} & {\tt FG} & {\tt TC} \\ \hline
  Maxwell form & \rule{0pt}{12pt}\multirow{2}{*}{$\displaystyle \frac{E_r+E_m}{2(1+\nu)}$} &
                 \multirow{2}{*}{$\displaystyle \frac{E_m}{E_r}$} &
                 \multirow{2}{*}{$\displaystyle \frac{E_r+E_m}{E_r E_m} \,\eta_m$}  \\
  $E_r$, $E_m=E_g-E_r$, $\eta_m$ & & & \\ \hline

  Kelvin-Voigt form & \rule{0pt}{12pt}\multirow{2}{*}{$\displaystyle \frac{1}{C_g}\frac{1}{2(1+\nu)}$} &
               \multirow{2}{*}{$\displaystyle \frac{C_v}{C_g}$} &
               \multirow{2}{*}{$\displaystyle C_v \,\eta_v$}  \\
  $C_g$, $C_v=C_r-C_g$, $\eta_v$ & & & \\ \hline

  Creep relaxation test & \rule{0pt}{12pt}\multirow{2}{*}{$\displaystyle \frac{1}{C_g} \frac{1}{2(1+\nu)}$} &
                 \multirow{2}{*}{$\displaystyle \frac{C_r-C_g}{C_g}$} &
                 \multirow{2}{*}{$\displaystyle \tauc$}  \\
  $C_g$, $C_r$, $\tauc$ & & & \\ \hline

  Stress relaxation test & \rule{0pt}{12pt}\multirow{2}{*}{$\displaystyle
\frac{E_g}{2(1+\nu)}$} &
                 \multirow{2}{*}{$\displaystyle \frac{E_g-E_r}{E_r}$} &
                 \multirow{2}{*}{$\displaystyle \frac{E_g}{E_r} \,\taue$}  \\
  $E_g$, $E_r$, $\taue$ & & & \\ \hline
\end{tabular}
\caption{\em Relations of the viscoelastic input quantities to the model
        parameters for a number of different descriptions of viscoelastic
        relaxation.}
\label{tbl:visc_inputs}
\end{table}

% Except for the difference in the way that the influence coefficients are
% calculated, the program works the same as for elastic contact problems.
% Only steady state rolling problems can be solved.
% The Gauss-Seidel solvers can be used too. We have not tried
% this very much. It seems that GS works less well for ss-roll than
% in elastic contact, and that there are difficulties in the normal problem
% for special material constants.

Note that when viscoelastic material behaviour is used, the calculation of
subsurface stresses is still based on the elastic half-space approach. This
means that the true surface stresses due to viscoelastic rolling contact
are not propagated entirely correct into the subsurface.

\magenta{
\subsection{\texorpdfstring{\magenta{Compressible elastic layer}}{Compressible elastic layer}}
\label{sec:thin_sheet}

A quick fix is made to capture the effect of a sheet of pressure sensitive
paper, using the normal part of Kalker's first order theory \cite[\S
3.2]{Kalker1990}:
\begin{equation}
     u_z^{(3)} = L_z p_n, \;\; 
     L_z = h^{(3)} \frac{(1+\nu^{(3)}) (1-2\nu^{(3)})}{(1-\nu^{(3)}) E^{(3)}} .
\end{equation} 
\begin{inputvars}
\inpvar{FLXZ}{\bunit{mm^3/N}}{Flexibility parameter $L_z$.}
\end{inputvars}
This option is activated with ${\tt B}=1$ (page \pageref{b-digit}).
}

\subsection{Flexibilities of the simplified theory}
\label{sec:fastsim}

CONTACT provides the `Modified FASTSIM' algorithm \cite{Spiryagin2013} for
quick approximation of the tangential surface tractions $\vec{p}_t$ using
the simplified theory \cite{Kalker1973,Kalker1982a-fastsim}. This uses the
simplified material model (${\tt M}=2,3$), also called the Winkler
foundation approach. The surface particles are assumed to be moving
independently of each other, with response $\vec{u}_t$ linear in the
surface traction $\vec{p}_t$. This may be viewed as if the bodies
consisted of a set of independent springs with (combined) flexibility
parameter $L$.
\begin{inputvars}
\inpvar{FLX}{\bunit{mm^3/N}}{Flexibility parameter $L$.}
\end{inputvars}
In Hertzian problems (Sections \ref{sec:hertz3d}--\ref{sec:sdec}),
three different flexibilities $L'_\xi$, $L'_\eta$ and $L'_\phi$ may be
used for longitudinal, lateral and spin creepage respectively. These
flexibilities are computed automatically when ${\tt M}=3$, using the
blending approach of \cite{Vollebregt2022a-1flex}. For non-Hertzian
problems (\S \ref{sec:nonhzvar}, \ref{sec:ibase}), these flexibilities
are based on an equivalent ellipse with semi-axes $a_{eqv}, b_{eqv}$,
estimated for the actual contact area.

The modifications proposed in \cite{Spiryagin2013} are based on a variable
flexibility, increasing with the ratio of the slip area to the area
of adhesion:
\begin{equation}
   L_{\eff} = \frac{L}{k}, \;\;\mbox{with}\;\;
   k = k_0 \left( \alpha_{inf} + 
                \frac{1-\alpha_{inf}}{1+\beta\varepsilon} \right) .
\end{equation}
This increases the flexibility when $k<1$. The input parameters are as
follows:
\begin{inputvars}
\inpvar{K0\_MF}{\bunit{-}}{Initial value $k_0$ of Kalker's reduction factor at creep
        values close to zero, $0<k_0\le 1$.}
\inpvar{ALFAMF}{\bunit{-}}{Fraction $\alpha_{inf}=k_\infty/k_0$ of the reduction
        factor at creep values approaching infinity, $0\le\alpha_{inf}\le 1$.}
\inpvar{BETAMF}{\bunit{-}}{Non-dimensional parameter $\beta$ that governs how
        quickly $k$ changes with increasing slip area, $\beta\ge 0$.}
\end{inputvars}
The ratio of the slip to adhesion areas is described by the parameter
$\varepsilon$ that's computed in the program on the basis of prescribed
creepages. It's effect is switched off by using $\alpha_{inf}=1$.
The original Fastsim algorithm is then recovered by using slope reduction
factor $k_0=1$.

The simplified theory is not realistic for computing the normal problem.
For this the full half-space approach is used (option ${\tt B}=0$). In
Hertzian problems, elliptical or parabolical traction bounds may be
used as alternatives, by setting ${\tt B}=2$ or 3. Of these options the
parabolical traction bound is advised. The elliptical traction bound and
the half-space solution cannot predict the shapes of adhesion and slip
areas well in cases with large spin, where there should be slipping near
the leading edge of the contact area. For non-Hertzian cases, two
approximate methods provided are KPEC (${\tt B}=5$) or ANALYN (${\tt B}=6$).

When using the simplified theory, the material parameters of Section
\ref{sec:lin_elast} must still be specified. These are used in the normal
problem when ${\tt B}=0$ and in the calculation of subsurface stresses,
which are both based on the full half-space approach.
% - L1, L2, L3 depend on \nu
% - subsurface stresses using full half-space solution

\subsection{Interfacial layer of contaminants}
\label{sec:intfc_layer}

\begin{figure}[bt]
\centering
\psfig{figure=fig/tractions_def2,width=4.8in,trim=180 240 100 200,clip=}
\caption{\em Illustration of tractions $p^{(a)}$ acting on bodies $a=1..3$
        and displacements $u^{(a)}$ in the bodies as a result of (gross)
        relative movement (creepage) $w$, in absense of micro-slip $s$.}
\label{fig:intfc_layer}
\end{figure}

Option ${\tt M}=4$ concerns the contact between two homogeneous, elastic
bodies as described in Section \ref{sec:lin_elast}, separated by a
so-called third-body layer that may be formed of metal oxides (wear
debris), friction modifiers, sand and clay, etc. This model is shown
schematically in Figure \ref{fig:intfc_layer}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/hou1997_schm_utot,width=3.2in,trim=0 0 30 0,clip=}
\psfig{figure=fig/hou1997_schm_tauc,width=3.2in,trim=0 0 30 0,clip=}
\caption{\em Left: Interfacial layer characteristics cf.\ Hou et al.\ 
        \cite{Hou1997}. Right: corresponding change of yield limit
        $\tau_c$ with accumulated plastic deformation: work-hardening
        ($k_\tau>0$) or softening ($k_\tau<0$), or elastic-perfectly
        plastic behavior ($k_\tau=0$).}
\label{fig:hou_schm}
\end{figure}

The layer is sheared elastically with
\begin{equation}
   \vec{u}_{el}^{(3)} = \vec{p}_t^{(1)} \cdot \frac{h^{(3)} }{ G^{(3)} } .
\end{equation}
Here $G^{(3)}$ is the shear modulus of the layer's material, and $h^{(3)}$
the layer thickness. 

Next, plasticity is introduced in the layer at locations where the tangential
stress reaches the yield limit $\tau_c$. This yield limit is characterized
using linear work-hardening or work-softening according to the
characteristics of Figure \ref{fig:hou_schm}, right:
\begin{equation}
        \tau_c = \tau_{c0} + k_\tau u^*_{pl} , \;\;
        u^*_{pl} = \int \| \dot{\vec{u}}_{pl} \| \,dt .
\end{equation}
Here $\tau_{c0}$ is the initial yield limit of fresh material, entering the
contact area, while $u^*_{pl}$ is the amount of plastic deformation
accumulated while passing through the contact. Work-hardening is obtained
using $k_\tau>0$, whereas work-softening occurs when $k_\tau<0$. The value
$k_\tau=0$ results in elastic-perfectly plastic behavior.

The slopes $k_u$ and $k_\tau$ used in Figure \ref{fig:hou_schm} are
related by
\begin{eqnarray}
    k_\tau = \frac{G^{(3)}/h^{(3)} \cdot k_u}{G^{(3)}/h^{(3)}-k_u} , \;\;
    k_u = \frac{G^{(3)}/h^{(3)} \cdot k_\tau}{G^{(3)}/h^{(3)}+k_\tau} .
                                                        \label{eq:k_tau}
\end{eqnarray}
In the input, the strength of the interfacial layer is described by four
parameters:
\begin{inputvars}
\inpvar{GG3}{\bunit{N/mm^2}}{Shear elastic modulus of the interface layer,
        $G^{(3)} > 0$.}
\inpvar{LAYTHK}{\bunit{mm}}{Thickness of the interface layer, $h^{(3)}\ge 0$.}
\inpvar{TAU\_C0}{\bunit{N/mm^2}}{Initial yield limit $\tau_{c0}^{(3)}$ at which
        plasticity starts to occur. No plasticity is computed when
        $\tau_{c0}\le 0$.}
\inpvar{K\_TAU}{\bunit{N/mm^3}}{Rate of increase $k_\tau$ of the yield limit
        $\tau_c$ with accumulated plastic deformation.}
\end{inputvars}
It is possible to use the tangential plasticity feature of CONTACT without
using a third body layer. This is accomplished by setting $h^{(3)}=0$.
In that case, plasticity is thought to occur near the surface of the softer
one of the primary bodies, cf.\ $u_{pl}^{(1)}$ in Figure \ref{fig:intfc_layer}.

\subsection{Influence coefficients for conformal contact}
\label{sec:num_infl}

The half-space approach relies on contact patches that are small compared
to the characteristic sizes of the two bodies. This assumption may be
violated if the contact patch is curved, for instance at the rail gauge
corner (Figure \ref{fig:worn_profile}). Conformal contacts therefore
require extension of the half-space approach, accounting for the conformal
shapes of the two bodies. This is provided in CONTACT through influence
coefficient options ${\tt C}_3=4$ and 9 (page \pageref{c3-digit}).

\begin{figure}[bt]
\centering
\psfig{figure=fig/wheel_3d_mesh_r80,height=1.6in,clip=}
\hspace{5mm}
\psfig{figure=fig/rail_3d_mesh_r80,height=1.4in,clip=}
\hspace{5mm}
\psfig{figure=fig/infl_asn_rail,height=1.8in,clip=}
\caption{\em Left/middle: finite element meshes used for numerical
        calculation of influence coefficients. Right: tangential
        response of the rail to a localized normal load for different radii
        of curvature, illustrating deviations from the half-space approach
        \cite{Vollebregt2014d-conformal}.}
\label{fig:quasiquart_mesh}
\end{figure}

Influence functions ($\mat{A}(\vec{x},\vec{x}')$ of equation
(\ref{eq:u_int_A_p})) describe how a body deforms at one position
($\vec{x}$) when loaded at another position ($\vec{x}'$). This relationship
depends on the shape of the body:
\begin{itemize}
\item A quarter-space that's loaded near the corner, will have larger
        elastic deformations than an elastic half-space with the same load
        (Figure \ref{fig:quasiquart_mesh}, middle/right).
\item Similarly, a three-quarterspace will have smaller deformations than
        an elastic half-space.
\end{itemize}
These differences between convex and concave bodies introduce a coupling
between normal and tangential contact problems.

The influence functions of the two bodies may be calculated separately,
using finite element methods, for instance, and provided to CONTACT in
tabular form, using an auxiliary file. This option is activated by
selecting ${\tt C}_3=9$ (page \pageref{c3-digit}). An additional line of
input is then required:
\begin{inputvars}
\inpvar{CFNAME}{\bunit{-}}{Filename for the input-file with numerically computed
        influence coefficients. The structure of this file is documented
        in Section \ref{sec:spec_inflcf}.}
\end{inputvars}

\begin{figure}[bt]
\centering
\psfig{figure=fig/blanco_rail_pn_v1,width=3.2in,trim=150 240 110 90,clip=}
\caption{\em Idea of Blanco's IF correction approach: the influence of
        loads exerted at $J$ on the displacements at $I$ depends on the
        angle variation $\alpha_J-\alpha_I$ between the two points.}
\label{fig:blanco-if}
\end{figure}

A quick way to estimate these influence functions was presented by
Blanco-Lorenzo et al.\ \cite{BlancoLorenzo2016,BlancoLorenzo2021a-inflcoef}.
This uses the surface inclination $\alpha$ to make a first order correction.
This is illustrated in Figure \ref{fig:blanco-if} for pressures $p_n$ exerted
at $J$, and their influence on elastic displacements at $I$.  This option is
provided in CONTACT for prismatic bodies, where the bodies are conformal in
$y-z$ directions only. It is activated with (experimental) ${\tt C}_3=4$.

The main input is the lateral surface inclination, using a table
$\{ (y_j, \alpha_j) \}, j=1\cdots n$ with linear interpolation.
\begin{inputvars}
\inpvar{NN}{-}{Number of points $y_j=\tilde{s}_j$ used along the (curved)
        contact surface.}
\inpvar{Y(J)}{\bunit{mm}}{Positions $y_j$ where $\alpha_j$ is given.}
\inpvar{ALPHA(J)}{\bunit{rad}}{Surface inclination $\alpha_j$ at position $y_j$.}
\end{inputvars}
Surface inclinations may be given relative to an arbitrary reference, e.g.\
using a global direction ($y_{tr}$), or a convienient (planar) local
direction ($\bar{s}$). Positive rotation is defined using the right-hand
rule as shown in Figure \ref{fig:blanco-if}.

Two methods are provided that each come in four variants. 
\begin{enumerate}\setcounter{enumi}{-1}
\item A fast approximation is provided using a linear fit of the table,
        corresponding to a constant radius of curvature.
\item The full method uses these surface inclinations as given,
        including all detail, which increases the computational work.
\end{enumerate}
\begin{inputvars}
\inpvar{IF\_METH}{-}{Fast (0) or detailed (1) method for surface
        inclinations.}
\inpvar{VARIANT}{-}{Variant used for the IF correction (1--4).}
\end{inputvars}
The variants concern the detailed formula used for the IF correction.
\magenta{
\begin{enumerate}
\item Blanco-proposal, decomposing pressures $\vec{p}$;
\item same, without $B_{xn}$ correction;
\item Vollebregt-proposal, transforming displacements $\vec{u}$;
\item Combined proposal, using $\vec{p}$ and $\vec{u}$.
\end{enumerate}
}

Numerically calculated influence coefficients can be combined with linearly
elastic materials (${\tt M}=0$, Section \ref{sec:lin_elast}) and with
interfacial layer (${\tt M}=4$, Section \ref{sec:intfc_layer}). These
material models will be used as `best guess' when subsurface stresses
are requested.

\magenta{
\subsection{Force based proportional damping}
\label{sec:damping}

A damping mechanism is provided aimed primarily at using CONTACT in a
multibody simulation via module 1. This damping mechanism takes the contact
forces $F_n^{el}, F_\tau^{el}$ computed by CONTACT for the previous and
current times, and sets
\begin{eqnarray}
  F_n^{tot} = F_n^{el} + F_n^{damp}, &\mbox{with}&
        F_n^{damp} = C_{damp,n} \fod{F_n^{el}}{t} , \\
  F_\tau^{tot} = F_\tau^{el} + F_\tau^{damp}, &\mbox{with}&
        F_\tau^{damp} = C_{damp,t} \fod{F_\tau^{el}}{t} , \; \tau=x,y .
\end{eqnarray}
The time derivatives $\txtfod{F^{el}}{t}$ are computed by a backward
difference quotient, e.g.\
\begin{equation}
        \fod{F_n^{el}}{t} = \max( -dF_{n,max}, \min( dF_{n,max}, dF_n )),
        \;\; dF_n = \frac{F_n^{el}(t)-F_n^{el}(t')}{t-t'} .
\end{equation}
This damping mechanism is activated by providing coefficients $C_{damp,n},
C_{damp,t}$ using the ${\tt M}_2$ digit. 
\begin{inputvars}
\inpvar{CDAMPN}{\bunit{s}}{Damping coefficient $C_{damp,n}$ for normal
        contact forces.}
\inpvar{CDAMPT}{\bunit{s}}{Damping coefficient $C_{damp,t}$ for tangential
        contact forces.}
\inpvar{DFNMAX}{\bunit{N/s}}{Maximum absolute value $dF_{n,max}$ used for
        $\txtfod{F_n^{el}}{t}$.}
\inpvar{DFTMAX}{\bunit{N/s}}{Maximum absolute value $dF_{\tau,max}$ used
        for $\txtfod{F_\tau^{el}}{t}$.}
\end{inputvars}
The forces $F^{tot}$ and $F^{damp}$ are currently not yet provided in the
output.
}

\section{Friction description}
\label{sec:fric_dscrp}

The local coefficient of friction $\mu=\mu(\vec{x},t)$ plays a central role
in the build up of tangential stresses between the contacting bodies.
Rather than being a constant, it may depend on the state of the two
surfaces, i.e.\ the presence of contaminants and fluids, and the local
surface temperature. This can be modelled using different approaches:
\begin{itemize}
\item The basic model consists of Coulomb friction with a prescribed,
        constant coefficient of friction.
\item `Falling friction' concerns situations where the total force is
        found to decrease with increasing creepage, after attaining a
        maximum value. This may be modelled with $\mu$ dependent on the
        slip velocity $s$.
\item Another approach to falling friction uses the surface temperature
        calculation, with $\mu$ dependent on $T$.
\item Different coefficients of friction may be experienced on the tread
        and flange of a wheel, for instance due to gauge face lubrication.
        This is facilitated using the {\tt V}-digit in module~1 (Section
        \ref{v-digit}), using different friction parameters for
        different sections on the rail.
\end{itemize}

\subsection{Dry Coulomb friction}

The basic friction law that is used by the program is dry, Coulomb friction
with a single coefficient of friction, 
\begin{equation}\label{eq:coulomb_law}
   \mu(\vec{x},t) = \mu_{stat} = \mu_{kin} .
\end{equation}
This option is obtained when ${\tt L}=0$. Two parameters must be given for
backward compatibility reasons.
\begin{inputvars}
\inpvar{FSTAT}{\bunit{-}}{Static coefficient of friction, $\mu_{stat}>0$.}
\inpvar{FKIN}{\bunit{-}}{Kinetic coefficient of friction $\mu_{kin}=\mu_{stat}$.}
\end{inputvars}
Previous versions of CONTACT allowed $\mu_{stat}$ to be larger than
$\mu_{kin}$. This is no longer supported, because the results are mostly
the same compared to using $\mu_{kin}$ throughout the entire contact.
This was discussed by Nielsen and Theiler for 2D situations
\cite{Nielsen1996}. The remaining differences due to $\mu_{stat}>\mu_{kin}$
are considered artifical effects of grid discretization. 

\subsection{Slip velocity dependent friction}
\label{sec:veldep_fric}

Other friction laws, particularly concerning slip-velocity dependent
friction, have been implemented too. These are illustrated in Figure
\ref{fig:fric_laws}. Results for these methods are included in the
example in Section \ref{sec:ex_tractcurv}\allexamp{, whereas a detailed
investigation is shown in Section \ref{sec:ex_veldep}}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/fric_laws,width=4in,clip=}
\caption{\em Dependence of friction coefficient $\mu$ on absolute slip
velocity $s_a$ for the friction laws of equations
(\ref{eq:exponential_law})--(\ref{eq:rational_law}).}
\label{fig:fric_laws}
\end{figure}

When ${\tt L}=4$, an exponential decrease of the friction coefficient
is used:
\begin{equation}\label{eq:exponential_law}
   \mu_s(s_a) = \mu_{kin} +
        \mu_{exp1} \exp(-\log(2)\cdot s_a/s_{h1}) +
        \mu_{exp2} \exp(-\log(2)\cdot s_a/s_{h2})
\end{equation}
Here $s_a(\vec{x},t)$ is the magnitude of the absolute slip velocity ($\ge 0$)
at position $\vec{x}$.\footnote{\label{foot:s_a}In the calculation of shifts
(${\tt T}=1$) the absolute slip velocity $s_a$ is computed as $S_a/\delta t$,
with $S_a$ the slipped distance $\bunit{mm}$ and $\delta t=1\unit{s}$.}
$\mu_{exp1}, \,\mu_{exp2}, \,s_{h1}$ and $s_{h2}$ are the coefficients of
the friction law. Two terms are provided for flexibility, and allow two
different time-scales to be incorporated. $\mu_{exp1}$ and $\mu_{exp2}$ are
the maximum sizes of the exponential terms (at $s_a=0$, $\mu_{stat}=\mu_{kin}+
\mu_{exp1}+\mu_{exp2}$). Setting one of these to zero disables a term.
$s_{h1}$ and $s_{h2}$ are the absolute slip velocities at which the size of
the terms is halved compared to $s_a=0$.
\begin{inputvars}
\inpvar{FKIN}{\bunit{-}}{Limit value $\mu_{kin}>0$ for the coefficient of
        friction for large slip velocities, used when ${\tt L}=2-4$.}
\inpvar{SABSH1}{\bunit{mm/s}}{Absolute slip velocity $s_{h1}>0$ for which
        the size of a term is halved compared to $s_a=0$. Used when
        ${\tt L}=2-4$.}
\inpvar{SABSH2}{\bunit{mm/s}}{Absolute slip velocity $s_{h2}>0$ for which
        the size of a term is halved compared to $s_a=0$. Used when
        ${\tt L}=2-4$.}
\inpvar{FEXP1}{\bunit{-}}{Coefficient $\mu_{exp1}$ of
        (\ref{eq:exponential_law}), used when ${\tt L}=4$.}
\inpvar{FEXP2}{\bunit{-}}{Coefficient $\mu_{exp2}$ of
        (\ref{eq:exponential_law}), used when ${\tt L}=4$.}
\end{inputvars}

Note that equation (\ref{eq:exponential_law}) incorporates Polach's
exponential formula \cite{Polach2005},
\begin{equation}\label{eq:polach_law}
   \mu_s(s_a) = \mu_{stat} \left( (1-A) e^{-B s_a} + A \right) .
\end{equation}
For given $A$ and $B$, one may simply set $\mu_{kin}=A\mu_{stat}$,
$\mu_{exp1}=(1-A)\mu_{stat}$, $s_{h1}=\log(2)/B$ and use $\mu_{exp2}=0$.
Note that $B$ should be given with unit $\bunit{s/mm}$, $1000\times$ smaller
than the reference values provided in \cite{Polach2005}, with unit
$\bunit{s/m}$.

When ${\tt L}=2$, a linear decrease of the friction coefficient is used,
until a certain minimum is reached:
\begin{equation}\label{eq:linear_law}
   \mu_s(s_a) = \mu_{kin} +
           \mu_{lin1} \cdot \max( 0, 1 - s_a/2s_{h1} ) +
           \mu_{lin2} \cdot \max( 0, 1 - s_a/2s_{h2} )
\end{equation}
$\mu_{lin1}$ and $\mu_{lin2}$ are the maximum sizes of the linear terms.
\begin{inputvars}
\inpvar{FLIN1}{\bunit{-}}{Coefficient $\mu_{lin1}$ of (\ref{eq:linear_law}),
        used when ${\tt L}=2$.}
\inpvar{FLIN2}{\bunit{-}}{Coefficient $\mu_{lin2}$ of (\ref{eq:linear_law}),
        used when ${\tt L}=2$.}
\end{inputvars}

When ${\tt L}=3$, a decrease of the friction coefficient is used described by
a so-called rational formula:
\begin{equation}\label{eq:rational_law}
   \mu_s(s_a) = \mu_{kin} +
        \frac{\mu_{rat1}}{1+s_a/s_{h1}} +
        \frac{\mu_{rat2}}{1+(s_a/s_{h2})^2}
\end{equation}
The two terms can again be configured independently. The parameters
$\mu_{rat1}$ and $\mu_{rat2}$ control their sizes, and $s_{h1}$ and
$s_{h2}$ the rate of decay.
\begin{inputvars}
\inpvar{FRAT1}{\bunit{-}}{Coefficient $\mu_{rat1}$ of (\ref{eq:rational_law}),
        used when ${\tt L}=3$.}
\inpvar{FRAT2}{\bunit{-}}{Coefficient $\mu_{rat2}$ of (\ref{eq:rational_law}),
        used when ${\tt L}=3$.}
\end{inputvars}

\subsection{Temperature dependent friction}
\label{sec:temp_dep_friction}

\begin{figure}[bt]
\centering
\optionaltikz{
\begin{tikzpicture}[scale=1.3]
    \coordinate (o)  at (-1,0);
    \coordinate (x)  at  (5,0);
    \coordinate (y)  at (-1,3.5);
    \coordinate (q)  at (-1,3);
    \coordinate (qy) at (-1.1,3);
    \coordinate (w)  at  (0,3);
    \coordinate (wx) at  (0,-.1);
    \coordinate (e)  at  (4,1);
    \coordinate (ey) at (-1.1,1);
    \coordinate (ex) at (4,-0.1);
    \coordinate (r)  at  (5,1);
    \coordinate (h)  at (2,2);
    \coordinate (hx) at (2,1);
    \coordinate (hy) at (0,2);
    \coordinate (hxy) at (2,2.2);
    \node at (qy) [left]  {$\mu_{ref}$};
    \node at (hy) [right] {$\Delta\mu_{heat}$};
    \node at (ey) [left]  {$\mu_{kin}$};
    \node at (wx) [below] {$T_{ref}$};
    \node at (hx) [below] {$\Delta T_{heat}$};
    \node at (ex) [below] {$T_{kin}$};
    \node at (hxy) [right] {$\mu_s(T_{srf})$};
    \node at (y) [above] {$\mu_s\,[-]$};
    \node at (x) [right] {$T_{srf}\,[\celc]$};
    \draw (y) -- (o) -- (x);
    \draw [red,thick] (q) -- (w) -- (e) -- (r);
    \draw [dashed] (qy) -- (q);
    \draw [dashed] (ey) -- (e);
    \draw [dashed] (wx) -- (w);
    \draw [dashed] (ex) -- (e);
\end{tikzpicture}
}
\caption{\em Piecewise linear dependence of friction on surface temperature
        cf.\ equation (\ref{eq:mu_T}). In this case $\Delta\mu_{heat}$ is 
        negative, resulting in a decreasing coefficient of friction.}
\label{fig:mu_T}
\end{figure}

Option ${\tt L}=6$ uses a piecewise linear relationship between the surface
temperatures $T_{srf}$, computed with the {\tt H}-digit, and the coefficient
of friction $\mu$:
\begin{equation}\label{eq:mu_T}
        \mu_s(T_{srf}) = \left\{ \begin{array}{lll}
                \mu_{ref} & T_{srf} \le T_{ref} \\
                \mu_{ref} + \Delta\mu_{heat}
                                \frac{T_{srf}-T_{ref}}{\Delta T_{heat}} 
                          & T_{ref} \le T_{srf} \le T_{kin}, &
                            T_{kin} = T_{ref} + \Delta T_{heat} \\
                \mu_{kin} & \hspace{12.5mm} T_{srf}\ge T_{kin},       &
                            \mu_{kin} = \mu_{ref} + \Delta\mu_{heat}
        \end{array} \right. 
\end{equation}
Here $T_{srf}$ is the bulk surface temperature in $\mbox{}\celc$,
$T_{ref}$ is the lower temperature at which $\mu$ starts changing,
$T_{kin}$ is the upper temperature at which $\mu$ stops changing,
$\mu_{kin}$ is the ultimate value for $\mu$ at high temperatures, and
$\Delta\mu_{heat}$ the temperature dependent part of $\mu$. 
Equation (\ref{eq:mu_T}) is illustrated in Figure \ref{fig:mu_T}. 
\begin{inputvars}
\inpvar{FREF}{\bunit{-}}{Reference value $\mu_{ref}>0$ for the coefficient of
        friction at low surface temperatures.}
\inpvar{TREF}{\bunit{\celc}}{Reference temperature $T_{ref}$ of equation
        (\ref{eq:mu_T}).}
\inpvar{DFHEAT}{\bunit{-}}{Coefficient $\Delta\mu_{heat}$ of (\ref{eq:mu_T}),
        with $\mu_{ref}+\Delta\mu_{heat}>0$.}
\inpvar{DTHEAT}{\bunit{\celc}}{Coefficient $\Delta T_{heat}>0$ of (\ref{eq:mu_T}).}
\end{inputvars}
Equation (\ref{eq:mu_T}) allows
for gradual transitions, for instance using $T_{ref}=0\celc$ and $\Delta
T_{heat}=800\celc$, as well as sharp transitions at any given temperature,
e.g.\ $T_{ref}=400\celc, \Delta T_{heat}=100\celc$. Positive values for
$\Delta\mu_{heat}$ may be used, to explore the effects of friction
increasing with temperature.

\subsection{Friction memory}

The friction laws of Section \ref{sec:veldep_fric} lead to
unwanted effects in transient calculations when they are based on the
instantaneous slip velocity $s_a$ at time $t$. This is \allexamp{illustrated
in the example in Section \ref{sec:ex_veldep} and} analysed
\allexamp{further} in \cite{Vollebregt2012a-quasistd}. The point is that the
friction coefficient changes abruptly at the transition from the adhesion
to the slip area, see the line `$d_c=0$' in Figure \ref{fig:fric_mem}. 

To circumvent these unwanted effects, the coefficient $\mu_s$ is
not applied directly but via a relaxation process. The actual friction
coefficient $\mu(\vec{x},t)$ tends towards the target value
$\mu_s(s_a(\vec{x},t))$, but also has a memory for the previous values of
$\mu$ and $s_a$:
\begin{equation}
  \dot{\mu}(\vec{x},t) = -\frac{\max(s_a(\vec{x},t),s_0)}{d_c}
            \left( \mu(\vec{x},t) - \mu_s(s_a(\vec{x},t)) \right)
                \label{eq:dmu_dt}
\end{equation}

\begin{figure}[bt]
\centering
\psfig{figure=fig/veldep1_mu,width=3.2in,clip=}
\caption{\em Typical effect of friction memory (equation (\ref{eq:dmu_dt}))
on the friction coefficient $\mu$: gradual instead of abrupt change of
$\mu(\vec{x},t)$.}
\label{fig:fric_mem}
\end{figure}

This form implies that the transient behavior consists of an exponential
decay towards the steady state value $\mu_s$. $d_c$ is the characteristic
sliding distance over which the adaptation occurs (typically in the order
of $\mu m$). Its effect is illustrated in Figure \ref{fig:fric_mem}, showing
the actual friction coefficient $\mu(\vec{x},t)$ for a steady rolling
cylinder. The coefficient $s_0$ is a small velocity (${\cal O}(mm/s)$) that
allows the friction coefficient to change in the adhesion area (where
$s_a=0$), if it comes from a different value than the static coefficient
$\mu_{stat}=\mu_s(0)$.
\begin{inputvars}
\inpvar{MEMDST}{\bunit{mm}}{Characteristic distance $d_c$ for the friction memory
        effect ($\ge 0$). An instantaneous friction law is obtained by
        setting $d_c=0$.}
\inpvar{MEM\_S0}{\bunit{mm/s}}{Minimum velocity $s_0$ for the friction memory
        effect ($\ge 0$).}
\end{inputvars}

In cases where ${\tt L}=1$, the friction law and coefficients of the previous
case are maintained.

\subsection{Friction variation}
\label{sec:varfrc}

The input parameters for the friction laws ${\tt L}=0, 2\text{--}4, 6$ as
discussed above, may be varied laterally, along the rail profile (module
1)\magenta{\ or contact $y$-direction (module 3)}, using the option 
${\tt V}=1$. The parameters are specified at two or more control points. 
\begin{inputvars}
\inpvar{NVF}{ }{Number of control points $n_{vf}$ for friction variation.}
\end{inputvars}
Linear interpolation is used between these points, while the parameters
are held constant outside of this range.

The control points on the rail profile are defined indirectly, using the
rail surface inclination:
\begin{inputvars}
\inpvar{ALPHVF}{\bunit{rad}}{Rail surface inclinations at the control points,
        $\alpha_{vf,i}, i=1\cdots n_{vf}$.}
\end{inputvars}
The surface inclination is measured in rail profile coordinates, from the
horizontal $y_r$-axis to the inclined surface. Negative values are found on
gauge face, small values at the top of the rail, increasing to $90^\circ$ at
the field side of the rail. The values must be entered in increasing order.

\magenta{
Friction variation is supported in module 3 through option ${\tt V}=2$
(option ${\tt V}=1$ is not supported).
This requires that the parameters for the friction laws are given for each
row of the grid. This uses ${\tt NVF}={\tt MY}$ and avoids any
interpolation.
}

\section{Potential contact area and discretisation}
\label{sec:pot_con}

\begin{figure}[bt]
\centering
\psfig{figure=fig/potcon_numbering,width=5in,trim=60 140 20 110,clip=}
\caption{\em The potential contact area, its discretisation, and the
        numbering of the elements.}
\label{fig:potcon_discr}
\end{figure}

The potential contact area is a rectangular area aligned with the $x$- and
$y$-axes, $(x,y)\in[x_l,x_h] \times[y_l,y_h]$. It is divided into
$m_x\times m_y$ rectangular elements of size $\delta x\times\delta y$, see
Figure~\ref{fig:potcon_discr}.
\begin{inputvars}
\inpvar{MX, MY}{\bunit{-}}{The number of discretisation elements in $x$- and
        $y$-directions respectively, number of columns and rows of the
        discretisation grid.}
\inpvar{NPOT}{\bunit{-}}{Total number of discretisation elements, ${\tt
        NPOT}={\tt MX}\cdot {\tt MY}$.}
\end{inputvars}
The elements are numbered using two-dimensional indices $(i_x,i_y)\in
\{1\cdots m_x\}\times\{1\cdots m_y\}$, as well as with a one-dimensional
index
\begin{equation}\label{eq:1d_index}
        I=i_x+(i_y-1)\cdot m_x .
\end{equation}
The centers of the elements are given by:
\begin{equation}\label{eq:x_i}
   \vec{x}_I = \left[ x_l+(i_x-\frac{1}{2})\cdot \delta x,
                y_l+(i_y-\frac{1}{2})\cdot \delta y \right]^T
\end{equation}
Note: the potential contact area should be somewhat larger than the true
contact area:
\begin{enumerate}
\item The solver SteadyGS for the steady state rolling problem requires one
        `exterior' element at the trailing edge of the contact area. If
        there is an interior element in the first grid column ($i_x=1$),
        SteadyGS will not be used, the slower and less robust ConvexGS will
        be used instead.
\item To properly estimate the displacement difference $\vec{u}_t$ at the
        leading edge requires two `exterior' elements there too (last two
        grid columns, $m_x-1$ and $m_x$). In grid rows where these
        elements are not available, the so called leading edge correction
        will be switched off.
\end{enumerate}
It is recommended to use two additional grid rows and columns around the
actual contact area at all sides.

In a sequence of cases (${\tt P}=0, 1$), the potential contact areas used
need to be aligned between consecutive cases.
\begin{itemize}
\item Using equal step sizes $\delta x, \delta y$, within a tolerance of
        $0.01\%$ of $\min(\delta x,\delta y)$;
\item Using offsets $x_l-x'_l=k_x\,\delta x, y_l-y'_l=
        k_y\,\delta y$ with integer $k_x, k_y$, within a tolerance of
        $0.1\%$ of $\min(\delta x,\delta y)$;
\item With the potential contact area for the new case large enough such
        that all elements that were in contact at the previous time are
        included in the new potential contact.
\end{itemize}
These requirements can be understood as using a constant, infinite `super
grid' with a time-varying `active window'.

The location and discretisation of the potential contact area can be
specified in a number of ways.
\begin{inputvars}
\inpvar{IPOTCN}{-}{Integer flag. Negative values: Hertzian options,
        positive values: direct specification of potential contact area
        by the user.}
\end{inputvars}
The available options are discussed in Sections \ref{sec:hertz3d} to
\ref{sec:nonhzvar}.

\subsection{Elliptical contacts -- 3D Hertzian geometries}
\label{sec:hertz3d}

\begin{figure}[bt]
\centering
\psfig{figure=fig/vert_circles,width=3.2in,trim=34 10 85 50,clip=}
\psfig{figure=fig/skewed_circles,width=3.2in,trim=35 100 85 140,clip=}
\caption{\em Left: vertical sections of a wheel in global
        $Oxyz$-coordinates, circles of almost the same radius $R_w(y)$.
        Right: rotated to contact local $Oxsn$-coordinates, all circles
        touching at $n=0$. The effective radius becomes $R_{x,\eff}=
        R_w(y)/\cos(\delta)$ \cite{Vollebregt2018b-corrigendum}.}
\label{fig:skewed_circles}
\end{figure}

The variables in this section concern the geometry of the bodies when the
problem is Hertzian, with constant radii of curvature in $x$- and
$y$-directions. The potential contact area is then derived from the
Hertzian solution.
\begin{inputvars}
\inpvar{AA, BB}{\bunit{mm}}{The semi-axes $a,b$ of the contact ellipse.}
\inpvar{A1, B1}{\bunit{mm^{-1}}}{The curvatures $A,B$ in $x$- and $y$-direction.}
\end{inputvars}
The curvatures are related to the effective radii of curvature of the two
bodies by
\begin{equation}\label{eq:a1_b1}
   {\tt A1} = \frac{1}{2 R_{x,\eff}^{(1)}} + \frac{1}{2 R_{x,\eff}^{(2)}} , \;\;
   {\tt B1} = \frac{1}{2 R_y^{(1)}} + \frac{1}{2 R_y^{(2)}} .
\end{equation}
In wheel-rail contact, the effective rolling radius for the wheel is 
$R_{x,\eff}=R_w(y)/\cos(\delta)$ \cite{Vollebregt2018b-corrigendum}. 
That is, the contact angle $\delta$ makes the surface look flatter in
rolling direction. This is illustrated in Figure \ref{fig:skewed_circles}
using constant wheel radius $R_w$. (In practice, $R_w$ varies along the
profile. This is a second order effect, because the actual values of $R_w$
are much bigger than shown in the figure.)

The Hertzian solution may be described in the input in different combinations:
\begin{itemize}
\item ${\tt IPOTCN}=-1$: curvatures {\tt A1}, {\tt B1} specified;
\item ${\tt IPOTCN}=-2$: curvature {\tt A1} and aspect ratio
        ${\tt AA}/{\tt BB}$ specified;
\item ${\tt IPOTCN}=-3$: semi-axes {\tt AA}, {\tt BB} specified.
\end{itemize}
Other variables used in the Hertzian problem are the material constants
(Section \ref{sec:matcns}) and either the approach {\tt PEN} or the
normal force {\tt FN}, see Section \ref{sec:kincns}.

The pressure distribution may be computed from the geometry (${\tt B}=0$),
or can be prescribed beforehand.
\begin{eqnarray}
 \mbox{elliptical}, {\tt B}=2  &:& 
                p_n(x,y) = p_{max} \sqrt{ 1 - (x/a)^2 - (y/b)^2 },
        \;\; p_{max} = \frac{3F_n}{2\pi ab}, \\
 \mbox{parabolical}, {\tt B}=3 &:& 
                p_n(x,y) = p_{max} \left( 1 - (x/a)^2 - (y/b)^2 \right),
        \;\; p_{max} = \frac{2F_n}{\pi ab} .
\end{eqnarray}

The potential contact area is taken as the rectangle $[-{\tt AA}\cdot s,{\tt
AA}\cdot s] \times [-{\tt BB}\cdot s,{\tt BB}\cdot s]$ with $s={\tt
SCALE}$. 
\begin{inputvars}
\inpvar{SCALE}{\bunit{-}}{Scale parameter for the potential contact area.}
\end{inputvars}
Choose ${\tt SCALE}=1.1$ for a potential contact area that is 10\%
larger than the actual Hertzian contact area, or ${\tt SCALE}={\tt MX}/({\tt
MX-4})$ to add two unused rows and columns around the actual contact
ellipse.

In non-quasiidentity, the true contact can fall outside the Hertzian ellipse.
Therefore a larger potential contact area should be used. This is achieved by
setting ${\tt SCALE}>1$ in those cases.

\subsection{Rectangular contacts -- 2D Hertzian geometries}
\label{sec:hertz2d}

Finite line contacts are defined by the assumption that the pressure
distribution is uniform on $y\in[-b,b]$, conforming with the
2D Hertzian solution, and zero outside this range.
\begin{itemize}
\item ${\tt IPOTCN}=-4$: rectangular contact specified by curvature
        {\tt A1} and half width {\tt BB};
\item ${\tt IPOTCN}=-5$: rectangular contact with half length {\tt AA} and
        half width {\tt BB}.
\end{itemize}
The pressure distribution is then prescribed using options ${\tt B}=2$ or 3,
using Hertzian formulas in each strip $y=const$:
\begin{eqnarray}
 \mbox{elliptical}, {\tt B}=2  &:& 
                p_n(x,y) = p_{max} \sqrt{ 1 - (x/a)^2 },
        \;\; p_{max} = \frac{2F_n}{\pi aL}, \;\; L=2b, \\
 \mbox{parabolical}, {\tt B}=3 &:& 
                p_n(x,y) = p_{max} \left( 1 - (x/a)^2 \right),
        \;\; p_{max} = \frac{3F_n}{4aL} .
\end{eqnarray}
These options require that the total force be prescribed (${\tt N}=1$,
page \pageref{n3-digit}).

\subsection{SDEC: simple double half-elliptical contact area}
\label{sec:sdec}

\begin{figure}[bt]
\centering
\psfig{figure=fig/sdec_schema,width=2.2in,trim=170 50 130 40,clip=}
\caption{\em Definitions for the double half-elliptical contact region of
        the SDEC approach.}
\label{fig:sdec_schema}
\end{figure}

The variables in this section allow to create a contact area that consists
of two half-ellipses with different semi-axes according to the SDEC
approach \cite{Piotrowski2017}. 
\begin{itemize}
\item ${\tt IPOTCN}=-6$: SDEC approach, using {\tt AA}, {\tt BNEG} and {\tt
        BPOS}.
\end{itemize}
The dimensions regarding the two half ellipses are illustrated in Figure
\ref{fig:sdec_schema}. Note that the origin of the contact coordinates is
chosen differently than in \cite{Piotrowski2017}, as discussed in
\cite{Vollebregt2018a-sdec}.
\begin{inputvars}
\inpvar{AA}{\bunit{mm}}{Semi-axis $a$ of the two half ellipses in $x$-direction.}
\inpvar{BNEG, BPOS}{\bunit{mm}}{The semi-axes $b_{neg},b_{pos}$ of the two half
        contact ellipses in $y$-direction.}
\end{inputvars}
The pressure distribution is then prescribed using option ${\tt B}=4$,
using a Hertzian-like formula in each strip $y=const$:
\begin{eqnarray}
% positieve psi: b_{pos} > b_{neg}, dus y_0 < 0
   b = \frac{b_{pos}+b_{neg}}{2}, \;\;
%  b_{pos} = b - y_0, \;\;
%  b_{neg} = b + y_0, \;\;
   \psi = \frac{b_{pos} - b_{neg}}{2 b}, \;\;
   y_0 = - b \psi,  \\
%  y_0 = - \frac{b_{pos} - b_{neg}}{ 2 }, \;\;
%  \psi = -\frac{y_0}{b}, \\
   y-y_0 > 0: x_{l,pos} = 
                a \sqrt{ 1 - \frac{ (y-y_0)^2 }{ b^2 (1+\psi)^2 } }, \\
   y-y_0 < 0: x_{l,neg} = 
                a \sqrt{ 1 - \frac{ (y-y_0)^2 }{ b^2 (1-\psi)^2 } }, \\
   p_{max} = \frac{3}{2} \frac{F_n}{ \pi ab}, \;\;
   p_n(x,y) = \frac{p_{max}}{a} \sqrt{x^2_l(y) - x^2} .
\end{eqnarray}
The precise form of the undeformed distance is then constructed from the
pressure profile.

Other variables used in the SDEC approach are the material constants
(Section \ref{sec:matcns}), the normal force {\tt FN}, see Section
\ref{sec:kincns}, and the {\tt SCALE} parameter of the Hertzian approach
(Section \ref{sec:hertz3d}).

\subsection{Direct specification of the potential contact area}
\label{sec:nonhzvar}

The parameters related to the potential contact area and its discretisation
are shown in Figure \ref{fig:potcon_discr}:
\begin{inputvars}
\inpvar{DX, DY}{\bunit{mm}}{Sides $\delta x,\delta y$ of each element.}
\inpvar{XL, YL}{\bunit{mm}}{Coordinates $(x_l,y_l)$ of the lower left corner of
        the potential contact area.}
\inpvar{XH, YH}{\bunit{mm}}{Coordinates $(x_h,y_h)$ of the upper right corner of
        the potential contact area.}
\inpvar{XC1, YC1}{\bunit{mm}}{Coordinates of the center of element $(1,1)$
        of the potential contact area.}
\inpvar{XCM, YCM}{\bunit{mm}}{Coordinates of the center of element $(m_x,m_y)$
        of the potential contact area.}
\end{inputvars}
Different options are available, as indicated by variable {\tt IPOTCN}.
\begin{itemize}
\item ${\tt IPOTCN}=1$: coordinates {\tt XL}, {\tt YL} specified together
        with stepsize {\tt DX}, {\tt DY};
\item ${\tt IPOTCN}=2$: coordinates {\tt XL}, {\tt YL} specified together with
        coordinates {\tt XH}, {\tt YH};
\item ${\tt IPOTCN}=3$: coordinates {\tt XC1}, {\tt YC1} specified together
        with stepsize {\tt DX}, {\tt DY};
\item ${\tt IPOTCN}=4$: coordinates {\tt XC1}, {\tt YC1} specified plus
        {\tt XCM}, {\tt YCM}. (Note: not allowed when ${\tt MX}=1$ or ${\tt
        MY}=1$.)
\end{itemize}

\section{Non-Hertzian geometry specification}
\label{sec:ibase}

In Hertzian problems the geometry is specified by the loading parameters
and curvatures, see Section \ref{sec:hertz3d}. In non-Hertzian cases the
distance $h(\vec{x})$ between the undeformed surfaces of the two bodies must
be specified. For this different parametrisations are available.
\begin{inputvars}
\inpvar{IBASE}{-}{Integer flag. Form of undeformed distance.}
\end{inputvars}
\vspace{-2ex}
\begin{itemize}
\item ${\tt IBASE}=1$: undeformed distance is quadratic in $(x,y)$.
\item ${\tt IBASE}=2$: the bodies are circular in $x$, the profile in
        $y$-direction is specified.
\item ${\tt IBASE}=3$: the profile is quadratic plus the difference of two
        sines in $x$-direction.
\item ${\tt IBASE}=9$: a general profile is used, the undeformed distance
        is specified explicitly for all elements.
\end{itemize}
\label{itm:ibase1}When ${\tt IBASE}=1$ the following formula is used:
\begin{equation}\label{eq:quadr_ud}
  h(x,y) = b_1 \, x^2 + b_2 \, x \, y + b_3 \, y^2 + b_4 \, x + b_5 \, y + b_6
\end{equation}
\vspace{-3ex}
\begin{inputvars}
\inpvar{B(1:3)}{\bunit{mm^{-1}}}{Coefficients of quadratic terms.}
\inpvar{B(4:5)}{\bunit{-}}{Coefficients of linear terms.}
\inpvar{B(6)}{\bunit{mm}}{Coefficient of constant term.}
\end{inputvars}
\label{itm:ibase2}Option ${\tt IBASE}=2$ is intended for non-Hertzian
rolling of a body of revolution. The axle of the body is parallel to the
$y$-axis at $x$-coordinate $x_m$. The effective radius of curvature in
$x$-direction is $R_m$. The profile `$p(y)$' in $y$-direction is arbitrary.
It is specified at a regular spacing, which may be different from the
grid sizes used in the potential contact area. Linear inter- or
extrapolation is used to get the profile at other $y$-coordinates.
The formula used for the undeformed distance is
\begin{equation}\label{eq:circ_x_ud}
  h(x,y) = p(y) + \frac{(x-x_m)^2}{2\,R_m}
\end{equation}
\begin{inputvars}
\inpvar{NN}{-}{Number of profile points in $y$-direction.}
\inpvar{XM}{\bunit{mm}}{$x$-coordinate of the axis of the body of revolution.}
\inpvar{RM}{\bunit{mm}}{Effective radius of curvature of the surface in rolling
        direction.}
\inpvar{Y1}{\bunit{mm}}{Lowest $y$-coordinate $y_1$ for which the profile is
        specified.}
\inpvar{DY1}{\bunit{mm}}{Increment of $y$-coordinates between successive points
        $y_k$ and $y_{k-1}$.}
\inpvar{B(1:NN)}{\bunit{mm}}{Profile heights $p(y_k)$ above $z=0$ for the sample
        points $y_k$, $k=1\cdots{\tt NN}$.}
\end{inputvars}
Note that the specification of the profile here has nothing to do with the
choice of the potential contact area. More specifically: the number of
heights {\tt NN} is independent of the number of rows {\tt MY}. The profile
will be determined by interpolation between the successive heights.

Note further that the effective rolling radius can be different from the
vertical height of the axle above the plane. The undeformed distance is
measured in normal direction. For a wheel with radius $R$ and a contact
angle $\delta$, the effective radius of curvature is $R/\!\cos\delta$,
see Section \ref{sec:hertz3d} (Figure \ref{fig:skewed_circles}) and
\cite[eq.\ (1.61b)]{Kalker1990}.

\label{itm:ibase3}The formula used with ${\tt IBASE}=3$ is the following.
\begin{equation}
 h(x,y) = b_1 \sin( b_2 ( x - b_3 ) ) -  b_4 \sin( b_5 ( x - b_6 ) ) +
        x^2/b_7 + y^2 / b_8
\end{equation}
This implies that $b_7$ and $b_8$ are radii of curvature ($\bunit{mm^{-1}}$),
$b_1$ and $b_4$ are vertical distances ($\bunit{mm}$), $b_3$ and $b_6$ are
horizontal positions where the sines are zero ($\bunit{mm}$), and $b_2$ and $b_5$
are frequencies ($\bunit{rad/mm}$).

\label{itm:ibase9}When ${\tt IBASE}=9$, the values $h(\vec{x}_I)$ are
specified for all elements $I$.
\begin{inputvars}
\inpvar{H(I)}{\bunit{mm}}{Undeformed distance at center of element $I$.}
\end{inputvars}
Refer to (\ref{eq:1d_index}) and (\ref{eq:x_i}) for the numbering and
coordinates of the elements.

The specification of the undeformed distance may be completed by the
application of a so-called {\em planform}. Elements that lie outside the
planform will get a very large undeformed distance so that they cannot
enter the contact area.
\begin{inputvars}
\inpvar{IPLAN}{-}{Integer flag. Type of planform.}
\end{inputvars}
\vspace{-2ex}
\begin{itemize}
\item ${\tt IPLAN}=1$: Unrestricted planform, all elements of the potential
        contact area may enter the actual contact area.
\item ${\tt IPLAN}=2$: Quadratic planform. Elements are excluded from the
        contact area when a qua\-dra\-tic function $pl(x,y)$ is $\ge 0$. The
        function $pl$ is specified by six parameters analogously to $h(x,y)$
        in (\ref{eq:quadr_ud}).
\item ${\tt IPLAN}=3$: Union of two rectangles, specified by eight parameters.
\begin{equation}
        [ x_l^{(1)}, x_h^{(1)} ] \times [ y_l^{(1)}, y_h^{(1)} ]
        \;\; \cup \;\;
        [ x_l^{(2)}, x_h^{(2)} ] \times [ y_l^{(2)}, y_h^{(2)} ]
\end{equation}
The parameters are specified in the order in which they occur in this
formula.
\magenta{
\item ${\tt IPLAN}=4$: Weighted interaction between $n_{patch}$ different
contact patches. Contact patches are separated at given
$y_{i\text{--}i+1}$-values. The effect of pressures on normal displacements
of different patches is multiplied by factors $f_{i,j}\in[0,1]$, e.g.\
\begin{equation}
        n_{patch} = 3, \;\;
        \vec{y} = \left[ \begin{array}{c} 
                         y_{1\text{--}2} \\ y_{2\text{--}3} 
                  \end{array} \right] , \;\;
        \mat{F} = \left[ \begin{array}{ccc}
                                1 & f_{1,2} & f_{1,3} \\
                                * &   1     & f_{2,3} \\
                                * &   *     &    1      \end{array} \right] .
\end{equation}
The $y$-values must be strictly increasing, i.e.\ $y_{1\text{--}2} < 
y_{2\text{--}3}$. The matrix $\mat{F}$ is symmetrical and may usually be
tridiagonal. The multiplication factors $f$ are retrieved in row-wise
order: $f_{1,2}, f_{1,3}, f_{2,3}$.
}
\end{itemize}

\section{Kinematic variables}
\label{sec:kincns}

The normal problem is specified either using the approach or the total
normal force, depending on the ${\tt N}_3$-digit (page \pageref{n3-digit}).
\begin{inputvars}
\inpvar{PEN}{\bunit{mm}}{Approach $\delta_n$ of the two bodies. Constant offset to
        the profile specification $h(x,y)$: the total undeformed distance
        is $h(x,y)-\delta_n$. If the minimum of $h(x,y)$ is 0, $\delta_n$ is
        the maximum penetration of the undeformed surfaces.}
\inpvar{FN}{\bunit{N}}{Total normal force in the contact area.}
\end{inputvars}

\subsection{\texorpdfstring{Tangential quantities in case of a shift 
        (${\tt T}=1$)}{}}
\label{sec:kincns_shift}

In the calculation of a shift (${\tt T}=1$), the following variables are used
to characterize the relative motion of the two bodies:
\begin{inputvars}
\inpvar{CKSI, CETA}{\bunit{mm}}{Rigid shift, i.e.\ the displacement of the two
        bodies' axles in $x$- and $y$-directions respectively in a time
        step $\delta t$.}
\inpvar{CPHI}{\bunit{rad}}{Rotation shift, angular displacement of the two
        bodies around the $z$-axis in a time step $\delta t$.}
\inpvar{SPINXO,YO}{\bunit{mm}}{Optional `spin center' $(x_o,y_o)$ cf.\
        \cite{Vollebregt2018a-sdec}, default $(0,0)$.}
\end{inputvars}
When ${\tt E}_3=9$ an additional term is added:
\begin{inputvars}
\inpvar{EXRHS(I,:)}{\bunit{mm}}{Extra term in the rigid shift of the elements,
        specified explicitly by the $x$- and $y$-components for each
        element (order: $x,y$ for element 1, $x,y$ for element 2, ...,
        e.g.\ using one line per element.)}
\end{inputvars}
The rigid shift of all elements is computed with
\begin{equation}
    \vec{W}_{It} = [{\tt CKSI} - {\tt CPHI} \cdot (y_I-y_o) + 
                                                {\tt EXRHS}_{Ix},  \;\;
     {\tt CETA} + {\tt CPHI} \cdot (x_I-x_o) + {\tt EXRHS}_{Iy}  ]^T
\end{equation}
The true time step size $\delta t$ is unknown to the program. Calculations
are done with a dummy value $\delta t^*=1\unit{s}$, and the corresponding
variables are set to ${\tt CHI}=0^\circ$, ${\tt DQ}=1\unit{mm}$ and
${\tt VELOC}=1\unit{mm/s}$. Internally in the program, a shift of $3\unit{mm}$
corresponds to an absolute slip velocity of $3\unit{mm/s}$ and a relative
slip velocity of $3$.

\subsection{Tangential quantities in case of rolling \texorpdfstring{(${\tt
        T}=2-3$)}{}}
\label{sec:kincns_roll}

In rolling problems (${\tt T}=2,3$) the following variables are used.
\begin{inputvars}
\inpvar{CHI}{\bunit{rad}}{Rolling direction $\chi$. This may be given in
        degrees using the notation {\tt 180d}, which is converted to
        $\unit{rad}$ and displayed as such in the output-file. The value
        should be near $0$ or $\pi$ ($180^\circ$), i.e.\ rolling in
        positive or negative $x$-direction. It is not used in shifts.}
\inpvar{DQ}{\bunit{mm}}{Rolling distance traversed per timestep, i.e.\
        $\delta q=V\cdot\delta t$. This should preferrably be of the
        order of the grid size {\tt DX} \cite{Wekken2017a-wiggles}.}
\inpvar{VELOC}{\bunit{mm/s}}{The rolling velocity $V$. This affects
        viscoelastic material behaviour (${\tt M}=1$), velocity dependent
        friction laws (${\tt L}=2-4$), and the frictional power dissipation
        {\tt FRIC}.}
\inpbreak
\inpvar{CKSI, CETA}{\bunit{-}}{Creepages in $x$- and $y$-directions
        respectively, rigid slip velocities relative to the rolling speed
        $V$.}
\inpvar{CPHI}{\bunit{rad/mm}}{Spin creepage, angular velocity of the two
        bodies around the $z$-axis relative to the rolling speed $V$.}
\inpvar{SPINXO,YO}{\bunit{mm}}{Optional `spin center' $(x_o,y_o)$ cf.\
        \cite{Vollebregt2018a-sdec}, default $(0,0)$.}
\end{inputvars}
When ${\tt E}=9$ an additional term is added which is particularly relevant
for conformal contact situations:
\begin{inputvars}
\inpvar{EXRHS(I,:)}{\bunit{-}}{Extra term in the rigid slip of the elements,
        specified explicitly by the $x$- and $y$-components for each
        element (e.g.\ using one line of input per element.)}
\end{inputvars}
In this case the rigid shift is computed from the function
\begin{equation}\label{eq:rig_shift_roll}
 \vec{W}_{It} = {\tt DQ} \cdot \left[
        \begin{array}{l}
        {\tt CKSI} - {\tt CPHI} \cdot (y_I-y_o+sn\cdot\delta q/6)
                + {\tt EXRHS}_{Ix}  \\
        {\tt CETA} + {\tt CPHI} \cdot (x_I-x_o+cs\cdot\delta q/6)
                + {\tt EXRHS}_{Iy}
        \end{array} \right]
\end{equation}
The additional terms $(sn,cs)\cdot\delta q/6$ compensate for the rolling
distance traversed in a time step, along rolling direction {\tt CHI}.

The total forces in $x$- and $y$-directions are defined as follows.
\begin{inputvars}
\inpvar{FX, FY}{\bunit{-}}{Total tangential forces in $x$- and $y$-directions,
        divided by the static traction bound {\tt FSTAT $\cdot$ FN}.}
\end{inputvars}
These can be both output (${\tt F}=0,1$) and input (${\tt F}=1,2$) of the
program. Note that a problem with creepages prescribed is easier to solve
than a problem with total forces prescribed. An additional (Newton-Raphson)
iteration process is used when total forces are prescribed, to determine
the appropriate values for the creepages. This process is not fully
reliable when the total forces are close to the maximum values that can be
attained (full sliding solution).

\section{Solution processes}
\label{sec:solut_proc}
\label{sec:iter_const}

Using CONTACT's full solution approach, the discretised problem is solved
using five nested iteration processes.
\begin{enumerate}
\item The outer iteration.
\begin{enumerate}
\item If the two bodies have identical elastic properties then they are
        called `{\em quasi-identical\/}'. This results in decoupling of the
        normal and tangential problems. The normal problem can be solved
        first and with that (and resulting traction bound $g$) the
        tangential problem can be solved. This is a one-step outer
        iteration procedure that is called `Johnson's process'.

\item On the other hand when the two bodies have different elastic
        properties, the tangential tractions affect normal displacement
        differences and vice versa.
        In such a case an outer iteration process called `Panagiotopoulos
        process' is used. This consists of solving normal and tangential
        problems alternatingly until the update between consecutive
        iterations is smaller than a tolerance.
\end{enumerate}

\item\label{itm:slip_veloc} The slip velocity iteration.
\begin{enumerate}
\item The traction bound $g$ 
        can be made dependent on the slip velocity
        $\|\vec{s}_t\|$. In that case an additional iteration loop is used.
        In each iteration, a contact problem with a fixed traction bound $g$
        is solved. This yields a new estimate for the slip velocity
        $\vec{s}_t$, which is then used to compute a new traction bound $g$
        and iterate.
\end{enumerate}

\item The active set algorithms NORM and TANG \cite{Kalker1990}. Note:
although these algorithms are still maintained in the code, they are not
active anymore. Today the element divisions are determined by the iterative
solvers described below at item \ref{itm:it_solvers}.
\begin{enumerate}
\item Kalker's algorithm NORM was used for solving the normal contact
        problem. It consisted of guessing which elements should be inside
        the contact area $C$ (`active' elements, active constraints
        $e=0$), solving the corresponding equations, checking where the
        guess was appropriate or not, and iterating until the
        correct element division is found.
\item Kalker's algorithm TANG was used for solving the tangential contact
        problem. In this case the active set algorithm determined the
        subdivision of the contact area $C$ into adhesion and slip areas
        $H, S$. Each iteration required solution of $2n$ linear and nonlinear
        equations. In Kalker's original approach the solution was done by
        Newton linearization in combination with Gaussian elimination
        \cite{Kalker1990}.
\end{enumerate}

\item The Newton-Raphson loop for the tangential forces.
\begin{enumerate}
\item If the total tangential forces $F_x, F_y$ are prescribed, then
        the creepages $\xi,\eta$ are to be adjusted. This cannot be done
        by the iterative solvers described below, which require that the
        rigid slip distribution is specified beforehand. This is solved by
        a small iterative procedure that estimates the derivatives
        $\txtfpd{F_x}{\xi}\text{--}\txtfpd{F_y}{\eta}$ and uses these to
        update the values of the creepages. This is called a
        Newton-Raphson process.

        The $2\times 2$ system for the tangential forces is complicated due
        to its inherent nonlinearities. Therefore the robustness of the
        approach is not 100\%, particularly when both creepages are
        unknown and when the tangential forces are close to the maximum
        where full sliding occurs.
\end{enumerate}

\item\label{itm:it_solvers} The iterative solvers NormCG, TangCG, 
        ConvexGS, and SteadyGS \cite{Vollebregt2014a-fftprec, 
        Zhao_Jing2015a-tangcg,Vollebregt1995a-convexgs,
        Vollebregt2010c-cst2010}.
\begin{enumerate}
\item Solving the normal problem requires finding normal pressures
        $p_{In}$ in each element satisfying equations like
        \begin{equation}
         e_I = h^*_I + \sum_{J\in C} A_{InJn} \, p_{Jn} = 0,
                                        \;\;\;\mbox{ for } I\in C
        \end{equation}
        Here $h^*$ optionally contains a term of the tangential tractions,
        which are fixed while solving the normal problem. A purpose-build
        fast solver is used for this problem that is called NormCG.
        This is an extension of the Bound-Constrained Conjugate Gradients
        method that is capable of dealing with constraints
        \cite{Vollebregt2014b-bccg}. A preconditioner is constructed using
        the Fast Fourier Transform (FFT) and a prescribed total force is
        dealt with in the method via a deflation technique
        \cite{Vollebregt2014a-fftprec}.
        The underlying system matrix is dense, but has constant diagonals. It
        is not explicitly formed, a matrix-free implementation is used
        instead.
\item The tangential problem with prescribed creepages is non-linear when
        there are elements in the slip area. The equations are solved using
        iterative solvers particularly designed for this problem. In
        transient calculations this is the new TangCG solver
        \cite{Zhao_Jing2015a-tangcg}, based on BCCG and using FFTs, or the
        older and slower ConvexGS solver \cite{Vollebregt1995a-convexgs}.
        For steady state problems the SteadyGS solver is used 
        \cite{Vollebregt2010c-cst2010}. These approaches have in common
        that they all incorporate the active set strategy, that enforces
        the traction bounds in all elements. This means that the element
        division between slip and adhesion areas is updated along the way.
        Finally the methods are implemented in a matrix-free way, to avoid
        memory limitations and allowing large problems to be solved.
\end{enumerate}

\end{enumerate}
These iterations are mostly bypassed when using the KPEC, ANALYN and FASTSIM
approaches. 

The nesting of algorithms is changed in the analysis of wheel/rail
contact (Chapter \ref{chp:module1}), adding a new outermost level 0 for
wheelset position and velocity variables, and skipping the Newton-Raphson
loops at level 4.

These iteration processes are terminated when the required accuracy is
reached, or when a prescribed maximum number of iterations is exceeded.
\begin{inputvars}
\inpvar{MAXOUT}{-}{Maximal number of iterations for the outer-loop, the
        Panagiotopoulos process. In quasi-identical cases (difference
        parameter ${\tt AK}=0$) Johnson's process is used with ${\tt MAXOUT}=1$.
        Otherwise a value of 20 is usually sufficient.}
\inpvar{MAXIN}{-}{Maximal number of iterations for the active set
        algorithms NORM and TANG. Usually a small value such as 20 suffices,
        a larger value may be needed when using a slip velocity dependent
        friction law (${\tt L}=2-4$), which does not have a separate
        iteration counter.}
\inpvar{MAXNR}{-}{Maximal number of iterations for the Newton-Raphson
        procedures that are used when total forces are prescribed. A value
        of 10 or 20 is usually ok.}
\inpvar{MAXGS}{-}{Maximal number of iterations in iterative solvers
        NormCG, Tang\-CG, ConvexGS and SteadyGS. This may be set to a high
        value such as 500 or 999.}
\end{inputvars}
When one of the iteration constants {\tt MAXOUT}, {\tt MAXIN} or {\tt
MAXNR} is reached, it is assumed that the process does not converge for
the problem at hand. This results in an error stop, because the next case
cannot always be computed properly. Reaching {\tt MAXGS} in the iterative
solvers does not immediately result in an error stop. When the error has
been reduced during the process we continue, if it grows the program is
stopped.
\begin{inputvars}
\inpvar{EPS}{\bunit{-}}{Requested relative accuracy of output quantities. This
        constant is used in many places in stop-criteria.}
\end{inputvars}
The typical stop-criterion used is
\begin{equation}
  \| \vec{p}^{k} - \vec{p}^{k-1} \|_{rms} <
                {\tt EPS} \cdot \| \vec{p}^k \|_{rms}
        \;\;\; \mbox{ ($k$: iteration counter).}
\end{equation}
Suitable modifications are made for the case that $\vec{p}^k\equiv 0$. Note that
this criterion does not guarantee small errors in the final results. Errors
of other iteration procedures (Panagiotopoulos, Newton-Raphson) are compounded.
The criterions that are used there can be found in the flow trace (see
description of the {\tt W}-digit in Section \ref{sec:controldigits}).

Two warnings that are related to the iteration accuracy {\tt EPS} are the
following:
\begin{alltt}\small
NORM: WARNING. There are **** elements with small deformed distance and
               **** elements with small pressure.

TANG: WARNING. There are **** elements with small slip and **** elements
               with tractions close to the traction bound.
\end{alltt}
These warnings indicate that the element divisions between $C$ and $E$
(NORM, interior and exterior elements) and between $H$ and $S$ (TANG,
adhesion and slip areas) may be affected by inaccuracies. Particularly the
former one should not be ignored. It indicates that
\begin{itemize}
\item elements in the contact area with normal pressure $p_n < \epsilon$
        might actually belong to the exterior, and
\item exterior elements with small deformed distance might better be
        interior elements.
\end{itemize}
The estimates of the element divisions become more reliable if the iteration
process is continued and the approximation error is reduced, i.e.\ when a
smaller tolerance {\tt EPS} is used. Similar considerations hold for the
latter warning regarding the slip and adhesion areas. In that case the
accuracy assessment is on the pessimistic side; the results are usually more
reliable than the warning suggests.

\begin{inputvars}
\inpvar{OMEGAH}{\bunit{-}}{Relaxation parameter $\omega_h$ for ConvexGS and
        SteadyGS for elements in the adhesion area.}
\inpvar{OMEGAS}{\bunit{-}}{Relaxation parameter $\omega_s$ for ConvexGS and
        SteadyGS for elements in the slip area.}
\inpvar{INISLP}{\bunit{-}}{Flag for initial estimate for slip velocity. Used in
        slip velocity dependent friction laws (${\tt L}=2-4$), else ${\tt
        INISLP}=0$ can be used.}
\inpvar{OMGSLP}{\bunit{-}}{Relaxation parameter $\omega_{slp}$ for the slip
        velocity. Used in the iteration procedure for slip velocity
        dependent friction laws (${\tt L}=2-4$), ignored otherwise.}
\end{inputvars}
Relaxation is an internal feature of the Gauss-Seidel based solvers
ConvexGS and SteadyGS, see \cite{Vollebregt1995a-convexgs} and
\cite{Vollebregt2009a-cm2009}. The program contains suitable default values
for these parameters that are used in the default case when ${\tt G}=0$.
Fine-tuning is possible by setting the {\tt G}-digit to 2 or 3.

Our experience is that TangCG should be used for shifts and transient
rolling (${\tt T}=1,2$) and SteadyGS for steady state rolling (${\tt T}=3$).
This is the default choice when ${\tt G}=0$. Deviation from the defaults
is needed only in specific circumstances. 
\begin{itemize}
\item Large problems may benefit from reducing $\omega_h, \omega_s$;
\item Small step sizes $c=\delta q/\delta x \ll 1$ may need reducing
        $\omega_h, \omega_s$ in order to work well
        \cite{Vollebregt2009a-cm2009}.
\end{itemize}

When using velocity-dependent friction, there may exist multiple valid
solutions to a case \cite{Croft2010-iwrn10,Vollebregt2012a-quasistd}. The
initial estimate for the slip-velocity then determines which one of the
possible solutions is found. Three different strategies are provided. When
${\tt INISLP}<0$, the slip velocity is approximated from below, such that the
`low-slip' solution is found. When ${\tt INISLP}>0$, the slip velocity is
approximated from above and the `high-slip' solution is obtained. Finally
the choice ${\tt INISLP}=0$ is in between and uses the slip velocity of the
previous case as initial estimate.

\magenta{
The new solver GDsteady is activated using ${\tt G}=5$, in cases with
steady rolling (${\tt T}=3$) using the standard material model (${\tt
M}=0$). In other cases, setting ${\tt G}=5$ reverts to the default solver
for the case as used by ${\tt G}=0$.

GDsteady provides three different variants $\mat{E}_{trl},
\mat{E}_{keep}(f)$, and $\mat{E}_{down}(k)$. The variant $\mat{E}_{trl}$
seems to be the fastest but most prone to stagnation, which seems to be
overcome most effectively using an iteration of method $\mat{E}_{down}(k)$.
These are configured using three parameters: the primary method configuration,
threshold $\beta_{thrs}$ for detecting stagnation, and the fall-back method
used in case of stagnation.
\begin{inputvars}
\inpvar{FDECAY}{\bunit{-}}{Decay factor $0<f_{decay}<1$ for method
        $\mat{E}_{keep}(f)$, switching to method $\mat{E}_{trl}$ for
        $f_{decay}\ge 1$ or $\mat{E}_{down}(|f|)$ for $f_{decay}<0$.}
\inpvar{BETATH}{\bunit{-}}{Threshold $\beta_{thrs}$. If iteration $j$ has
        $\beta^{(j)}<\beta_{thrs}$ then the fallback method
        is used in step $j+1$.}
\inpvar{KDOWFB}{\bunit{-}}{Number of grid spaces downstream, $k_{down,fb}$,
        for the fall-back method.}
\end{inputvars}
Parameter $f_{decay}$ for method $\mat{E}_{keep}$ should be close to 1,
and $k_{down,fb}$ should be $1\text{--}4$.

The method GDsteady uses diagonal scaling based on the location of elements
relative to adhesion/slip interfaces. In the adhesion area we use a
linear and constant function, starting at $d_{ifc}$ at the interface, going
against the rolling direction, changing the value by $d_{lin}$ at each
next point, until the final value $d_{cns}$ is reached at a distance of
$(d_{ifc}-d_{cns})/d_{lin}$ points. In the slip area, we compute a factor
$f_{slp}$, raised to the power $0.5\le p_s \le 2.5$, and multiplied by
$d_{scl}$ for scaling relative to the adhesion area.
\begin{subequations}
\begin{eqnarray}
 \mbox{in adhesion} &:&
   D_{scl} = \max( d_{cns} , d_{ifc} - (i_x-i_{ifc}) \cdot d_{lin} ), \\
 \mbox{in slip} &:&
   D_{scl} = d_{slp} \cdot \left( f_{slp} \right)^{p_s} .
\end{eqnarray}
\end{subequations}
These formulas are illustrated in Figure \ref{fig:diag_scl}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/diag_scaling,width=3.2in,trim=20 0 60 20,clip=}
\caption{\em Illustration of parameters used for diagonal scaling in the
        solver GDsteady.}
\label{fig:diag_scl}
\end{figure}

\begin{inputvars}
\inpvar{D\_IFC}{\bunit{-}}{Diagonal scaling factor $d_{ifc}$ for points
        in adhesion at interior interfaces.}
\inpvar{D\_LIN}{\bunit{-}}{Change of scaling factor $d_{lin}$ per grid
        point in adhesion area away from interface.}
\inpvar{D\_CNS}{\bunit{-}}{Diagonal scaling factor $d_{cns}$ for 
        points in the adhesion area far from interfaces.}
\inpvar{D\_SLP}{\bunit{-}}{Multiplication factor $d_{slp}$ for diagonal
        scaling in slip area.}
\inpvar{POW\_S}{\bunit{-}}{Power factor $p_{s}$ for diagonal scaling in
        slip area.}
\end{inputvars}
}

\section{Overall output quantities per contact patch}
\label{sec:global_outpt}

Overall output quantities are written to the output file {\tt <experim>.out}
when the {\tt O}-digit is set to values $1-5$.

The global part of the output firstly contains a description of the problem
that is solved (${\tt O}\ge 2$), its control digits and the primary input
values that are used (except discretisation and geometry). Then several
aggregate output quantities are displayed: the total forces or creepages as
determined by the program, the torsional moment, elastic energy and
frictional power. Finally sensitivities computed by the Newton-Raphson
processes may be displayed, statistics about the element division and
iterations and a picture of the contact area.  

\subsection{\texorpdfstring{Output in rolling problems (${\tt T}=2-3$)}{}}

The approach {\tt PEN}, creepages {\tt CKSI}, {\tt CETA} and total forces
{\tt FN}, {\tt FX} and {\tt FY} were already described in Section
\ref{sec:kincns}. These may be input or output depending on the {\tt N}-
and {\tt F}-digits.
\begin{inputvars}
\inpvar{MZ}{\bunit{N\,mm}}{Torsional moment $M_z$ around the $z$-axis of the local
        coordinate system.}
\inpvar{ELEN}{\bunit{J}}{Elastic energy.}
\inpvar{FRIC}{\bunit{W}}{Frictional power dissipation by the surface tractions.}
\end{inputvars}
The formulae used for these quantities are:
\begin{eqnarray}
  {\tt MZ} = \delta x\,\delta y
                        \sum_I \left( p_{Iy} \,x_I - p_{Ix}\, y_I\right), \\
  {\tt ELEN} = \frac{\delta x\,\delta y}{2\cdot 1000}  \sum_{i\in\{x,y,n\}}
                        \sum_{I} p_{Ii} \, u_{Ii}, \;\;
  {\tt FRIC} = \frac{V}{1000} \cdot \delta x\,\delta y
                        \sum_{\alpha\in\{x,y\}} \sum_{I} p_{I\alpha}
                        s_{I\alpha}
\end{eqnarray}
Note that $s_{I\alpha}$ is the relative slip velocity, hence the
multiplication with $V$.
Note: the elastic energy is not computed when ${\tt B}=2$ or 3 is used, since
the normal displacements $u_{In}$ are then not available. A zero is
displayed in the output instead.

Note: the frictional power computed by CONTACT suffers from a substantial
discretisation error. In certain cases the following macroscopic quantity
may be used as an alternative:
\begin{equation}
  {\tt FRIC} = V\cdot 10^{-3} \cdot \left( {\tt CKSI}\cdot F_x + 
                {\tt CETA}\cdot F_y + {\tt CPHI}\cdot M_z \right),
\end{equation}
with $F_x, F_y$ here being the total tangential forces in $\unit{N}$.
This alternative is valid only in steady state rolling, when the two
bodies are elastically similar (quasi-identical, $K=0$ in equation
(\ref{eq:combined_mater})), and when the creepages are constant throughout
the contact patch (${\tt E}_3=0$). This is illustrated for instance in
\cite{Munisamy1991}.
% the argument behind this is that the integral of p_x*u_x over the contact
% patch vanishes in case of quasi-identity [Nowell88], [Johnson85] ?
% m09026: "the integral p_x(u_x-u'_x) amounts to the change of elastic
%              energy, which vanishes in a steady state."

The sensitivities are calculated when the Newton-Raphson loop is used for
presribed total forces. This is currently only the case when ${\tt F}=1$ or
${\tt F}=2$. When a sensitivity has not been computed, a zero is displayed
in the output.
\begin{inputvars}
\inpvar{DFX/DKSI}{\bunit{-}}{Sensitivity of relative tangential
        force {\tt FX} to a change of creepage {\tt CKSI} (Section
        \ref{sec:kincns}).}
\end{inputvars}
The sensitivities of {\tt FX} to {\tt CETA} and of {\tt FY} to {\tt CKSI}
and {\tt CETA} are likewise defined.

\subsection{\texorpdfstring{Output in case of shifts (${\tt T}=1$)}{}}

In case of a tangential shift, there are some differences compared to the
output of rolling problems described above.
\begin{inputvars}
\inpvar{FRIC}{\bunit{J}}{Frictional work of the surface tractions.}
\inpvar{DFX/DKSI}{\bunit{mm^{-1}}}{Sensitivity of relative tangential
        force {\tt FX} to a change of rigid shift {\tt CKSI}. }
\end{inputvars}
In this case the true velocity $V$ and time step $\delta t$ are unknown to
the program. The shift distance $\vec{S}_{It}$ in the step is used instead of
the velocity:
\begin{eqnarray}
  {\tt FRIC} = \delta x\,\delta y
                           \sum_\alpha \sum_I p_{I\alpha} S_{I\alpha} .
\end{eqnarray}

\section{Main solution arrays}
\label{sec:solut_arrays}

The detailed output of quantities inside the contact area for ${\tt O}=5$
is rather crude, but may be beneficial for inspection of the results for
small problems.
\begin{inputvars}
\inpvar{IGS(I)}{-}{Element division of current time instant, stated per
                   element $I$ (0: Exterior, 1: Adhesion, 2: Slip, 3:
                   Plasticity). Refer to (\ref{eq:1d_index}) and
                   (\ref{eq:x_i}) for the numbering and coordinates of the elements.}
\inpvar{PS(I,1)}{\bunit{N/mm^2}}{The normal pressures $p_{In}$ of the current time
        step in element $I$, acting on body 1, the upper body.}
\inpvar{PS(I,2:3)}{\bunit{N/mm^2}}{The tangential tractions $\vec{p}_{It}$ per
        element $I$, load per unit area acting on body 1.}
\inpvar{PV(I,1:3)}{\bunit{N/mm^2}}{The tractions $\vec{p}'_{It}$ of the previous
        time instant.}
\inpvar{US(I,1:3)}{\bunit{mm}}{Displacement difference $\vec{u}_I$ per element
        $I$ in normal and tangential directions. Note: the normal
        displacement difference is not computed when ${\tt B}=2$ or 3; in
        that case zeros are displayed in the output instead.}
\end{inputvars}
The quantities that are printed in the output are:
\begin{inputvars}
\inpvar{X, Y}{\bunit{mm}}{coordinates $\vec{x}_I$ of the center of each element $I$,
        cf.\ (\ref{eq:x_i}).}
\inpvar{H-PEN}{\bunit{mm}}{True undeformed distance $h(\vec{x}_I)-\delta_n$, taking
        into account the approach $\delta_n$.}
\inpvar{PN}{\bunit{N/mm^2}}{Normal pressure {\tt PS(I,1)} $=p_{In}$.}
\inpvarw{TRCBND}{\bunit{N/mm^2}}{Traction bound $\mu_I\cdot p_{In}$ in the slip
        area.}
\inpvar{ABS(PT)}{\bunit{N/mm^2}}{Magnitude of tangential tractions
        $\| \vec{p}_{It} \|$.}
\inpvar{ARG(PT;-S)}{\bunit{deg}}{Direction of tangential tractions
        $\arg(\vec{p}_{It})$.}
\end{inputvars}
In rolling contact problems (${\tt T}=2-3$) the relative slip velocity is
displayed:
\begin{inputvars}
\inpvar{ABS(S)}{\bunit{-}}{Magnitude of the relative slip velocity
        $\|\vec{s}_{It} \|$.}
\inpvar{RIG.SLIP}{\bunit{-}}{$x$- and $y$-components of the relative rigid slip
        velocity $\vec{w}_{It}$.}
\end{inputvars}
In the computation of a shift (${\tt T}=1$), the shift distance is
displayed instead:
\begin{inputvars}
\inpvar{ABS(S)}{\bunit{mm}}{Magnitude of the shift distance $\| \vec{S}_{It} \|$.}
\inpvar{RIG.SHFT}{\bunit{mm}}{$x$- and $y$-components of the rigid shift distance
        $\vec{W}_{It}$.}
\end{inputvars}

\section{Subsurface stresses}
\label{sec:subsurf}

The calculation of subsurface stresses is activated by the control digit
{\tt S} (Section \ref{sec:controldigits}) when using the input-file, or
subroutine {\tt subs\_calculate} in the CONTACT library (Section
\ref{sec:clib_subs}). This computes the subsurface
displacements $u_i(x,y,z)$, displacement gradients $\txtfpd{u_i}{x_j}$ and
interior stresses $\sigma_{ij}(x,y,z)$, i.e.\ the stress tensor
$\vecsigma$. From this it derives stress invariants like the mean
hydrostatic stress $\sigma_{hyd}$, the equivalent tensile stress
$\sigma_{vm}$ of the von Mises criterion, the principal stresses
$\sigma_1, \sigma_2, \sigma_3$ and maximum shear stress
$\sigma_{tresca}=\sigma_1-\sigma_3$ used in the Tresca criterion.

Values can be computed for a large grid of points independent of the
surface contact area. Output can be requested for the maximum values in
this grid and for the values in each grid point separately.

\subsection{Control digits for the subsurface stress calculation}
\label{sec:subsurf_control}

The input of the subsurface points in {\tt <experim>.inp} starts with the
control digits ${\tt A}_s$ and ${\tt O}_s$, governing the level of output of
subsurface stresses to the Matlab-file {\tt <experim>.<case>.subs} and
the to the {\tt out}-file.
\begin{description}
\item[A$_s$ - MATFIL, subsurface stress] : governs the use of the Matlab-file
        {\tt <expe\-rim>.\-<case>\-.subs}, in cases where the subsurface
        stress calculation is used (${\tt S}\ge 1$):
\begin{description}
\item[0] -- the {\tt subs}-file is not created;
\item[1] -- the displacements and stress invariants in subsurface stress
        points are written to a Matlab-file {\tt <experim>.<case>.subs};
\item[2] -- additionally, all components of the stress tensor are written to
        the {\tt subs}-file.
\end{description}

\item[O$_s$ - OUTPUT, subsurface stress] : governs the extent of the output to
        the output-file {\tt <experim>\-.out}:
\begin{description}
\item[0] -- no results are printed to the output-file (values {\em are\/}
        computed, and stored in internal memory for use in other calculations);
\item[1] -- minimum output is printed, just the maximum values of primary
        stress invariants;
\item[2] -- the maximum values are printed for additional invariants, e.g.\
        the principal stresses;
\item[3] -- not used;
\item[4] -- the detailed results for the sub-surface (deformations, stresses)
        are printed as well, in addition to 2.
\end{description}
\end{description}
These control digits are read from the input-file when ${\tt S}=2$ or ${\tt
S}=3$. The same value is used for all blocks of subsurface points.

\subsection{Input for the subsurface stress calculation}
\label{sec:subsurf_inp}

The locations $[x,y,z]^T$ for the subsurface stress calculation are
specified in `blocks' of ${\tt NX} \cdot {\tt NY} \cdot {\tt NZ}$ points,
for coordinates {\tt X(1:NX)}, {\tt Y(1:NY)} and {\tt Z(1:NZ)}. Multiple
blocks may be used consecutively. Each block starts with a control
digit {\tt ISUBS}. In a way, this is comparable to the {\tt MODULE} number:
calculations continue until ${\tt ISUBS}=0$. 

In principle, the subsurface stresses can be calculated in any point of
the contacting (elastic) half-spaces, independent of the potential contact
area and its discretization. However, the computed stresses
are affected adversely by the piecewise constant approximation that
is used ($\tt{C}_3=2$, page \pageref{c3-digit}) \cite{Love1929,
Wekken2019a-subsurf}. This can be resolved using bilinear loading elements,
setting ${\tt C}_3=3$, at the expense of longer computations. A practical
alternative is to sample the subsurface stresses at the element centers
only \cite{Wekken2019a-subsurf}. This is the recommended approach for most
applications.

The use of element centers is facilitated by the input options ${\tt 
ISUBS}=1\text{--}7$. An option to compute subsurface stresses at any
location (non-centers) is provided by ${\tt ISUBS}=9$.

The input of one block describes the following values:
\begin{inputvars}
\inpvar{\tt NX,NY,NZ}{-}{Number of $x$-, $y$- and $z$-coordinates used in
        a block of subsurface points. The block consists of ${\tt NX}\cdot
        {\tt NY}\cdot{\tt NZ}$ points.}
\inpvar{X(NX),\mbox{Y(NY)\hspace{-1ex}} Z(NZ)}{\bunit{mm}}{Coordinate
        specification for a block of subsurface points.

        Note: in the actual calculations and output, the points are
        sorted in ascending order.}
\end{inputvars}
The coordinates per block can be specified in different ways.
\begin{inputvars}
\inpvar{\tt ISUBS}{-}{Integer flag. Input option for the coordinate
        specification for a block.}
\end{inputvars}
\begin{itemize}
\item ${\tt ISUBS}=1$: at the centers of all discretization elements of the
potential contact area, using constant spacing {\tt DZ} in vertical
direction.
\begin{inputvarsml}
\inpvar{\tt NZ}{-}{Number of layers $n_z$ in vertical direction.}
\inpvar{\tt ZL}{\bunit{mm}}{$z$-value $z_l$ of the lowest layer in vertical direction.}
\inpvar{\tt DZ}{\bunit{mm}}{Step size $\delta z$ between layers in vertical direction.}
\end{inputvarsml}
The values $z_{i_z}, i_z=1,\ldots,n_z$ are formed as
$z_{i_z}=z_l+(i_z-1)\delta z$.

\item ${\tt ISUBS}=2$: at the centers of a regular selection of
discretization elements, using constant spacing {\tt DZ} in vertical
direction.
\begin{inputvarsml}
\inpvar{\tt IXL}{-}{Starting column number $i_{x,l}$ for the selection.}
\inpvar{\tt IXINC}{-}{Column number increment $i_{x,inc}$ for the selection.}
\inpvar{\tt IXH}{-}{Ending column number $i_{x,h}$ for the selection.}
\end{inputvarsml}
The range of column numbers is formed as $i_x = i_{x,l}+k\cdot i_{x,inc}$ for
all values of $k$ such that $i_{x,l}\le i_x \le i_{x,h}$. Column numbers
outside the potential contact area (less than 1 or higher than {\tt MX}) are
ignored.  The number of points $n_x$ is determined accordingly.

Similar values {\tt IYL}, {\tt IYINC} and {\tt IYH} are used for the
selection of rows of the potential contact area.

The values for $z_{i_z}$ are specified in the same way as for ${\tt 
ISUBS}=1$.

\item ${\tt ISUBS}=3$: at the centers of an irregular selection of
discretization elements, using constant spacing {\tt DZ} in vertical
direction.
\begin{inputvarsml}
\inpvar{\tt NX}{-}{Number of column numbers used in $x$-direction.}
\inpvar{\tt IX(j)}{-}{List of column numbers $i_{x,j}$ used in $x$-direction.}
\end{inputvarsml}
Similar values {\tt NY} and {\tt IY(j)} are used for the selection of rows
of the potential contact area.

The values for $z_{i_z}$ are specified in the same way as for ${\tt ISUBS}=1$.

\item ${\tt ISUBS}=5$: at the centers of all discretization elements of the
potential contact area, at explicitly specified {\tt Z}-positions.
\begin{inputvarsml}
\inpvar{\tt NZ}{-}{Number of layers in vertical direction.}
\inpvar{\tt Z(j)}{\bunit{mm}}{List of vertical positions $z_j$ for all layers.}
\end{inputvarsml}

\item ${\tt ISUBS}=6$: at the centers of a regular selection of
discretization elements, specified in the same way as with ${\tt ISUBS}=2$,
at explicitly specified {\tt Z}-positions as with ${\tt ISUBS}=5$.

\item ${\tt ISUBS}=7$: at the centers of an irregular selection of
discretization elements, cf.\ ${\tt ISUBS}=3$, at explicitly specified
{\tt Z}-positions as with ${\tt ISUBS}=5$.

\item ${\tt ISUBS}=9$: at explicitly specified {\tt X}-, {\tt Y}- and
{\tt Z}-positions.

See {\tt NX}, {\tt NY}, {\tt NZ} and {\tt X(NX)}, {\tt Y(NY)} and {\tt
Z(NZ)} described above.
\end{itemize}

\subsection{Output of subsurface stress calculation}
\label{sec:subsurf_out}

The output of the subsurface stress calculation is written to the file
{\tt <experim>.<ncase>.subs} (Section \ref{sec:spec_subs}), which can be
imported directly in Matlab using the script {\tt load\-strs\-.m}
(Section \ref{sec:plot_subs}). Maximum values per block are written to the
file {\tt <experim>.out} according to the ${\tt O}_s$-digit, and for
${\tt O}_s\ge 4$ the complete results are written to the {\tt out}-file
as well.

Within subprogram STRESS a different numbering of coordinate directions is
used than in the remainder of the program. Here the $x$-axis is the first
coordinate direction, $y=2$ and $z=3$. In this subprogram positive values
are used for {\em tensile\/} rather than compressive stress.
The theory related to this calculation is described in \cite{Kalker1986a},
which is reproduced in Appendix C of \cite{Kalker1990}.
\begin{inputvars}
\inpvar{\tt XTABL(k,3)}{\bunit{mm}}{Expanded list of coordinates of points where
        subsurface stresses are calculated. Each point {\tt k} occupies one
        line, one additional line is used for each block.
        Note: the points are sorted in ascending order.}
\inpvar{\tt DISPL(k,i)}{\bunit{-/mm}}{Displacements in direction {\tt i}
        in subsurface point {\tt k}: $\vec{u}^{(a)}(\vec{x}_k) =
        [u_x^{(a)},u_y^{(a)},u_z^{(a)}]^T$.
        Here $a$ stands for the body number, with body 1 the upper body
        with $z\ge 0$.}
\end{inputvars}
At each point $\vec{x}$ in the subsurface there's a stress tensor
$\vecsigma(\vec{x})$:
\begin{equation}\label{eq:sigma}
     \vecsigma = \left[ \begin{array}{ccc} 
                        \sigma_{xx} & \sigma_{xy} & \sigma_{xz}   \\
                        \sigma_{yx} & \sigma_{yy} & \sigma_{yz}   \\
                        \sigma_{zx} & \sigma_{zy} & \sigma_{zz}
                \end{array} \right] .
\end{equation}
\begin{inputvars}
\inpvarw{\tt SIGMA(k,i,j)}{\bunit{N/mm^2}}{Stresses \label{itm:sigma}
        $\sigma_{ij}(\vec{x}_k)$ at subsurface point {\tt k}.}
\end{inputvars}
The components $\sigma_{ij}$ usually aren't the most interesting quantities
for the stress state in a point $\vec{x}$. It is often more relevant to
consider additional values that are derived from the tensor $\vecsigma$. The
first one is the mean (hydrostatic) stress $\sigma_{hyd}$, one-third of the
first stress invariant $I_1$:
\begin{equation}\label{eq:sighyd} 
    I_1 = trace(\vecsigma) = \sigma_{xx} + \sigma_{yy} + \sigma_{zz}, \;\;\;
     \sigma_{hyd} = \frac{1}{3} I_1.
\end{equation}
This describes the change of volume of the material by the stresses acting
at $\vec{x}$.
\begin{inputvars}
\inpvar{\tt SIGHYD(k)}{\bunit{N/mm^2}}{Mean hydrostatic stress $\sigma_{hyd}$.}
\end{inputvars}
Subtracting the volumetric stress tensor from $\vecsigma$ yields the stress
deviator tensor $\mat{s}$, that describes the distortion of the material:
\begin{equation}
        \mat{s} = \vecsigma - \sigma_{hyd}\,\mat{I}, \;\;\;
        \mbox{with $\mat{I}$ the $3\times 3$ identity.}
\end{equation}
The second invariant $J_2$ of this tensor is used to compute the equivalent
(tensile) stress $\sigma_{vm}$ in the von Mises criterion.
\begin{inputvars}
\inpvar{\tt SIGVM(k)}{\bunit{N/mm^2}}{The `equivalent (tensile) stress' or 
        `von Mises stress' $\sigma_{vm}$ of the von Mises criterion.}
\end{inputvars}
These values are computed as
\begin{eqnarray}
    J_2 &=& \frac{1}{2} \sum_{ij} (s_{ij})^2 
        \;=\; \frac{1}{6} \left( (\sigma_1 - \sigma_2)^2 + 
        (\sigma_2 - \sigma_3)^2 + (\sigma_3 - \sigma_1)^2 \right)
        , \label{eq:j2_stress} \\
   \sigma_{vm} &=& \sqrt{3 J_2} \label{eq:sigvm}.
\end{eqnarray}
Using these, the von Mises criterion for the onset of plastic yield may be
expressed as 
\begin{equation}
        J_2\ge k_{yield}^2 
    \;\;\rightarrow\;\; \sigma_{vm} \ge \sqrt{3}\, k_{yield},
\end{equation}
with $k_{yield}$ the yield strength of the material in simple shear, or as
\begin{equation}
        \sigma_{vm}\ge\sigma_{yield},
\end{equation}
with $\sigma_{yield}$ the yield strength in simple tension.

Finally CONTACT provides the principal stresses\footnote{This calculation
uses the function {\tt dsyevc3} provided by Kopp under the LGPL license
\cite{Kopp2008}.} and the maximum shear
stress used in the Tresca failure criterion.
\begin{inputvars}
\inpvarw{\tt SIGJ(k,j)}{\bunit{N/mm^2}}{Principal stresses $\sigma_j,
        j=1\text{--}3$ at subsurface point {\tt k}. These are the
        eigenvalues of the stress tensor, ordered such that $\sigma_1
        \ge \sigma_2 \ge \sigma_3$.\label{page:sigmaj}}
\inpvar{\tt SIGTR(k)}{\bunit{N/mm^2}}{Maximum shear stress
        $\sigma_{tresca}=\sigma_1 - \sigma_3$.}
\end{inputvars}

The Tresca criterion for the onset of plastic yield is
\begin{equation}\label{eq:tresca}
   \sigma_{tresca} \ge 2 k_{yield} \;\;\mbox{or}\;\; 
   \sigma_{tresca}\ge \sigma_{yield} .
 % \;\; (`k=\sigma_{yield}/2').
\end{equation}
Again, $k_{yield}$ is the yield strength in simple shear, and
$\sigma_{yield}$ the yield strength in simple tension.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Examples
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Examples}
\label{chp:examples}

In this chapter we present a number of examples for the program. These
examples correspond to input- and reference-output files that are provided
with the program in the {\tt examples} directory. The chapter starts with
classical test-cases like those of Cattaneo, Carter, Bentall-Johnson, etc,
in Sections \ref{sec:ex_cattaneo}--\ref{sec:ex_subsurf}. Further examples
are given in Sections \ref{sec:ex_mbench}--\ref{sec:ex_fastsim} that are
targeted on wheel/rail contacts: non-Hertzian geometries, creep
curves, including the effects of interfacial layers and surface
temperature.

\section{The Cattaneo shift problem}
\label{sec:ex_cattaneo}

A sphere is pressed onto a plane and then shifted tangentially. This problem
is entered in two steps in order to illustrate some input options of the
CONTACT program.

The first case concerns the frictionless normal problem only. A Hertzian
input-option is used, i.e.\ ${\tt IPOT\-CN}<0$. The radius of the sphere is
$50\unit{mm}$ such that the curvatures at the contact point are $A=B=
0.01\unit{mm^{-1}}$ (see equation (\ref{eq:a1_b1})). The sphere and plane are
assumed to consist of the same (soft) polyethylene material, with
$G=200\unit{N/mm^2}$ and $\nu=0.42$.

We use the Hertz theory to determine the normal force $F_n$ that creates a
contact area with radius $1\unit{mm}$.
For a circular contact area this says that
\begin{equation}
 a = b = \left( \frac{3}{2} F_n \frac{1-\nu^2}{E}
                         \frac{1}{A+B} \right)^{1/3}.
\end{equation}
This gives $F_n=9.1954\unit{N}$ and for the maximum pressure
$p_{n,max}=3F_n/2\pi ab=4.3905\unit{N/mm^2}$. In the example these data are
entered via {\tt AA} and {\tt BB}, it is possible to use {\tt A1} and
{\tt B1} just as well. The contact area is discretised with $15\times 15$
elements, two additional elements are used on all sides by setting
${\tt SCALE}=19/15=1.267$.
\begin{alltt}\small
 3  MODULE
  200100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022020     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0000331   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   100   100    30     1   0.0001      MAXGS , MAXIN , MAXNR , MAXOUT, EPS
  9.1954      0.000        0.000       0.000        FN, CKSI, CETA, CPHI
  0.400       0.400                                 FSTAT, FKIN
  0.420       0.420          200.        200.       POISS 1,2,  GG 1,2
   -3                                               IPOTCN
   19   19     1.000       1.000      1.26667       MX,MY,AA,BB,SCALE
\end{alltt}
When CONTACT is run, information on the Hertz solution is printed to the
output-file {\tt cattaneo\-.out}:
\begin{alltt}\small
 3D HERTZIAN GEOMETRY WITH NORMAL FORCE PRESCRIBED
 SEMIAXES PRESCRIBED, AA,BB:                  1.000       1.000
 THE CURVATURES A1,B1 ARE:                   0.1000E-01  0.1000E-01
 EFFECTIVE RAD.CURV RHO, SEMI-AXIS CP         100.0       1.000
 POTENTIAL CONTACT, SCALE:                   -1.267      -1.267       1.267
 DISCRETISATION MX,MY, DX,DY:                  19    19  0.1333      0.1333
\end{alltt}
The `effective radius of curvature' is $\rho=2/(A+B)$, the effective
semi-axis $c=\sqrt{ab}$.

The second case in the example input-file concerns the tangential shift
problem. In this case the geometry is entered using a non-Hertzian approach.
Option ${\tt IBASE}=1$ means that a quadratic profile is used. The
coefficients $b_1$ and $b_3$ that are entered here correspond to the
curvatures $A$ and $B$:
\begin{alltt}\small
% Second case: using non-Hertzian geometry-description, and including the
%              tangential shift problem.

 3  MODULE
  201120     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022020     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0101541   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
  9.1954     -0.8750       0.000       0.000         FN, FX, FY, CPHI
  0.400       0.400                                  FSTAT, FKIN
  0.420       0.420          200.        200.        POISS 1,2,  GG 1,2
    1                                                IPOTCN
   19   19  -1.26667  -1.26667   .13333     .13333   MX,MY,XL,YL,DX,DY
    1    1                                           IBASE, IPLAN
%    QUADRATIC UNDEFORMED DISTANCE
  0.0100    0.000     0.0100    0.000     0.000     0.000     B(I), I=1, 6
%    UNRESTRICTED PLANFORM
\end{alltt}
The relevant control digits (Section \ref{sec:controldigits}) are
\begin{itemize}
\item the {\tt P}-digit, which describes that the sphere was free from
        tangential tractions initially;
\item the {\tt T}-digit, which states that the problem concerns a shift;
\item the {\tt N}- and {\tt F}-digits, that state that total forces are
        being prescribed.
\end{itemize}
A tangential force is applied to the sphere of $(1-\theta^3)\,\mu F_n$,
with $\theta=1/2$. According to Cattaneo this yields a circular adhesion
area with radius $(1-\theta)a$ concentric with the contact area \cite[sec.
5.2.1.1]{Kalker1990}. The corresponding shift of the sphere with respect
to the plane is given by
\begin{equation}
        W_x = (1-\theta^2) \, \frac{3\mu F_n}{2\pi a G}
        \left( \frac{\pi}{2} - \nu \frac{\pi}{4} \right)
\end{equation}
In our case the sphere is the upper body, body 1. The tangential force $F_x$
that is entered in the input-file concerns the total load in the contact
interface, which oppose the force by which the sphere is shifted. Further
note that the force is entered relative to the maximum $\mu F_n$,
hence $F_x=-7/8$. The shift is $W_x=0.00817\unit{mm}$, and the theoretical
tangential traction is
\begin{equation}
\begin{array}{rll}
 p_x &= -\mu p_{n,max} \, \frac{1}{a} \left( \sqrt{a^2-r^2} - 
                \sqrt{\theta^2 a^2-r^2} \right), &
                \mbox{when } 0 \le r \le \theta a \\[0.5ex]
     &= -\mu p_{n,max} \, \frac{1}{a} \sqrt{a^2-r^2} &
                \mbox{when } \theta a \le r \le a \\[0.5ex]
     &= 0 & \mbox{when } r \ge a.
\end{array}
\end{equation}
This theoretical solution by Cattaneo is not altogether correct; there is a
traction component $p_y$ orthogonal to $x$-axis that is ignored. This
component is included in the full solution computed by CONTACT.

\begin{figure}[bt]
\centering
\psfig{figure=fig/cattaneo_px_y0,width=3.6in,trim=100 30 0 40,clip=}
\caption{\em Results for the Cattaneo shift problem. Distribution of
tangential traction $p_x$ along the center-line $y=0$.}
\label{fig:cattaneo_px_y0}
\end{figure}

After you've run CONTACT for this problem, you find the shift in the
output-file:
\begin{alltt}\small
     FN          FX          FY          MZ         ELAST.EN.   FRIC.WORK
         9.195      -3.218       0.000       0.000   8.525E-05  -2.750E-06
     FN/G       SHIFT X      SHIFT Y     APPROACH     PMAX    
     4.598E-02   8.155E-03       0.000   1.998E-02       4.393
\end{alltt}
The results may be inspected further with the Matlab package, see Figure
\ref{fig:cattaneo_px_y0}. The commands for producing this figure are
(see Section \ref{sec:plot_surf}):
\begin{alltt}\small
  s = loadcase('cattaneo',2); % the tangential problem concerns the
  opt2 = plot2d;              % second case in the actual input-file
  opt2.yslc = 0.0;
  opt2.facpt = -1.0;
  plot2d(s, opt2);
\end{alltt}
This shows the negative of the tangential tractions, $-p_x$, along the
centerline through the contact area $y=0$. The dashed line is the traction
bound $\mu p_n$, with maximum $\mu p_{n,max}=1.756\unit{N/mm^2}$.

\section{The 2D Carter/Fromm problem}
\label{sec:ex_carter_fromm}

The second example concerns the steady rolling of an infinite cylinder over
an elastic half-space (equivalently: two infinite cylinders with doubled
radius) with the same elastic constants. This is a 2D `plane strain'
problem. Such a problem is input to CONTACT using a `truncated 3D
problem': by using a single row of elements with a very large $\delta y$.
Note that the difference between a very large strip $[-a,a]\times[-\delta
y/2,\delta y/2]$ and an infinite strip $[-a,a]\times[-\infty,\infty]$ is
negligible at $y=0$, except for the displacements $\vec{u}$ that are
ill-defined in 2D problems \cite{Johnson1985}.

We consider a steel cylinder with a radius of $R^{(1)}=500\unit{mm}$ and a
steel half-space ($R^{(2)}=\infty$, combined radius $R=R^{(1)}$), with
elastic constants $G^{(a)}=82\,000\unit{N/mm^2}$, $\nu^{(a)}=0.28$.
According to the 2D Hertz solution, the normal force required per unit of
width to achieve a contact area $[-a,a]$, with $a=1\unit{mm}$ is
\begin{equation}\label{eq:fn_2d_hertz}
        F_n = \frac{\pi \,a^2 \,G}{4 \,R \,(1-\nu)} = 178.90\unit{N/mm}
\end{equation}
This is entered in CONTACT multiplied by the element width $\delta y$ as
${\tt FN}=35\,780$. The undeformed distance is specified using option ${\tt
IBASE}=1$: a quadratic function in $x$ and $y$ (page \pageref{itm:ibase1}).
In this case there is no dependence on $y$, such that the corresponding
$b_i$ are set to 0.

The theoretical relations between the size of the adhesion area, the total
tangential force and the longitudinal creepage are:
\begin{eqnarray}
  \xi = -\mu \frac{a-a'}{R}, \;\;
   F_x = (1 - (a'/a)^2 ) \, \mu F_n \,.
\end{eqnarray}
For adhesion in 60\% of the contact area ($a'=0.6$) this yields
$\xi=-0.024\%$ and ${\tt FX}=0.64$.

The input used for CONTACT is as follows.
\begin{alltt}\small
 3  MODULE
  203100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022020     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0001541   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   999   100    30      1     1e-5     MAXGS , MAXIN , MAXNR , MAXOUT, EPS
  35780.   -0.00024  0.000    0.000            FN, CKSI, CETA, CPHI
   0.300    0.300                              FSTAT, FKIN
   0.000    0.040    30000.                    CHI, DQ, VELOC
   0.280    0.280    82000.   82000.           POISS 1,2,  GG 1,2
    3                                          IPOTCN
  55   1   -1.0500   0.000    0.0400   200.0   MX,MY,XC1,YC1,DX,DY
   1   1                                       IBASE, IPLAN
%  QUADRATIC UNDEFORMED DISTANCE
   0.001   0.0   0.0   0.0   0.0   0.0         B1,B2,B3,B4,B5,B6
%  UNRESTRICTED PLANFORM
\end{alltt}
Note that the grid is specified in a different way than in the previous
example (${\tt IPOTCN}=3$), and that a time step size $\delta q=\delta x$
is used. The resulting traction distribution is shown in Figure
\ref{fig:carter2d}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/carter2d_px,width=3.6in,trim=100 40 0 10,clip=}
\caption{\em Tangential tractions $p_x$ for the 2D Carter/Fromm problem.}
\label{fig:carter2d}
\end{figure}

\section{The 2D Bentall-Johnson test-case}
\label{sec:ex_bentall}

Additional phenomena come into play when the two bodies are made of
dissimilar materials. Analytical and numerical solutions were provided for
this by Bentall and Johnson \cite{Bentall1967} for the contact of aluminum
and steel rollers.

An aluminum roller ($G^{(1)}=23\,000\unit{N/mm^2}, \nu^{(1)}=0.31$) with radius
$R^{(1)}=50\unit{mm}$ is pressed onto a steel roller
($G^{(2)}=82\,000\unit{N/mm^2},
\nu^{(2)}=0.28$) of the same size. The normal load is defined
using equation (\ref{eq:fn_2d_hertz}) such that the Hertzian half contact
width becomes $a_h=0.1\unit{mm}$. Note that the effective radius is
$R=25\unit{mm}$:
as far as the contact is concerned, two rollers of $R^{(1)}=R^{(2)}=50$
look like a single roller on a plane with $R=25\unit{mm}$. In the input this
shows up via $b_1=1/2R=0.02\unit{mm^{-1}}$. Further, the combined
material parameters $G, \nu$ and $K$ are required, that are defined
according to \cite[eq.(1.44)]{Kalker1990}:
\begin{eqnarray}
  \frac{1}{G}=\frac{1}{2}\left( \frac{1}{G^{(1)}} + 
                     \frac{1}{G^{(2)}} \right), \label{eq:g_comb} \;\;
  \frac{\nu}{G}=\frac{1}{2}\left( \frac{\nu^{(1)}}{G^{(1)}} + 
                     \frac{\nu^{(2)}}{G^{(2)}} \right), \label{eq:nu_comb} \;\;
  \frac{K}{G} = \frac{1}{4}\left( \frac{1-2\nu^{(1)}}{G^{(1)}} -
                     \frac{1-2\nu^{(2)}}{G^{(2)}} \right) . \label{eq:k_comb}
\end{eqnarray}
This gives $G=35\,924, \nu=0.3034, K=0.100$, which in turn gives
$F_n=16.20\unit{N/mm^2}$.

The first scenario concerns `free rolling'. One roller is driven by an
external torque such that it rotates at a constant speed. The other is
rolling freely, with negligible friction in its bearings. It is accelerated
or decelerated by the contact force, until it approaches a steady state
with $F_x=0$. In a case with equal materials this would give the same
circumferential velocities for both rollers, leading to creepage $\xi=0$.
With dissimilar materials the situation is different.

Normal pressures $p_n$ cause tangential displacements $u^{(a)}_x, u^{(a)}_y$
to occur in both bodies, $a=1,2$. These displacements are bigger for the
aluminum than for the steel roller. The sign of $u^{(a)}_x$ is such that
particles are drawn towards the center of the contact area. This means that
the particles of the aluminum roller traverse a smaller distance when
passing through the contact area: the particles of the steel roller move by
$\approx 2 a$ and those of the aluminum roller by $\approx 2 a-2u$.
This introduces a non-zero creepage at free rolling.

The different tangential displacements in the two bodies imply a tendency
of the surfaces to slip with respect to each other. If rolling is to the
left (counter-clockwise rotation for the upper roller), the upper surface
tends to the left with respect to the lower one. This tendency is
resisted by tangential tractions $p_x>0$ (in 2D scenarios, $p_y\equiv
0$). Note that normal pressures invoke tangential tractions. Vice versa,
tangential tractions affect the pressures $p_n$ as well. Finally, free
rolling is obtained by introducing a creepage $\xi>0$, that balances the
upper surface's tendency to the left. This is investigated using four cases:
\begin{enumerate}
\item[1, 2.] Minimal friction, $\mu=0.0001$, such that there's practically no
        influence from $p_x$ on $p_n$;
\setcounter{enumi}{2}
\item Maximal friction, $\mu=10.0$, such that the influence from $p_x$
        on $p_n$ is maximal;
\item Typical friction, $\mu=0.05$, for aluminum on steel contact.
\end{enumerate}
The input used for CONTACT looks as follows:
\begin{alltt}\small
 3 MODULE
  203100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022020     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0000011   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   500   100    30      1     1e-6      MAXGS , MAXIN , MAXNR , MAXOUT, EPS
   16201.9  0.00052   0.000   0.000            FN, CKSI, CETA, CPHI
   0.0001   0.0001                             FSTAT, FKIN
   180.0d   0.001     1000.                    CHI, DQ, VELOC
   0.310    0.280    23000.   82000.           POISS 1,2,  GG 1,2
   1                                           IPOTCN
 216   1   -0.108    -500.    0.001    1000.   MX,MY,XL,YL,DX,DY
   1   1                                       IBASE, IPLAN
   0.020   0.0   0.0   0.0   0.0   0.0         B1,B2,B3,B4,B5,B6
\end{alltt}
A few points are worth emphasizing:
\begin{itemize}
\item This first case uses a prescribed creepage, ${\tt F}=0, \xi=0.00052$,
        instead of specfying the force $F_x=0$. This is because the
        Newton-Raphson procedure has great difficulty with scenarios where
        full sliding occurs at practically all creepages. This first case
        is used with minimal output. Then the second case uses its
        results as initial estimate, by setting ${\tt I}=1$. With this
        improved initial estimate the Newton-Raphson process works well.
\item In the first two cases we use ${\tt MAXOUT}=1$ even though there's
        material dissimilarity. This means that Johnson's process is used
        instead of the Panagiotopoulos process, whereby the influence of
        tangential tractions on normal pressures is ignored.
        This is safe in this case because the influence is negligible.
\item Rolling is to the left, $\chi=180^\circ$, such that particles enter
        the contact area at $x=-0.1$ and leave at $x=0.1\unit{mm}$. This
        honours the convention used by Bentall and Johnson such that the
        pictures are compared more easily.
\end{itemize}
The theoretical result by Bentall and Johnson says that the creepage at
free rolling is
\begin{equation}
  \xi = 0.457 \frac{\kappa a}{R}, \;\;\mbox{with}\;\;
  \kappa = 2\beta = \frac{2K}{1-\nu} = 0.2877.
\end{equation}
Here $\beta$ is Dundur's constant \cite[p.110]{Johnson1985} and $K$ is
Kalker's difference parameter. The formula gives $\xi=0.0005259$ whereas
CONTACT gives $\xi=0.0005260$ at $\mu=0.0001$. At $\mu=0.05$ the creepage
reduced to $0.000429$, whereas at $\mu=10.0$ it reduced further to
$\xi=0.000359$. Note that the sign of the creepage depends on the
convention used for the rolling direction and on numbering of the rollers
(through the signs of $\kappa$ and $K$). This is summarized as that
the softer roller tends to roll at higher angular velocity than the stiffer
one.

The maximum pressure increases from $103.14$ to $103.81\unit{N/mm^2}$
($+0.65\%$) due to the influence of $p_x$ on $p_n$. This doesn't show up in
the contact area that consists of 200 elements in all four cases. 
\allexamp{A case with a larger influence is shown later in Section
\ref{sec:ex_spence}.}

\begin{figure}[bt]
\centering
\psfig{figure=fig/bentall_px_fxpos,width=3.2in,trim=35 0 70 20,clip=}
\psfig{figure=fig/bentall_px_fxneg,width=3.2in,trim=35 0 70 20,clip=}
\caption{\em Traction $q(x)=p_x^{(2)}$ on the bottom roller in the
Bentall-Johnson test-case for two scenarios of tractive rolling, cf.\
\cite[Fig.9]{Bentall1967}. Left: $F_x=0.75$ on upper roller, right:
$F_x=-0.75$. In both cases $\mu=0.05$.}
\label{fig:bentall_tractive}
\end{figure}

Two more cases in the input-file concern tractive rolling at relative
tangential forces $F_x=0.75$ and $-0.75$. In the first of these the
aluminum roller $(1)$ is braked by the contact force exerted by the steel
roller $(2)$, in the latter case the aluminum roller is accelerated.
The results of these cases are shown in Figure \ref{fig:bentall_tractive}.
These results show excellent agreement with the corresponding results
presented in \cite[Fig.9]{Bentall1967}.

\section{Steady rolling of two viscoelastic cylinders}
\label{sec:ex_visc}

The next example employs the viscoelastic material model in CONTACT for two
identical cylinders with parallel axes in rolling contact
\cite{Wang_guangqiu1993}. Both cylinders have a radius
$R^{(a)}=100\unit{mm}$
(combined radius $R=50\unit{mm}$) and consist of polymer PA6, a viscoelastic
material that is characterized by a standard linear solid model with an
initial Young's modulus $E_g=3200\mpa$, Poisson's ratio $\nu=0.4$,
spring ratio ${\tt FG}=f=1$ (final Young's modulus $E_r=1600\mpa$) and
creep relaxation time ${\tt TC}=\tauc$ varying between three different
test-cases. The corresponding initial modulus of rigidity that is input to
CONTACT is (cf.\ last row of Table \ref{tbl:visc_inputs})
\begin{equation}
        {\tt GG} =G_g = E_g/2(1+\nu) = 1143\mpa .
\end{equation}
The cylinders are pressed together with a normal force per unit length
of $F_n = 600\unit{N/mm}$ and the coefficient of friction is $\mu = 0.3$. The
relative traction force is taken as $F_x/\mu F_n = -0.6$.

In case of very slow relaxation (relaxation time $\tauc\rightarrow\infty$),
the viscoelastic effect is largely unnoticed. The viscoelastic problem reduces
to an elastic problem with initial modulus of rigidity $G_{\infty} = G_g$.
At the other extreme, $\tauc\downarrow 0$, the material responds almost
instantaneously, elastically with $G_0=G_r=E_r/2(1+\nu)$ (cf.\ equations
(\ref{eq:SLS_creep_compliance}) and (\ref{eq:SLS_stress_relaxation})).
The corresponding shear modulus is obtained from $G_r=G_g/(1+f)$, which
gives $G_r=G_g/2=571.5\mpa$. In Figure
\ref{fig:sls_voigt_maxwell_models} (left), this is interpreted as that
the two springs have equal strength, such that the total stiffness is
halved.

According to the 2D Hertz solution (e.g.\ equation (\ref{eq:fn_2d_hertz})),
the half-width of the contact area $a_h$ and the maximum normal pressure
$p_0$ are given as
\begin{equation}
\label{eq:2d_hertz_hw_radius}
	a_h = \left( \frac{4 R F_n (1-\nu)}{\pi G}\right)^{1/2}, \;\;\;
	p_0 = \left( \frac{F_n}{\pi R}\frac{G}{(1-\nu)}\right)^{1/2}.
\end{equation}
For $G_g=G_\infty$ (stiff, glassy) and $G_r=G_0$ (soft, rubbery), equations
(\ref{eq:2d_hertz_hw_radius}) give $a_h=4.48\unit{mm}$, $p_0=85.3\mpa$ and
$a_h=6.33\unit{mm}$, $p_0=60.3\mpa$, respectively.

The example input file {\tt visc\_cylindr.inp} contains four viscoelastic
cases with varying $\tauc=0,$ $0.009, 0.045$ and $2.0\unit{s}$, and two elastic
cases with varying $G$ ($517.5$ and $1143\unit{N/mm^2}$). The viscoelastic
cases are defined conform the following input:
\begin{alltt}\small
 3  MODULE
  203120     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022120     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0001341   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   100   100    30      1     1e-5     MAXGS , MAXIN , MAXNR , MAXOUT, EPS
 600000.   -0.600    0.000    0.000            FN, FX, FY, CPHI
   0.300    0.300                              FSTAT, FKIN
   0.000    0.160    1000.                     CHI, DQ, VELOC
   0.400    0.400    1143.    1143.            POISS 1,2,  GG 1,2
   1.0      1.0      0.009    0.009            FG 1,2, TC 1,2
    3                                          IPOTCN
  99   1   -7.920   0.000    0.160    1000.0   MX,MY,XC1,YC1,DX,DY
    1    1                                     IBASE, IPLAN
%    QUADRATIC UNDEFORMED DISTANCE
  0.010    0.000     0.000    0.000     0.000     0.000     B(I), I=1, 6
\end{alltt}
Things to note here are:
\begin{itemize}
\item The {\tt M} ({\tt MATER}) control digit is set to 1, i.e.\ for
        viscoelastic materials.
\item The normal force per unit length $F_n$ is translated to {\tt FN}
        by multiplying with $\delta y$.
\item The potential contact area is defined similarly as in the
        Carter/Fromm example, Section~\ref{sec:ex_carter_fromm}. In the
        $y$-direction, the contact region consists of one element with a
        large size of $\delta y=1000\unit{mm}$.
\item The undeformed distance between the cylinders equals
        $h(x,y)=R - \sqrt{R^2-x^2}$. For $x\ll R$ this is
        approximated as $h \approx x^2/2R$, and entered as a quadratic
        profile with ${\tt IBASE}=1$.
\end{itemize}

\begin{figure}[bt]
\centering
\psfig{figure=fig/visc_cylindr,width=4.2in,trim=35 75 65 70,clip=}
\caption{\em Results for the rolling contact of two viscoelastic cylinders.
Distribution of normal and tangential traction $\mu p_n(x)$ and
$p_x(x)$ for different relaxation distances $V\!\tau$. The axes are
normalized with $a_h=6.34\unit{mm}$ and $p_0= 60.3\mpa.$}
\label{fig:visc_cylindr}
\end{figure}

The results for the test-cases are shown in Figure~\ref{fig:visc_cylindr}. The
lowest pressures and shear tractions are found if the viscoelastic effects
take place immediately, relaxation distance $V\!\tauc=0$. This is the
softest material behaviour, resulting in the widest contact area with
semi-width $a_h=6.34\unit{mm}$, which is also obtained in the elastic case
using $G=G_0$. For increasing $\tauc$ the contact area
shrinks, first at the trailing edge and later also at the leading edge of
the contact area. The tractions increase correspondingly, until ultimately
the traction profile equals that of the elastic case with $G=G_{\infty}$.
For intermediate values of $\tauc$, an asymmetric traction profile is
found, which is a typical feature of viscoelastic contact. At the inlet
additional pressure is needed in order to overcome the creep relaxation and
avoid interpenetration of the two surfaces. At the outlet, it takes a while
for the material to relax back to its original form such that less pressure
is needed there.

\section{Instationary problems: from Cattaneo to Carter}
\label{sec:ex_catt_to_cart}

\begin{figure}[bt]
\centering
\psfig{figure=fig/catt_distc_12dx,width=3.2in,trim=100 30 0 10,clip=}
\psfig{figure=fig/catt_eldiv_3units,width=3.2in,trim=25 0 60 25,clip=}
\caption{\em Left: tangential tractions $p_x$ at centerline $y=0$ for the
transient rolling problem `from Cattaneo to Carter' after `3 units' of
time. Right: corresponding element division.}
\label{fig:catt_cart}
\end{figure}

The example `{\tt catt\_to\_cart.inp}' shows the computation of transient
phenomena. This example concerns the situation described in
\cite[paragraph 5.2.2.5]{Kalker1990}.

The test-case concerns the traction distribution arising in a wheel which
is at rest at first and then starts accelerating. The geometry, material
constants and normal load are chosen such that a circular contact area of
radius $3.5\unit{mm}$ is obtained. After the initial Cattaneo shift the spheres
roll with a constant longitudinal force $F_x=-0.657$ prescribed without
lateral and spin creepage. The results are written to {\tt mat}-files after
4, 8, 12, 20 and 28 steps of rolling, corresponding to a rolling distance
of 1, 2, 3, 5 and 7 $mm$, called `1--7 units of rolling' in~\cite{Kalker1990}.

Results of this example are presented in Figure \ref{fig:catt_cart}. The
graph on the left shows the tractions $p_x$ along the centerline $y=0$
after 3 units of time. The graph on the right shows the corresponding
areas of slip and adhesion. These results are qualitatively different from
those in \cite{Kalker1990}, because of the higher resolution that can be
used nowadays.

One specific aspect of the input-file {\tt catt\_to\_cart.inp} is that it
solves the same problem in three different ways. The first sequence of 57
cases uses the moving coordinate system of option ${\tt T}=2$. In these
cases the geometry is the same in all steps:
\begin{alltt}\small
    1   1                                                    IBASE, IPLAN
 0.002963   0.000    0.002963    0.000    0.000    0.000     B(I), I=1, 6
\end{alltt}
The next 57 cases solve the same problem using the world-fixed coordinate
system of option ${\tt T}=1$. In this case the quadratic undeformed distance
must be shifted to the right over a distance of $\delta q$ in each step:
\begin{equation}
  h(x,y) = b_1 \cdot (x-k\cdot\delta q)^2 + b_3\cdot  y^2
\end{equation}
With $\delta q=0.25\unit{mm}$ this yields the following geometry in step $k=4$:
\begin{alltt}\small
    1   1                                                    IBASE, IPLAN
 0.002963   0.000   0.002963 -0.0059260  0.000  0.0029630    B(I), I=1, 6
\end{alltt}
A large grid is used ($90\times 33$ instead of $34\times 33$ elements) 
that accomodates for all time steps with a single grid. In the output the
value {\tt CKSI} is multiplied by $\delta q=0.25\unit{mm}$.

The third sequence uses the world-fixed coordinate system (${\tt T}=1$),
with a potential contact area of $34\times 33$ elements that is shifted
$\delta x$ per time step, moving along with the actual contact area.

The easiest way to create the corresponding input-file is via a small
Matlab script that writes out the problem data per case.

The different approaches give practically the same results. This is shown 
in Figure \ref{fig:catt_cart} (left). To create this figure is a bit
intricate. Loading and plotting the data for the first sequence is similar
as before (Section \ref{sec:plot_surf}):
\begin{alltt}\small
r3=loadcase('catt_to_cart',13);  % "r3" = rolling, 3 units == case 13
s3 = loadcase('catt_to_cart',70);  % "s3" = shift + fixed view, case 70
v3 = loadcase('catt_to_cart',127); % "v3" = shift + moving view, case 127
opt=plot2d; opt.yslc=0; opt.facpt=-1;
plot2d(r3,opt);
\end{alltt}
Adding the data for the second and third sequences requires shifting the
data by 12 grid spaces:
\begin{alltt}\small
plot(s3.x-12*s3.dx, -s3.px(17,:), '-*');  % row 17 == centerline y=0.
plot(v3.x-12*v3.dx, -v3.px(17,:), '--o');
\end{alltt}
Figure \ref{fig:catt_cart} (right) shows the element division:
\begin{alltt}\small
opt=plot3d; opt.field='eldiv'; plot3d(r3,opt);
\end{alltt}

\allexamp{
\section{Dissimilar materials: Spence compression}
\label{sec:ex_spence}

The example {\tt spence35.inp} illustrates the interaction between normal
and tangential tractions when dissimilar materials are used.

We consider an elastic sphere with Poisson's ratio $\nu$. It is
pressed onto a rigid half-space in the presence of dry friction with
coefficient $\mu$. There is rotational symmetry; the contact area $C$
and adhesion area $H$ are circular, and the ratio of the contact radius and
the adhesion radius is a constant depending only on $\mu$ and $\nu$.

The problem was solved semi-analytically by Spence \cite{Spence1975}. It
was used as a test-problem a.o.\ by Kalker \cite[paragraph
5.3.1]{Kalker1990} and Willner \cite{Willner2008}. Solutions for the
example are shown in Figure \ref{fig:spence_px}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/spence_ptvec_case35,width=3.2in,trim=30 0 50 20,clip=}
\psfig{figure=fig/spence_px,width=3.2in,trim=30 0 50 10,clip=}
\caption{\em Spence compression. Left: element divisions and direction of
tangential tractions. Right: tangential tractions as function of radial
position $r$.}
\label{fig:spence_px}
\end{figure}

The example uses a sphere radius $R^{(1)}=121.5\unit{mm}$, modulus of rigidity
$G^{(1)}=0.5\unit{N/mm^2}$, Poisson's ratio $\nu^{(1)}=0$ and coefficient of
friction $\mu=0.2986$. The combined material parameters (Section
\ref{sec:lin_elast}) are $G=1, \nu=0$ and $K=0.5$, which is the maximal
difference that can be obtained. With these parameters, the radius of the
adhesion area is half that of the radius of the contact area
\cite{Spence1975}.

To understand the results of Figure \ref{fig:spence_px} we consider the
half-space solution by Boussinesq \cite{Boussinesq1885}. This solution
states that a localized compressive normal load $P$ acting on body $(1)$
invokes tangential displacements $\vec{u}^{(1)}_t$. At the surface
$z=0$, these tangential displacements are directed inwards, towards the
location where $P$ is applied.

In the examples of the previous sections we used identical elastic
constants for bodies (1) and (2). In those cases the tangential
displacements were identical for the two bodies, thus not creating any
displacement difference $\vec{u}_t$ (cf.\ equation (\ref{eq:displ_diff})).
In the current example body (2) is rigid, $\vec{u}^{(2)}=\vec{0}$, and
consequently a normal load $P$ {\em does\/} invoke a tangential
displacement difference between opposing surface particles of bodies (1)
and (2). This displacement difference is counteracted by frictional surface
tractions $\vec{p}^{(1)}_t$ acting on body (1), directed radially
outwards w.r.t.\ where the load $P$ is applied.

Finally, the tangential tractions also invoke normal displacements
$u^{(1)}_n$. These add to the profile of the sphere, such that the
the normal pressure distribution is also modified. This is shown by the
traction bound in Figure \ref{fig:spence_px} (right). At the center $r=0$,
the normal pressure is 1.31 times higher than for the Hertzian pressure
distribution, whereas the pressures are reduced at the outer side of the
contact area.

\begin{figure}[bt]
\centering
\psfig{figure=fig/spence_px_4stps,width=3.2in,clip=}
\psfig{figure=fig/spence_ux_4stps,width=3.2in,clip=}
\caption{\em Spence compression using too few stages in applying the load.
Left: tangential tractions, right: tangential surface displacements as
function of radial position $r$.}
\label{fig:spence_px_4stps}
\end{figure}

In the results presented here, a grid of $91\times 91$ elements of size
$\delta x=\delta y=0.1\unit{mm}$ is used. The load is gradually increased in 69
steps as $F_n=(k/90)^3$ for $k=2-70$. These cases are connected to each
other via the definition of the (micro) slip velocity (equation
(\ref{eq:discr_shift})). The relevance of this is clearly illustrated by
considering that the load is imposed at once, and comparing the results.
Figure \ref{fig:spence_px_4stps} shows the results of this scenario and for
simulations where the load is applied in four or seven steps.

By definition, surface particles in the adhesion area are locked in to the
corresponding particles of the other body. In the Spence problem, this
means that their tangential position does not change. In CONTACT this is
computed via the {\em shift\/}, the time-increment $\vec{u}_t -\vec{u}'_t$
(note that $\vec{W}_t=\vec{0}$). Now if the sphere was not yet loaded at
the previous time-instance $t'$, its tangential displacements $\vec{u}'_t$
were zero too, and equation (\ref{eq:discr_shift}) gives
$\vec{u}_t=\vec{0}$ in the adhesion area at the new time instance. This is
reflected in the horizontal part of the light-blue line in Figure
\ref{fig:spence_px_4stps} (right) for $r<0.9$. The shift
$\vec{u}_t-\vec{u}'_t$ is over-estimated, which increases the tangential
tractions $\vec{p}_t$ (Figure \ref{fig:spence_px_4stps}, left) and reduces
the size of the adhesion area.

Similar effects are visible when using four or seven steps. The results
quickly tend to the correct values, but significant oscillations are
visible. These are due to adding multiple discretisation elements to the
adhesion area per time step. Note that for the grid discretisation that is
used, the adhesion area has a radius of about 17 elements in the final stage.
}

\section{The calculation of subsurface stresses}
\label{sec:ex_subsurf}

The calculation of subsurface stresses is illustrated in the example {\tt
subsurf.inp}. This starts by defining the contact problem as usual, the
main difference being that the {\tt S}-digit is used. In the first case in
the input-file ${\tt S}=3$, and new subsurface points are entered. Two
blocks of subsurface points are defined using input option ${\tt
ISUBS}=9$ (see also Section \ref{sec:subsurf_inp}):
\begin{alltt}\small
% subsurface points:
   2   1        MATFIL, OUTPUT
% first block of subsurface points:
   9            ISUBS
   1   1   15   NX, NY, NZ
% points x:
   0.0
% points y:
   0.0
% points z:
   0.0   0.1   0.2    0.3   0.4   0.5   0.6   0.7   0.8   0.9
   1.0   1.25  1.667  2.5   5.0

% second block of subsurface points:
   9            ISUBS
  21   21   15   % NX, NY, NZ
   ...
  0             ISUBS
\end{alltt}
When this case is computed, the surface tractions are solved first
and subsurface stresses are evaluated immediately thereafter. Some
aggregate results are printed to the output-file, whereas the main
detailed results are put in a table for Matlab. This latter output
is stored in the file {\tt subsurf.0001\-.subs}; the first part of the
name is the experiment-name used, and the middle part `{\tt .0001}' is
the case-number. The extension {\tt .subs} is used for files containing
subsurface results. This is prepared in such a way that it can be
imported in Matlab at once.

The second case in the example has the {\tt S}-digit set to 1. As such it
re-uses the subsurface points defined in the first case of the
input-file.

\begin{figure}[bt]
\centering
\psfig{figure=fig/subsurf_zaxis,width=2.8in,trim=130 0 150 30,clip=}
\caption{\em Subsurface stresses in the half-space ($z\ge 0$), due to unit
loadings on a square with unit sides in normal and tangential directions.}
\label{fig:subsurf1}
\end{figure}

The contact problem in this example concerns the experiment described by
Kalker in \cite[paragraph 5.2.2.4]{Kalker1990}. It concerns the subsurface
field resulting from a unit load in a square element with size $1\times
1\unit{mm}$. The first case concerns a load in normal direction, the second case
concerns a normal plus tangential load. The subsurface stresses resulting
from this experiment are displayed in Figure \ref{fig:subsurf1}. Note that
Kalker's $\sigma_{ii}$ is $3\sigma_{hyd}$. 

The Matlab commands used for producing this figure are (see Section
\ref{sec:plot_subs}):
\begin{alltt}\small
  % load results for cases 1 and 2, each using two blocks 'a' and 'b'
  [s1a, s1b] = loadstrs('subsurf', 1);
  [s2a, s2b] = loadstrs('subsurf', 2);
  dif = diffstrs(s2a, s1a);
  plot(s1a.z, -squeeze(s1a.sighyd(1,1,:)), '-o');
  plot(s1a.z,  squeeze(s1a.sigvm(1,1,:)), '-*')
  plot(dif.z,  squeeze(dif.sigvm(1,1,:)), '--*')
\end{alltt}
Here `{\tt diffstrs}' is used to obtain the stresses due to the tangential
traction alone. For more information type `{\tt help diffstrs}' at the
Matlab command prompt.

The second block of points in the subsurface input specifies a 3D grid of
points. This allow plots to be made such as shown in Figure
\ref{fig:subsurf2}. This plot is created with the Matlab commands:
\begin{alltt}\small
  [s2a, s2b] = loadstrs('subsurf', 2);
  opt = plotstrs; opt.yslc = 0;
  opt.typplot = 'contourf';
  opt.cntrlvl = [0:0.02:0.08, 0.12:0.04:0.40];
  plotstrs(s2b, opt);
  set(gca,'clim',[0 0.40]);
  h=findobj(gcf,'type','colorbar');
  set(h, 'ylim',[0 0.40], 'ytick',opt.cntrlvl);
\end{alltt}

\begin{figure}[bt]
\centering
\psfig{figure=fig/subsurf_uz,width=4.0in,trim=35 0 15 25,clip=}
\caption{\em Normal displacements $u_z$ at $y=0$ inside body 1 ($z\ge 0$),
due to unit loads $p_n=1$ and $p_x=1$ on a square with unit sides.}
\label{fig:subsurf2}
\end{figure}

The file {\tt matlab\_subsurf.m} shows how the same cases are computed
using the CONTACT library version (Sections \ref{sec:clib_subs},
\ref{sec:clib_ex_subs}).

\section{The Manchester wheel-rail benchmark}
\label{sec:ex_mbench}

An important application area for CONTACT concerns the detailed study of
wheel-rail problems. To illustrate the use of CONTACT for
realistic wheel and rail profiles, we consider a case from the Manchester
contact benchmark. This benchmark is proposed in \cite{Shackleton2006} and is
presented together with initial results in \cite{Shackleton2008}. Data for
the profiles are provided\footnote{\tt
www.cmcc.nl/downloads/manch-benchmark.zip} thanks to dr.\ Shackleton of
the Institute of Railway Research of Huddersfield University.

\begin{figure}[bt]
\centering
\psfig{figure=fig/manch_benchm_wheelset,width=4.2in,clip=}
\psfig{figure=fig/manch_track_coords,width=2.2in,clip=}
\caption{\em Illustration of the simple wheelset model used in Manchester
benchmark simulation Case A \cite{Shackleton2006}.}
\label{fig:manch_wheelset}
\end{figure}

The aim of `Case A' of the benchmark is to compare predictions from
different contact models for clearly defined contact conditions. To this
end a single wheelset is considered as illustrated in Figure
\ref{fig:manch_wheelset}. Real wheel (new S1002 wheels) and rail profiles
(new UIC60 rails at 1:40 inclination) are used, with prescribed lateral
displacement, yaw angle, vertical load, velocity, and coefficient of friction.

The example uses two input-files, {\tt mbench\_a22\_left} and {\tt
mbench\_a22\_right}, for the left and right wheels of the wheelset
respectively. Each file defines 21 cases corresponding to benchmark case
A-2.2 with steady rolling and including yaw. These problems use
a constant coefficient of friction $\mu=0.30$. The use of friction
variation is shown in {\tt mbench\_a22\_varfric}. This side uses
$\mu=0.20$ on the inside of the rail (surface inclination $\delta_r
\le -20^\circ$), $\mu=0.30$ at the top of the rail ($\delta_r\ge
-10^\circ$), and linear variation in between.

The example uses module 1 for wheel/rail contact analysis (Chapter
\ref{chp:module1}), concerning a wheelset of which the position and
velocity states are fully prescribed.  This isn't entirely so in the
benchmark problem, that relies on the dynamic equations to complete the
problem specification. For instance, it isn't defined how the vertical load
is imposed: at the center of mass or at the bearings, distributed equally
or in an asymmetrical way. This is dealt with by making some ad-hoc
assumptions; once the states are better described, the resulting problem
can be solved in a similar way.

First we solved the static problem of the benchmark, with vertical force
divided equally over the two wheels. This uses option ${\tt N}_1=1$ with
${\tt FZ}=10\unit{kN}$. The primary unknown in this case is the roll angle
$\phi_{ws}$: if this is chosen poorly, then different values for the
wheelset $z_{ws}$ are obtained for left and right wheels. A basic iteration
was used, starting from $\phi_{ws}=0$, solving the left and right contacts,
and adjusting $\phi_{ws}$ to account for the difference, in order to find
the appropriate values.

After this the full benchmark problem was solved, including rolling at a
speed $V=2\unit{m/s}$. Here, the difficulty is to choose the wheelset angular
velocity $\omega_{ws}$ in an appropriate way. In the end, at steady
rolling, there should be no resulting moment in rolling direction, i.e.\
$M_{y(ws)}^{lft} + M_{y(ws)}^{rgt} =0$. The procedure we used consisted
of finding two pitch velocities $\omega_{ws}$ that give opposite net
moments and then use iteration to shrink this interval to the desired
resolution. The full moments were used as obtained from the CONTACT library
version, including the effect of the longitudinal shift of the vertical
force.

The resulting input for a case is then entered as follows:
\begin{alltt}\small
% 13: Lateral displacement  6.0 mm, yaw angle 14.4 mrad

  1 MODULE
 0203100    C-P-B-T-N-F-S   CONFIG, PVTIME, BOUND,  TANG,   NORM,   FORCE,  STRESS
 0122033    V-L-D-C-M-Z-E   VARFRC, FRCLAW, DISCNS, INFLCF, MATER,  ZTRACK, EWHEEL
 0101321    H-G-I-A-O-W-R     HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW,   RETURN
  0.280   0.280   82000.  82000.                 POISS 1,2,  GG 1,2
  0.200   0.200   1.000   90d   8.0   4.0        DX, DS, DQREL, A\_SEP,D\_SEP,D\_COMB
   14.0     0    1435.0   0.000                  GAUGHT, GAUGSQ, GAUGWD, CANT
  'MBench\_UIC60\_v3.prr'   0     1.0   0.0        RFNAME, MIRRORY, SCALE, SMOOTH
     0.0    0.0   0.000   0.0   0.0   0.000      DY, DZ, ROLL, VY, VZ, VROLL
  1360.0  -70.0   460.0                          FBDIST, FBPOS, NOMRADW
  'MBench\_S1002\_v3.prw'   0     1.0   0.0        WFNAME, MIRRORY, SCALE, SMOOTH
  0.0  6.0  10000. -0.0006272  0.0144  0.0       S,  Y,  FZ, ROLL,  YAW,  PITCH
 2000. 0.0    0.0   0.0        0.0    -4.329372  VS, VY, VZ, VROLL, VYAW, VPITCH
\end{alltt}
One interesting point regarding this input is the absense of rail cant. This
is included in the profile itself, following the original benchmark
specification, that describes the rail in the canted position.

\begin{figure}[bt]
\centering
\psfig{figure=fig/cpos_a22_final,width=4.2in,clip=}
\caption{\em Results for Manchester benchmark example: contact locations at
left and right wheels, as function of the lateral wheelset displacement.}
\label{fig:mbench_cpos}
\end{figure}

One interesting result for this example concerns the contact locations that
are found at the different wheelset positions. These are shown in Figure
\ref{fig:mbench_cpos}, for the left and right rails in the top and bottom
graphs respectively. The coordinates used on the horizontal axis are with
respect to the rail origin, chosen as the highest point in the canted rail
profile. Note that the track center is on the left for both rails, that is,
left-handed coordinates are used for the left rail. Note further that two
contact patches are found on the right rail if the wheelset is displaced to
$y_{ws}=5\unit{mm}$. The results are generally in line with those presented in
\cite{Shackleton2008}, showing that the yaw angle has little effect on the
lateral contact position.

\begin{figure}[bt]
\centering
\psfig{figure=fig/mbench_a22_6mm_lft_prr,width=3.2in,clip=}
\psfig{figure=fig/mbench_a22_6mm_rgt_prr,width=3.2in,clip=}
\caption{\em Results for Manchester benchmark example: wheelset with
lateral displacement $y_{ws}=6\unit{mm}$, yawed at $\psi_{ws}=14.4\unit{mrad}$.}
\label{fig:mbench_prr}
\end{figure}

The results are illustrated further in Figure \ref{fig:mbench_prr}, for a
lateral displacement of $6\unit{mm}$, displaying the contact patches at the rail
surface. These pictures are created as follows:
\begin{alltt}\small
l13 = loadcase('mbench_a22_left',13);
prr = read_profile('MBench_UIC60_v3.prr');
opt = plot3d; opt.rw_surfc = 'prr';
plot3d(l13, opt, prr);
\end{alltt}
\color{black}

The file {\tt matlab\_mbench.m} shows how this problem is computed
using the CONTACT library version in Matlab (Section
\ref{sec:clib_mbench}). The file {\tt test\_mbench.f90} shows a
corresponding implementation in Fortran.

\section{Simulation of wheel out-of-roundness}
\label{sec:ex_wheelflat}

CONTACT typically represent wheels using a 2-dimensional profile for a
cross-section in lateral direction. A 3-dimensional surface is imagined
using a uniform revolution about the axis of the wheel, thereby exluding
wheel out-of-roundness. Out-of-roundness can be included using the
so-called slices-file, using multiple 2-dimensional profiles at different
positions along the circumference of the wheel. This is illustrated in
the example {\tt wheelflat.inp}. The example is based on a damaged wheel
for which geometry measurements were obtained by means of 3D laser scans
\cite{Maglio2023a-phd,Maglio2023b}. The data are provided thanks to prof.\
Nielsen of Chalmers University of Technology.

\begin{figure}[bt]
\centering
\psfig{figure=fig/flat_1_lines2,height=2.1in,trim=80 0 100 30,clip=}
\psfig{figure=fig/wheel_flat_1,height=2.1in,trim=150 0 180 30,clip=}
\caption{\em 3D laser scan data for a wheel flat used in the {\tt
        wheelflat} example \cite{Maglio2023b,Mattsson2023}.}
\label{fig:chalmers_flat1}
\end{figure}

The laser scan data were provided as radial deviations $dr_{dev}$ with
respect to the nominal profile as illustrated in Figure
\ref{fig:chalmers_flat1}. An S1002 profile is used, resampling the tread
region at $1\unit{mm}$ spacing, and adding the deviations to the profile
data. 3075 samples were given along the circumference
of the wheel, corresponding to $1\unit{mm}$ spacing at the tape circle
line ($r_{nom}=490\unit{mm}$). They are thinned out by keeping 80
samples on either side of the maximum depth and using every 30th sample
along the remainder of the circumference. After this there are 258 slices
remaining. Circumferential $x_w$ positions for the slices are converted
to radians in the basic interval $[-\pi,\pi)$. This
places the flat in the interval $\theta_{wc}=[0.486,0.812]\unit{rad}=
[27.8^\circ,46.5^\circ]$ with center at $\theta_{wc}=0.649\unit{rad}=
37.2^\circ$.

The slices file {\tt S1002\_flat.slcw} used looks as follows:

\begin{alltt}\small
% wheel flat on S1002 profile, 
% data courtesy M. Maglio / Chalmers University of Technology

     0.0       \blue{1.0}   TH_OFFSET [x], TH_SCALE [rad/x], x=rad
     \blue{258}             NSLC
       0    0    0   NFEAT, NKINK, NACCEL
       \blue{2}             S_METHOD (1=intpol, 2=approx)

% slice positions TH_SLC [x] and filenames WFNAME per slice

   -3.0995   'S1002_flat/Wheel_section_208.txt'
              ...
   -0.0383   'S1002_flat/Wheel_section_258.txt'
    0.0000   'S1002_flat/Wheel_section_1.txt'
    0.0612   'S1002_flat/Wheel_section_2.txt'
              ...
    0.4857   'S1002_flat/Wheel_section_9.txt'   % start of wheel flat
    0.4878   'S1002_flat/Wheel_section_10.txt'
              ...
    3.1224   'S1002_flat/Wheel_section_207.txt'
\end{alltt}

Three values highlighted in blue are $\theta_{scale}=1$ indicating
that the slice positions are given in radians such that no scaling is
needed, $n_{slc}=258$ for the number of slice positions presented, and
${\tt s\_method}=2$ to select the approximating spline method introducing a
little smoothing. In the example, the slice filenames are obtained from the
numbering after selecting every 30th slice, before wrap-around of
$[\pi,2\pi)$ to $[-\pi,0)$. From this we see that the numbers in the
filenames are ignored by CONTACT. In fact, it would be possible to
repeat the same file (`{\tt Nominal\_profile.txt}') at different positions
(all $\theta_{slc}$ outside $[0.485,0.813]$). The slices before number 6
($\theta_{slc}=0.3061$) and after number 172 ($\theta_{slc}=0.9796$) could
be deleted with no difference to the calculation.

The calculations in {\tt wheelflat.inp} concern this wheel at 26 pitch
positions $\theta_{ws}$. Negative values $\theta_{ws}$ are needed to bring
a flat into contact that is located at positive $\theta_{wc}$ (see Figure
\ref{fig:wheel_theta}). The pitch velocity $v_\theta$ is negative as well.
So we find the flat approaching the contact zone at $\theta_{ws}=-25^\circ$
and leaving the contact zone at $\theta_{ws}=-50^\circ$. Dynamic effects
are excluded here using a constant prescribed vertical force
$F_z=125\unit{kN}$. These would need to be computed by multibody dynamic
simulation including the track stiffness and wheelset dynamic response.

\begin{alltt}\small
  'S1002_flat.slcw'   0   1.0   5.0               WFNAME, MIRRORY, SCALE, SMOOTH
      0.0   0.0  125000.  0.0   0.0   -25.0d      S, Y, FZ, ROLL, YAW, PITCH
   2000.0   0.0    0.0    0.0   0.0   -4.08191    VS,VY,VZ, VROLL,VYAW,VPITCH
\end{alltt}

\begin{figure}[bt]
\centering
\psfig{figure=fig/wheelflat_pn8x,width=5.4in,trim=100 5 120 30,clip=}
\caption{\em Computed contact patch shapes and pressures $p_n$ for
        Chalmers' measured wheel flat approaching, passing through and
        leaving contact at constant vertical force. Contour: corresponding
        contact patch on nominal wheel profile without out-of-roundness.}
\label{fig:chalmers_pn8x}
\end{figure}

Results are shown in Figure \ref{fig:chalmers_pn8x} for eight wheelset
pitch angles $\theta_{ws}$. The dark-red contour shows the outline of the
contact patch for the nominal profile. From this we see how the contact
patch shifts back at first, moves sideways and then advances ahead of the
nominal patch, after which it finally comes back to the reference shape
and position. 

\section{Calculation of creep force curves}
\label{sec:ex_tractcurv}

A main outcome of CONTACT for railway applications is the relation between
the creepages and creep force. These are the subject of example {\tt
tractcurv.inp}, which concerns the creep force for the Siemens locomotive
Eurosprinter 127 001. Measurements of the creep force were presented by
Engel et al.\ for a study of traction control strategies \cite{Engel1998}.
The measurements concern straight running on tangent track, i.e.\ with pure
longitudinal creep. The measurements are shown in Figure
\ref{fig:tractcurv} together with the computed results.

\begin{figure}[bt]
\centering
\psfig{figure=fig/eurosprinter6,width=3.2in,trim=40 17 60 20,clip=}
\psfig{figure=fig/eurosprinter5,width=3.2in,trim=40 17 60 20,clip=}
\caption{\em Measured and computed creep forces for the Siemens locomotive
Eurosprinter 127001 for pure longitudinal creepage.}
\label{fig:tractcurv}
\end{figure}

The creep force curve is computed in CONTACT with a series of cases, one
for each creep value. In the example 30 cases are used per creep force
curve, with small steps for $\xi$ at first and larger spacing after
saturation has occurred. The input for the first case can be understood on
the basis of the examples presented above:
\begin{alltt}\small
 3 MODULE
  203100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022020     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0000341   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
    80   200    5    1      1e-6    MAXGS , MAXIN , MAXNR , MAXOUT, EPS
 106700.      0.00001    0.000      0.000           FN, CKSI, CETA, CPHI
   0.330      0.330                                 FSTAT, FKIN
   0.000      0.100      10000.                     CHI, DQ, VELOC
   0.280      0.280      82000.     82000.          POISS 1,2,  GG 1,2
   -2                                               IPOTCN
   44   44    0.0008     0.500      1.100           MX,MY,A1,AOB,SCALE
    80   200    5    1      1e-6    MAXGS , MAXIN , MAXNR , MAXOUT, EPS
\end{alltt}
Noteworthy points are as follows:
\begin{itemize}
\item The wheel radius is $R=625\unit{mm}$, which gives a curvature
        $A=0.0008\unit{mm^{-1}}$ in rolling direction.
\item The Hertzian input option ${\tt IPOTCN}=-2$ is used for prescribing
        $A$ and $a/b$. The value $a/b=0.5$ is typical for a wheelset
        at central position on the rails.
\item For this locomotive the vertical load is $106.7\unit{kN}$ per wheel, and
        the velocity used in the experiments is $V=10\unit{m/s}$.
\item The first creep force curve concerns Kalker's original model with
        Coulomb dry friction: ${\tt L}=0$, $\mu=0.33$.
\end{itemize}
The following 29 cases re-use most of the inputs by proper setting of
the control digits ({\tt L}, {\tt D}, {\tt C}, {\tt Z} and {\tt G}):
\begin{alltt}\small
 3 MODULE
  203100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  100000     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0100341   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
 106700.      0.0004     0.000      0.000           FN, CKSI, CETA, CPHI
\end{alltt}
In the $31^{st}$ case the calculation of a second creep force curve is
started. This curve concerns extensions of CONTACT for incorporating the
`reduced initial slope' and `falling friction' effects, see Figure
\ref{fig:tractcurv} (left). These effects are incorporated via the
interfacial layer of material model ${\tt M}=4$ (Section
\ref{sec:intfc_layer}) and the velocity dependent friction of ${\tt L}=4$
(Section \ref{sec:fric_dscrp}). The corresponding inputs are:
\begin{alltt}\small
% Exponential falling friction (L=4):
   0.1400     0.1900     1250.    0.000   0.000  FKIN, FEXP1,SABSH1,FE2,SH2
   0.003      1.000                              MEMDST, MEM_S0
...
% Elastic bodies with elasto-plastic interface layer (M=4):
   0.280      0.280      82000.   82000.         POISS 1,2,  GG 1,2
   8200.      1.250      0.000    0.000          GG3, LAYTHK, TAUCRT, GGPLST
\end{alltt}
Next, cases 61 to 90 employ the original Fastsim algorithm with parabolic
traction bound (${\tt M}=3, {\tt B}=3$). Finally cases 91 to 120 use
`Modified Fastsim' with parameters $k_0=0.54, \alpha_{inf}=0.02,
\beta=0.64$ as specified in \cite{Spiryagin2013}. The friction
parameters are derived with the help of equation (\ref{eq:polach_law})
with $\mu_{stat}=0.36, A=0.38, B=0.7$.
\begin{alltt}\small
% Exponential falling friction (L=4), static 0.36(!):
   0.1368     0.2232      990.   0.000   0.000   FKIN, FEXP1,SABSH1,FE2,SH2
...
% Slope reduction for Modified Fastsim algorithm (M=3):
   0.540      0.020      0.620                   K0\_MF,ALFAMF,BETAMF
\end{alltt}

After the simulation, the traction forces $F_x$ are presented in
the output-file {\tt tractcurv.out}:
\begin{alltt}\small
     FN          FX          FY          MZ         ELAST.EN.   FRIC.POWER
     1.067E+05      -247.0       0.000       0.000       3.265  -4.124E-05
     FN/G      FX/FSTAT/FN  FY/FSTAT/FN  APPROACH     PMAX    
         1.301  -7.015E-03       0.000   7.651E-02       640.7
\end{alltt}
They are imported into Matlab using the script {\tt parse\_out3.m} and
plotted with the following commands:
\begin{alltt}\small
   sol  = parse_out3('tractcurv.out');
   cksi = 100 * reshape(sol.creep.cksi, 30, 4);
   fx   =       reshape(sol.force.fx, 30, 4);
   fx   = -fx * diag(fstat);
   plot(cksi, fx, '-o');
\end{alltt}
Note that the conventions used in CONTACT make that a positive creepage
$\xi$ comes with a negative force $F_x$. For a coordinate system with $z$
pointing upwards, the upper body 1 is the wheel. A positive creepage $\xi$
then means that particles of the wheel move slower through the contact area
than the particles of the rail. Adhering together of the particles then
requires negative displacements $u^{(1)}_x$ (and positive $u^{(2)}_x$), which
again requires negative tractions $p^{(1)}_x$ acting on the wheel surface.
Since creep force curves are typically plotted with positive force for
positive creep we use {\tt -fx} in the Matlab plot-command.

The file {\tt matlab\_tractcurv.m} shows how this problem is computed
using the CONTACT library version (Section \ref{sec:clib_tract}).

\section{Conformal contact}
\label{sec:ex_conformal}

In wheel-rail contact analysis, it is typically assumed that the contact is
`concentrated', i.e.\ the contact area is assumed small with respect to
the dimensions of the contacting bodies as a whole, such that the contact
area almost lies in a plane. This
assumption is clearly violated in the case of contact between the wheel
flange root and rail gauge corner. This is illustrated in Figure
\ref{fig:worn_profile} via a measured worn rail profile. At the rail
gauge corner the normal direction changes orientation by $41^\circ$ over a
distance of $7\unit{mm}$, because the radius of curvature goes down to less than
$10\unit{mm}$. This leads to {\em conformal contact\/} situations between the
flange root and rail gauge corner, where the contact area is curved.

The example in this section is taken from the paper
\cite{Vollebregt2018b-corrigendum}, and focuses on the different aspects
related to solving conformal contact problems. 
Three different aspects are taken into account:
\begin{description}
\item[undeformed distance] The undeformed distance between wheel and rail
is computed in a different way \cite{Vollebregt2014d-conformal}. 
Approximating a circular arc by a quadratic function is no longer
appropriate, and the changing normal direction is taken into account.
\item[varying spin creepage] The rigid slip originating from spin cannot be
represented anymore by $\vec{w}=[\phi y, -\phi x]^T$ (equation 
(\ref{eq:rig_shift_roll})), but must take the varying normal direction
into account \cite{Li_zili2002-phd-thesis}.
\item[influence coefficients] The response of the true bodies to surface
loads deviates from the response of the elastic half-space. The true
response can be computed using FEM and introduced via numerically computed
influence coefficients (\cite{Vollebregt2014d-conformal}, see Section
\ref{sec:num_infl}, Figure \ref{fig:quasiquart_mesh}).
\end{description}

\begin{figure}[bt]
\centering
\psfig{figure=fig/meas_prof_detail,width=3.2in,clip=}
\caption{\em Measured worn profile with conformal contact situation
        at the rail gauge corner.}
\label{fig:worn_profile}
\end{figure}

We consider a vehicle during steady curving. The wheelset is positioned
such that the outer wheel makes contact to the rail at the rail gauge
corner at a position where the contact angle is about $45^\circ$ (position
$s=0$ in Figure \ref{fig:worn_profile}). This defines the spin creepage
$\phi=-0.001537\unit{rad/mm}$ for a planar contact analysis. The longitudinal
and lateral creepages $\xi$ and $\eta$ can take any values in principle,
depending on the angle of attack (yaw angle $\psi$) and the rolling radius
difference between left and right wheels of the wheelset. These depend
among others on the radius of curvature and the steering ability of the
vehicle. The values that are selected are $\psi=-14\unit{mrad}$
($\eta=-0.99\,\%$) and $\xi=-0.4\,\%$.

The curvature of the contact patch is defined through the transverse radius
$R_{yr}=10.0\unit{mm}$ for the rail profile. A strongly conformal situation is
constructed using radius of curvature $R_{yw}=-10.2\unit{mm}$ for the wheel, which
may occur in the flange root of a worn wheel with S1002 profile. A typical
value of $F_n=100\unit{kN}$ is used for the wheel normal load. The corresponding
approach $\delta_n=0.09089\unit{mm}$ is derived using the Hertzian theory, and is
then held fixed in the different cases such that the total force becomes
variable again.

This single scenario is modeled in five different cases in input-file {\tt
conformal.inp}.
\begin{enumerate}
\item In the first case, a Hertzian approximation is used and all effects
of conformality are ignored. The profile is entered via the quadratic
function (\ref{eq:quadr_ud}), with the coefficients computed using
(\ref{eq:a1_b1}).
\item In the second case, the true undeformed distance is computed in
Matlab and entered into CONTACT via option ${\tt IBASE}=9$. The approach
$\delta_n$ is used already in Matlab such that $\delta_n=0$ is entered in the
input-file.

The third, fourth and fifth cases re-use the grid and undeformed
distance of the second case, by setting ${\tt D}=0$ and ${\tt Z}_3=0$.

\item In the third case, numerically computed influence coefficients are
used. This is entered via ${\tt C}_3=9$ and ${\tt CFNAME}={\tt
'inflcf\_r10\_mx51.txt'}$. The file is prepared in advance, using finite
element calculcations for meshes such as the ones displayed in Figure
\ref{fig:quasiquart_mesh} \cite{Vollebregt2014d-conformal}. There is a
close correspondence between the CONTACT grid and the input-file: these
must both use the same grid spacings $\delta x, \delta y$ and also the
number of elements must be the same.

\item In the fourth case, the effect of conformality on the creepages is
properly taken into account. The rigid slip is evaluated in Matlab for
all points of the potential contact area and printed to a file, and is
incorporated in the CONTACT input-file via option ${\tt E}_3=9$. Since the
full rigid slip is computed in Matlab we set ${\tt CKSI}={\tt CETA}={\tt
CPHI}=0$. Further we use the half-space elasticity again, setting ${\tt
C}_3=2$ instead of ${\tt C}_3=9$.

\item Finally, the fifth case incorporates all three effects
simultaneously. The proper undeformed distance that was introduced in case
2, the numerically computed influence coefficients of case 3, and the
varying creepages of the fourth case. Since the rigid slip is the same as
in the previous case it can be reused, using ${\tt E}_3=1$, instead of
repeating all the values again.
\end{enumerate}

\begin{figure}[bt]
\centering
\psfig{figure=fig/conform_ptabs1,width=3.2in,trim=10 60 42 95,clip=}
\psfig{figure=fig/conform_ptabs2,width=3.2in,trim=10 60 42 95,clip=}
\caption{\em Comparison of results for different approximations to a
conformal contact problem. Left: results for case 1, Hertzian approach, and
case 5, full conformal approach. Right: contribution of planar $\rightarrow$
varying creepage (case $3\rightarrow 5$) and of halfspace $\rightarrow$
numerical influence functions ($4 \rightarrow 5$).}
\label{fig:conformal}
\end{figure}

The results are illustrated in Figure \ref{fig:conformal}. It can be seen
that the undeformed distance calculation has a considerable effect on the size
and width of the contact patch. The Hertzian approach overestimates the
width and contact area by $10\text{--}15\%$ and underestimates the pressures
and tangential traction correspondingly. Varying creepage and numerical
influence coefficients have less pronounced effects on the total forces,
but do change the distribution of stresses over the contact patch. 

The pictures of Figure \ref{fig:conformal} are created using {\tt
opt.field='ptabs+vec'}. In order to get two plots in one figure we use
Matlab's {\tt subplot} command and set {\tt opt.addplot=1}. The colors for
magnitude of tangential tractions are controlled using {\tt opt.zrange=[0
320]} and {\tt [0 130]} respectively. In the figure on the right we used
{\tt opt.veccolor='m'} and {\tt opt.vecscale=0.005} ($\bunit{mm}$ per
$\bunit{N/mm^2}$). The colors in Figure \ref{fig:conformal}, right, indicate the
magnitude of the difference, $\|\vec{p}^i-\vec{p}^j\|$, showing the length
of the arrows on these pictures.

\section{Calculation of contact temperatures}
\label{sec:ex_temperature}

The example {\tt ertz\_temperature.inp} shows the calculation of surface
temperatures using module 3. This example considers the scenario
used by Ertz and Knothe \cite{Ertz2002a}: a Hertzian case with semi-axes
$a=5.88$ and $b=10.54\unit{mm}$, normal force $100\unit{kN}$, a vehicle velocity of
$30\unit{m/s}$, and a sliding velocity of $1\unit{m/s}$, which is obtained using
creepage $\xi=-0.03333$. Rolling is to the left (${\tt chi}=180^\circ$)
such that particles traverse the contact from left to right, with
increasing $x$-values corresponding to increasing time.

The temperature calculation is activated setting the {\tt H}-digit to 3.
This requires additional material parameters: the specific heat capacity
$c_p=450\unit{J/kg\celc}$, thermal conductivity $\lambda=50\cdot
10^{-3}\unit{W/mm\celc}$, and the density of the materials, $\rho=7850\cdot 
10^{-9}\unit{kg/mm^3}$.

For each body, the initial temperature is at the background value, which
may be different for the rail (body 1) and wheel (2). The surface
temperatures instantaneously jump to an intermediate value for the material
that enters the contact area. In the adhesion area this value remains
constant, and may be increased in the slip area due to frictional heat
input. After leaving the contact area, the heat energy will be spread out
inside both bodies, by which the surface temperature relaxes back to the
background value again.

Different cases are computed for (1) equal background temperatures with
sliding, (2) different background temperatures with no sliding, and (3)
different background temperatures with sliding. Finally, the fourth case
shows results for partial sliding, using $\xi=0.2\%$.

We use the non-Hertzian grid specification in order to add extra elements
at the trailing side of the contact area. The {\tt A}-digit is set to 2 to
export all values in the {\tt mat}-file, for the whole potential contact
area. 
\begin{alltt}\small
 3  MODULE
  203100    P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  022020    L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 3002231  H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   999   100    30      1     1e-5     MAXGS , MAXIN , MAXNR , MAXOUT, EPS
  100000.  -0.03333  0.000    0.000          FN, CKSI, CETA, CPHI
   0.300    0.300                            FSTAT, FKIN
   180d     0.200    30.0                    CHI, DQ, VELOC
   0.280    0.280    82000.   82000.         POISS 1,2,  GG 1,2
   0.000    450.     50e3     7.85e-6        BKTEMP1, HEATCP1, LAMBDA1,DENS1
   0.000    450.     50e3     7.85e-6        BKTEMP2, HEATCP2, LAMBDA2,DENS2
    1                                        IPOTCN
   211  45  -6.90  -11.25   0.200   0.500    MX,MY, XL,YL, DX,DY
    1    1                                   IBASE, IPLAN
  0.001015  0.0  0.0004215  0.0  0.0  0.0    B1,B2,B3,B4,B5,B6
\end{alltt}
The results for cases 1 and 2 are shown in Figure \ref{fig:temperature}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/temperature_fld,width=3.2in,clip=}
\psfig{figure=fig/temperature_tser,width=3.2in,clip=}
\caption{\em Surface temperatures for example {\tt ertz\_temperature.inp}.
Left \& top-right: results for case 1, with full sliding ($1\unit{m/s}$) and
equal bulk temperatures. Bottom-right: results for case 2, with no sliding
and different bulk temperatures (centerline $y=0$).}
\label{fig:temperature}
\end{figure}

\section{Shearing of interfacial layers}
\label{sec:ex_plastic}

The example {\tt plastic\_3bl} illustrates CONTACT's submodel for
interfacial layers. This considers the rheometer experiments as reported by
Hou et al.\ \cite{Hou1997}, where different powders were placed on an
anvil, pressed and sheared, measuring the shear stresses as a function of
slip distance. Results were presented for magnetite, clay, sand and
molybdenum sulfide (MoS2), compressed at $900\unit{N/mm^2}$.

\begin{figure}[bt]
\centering
\begin{minipage}[t]{0.50\textwidth}
  \vspace{10ex}
  \centering
  \begin{tabular}[b]{|l|ccr|}
  \hline
                       & $u_{c0}$ & $\tau_{c0}$ & \multicolumn{1}{c|}{$k_u$} \\
   $3^{rd}$ body layer &  $mm$ & $N/mm^2$    & $N/mm^3$ \\
  \hline
  `magnetite' & $0.070$ & $560$ & $   0.$ \\
  `clay'      & $0.040$ & $200$ & $ 400.$ \\
  `sand'      & $0.050$ & $400$ & $-200.$ \\
  `MoS2'      & $0.020$ & $ 20$ & $  20.$ \\
  \hline
  \end{tabular}
\end{minipage}
\begin{minipage}[t]{0.49\textwidth}
  \vspace{0pt}
  \psfig{figure=fig/hou1997_example,width=3.2in,clip=}
\end{minipage}
\caption{\em Shear stress curves computed by CONTACT for several compounds,
mimicking the results of Hou et al.\ \cite[Fig. 4]{Hou1997}.}
\label{fig:plastic_3bl}
\end{figure}

In the simulation, we approximate the measured rheologies by piecewise
linear functions. These are characterized by the threshold point $(u_{c0},
\tau_{c0})$ where the slope of the curve changes, and by the slope $k_u$ in
the plastic regime. The values used are shown in the table in Figure
\ref{fig:plastic_3bl}, left, the resulting curves in Figure
\ref{fig:plastic_3bl}, right. See also Figure \ref{fig:hou_schm} in Section
\ref{sec:intfc_layer}.

The simulations concern a single element in contact with size $1\unit{mm^2}$,
carrying a normal load $F_n=900\unit{N}$. The upper body is shifted to the left with
respect to the lower, using ${\tt T}=1$, with $13\text{--}17$ steps like
${\tt cksi}= -0.035$ or $-0.050\unit{mm}$. Additional steps are inserted in the
`clay' series, using one step to the right, ${\tt cksi}=+0.036\unit{mm}$, to
show the corresponding behavior. The resulting stresses $\tau=p_x$ are
computed by CONTACT as shown in Figure \ref{fig:plastic_3bl}, right. 

In CONTACT, the slope $\tau_{c0}/u_{c0}$ comes about by elastic deformation
in the layer and in the primary bodies. The flexibility of the latter is
found using a test without interfacial layer: $F_x=84.97\unit{N}$ at ${\tt
cksi}=-0.001\unit{mm}$. For a given layer thickness, the elastic modulus is then
obtained as
\begin{equation}
   L_{tot} = L_{prim} + L_{lay}
        \;\;\rightarrow\;\;
   \frac{h^{(3)}}{G^{(3)}} = \frac{u_{c0}}{\tau_{c0}} 
                           - \frac{0.001}{84.97}
        \;\;\rightarrow\;\;
   G^{(3)} = h^{(3)} \cdot \left( \frac{u_{c0}}{\tau_{c0}} 
                           - \frac{0.001}{84.97} \right)^{-1}
\end{equation}
Using the values of Figure \ref{fig:plastic_3bl}, left, with a layer
$h^{(3)}=20\unit{\mu m}$, this gives $G^{(3)}=176.6, 106.3$, $176.6$ and
$20.4\unit{N/mm^2}$ for the four materials. The slopes $k_\tau$ used in the
input are computed with equation (\ref{eq:k_tau}):
\begin{alltt}\small
% Series 2: Clay,  u_c0 = 0.040 mm, tau_c0 = 200 N/mm2, k_u = 400 N/mm2 / mm

 3  MODULE
  201100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  102400     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0101441   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   900.0      -0.040       0.000      0.000      FN, CKSI, CETA, CPHI
   0.280       0.280       82000.     82000.     POISS 1,2, GG 1,2
   106.25      0.020       200.0      435.0      GG3, LAYTHK, TAU_C0, K_TAU
\end{alltt}

\allexamp{
\section{Transient rolling with velocity dependent friction}
\label{sec:ex_veldep}

Besides Coulomb's law of dry friction, several extended friction laws are
provided as well as described in Section \ref{sec:fric_dscrp}. Particularly
for experimenting with `falling friction', that is, friction
formulations where the friction coefficient $\mu$ decreases with increasing
local slip velocity $\|\vec{s}_t\|$. The results of this are demonstrated
in example {\tt veldep\_fric}, which corresponds to the test case that is used
in the paper \cite{Vollebregt2012a-quasistd}.

The example concerns the 2D rolling contact of a cylinder on a plane. The
geometry and normal pressure are set such that a contact patch size of
$8\unit{mm}$ is obtained. Three different friction laws are provided in the
input-file.
The last one of these is used by setting ${\tt L}=4$, and corresponds
to equation (\ref{eq:exponential_law}).

\begin{figure}[bt]
\centering
\psfig{figure=fig/veldep_l4_dx01_mult,width=3.2in,trim=20 0 60 0,clip=}
\psfig{figure=fig/veldep_l4_dx01_t49,width=3.2in,trim=20 0 60 0,clip=}
\caption{\em Results obtained with slip-velocity dependent friction law
${\tt L}=4$. Left: demonstration of multiple solutions to the same case,
depending on initial estimate to the slip. Right: traction distribution
after 49 time steps, with peculiar peaks travelling from right to left
through the contact area.}
\label{fig:veldep_fric}
\end{figure}

There appear to be multiple solutions to the discrete system. This is
demonstrated by calculating three different cases consecutively:
\begin{itemize}
\item `case 1': solve for a steady state solution ($p=p(x), u=u(x),
        \txtfpd{u}{t}=0$) for one creepage $\xi$;
\item `case 2': starting from the steady state for creepage $\xi$,
        perform a single time step for a slightly perturbed creepage
        $\tilde{\xi}$, with initial estimate $s^0=0$;
\item `case 3': starting from the steady state for creepage $\xi$,
        perform a single time step for a slightly perturbed creepage
        $\tilde{\xi}$, with initial estimate $s^0=V{\rm sgn}(\xi)$;
\end{itemize}
The `true' creepage in case 1 is set at $\xi=-0.1\%$. The perturbation
in cases 2 and 3 consists of decreasing the creepage to
$\tilde{\xi}=-0.09999\%$.

Figure \ref{fig:veldep_fric} (left) shows the results of this experiment,
using grid step size $\delta x=0.1\unit{mm}$ and rolling velocity
$V=45\unit{m/s}$. These results show that two different solutions are
possible for exactly the same contact problem. If $s$ is approximated from
below (`case~2'), several elements are moved to the adhesion area. If
$s$ is approximated from above (`case~3'), a much higher slip is found.
And if the creepage is not perturbed then a third solution is possible:
the steady state solution that is in between the two extremes.

Note that Figure \ref{fig:veldep_fric} shows the absolute slip $s_a$, in
units of $km/s$, in order to scale the values to the same range as those
of $p/G$. The largest slip in the steady solution is approximately
$-0.13\unit{m/s}$ ($-0.3\%$).

The qualitative behaviour of the numerical results is illustrated further
in Figure \ref{fig:veldep_fric} (right). This concerns the computed traction
distribution after calculation of 49 time steps ($4.9\unit{mm}$ rolling
distance). In each time step the initial estimate $s^0=-V$ (high slip) is
used.

The result for the first time step is already shown in Figure
\ref{fig:veldep_fric} (left). In the second time step the slip velocity drops,
most elements are transferred to the adhesion area, and the two peaks in
the traction distribution move one grid space to the left. In the next few
steps the slip velocity and slip area increase gradually and the peaks
travel further to the left. After a while a critical configuration is
reached, the slip velocity jumps to a high value, a new peak is found
at the leading edge of the contact area, and the process starts to repeat
itself.

The background of these peculiar peaks is analysed in
\cite{Vollebregt2012a-quasistd}. They are explained by a discontinuity in
time of the elastic displacements field. Traction builds up until a certain
maximum is attained, after which the elastic field jumps to a new state in
`zero time'. This behaviour is attributed to the use of a quasi-static
approach (ignoring inertia effects) and to the friction law employed,
particularly to the use of the instantaneous slip velocity $s_a$. The peaks
can be suppressed by introducing friction memory with a memory length $d_c$
of several $\mu m$. The peaks are thus real as far as the numerical model
is concerned, but whether they occur in reality is still unknown.
}

\section{The use of the FASTSIM algorithm}
\label{sec:ex_fastsim}

The input-file {\tt fastsim.inp} illustrates the use of the FASTSIM
approach using the CONTACT program. A single Hertzian case with aspect
ratio $a/b=2$ is solved three times using different solution methods.
\begin{enumerate}
\item The first case uses the original CONTACT algorithm, by selecting
        ${\tt B}=0$ and ${\tt M}=0$.
\item The second case uses the FASTSIM algorithm in the recommended way,
        i.e.\ with parabolic traction bound. This is achieved by setting
        ${\tt B}=3$ and ${\tt M}=3$.
\item The third case uses the FASTSIM algorithm together with an elliptical
        traction bound: ${\tt B}=0$ or 2, ${\tt M}=3$.
\end{enumerate}
\begin{alltt}\small
% second case: FASTSIM algorithm, parabolical traction bound (M=3, B=3)

 3 MODULE
  233100     P-B-T-N-F-S        PVTIME, BOUND , TANG  , NORM , FORCE, STRESS
  122320     L-D-C-M-Z-E        FRCLAW, DISCNS, INFLCF, MATER, RZNORM, EXRHS
 0100341   H-G-I-A-O-W-R  HEAT, GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW, RETURN
   82000.     0.000     -0.000625   0.000625        FN, CKSI, CETA, CPHI
   0.000      0.400      30000.                     CHI, DQ, VELOC
   0.280      0.280      82000.     82000.          POISS 1,2,  GG 1,2
   1.000      1.000      1.000                      K0_MF,ALFAMF,BETAMF
   -3                                               IPOTCN
   44   44     8.000      4.000      1.100          MX,MY,AA,BB,SCALE
\end{alltt}
Figure \ref{fig:eldiv_fastsim} illustrates the tangential tractions that
are obtained. It can be seen that the parabolical traction bound gives
results that compare better to those of the half-space approach. The total
forces compare quite well in this case: $F_y=-0.61$ for CONTACT, and
$-0.64$ and $-0.59$ for FASTSIM with parabolic and elliptical traction bound
respectively. Note that these results are affected by the discretisation
that is used, and that no general conclusions can be drawn on basis of a
single case. For more information on the accuracy of the FASTSIM approach
(and USETAB, Polach's method) when compared to CONTACT see
\cite{Vollebregt2011a-assessm}. For a comparison of parabolical and elliptical
traction bounds and one versus three flexibilities see
\cite{Vollebregt2010b-fastsim2,Vollebregt2022a-1flex}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/fastsim_eldiv_cntc,width=3.2in,trim=30 105 30 140,clip=}

\psfig{figure=fig/fastsim_eldiv_parab,width=3.2in,trim=30 105 30 140,clip=}
\psfig{figure=fig/fastsim_eldiv_ellip,width=3.2in,trim=30 105 30 140,clip=}
\caption{\em Tangential tractions in a steady state rolling problem with
large spin. Top: results for the CONTACT
(half-space) algorithm on a $40\times 40$ grid. Bottom: results for the
FASTSIM algorithm with parabolical (B=3, left) and elliptical traction
bound (B=2, right), computed on $200\times 200$ grids.}
\label{fig:eldiv_fastsim}
\end{figure}

The pictures are created with the Matlab program {\tt plot3d} (Section
\ref{sec:plot_surf}), in which the following settings are used:
\begin{alltt}\small
s = loadcase('fastsim'); opt = plot3d;
opt.field='ptabs+vec'; opt.numvecx=22; opt.numvecy=12;
opt.exterval=NaN; opt.zrange=[0 400];
plot3d(s, opt); shading flat; axis equal;
\end{alltt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Matlab plot-programs
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Matlab plot-programs}
\label{chp:matlab_plots}

Several Matlab scripts are provided for visualisation of the output of the
CONTACT program:
\begin{enumerate}
\item CONTACT writes its results to tables in the files {\tt
        <experim>.<ncase>.mat} (surface tractions) and {\tt
        <experim>.<ncase>.subs} (subsurface stresses);
\item In Matlab you load these results with the scripts {\tt loadcase} and
        {\tt loadstrs};
\item The results are plotted with the scripts {\tt plot2d}, {\tt plot3d}
        and {\tt plotstrs}.
\end{enumerate}
The scripts are meant for basic inspection tasks only; for more
sophisticated and stylish pictures you can refine our scripts or use
Matlab's command interface.

An additional script is provided for the overall output quantities:
\begin{enumerate}\setcounter{enumi}{3}
\item The basic data from the output-file {\tt <experim>.out} (creepages,
        total forces and overall output quantities) can be loaded into
        Matlab with the scripts {\tt parse\_out1} and {\tt parse\_out3},
        for modules 1 and 3 respectively;
\end{enumerate}
No specific programs are provided for further processing and visualization
of these overall results. You can type {\tt help parse\_out3} at the Matlab
command prompt for information about this script, see Section
\ref{sec:ex_tractcurv} for an example of its use.

\section{Prerequisites}

Usage of the plot programs requires a license to the (commercial) Matlab
package. As an alternative you may work with GNU Octave, a free software
that is quite similar to Matlab. Another alternative might be Gnuplot, but
this requires a larger development effort for creating new plotting
scripts.

The Matlab search path must be adjusted such that our plotting programs can
be found. This is done in Matlab with the {\tt addpath} command, e.g.
\begin{verbatim}
>> addpath('C:\Program Files\Vtech CMCC\contact_v23.2\matlab');
\end{verbatim}
This command may be put in a file `{\tt startup.m}' in your working
directory, in your personal overall startup-file
(`\verb+My Documents\MATLAB\startup.m+') or in a system-wide
configuration-file (`\verb+<MAT-+ \verb+LAB>\toolbox\local\pathdef.m+').

You can check whether the path is set correctly by typing
\verb+ help contact_v23.2\matlab+. This should show the following output:
\begin{alltt}\small
Matlab scripts for visualisation of output of the CONTACT program (trunk).

Loading results into Matlab.

  loadcase   - load the results for one case for a given experiment name.
  diffcase   - compute the difference of results for two cases
  loadstrs   - load the results for a subsurface stress calculation.
  diffstrs   - compute the difference of results for two cases w.r.t.
               subsurface stress calculations.

  parse_out1 - sample script to read output of the contact patches for
               wheel-rail contact cases (module 1) from an .out-file.
  parse_out3 - sample script to read the creepages and forces of generic
               contact cases (module 3) from an .out-file.

Visualizing the results.

  plot2d     - 2D plots of tractions for rows or columns of the contact area.
  plot3d     - 3D plots of various quantities for the entire contact area.
  plotstrs   - plot sub-surface displacements and stresses.

Working with wheel/rail profiles.

  read_profile    - generic routine for reading profiles
  read_slices     - lower-level routine for reading variable profile slcs file
  read_simpack    - lower-level routine for reading Simpack prr/prw files
  read_miniprof   - lower-level routine for reading Miniprof ban/whl files
  modify_profile  - lower-level routine for making some profile adjustments
  resample_slices - helper routine for 2D interpolation of variable profile
  write_simpack   - routine for writing Simpack prr/prw files
  write_miniprof  - routine for writing Miniprof ban/whl files
\end{alltt}

\section{Inspecting the surface stresses}
\label{sec:plot_surf}

\subsection{Loading the results into Matlab}

The contents of the {\tt .mat}-files (surface tractions) are specified in
Section \ref{sec:spec_mat}. These are loaded with the script {\tt
loadcase}:
\begin{alltt}\small
>> s = loadcase('mbench_a22_left', 13)
s = 
       config: 0
      h_digit: 0
         meta: [1x1 struct]
        mater: [1x1 struct]
         fric: [1x1 struct]
       kincns: [1x1 struct]
           mx: 49
           my: 40
           xl: -4.9000
           yl: -3.9000
           dx: 0.2000
           dy: 0.2000
      d_digit: 2
     x_offset: []
     y_offset: []
            x: [1x49 double]
            y: [1x40 double]
        eldiv: [40x49 double]
            h: [40x49 double]
           mu: [40x49 double]
           pn: [40x49 double]
           px: [40x49 double]
           py: [40x49 double]
           un: [40x49 double]
           ux: [40x49 double]
           uy: [40x49 double]
         srel: [40x49 double]
         shft: [40x49 double]
       trcbnd: [40x49 double]
\end{alltt}
With this command the results for the thirteenth case of the Manchester
benchmark example are loaded (Section \ref{sec:ex_mbench}). The members
{\tt meta}, {\tt mater}, {\tt fric} and {\tt kincns} are
structs themselves, e.g.
\begin{alltt}\small
>> s.fric
    frclaw: 0
     fstat: 0.3000
      fkin: 0.3000
\end{alltt}
The result is a structure of which the different components can easily be
recognized. 

For wheel/rail contact using module 1, a single case may result in multiple
contact patches. In such cases, {\tt mat}-files are created for each
contact patch separately, with letters {\tt 'a'}, {\tt 'b'}, etc.\ appended
to the case number.
\begin{itemize}
\item By default, {\tt loadcase} will load all the patches and return these
        in an array of structures. For example, two patches are obtained in
        the {\tt mbench} example when using ${\tt dcomb}={\tt dsep}=0$:
\begin{alltt}\small
    >> s11 = loadcase('mbench_a22_right', 11)

    s11 = 
           1x2 struct array with fields: ...
\end{alltt}
\item Output may be retrieved for a single patch by specifying the patch
        number:
\begin{alltt}\small
    >> s11b = loadcase('mbench_a22_right', 11, 2);
\end{alltt}
        The second argument `{\tt 11}' is the case number, the third
        argument `{\tt 2}' indicates the requested patch number. 
\item {\tt loadcase} may be also be instructed to return outputs for all
        patches in separate structures, using the patch number {\tt -1}:
\begin{alltt}\small
    >> [s11a, s11b] = loadcase('mbench_a22_right', 11, -1);
\end{alltt}
        This example tries to load output for three patches for case 11 of
        experiment {\tt mbench\_\-a22\_\-right}. The output structs will be
        empty if no corresponding {\tt mat}-file is found.
\end{itemize}


\subsection{Plotting results for the entire (3D) contact area}
\label{sec:plot3d}

Several standardised contour- and surface-plots are provided by the script
{\tt plot3d}. This script works on the solution structure provided by {\tt
loadcase} and further uses an options structure to configure the plot. The
options structure is initialized by {\tt plot3d} itself:
\begin{alltt}\small
>> opt = plot3d
opt =
       field: 'default'
    rw_surfc: 'none'
    exterval: NaN
     typplot: 'surf'
        view: 'default'
      xrange: []
     xysteps: []
      zrange: []
     ixrange: 'auto'
     iyrange: 'auto'
     numvecx: 15
     numvecy: 15
    xstretch: 1
    vecscale: []
    veccolor: []
    vecwidth: []
    addeldiv: []
    eldivcol: [3x3 double]
    eldivwid: []
    colormap: 'parula'
     addplot: 0
\end{alltt}
The main option is the {\bf field} of the solution structure to be plotted.
Possible values are (see `{\tt help plot3d}'):
\begin{itemize}
\item {\tt 'eldiv'}, {\tt 'eldiv\_spy'}, {\tt 'eldiv\_contour'}: different
        ways of presenting the element division. See Figure
        \ref{fig:catt_cart} (right);
\item {\tt 'h'}: the undeformed distance of the two bodies;
\item {\tt 'mu'}, {\tt 'taucrt'}: the actual local coefficient of
        friction and the critical shear stress (yield limit) for the
        tangential plasticity model;
\item {\tt 'pn'}, {\tt 'px'}, {\tt 'py'}: the normal and tangential
        tractions acting on body (1), i.e.\ the rail in module 1;
\item {\tt 'ptabs'}, {\tt 'ptarg'}: the magnitude and direction of the
        tangential tractions;
\item {\tt 'ptvec'}: a vector-plot of the tangential tractions;
\item {\tt 'ptabs+vec'}: show magnitude and direction of tangential tractions
        in a single plot. See Figures \ref{fig:conformal} and
        \ref{fig:eldiv_fastsim};
\item {\tt 'un'}, {\tt 'ux'}, {\tt 'uy'}: the displacement differences in
        normal and tangential directions;
\item {\tt 'uplsx'}, {\tt 'uplsy'}: the components of the accumulated
        plastic deformation (if ${\tt M}=4$);
\item {\tt 'utabs+vec'}, {\tt 'upls+vec'}: elastic and plastic
        displacements in tangential directions, magnitude and direction;
\item in shifts (${\tt T}\le 1$): 
\begin{itemize}
\item {\tt 'sx'}, {\tt 'sy'}: the components of the local shift (slipped
        distance);
\item {\tt 'shft'}: the magnitude of the local shift;
\item {\tt 'shft+vec'}: show magnitude and direction of the local shift in
        one plot;
\end{itemize}
\item in rolling (${\tt T}\ge 2$):
\begin{itemize}
\item {\tt 'sx'}, {\tt 'sy'}: the components of the relative micro-slip
        velocity {\tt srel};
\item {\tt 'sabs'}, {\tt 'srel'}: the magnitude of the absolute/relative
        micro-slip velocity;
\item {\tt 'sabs+vec'}, {\tt 'srel+vec'}: magnitude and direction of
        the micro-slip in one plot.
\end{itemize}
\item {\tt 'fricdens'}: the frictional power density;
\item {\tt 'temp1'}, {\tt 'temp2'}: surface temperatures of bodies 1 and 2
        (if ${\tt H}\ge 1$).
\end{itemize}
Option {\bf rw\_surfc} governs how the contact surface is plotted: using
{\tt 'none'} for the typical flat view, {\tt 'prr'} or {\tt 'both'} for
using rail coordinates, or {\tt 'prw'} for using the wheel surface view,
see Figure \ref{fig:mbench_prr} for an example. The latter options require
that rail and/or wheel profiles or filenames are provided, e.g.\
\begin{alltt}\small
  plot3d( s1a, opt, 'MBench_UIC60_v4.prr', 'MBench_S1002_v3.prw' );
\end{alltt}
In case the profiles need additional preparations, like scaling, smoothing,
or mirroring, they can be read and processed separately, e.g.:
\begin{alltt}\small
  mirror_y = 1; mirror_z = -1; scale_yz = 1000;
  prr = read_profile('MBench_UIC60_v4.prr', [], mirror_y, mirror_z, scale_yz);
  plot3d( s1a, opt, prr, 'MBench_S1002_v3.prw' );
\end{alltt}
The meaning of the other options is:
\begin{description}[leftmargin=6em,style=nextline]
\item[exterval] The value to be plotted at points of the exterior area.
        Particularly useful for plotting fields {\tt 'eldiv'}, {\tt 'h'}
        and {\tt 'ptabs+vec'}, using {\tt opt.exterval=NaN}.
\item[typplot] Type of plot for contact patches: using a color plot
        ({\tt 'surf'}), filled contour plot ({\tt 'contourf'}), or plot
        wheel/rail contacts in rear view ({\tt 'rw\_rear'} or side view
        ({\tt 'rw\_side'});

An example of the rear view is shown in Figure \ref{fig:site_b_cpatch}. This
is created using
\begin{alltt}\small
  s = loadcase('siteB_z117',1);
  opt          = plot3d;
  opt.typplot  = 'rw_rear';
  opt.rw_surfc = 'both';
  opt.field    = 'pn';
  opt.vecscale = 10/2000; % mm/MPa
  plot3d( s, opt, prr, prw );
\end{alltt}

\item[view] The view direction, e.g.\ {\tt [30 30]} (rotation about
        $z$-axis and elevation above the plane, in degrees). You may use
        {\tt [ 0 90]} to get a 2D color plot or {\tt 'rail'} for view
        {\tt [90 -90]}.
\item[xrange] The range of the $x$-axis to be displayed in {\tt 'surf'} and
        {\tt rw\_side'} plots.
\item[xysteps] The spacing {\tt dxy} or {\tt [dx dy]} of thin lines on 3d
        surfaces in {\tt 'surf'} plots. 
\item[zrange] The range of the $z$-axis to be displayed.
\item[ixrange] The selection of the elements {\tt [1,mx]} in $x$-direction
        to be displayed in the plot.
\item[iyrange] The selection of the elements {\tt [1,my]} in $y$-direction
        to be displayed in the plot.
\item[numvecx] The maximum number of vectors to be displayed in
        $x$-direction. If necessary, every $2^{nd}$, $3^{rd}$, etc.\ grid
        point is left out of the plot.
\item[numvecy] Same as {\tt numvecx} for $y$-direction.
\item[vecscale] Manual scaling factor for vectors on vector-plots and
        tractions in rear view/side view plots. Length of the vector in
        $mm$ that will be used for a stress of $1\unit{N/mm^2}$;
\item[veccolor] Color specification for vectors on vector plots. Default:
        {\tt 'b'} for field {\tt 'ptvec'}, {\tt 'k'} for {\tt 'ptabs+vec'}.
\item[vecwidth] Line width for vectors on vector plots.
\item[addeldiv] Add contour lines around adhesion area and contact area,
        cf.\ {\tt 'eldiv\_contour'} (only in 2D plots).
\item[eldivcol] Set colors of lines around whole contact area and the slip
        and plasticity areas for {\tt 'eldiv\_contour'} and {\tt 'addeldiv'}.
        Default: dark blue, dark red, magenta.
\item[eldivwid] Line width for contours of element division.
\item[colormap] This changes the colormap for 3D plots. Special values are
        {\tt 'none'} and {\tt 'black'}, which create a black-and-white mesh
        plot instead of a coloured surface.
\item[addplot] Typically {\tt plot3d} clears the figure before creating a
        new plot. Sometimes it is convenient to turn this off and add to an
        existing plot.
\end{description}

\subsection{Plotting results for 2D cross-sections}

The script {\tt plot2d} provides a means for plotting the results of 2D
calculations (i.e.\ with MY=1) or plotting 2D slices for 3D calculations.

This script is primarily interested in the tangential surface tractions
{\tt px}/{\tt py}, and further plots the traction bound {\tt trcbnd} as
well ($g=\mu p_n$). It uses an options structure that is initialized again
by the script itself:
\begin{alltt}\small
>> opt=plot2d
opt =
            orie: 2
           pxory: 'x'
            xslc: 0
            yslc: 0
           negpn: 1
           facpt: 1
            xlim: []
            ylim: []
            plim: []
    pn_linestyle: '--'
    pt_linestyle: '-o'
\end{alltt}
The meaning of the options is:
\begin{description}[leftmargin=7em,style=nextline]
\item[orie]  plot columns of the potential contact area ({\tt 1}, $x=$const) or
        rows ({\tt 2}, $y=$const, default);
\item[pxory] plot tangential tractions {\tt px} ({\tt 'x'}, default) or
        {\tt py} ({\tt 'y'});
\item[xslc]  $x$-coordinate(s) for a column-wise plot (${\tt orie}=1$). Can
        be an array of values for plotting multiple slices at once. Note:
        the grid column(s) closest to {\tt xslc} is/are used. Default: 0.0;
\item[yslc]  $y$-coordinate(s) for a row-wise plot (${\tt orie}=2$), see {\tt
        xslc};
\item[negpn] flag for the vertical range to be plotted.
\begin{itemize}
\item {\tt  1} = show positive traction bound  $\mu p_n$;
\item {\tt  0} = show positive and negative traction bounds;
\item {\tt -1} = show negative traction bound $-\mu p_n$.
\end{itemize}
\item[facpt] multiplication factor for negating {\tt px}/{\tt py}: {\tt 1}
        for plotting the tangential tractions themselves, {\tt -1} for
        plotting their negative {\tt -px} or {\tt -py};
\item[xlim]  $x$-range for a row-wise plot (${\tt orie}=2$). Default: {\tt
        [xl-dx, xh+dx]};
\item[ylim]  $y$-range for a column-wise plot (${\tt orie}=1$). Default: {\tt
        [yl-dy, yh+dy]};
\item[plim]  vertical range of the plot. The default depends on {\tt
        negpn}. For ${\tt negpn}=1$ it is the range {\tt [0,pmax]} extended
        a little on both sides;
\item[pn\_linestyle] Matlab linestyle for the traction bound;
\item[pt\_linestyle] Matlab linestyle for the tangential tractions.
\end{description}
The use of this script is illustrated in the Cattaneo and Carter2D
examples: Sections \ref{sec:ex_cattaneo} and \ref{sec:ex_carter_fromm},
Figures \ref{fig:cattaneo_px_y0} and \ref{fig:carter2d}.

\section{Inspecting subsurface stresses}
\label{sec:plot_subs}

\subsection{Loading the results into Matlab}

The contents of the {\tt .subs}-files (subsurface stresses) are specified in
Section \ref{sec:spec_subs}, see further Section \ref{sec:subsurf_out} for a
description of the physical quantities. These are loaded with the script
{\tt loadstrs}:
\begin{alltt}\small
>> sub28 = loadstrs('spence35', 28)
sub28 =
         nx: 45
         ny: 1
         nz: 1
    npoints: 45
          x: [45x1 double]
          y: 0
          z: 1.0000e-06
         ux: [45x1x1 double]
         uy: [45x1x1 double]
         uz: [45x1x1 double]
     sighyd: [45x1x1 double]
      sigvm: [45x1x1 double]
\end{alltt}
Two complications are that there can be multiple grids of points in a single
subsurface stress calculation, and that each grid can be three-dimensional.
The former is handled by multiple output-arguments for function {\tt loadstrs}:
\begin{alltt}\small
  [blk1, blk2, blk3] = loadstrs('subsurf2', 1);
\end{alltt}
The latter means that the output arrays such as {\tt ux}, {\tt uy}, etc.\
are three-dimensional. These cannot be plotted directly, you select the
appropriate slices by providing indices (e.g.\ {\tt ux(1,1,:)}) and
restructure the size of the array using the {\tt squeeze} command.

\subsection{Plotting the subsurface stresses}

The subsurface stresses are plotted with the command {\tt plotstrs}. It
works with an options structure like the previous scripts:
\begin{alltt}\small
>> opt=plotstrs
opt =
       field: 'mises'
         dir: 'y'
        xslc: 0
        yslc: 0
        zslc: 0
     addplot: 0
     typplot: 'contourf'
     cntrlvl: 'auto'
      clabel: 'off'
       scale: 'linear'
    colormap: 'parula'
\end{alltt}
The quantities that can be plotted are entered in the {\tt field} option:
\begin{itemize}
\item {\tt 'ux'}, {\tt 'uy'}, {\tt 'uz'}: elastic displacements in the upper
        ($z>0$) or lower body ($z<0$);
\item {\tt 'sighyd'} or {\tt 'hydro'}: the mean hydrostatic stress
        $\sigma_{hyd}$, see equation (\ref{eq:sighyd});
\item {\tt 'sigvm'} or {\tt 'mises'}: the von Mises stress $\sigma_{vm}$
        (equation (\ref{eq:sigvm})).
\item In case the full stress tensor is exported (${\tt A}=2$):
\begin{itemize}
\item {\tt 'sigxx'}, {\tt 'sigxy'}, {\tt 'sigxz'}, {\tt 'sigyy'}, 
      {\tt 'sigyz'}, {\tt 'sigzz'}: the components $\sigma_{ij}$ of the 
      stress tensor {\tt SIGMA} at the subsurface points, see equation
        (\ref{eq:sigma});
\item {\tt 'sigma1'}, {\tt 'sigma2'}, {\tt 'sigma3'}: the principal
      stresses $\sigma_1, \sigma_2, \sigma_3$ (page \pageref{page:sigmaj});
\item {\tt 'sigtr'} or {\tt 'tresca'}: the maximum shear stress
        $\sigma_1-\sigma_3$ of the Tresca criterion (equation
        (\ref{eq:tresca})).
\end{itemize}
\end{itemize}
Note that subsurface stresses are computed for three-dimensional
structured grids, called `blocks' in the CONTACT input. The corresponding
options are:
\begin{description}[leftmargin=6em,style=nextline]
\item[dir]   sets the orientation of the 2D slice to be viewed: {\tt 'y'}
        for a slice parallel to the $Oxz$-plane (default), {\tt 'x'} for a
        slice parallel to $Oyz$ and {\tt 'z'} for a slice with constant
        depth $z$, parallel to the $Oxy$ plane;
\item[yslc]  sets the $y$-coordinate for an $Oxz$-plot ({\tt dir='y'}).
        Default 0.0;
\item[xslc, zslc] $x$- and $z$-coordinates for {\tt dir='x'} and {\tt dir='z'}.
\end{description}
The other options control the outlook of the plot:
\begin{description}[leftmargin=6em,style=nextline]
\item[typplot] make a color plot ({\tt 'surf'}), contour line plot
        ({\tt 'contour'}) or filled contour plot ({\tt 'contourf'});
\item[cntrlvl] list of values for which contour lines are desired;
\item[clabel] show numerical values on contour lines ({\tt 'on'}) or
        not ({\tt 'off'});
\item[scale] use a linear ({\tt 'linear'}) or logarithmic ({\tt 'log'})
        scale for the colors on the plot;
\item[colormap] this changes the colormap used, e.g.\ {\tt 'parula'}, {\tt
        'jet'}, {\tt 'hot'}.
\end{description}
A filled contour plot is shown in the subsurface stress example in Figure
\ref{fig:subsurf2} of Section \ref{sec:ex_subsurf}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONTACT library
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{The CONTACT library}
\label{chp:contact_library}

\begin{figure}[bt]
\centering
\psfig{figure=fig/contact_arch_lib,width=4in,trim=150 330 85 335,clip=}
\caption{\em Software architecture for the CONTACT library.}
\label{fig:arch_lib}
\end{figure}

The computational part of CONTACT can be interfaced with other programs and
steered from there. This works through the so-called CONTACT library as
illustrated schematically in Figure \ref{fig:arch_lib}. The library is a
dll (Windows) or so-file (Linux) that provides a well-defined interface.
This interface can be accessed from Matlab and Python as well.

\section{Result elements and contact problems}

The library is set up to compute the evolution of multiple contact problems
that can be grouped in different ways.

Contact problems are stored using containers that are called `result
elements'. CONTACT does not care how these containers are used. 
\begin{itemize}
\item It's possible to re-use a single result element over and over again
        for all kinds of contact problems;
\item Separate result elements may be defined for different axles, and for
        the left and right wheels on each axle;
\item The contact of one wheel with a switch and a stock rail could be
        separated into different contact problems, using different
        containers.
\end{itemize}
Result elements are identified by an integer number {\tt ire} below 1000.
The numbering does not have to be consecutive. Each result element can have
one or more `contact patches' associated with it, created automatically
when using module 1, or defined by the user when using module 3. Contact
patches are identified by an integer number {\tt icp} below 10, and these
also don't have to be numbered consecutively.

Most data are configured and stored separately for each contact patch or
contact problem.  Therefore practically all subroutines start with the
arguments {\tt ire} and {\tt icp}. The code ${\tt icp}=-1$ is used to
indicate a task working on all patches of a result element. The memory
requirement is proportional to the total number of contact patches that are
stored simultaneously.

The number of cases computed can be different for each contact problem.
The cases for different contact problems can be interlaced in any way as
well. Each contact problem is solved independently, using its own internal
data and possibly its own previous state. Two consecutive cases for the
same contact problem are governed by the same rules as consecutive cases in
the input file. For instance, the grid can be changed between steady state
cases but must stay the same in transient scenarios.

\section{Data units and sign conventions}
\label{sec:units}

The CONTACT library can work with different data units. This is mainly a
cosmetic aspect of the interface. Appropriate scaling is used between the
values provided and the values stored internally; internally the same
units are used as before. An important part concerns the sign conventions
of the inputs (creepage) and the results (traction, force, slip).

\paragraph{CONTACT's unit convention}

The primary unit convention is the same as the one used throughout this
document:
\begin{itemize}
\item Body 1 is the upper body, $z>0$, and body 2 the lower one, $z<0$.
\item Stresses and forces are acting {\em on\/} body 1, and relative
        displacements and velocities are those {\em of\/} body 1 {\em relative
        to\/} body 2.
\item Lengths are in $\unit{mm}$ and areas in $\unit{mm^2}$. Forces in
        $\unit{N}$ and stresses in $\unit{N/mm^2}$. Angles are in
        $\unit{rad}$ in the calculations, but may be printed in $^\circ$
        for easier interpretation. Time is in $\unit{s}$, velocities are
        in $\unit{mm/s}$, and temperatures in $\unit{\celc}$.
\end{itemize}

\paragraph{SI unit convention}

The main alternative is to use SI units everywhere. This uses the same
choices as CONTACT for identifying the bodies and defining the signs of
stresses, velocities, displacements and velocities.
\begin{itemize}
\item Lengths are in $\unit{m}$ and areas in $\unit{m^2}$. Forces in
        $\unit{N}$ and stresses in $\unit{N/m^2}$. All angles are in
        $\unit{rad}$. Times are in $\unit{s}$, velocities in $\unit{m/s}$,
        and temperatures in $\unit{K}$.
\end{itemize}

\paragraph{SIMPACK's unit convention}

The SIMPACK program uses SI units but uses a different way of designating
the two bodies.
\begin{itemize}
\item Body 1 is the rail body, and body 2 is the wheel. These are
        respectively the upper and lower bodies, with the positive $z$-axis
        pointing into the rail.
\item Stresses and forces are acting {\em on\/} body 2, the wheel. Relative
        displacements and velocities are those of the rail compared to the
        wheel.
\end{itemize}

The unit convention is changed using subroutine {\tt cntc\_setflags} by
setting flag {\tt CNTC\_\-if\_\-units} to the appropriate value. This is
typically done at the start of the calculation, for all contact
problems/result elements that are used.

Wheel and rail profiles are not affected by the unit convention that's used.
The values are needed using $\unit{mm}$ as the unit of length. An optional
scaling factor may be provided to convert to this convention explicitly as
discussed in Section \ref{sec:track_geom}.

\section{Interface routines}
\label{sec:clib_interface}

The interface of the routines is specified in detail in the Matlab
functions. These are shown using Matlab's {\tt help}-feature:
\begin{alltt}\small
>> help matlab_intfc

   ... provides an overview of the interface routines ...

>> help cntc_setwheelsetposition

   function [ ] = cntc_setwheelsetposition(ire, ewheel, nparam, params) 
 
   set the wheelset position state data for a wheel-rail contact problem
     ewheel         - type of position specification (E-digit)
     nparam         - number of parameters provided
     params(nparam) - depending on method that is used

   E=0  : keep wheelset position from previous specification, ignore params
   E=1-8: new wheelset position   params = [s, y, z, roll, yaw, pitch]
 
   dimensions:   s_ws, y_ws, z_ws [length],       roll, yaw, pitch [angle]
\end{alltt}
There are slight differences between the interfaces for Fortran, C, Matlab
and Python, for instance skipping certain length parameters in Matlab and
Python that must be provided in Fortran and C. Specific information for C
programmers is provided in the file {\tt contact\_addon.h}. For Fortran
programmers the interfaces are specified in {\tt contact\_addon.ifc}.

\subsection{Preparations}
\label{sec:cntc_preparations}

\begin{alltt}\small
cntc_initlibrary          - load library into matlab (Matlab)
cntc_initializefirst      - open out-file, initialize data-structures (Fortran/C)
cntc_initialize           - further initializations per result element
cntc_setfileunits         - configure logical file units (Fortran)
cntc_setglobalflags       - configuration of general settings
cntc_managelicense        - perform license activation, refreshing or printing
\end{alltt}

\paragraph{cntc\_initlibrary}

The first step in Matlab is to load the library, which is done with {\tt
cntc\_\-init\-library}. Optional arguments can be used to change the
output folder or experiment name (default `{\tt contact\_addon}').
\begin{alltt}\small
   [CNTC, ifcver, ierror] = cntc_initlibrary;
\end{alltt}
The function returns a struct {\tt CNTC} with so-called `magic numbers'
that are used in the interface. The error code will be $-12$ if no
appropriate license could be found, or if a license is found that isn't
valid for the actual computation.

In Fortran and C, the analogue is {\tt cntc\_initializefirst}. In that
case the magic numbers are provided in {\tt caddon\_\-flags.\-inc}.

\paragraph{cntc\_initializefirst}

When using the library from Fortran/C, it is needed to properly
initialize its data-structures, license, experiment name, file I/O etc.
This is done by subroutine {\tt cntc\_init\-ia\-lize\-first}. This
routine will be called by {\tt cntc\_initialize} if it isn't called
explicitly. In Matlab, this routine is called by {\tt cntc\_initlibrary}. 

The output-file for the experiment will be opened (default {\tt
contact\_addon.out}), removing the previous contents if already present.
Note that {\tt cntc\_initializefirst} will be called again if a new
computation is started after all previous result elements have been cleared
({\tt cntc\_finalizelast}).

\paragraph{cntc\_initialize}

Additional initializations per result element are done by subroutine {\tt
cntc\_\-init\-ial\-ize}, for instance setting the module that's used. The
routine invokes the overall initalizations of {\tt cntc\_initializefirst}
in the very first call, if needed. The call to {\tt cntc\_initialize} will
be made automatically when needed by other routines of the interface.
However, in that case the error code and some configuration options are
lost.

\paragraph{cntc\_setfileunits}

CONTACT is programmed in Fortran, such that it uses `logical file units'
for file I/O. By default CONTACT uses logical units in the range
$11\text{--}20$. If the encompassing program is programmed in Fortran too
this may lead to clashes in the logical units used. In that case the unit
numbers usable may be configured using {\tt cntc\_setfileunits}. This is
not needed when using the library from Matlab or C.

Subroutine {\tt cntc\_setfileunits} may be called only once and may only be
called before {\tt cntc\_\-init\-ia\-lize\-first}. This is because {\tt
cntc\_initializefirst} may open files after which the logical unit numbers
cannot be changed anymore.

\paragraph{cntc\_setglobalflags}

Subroutine {\tt cntc\_setglobalflags} provides for the configuration of
general settings, in particular the amount of print output of the
interface itself and the use of parallel computation, which are the same
for all result elements.

Configuration flags have been given `magic numbers' that are defined in {\tt 
caddon\_flags.inc}. For instance the interface
print-output is configured using flag `2000', which is the value of
parameter {\tt CNTC\_if\_debug} (Fortran/C) or {\tt CNTC.if\_debug} (Matlab):
\begin{alltt}\small
    numflg    = 1;             % configure idebug = 0 in the CONTACT library
    flags(1)  = CNTC.if_debug;
    values(1) = 0;
    cntc_setglobalflags(numflg, flags, values);
\end{alltt}

\paragraph{cntc\_managelicense}

The CONTACT library version uses a different license file than the
stand-alone program. This license needs to be activated before the first
run and may then be refreshed and printed (Section \ref{sec:license_mngmt}).
These activities can be started using {\tt cntc\_manage\-li\-cense} in Matlab,
e.g.\
\begin{alltt}\small
    license_id = 123456; password = 'abcdef';
    ierror = cntc_managelicense('activate', license_id, password);
    ierror = cntc_managelicense('print');
\end{alltt}
Print output and error messages are written to {\tt contact\_addon.out}
(default experiment name). A sample program {\tt caddon\_license} is
provided that performs the same from the Windows command prompt or Linux
command line. The source code of this program is given in the {\tt src}
folder. It is configured to print output to the temp folder, \verb+C:\Temp+
on Windows, \verb+/tmp+ on Linux.

\subsection{Use of parallel computing}

CONTACT supports parallel computing in two different ways, both using
`shared memory' parallel programming.
\begin{enumerate}
\item Multiple contact problems may be computed concurrently -- using
        multiple threads in the user's program;
\item the calculations per contact problem may use parallel computation
        as well -- using internal parallelization in CONTACT.
\end{enumerate}
The first type requires that the user's (Fortran/C) program is adapted and
parallelized, using OpenMP or explicit threading. A few restrictions should
be kept in mind:
\begin{itemize}
\item The initializations, setting of global flags and finalizations may
        not be called from parallel regions.
\item Different threads should never work on the same contact problem ({\tt
        ire}, {\tt icp}) at the same time.
\end{itemize}
The maximum number of threads that can be used simultaneously may be
restricted by the license that's used. This can be inquired using
\begin{alltt}\small
cntc_getmaxnumthreads       - get max.number of concurrently active threads
\end{alltt}
The second type, internal parallelization, is governed by the flag {\tt
CNTC\_if\_openmp}. The parameter value provided is the number of threads
to use per contact problem. This can be set to $-1$ to request as many
threads as possible, as instructed by the environment {\tt
OMP\_NUM\_THREADS} and the available cpu cores in the machine.

Internal parallelization doesn't gain much speedup in CONTACT unless
certain conditions are met. It is disabled by default, setting the number
of threads per contact problem to 1 in {\tt cntc\_initia\-li\-ze\-first}. This
strategy is also disabled when multi-threading of the first type is detected.

\subsection{Configuring basic contact problems (module 3)}

The configuration of a basic contact problem (module 3) consists of
practically all data that are specified for a case in the input-file (Chapter
\ref{chp:module3}). Data that are set once will be remembered until
replaced by newer values. Setting data will sometimes change control digits
as well on the basis of the values provided. For instance when configuring
the normal force, this will automatically switch to ${\tt N}=1$.
\begin{alltt}\small
cntc_setflags               - configuration of flags, control digits (\ref{sec:controldigits})
cntc_setmetadata            - configuring various metadata in CONTACT (-)
cntc_setsolverflags         - configuration of solver parameters (\ref{sec:iter_const})

cntc_setmaterialparameters  - set material parameters (\ref{sec:matcns})
cntc_settemperaturedata     - set heat related material parameters (\ref{sec:heat_param})
cntc_setfrictionmethod      - set friction parameters (\ref{sec:fric_dscrp})
cntc_settimestep            - set time step used in shift problems (\ref{sec:kincns})
cntc_setreferencevelocity   - set rolling velocity (\ref{sec:kincns})
cntc_setrollingstepsize     - set rolling direction and step size (\ref{sec:kincns})

cntc_sethertzcontact        - set Hertzian problem specification (\ref{sec:hertz3d})
cntc_setpotcontact          - set pot.contact for non-hertzian cases (\ref{sec:pot_con})

cntc_setpenetration         - set approach/penetration (\ref{sec:kincns})
cntc_setnormalforce         - set total normal force (\ref{sec:kincns})
cntc_setundeformeddistc     - set undeformed distance function (\ref{sec:ibase})

cntc_setcreepages           - set creepages (\ref{sec:kincns})
cntc_setextrarigidslip      - set extra term of rigid slip elementwise (\ref{sec:kincns})
cntc_settangentialforces    - set total tangential forces (\ref{sec:kincns})
\end{alltt}

\paragraph{cntc\_setflags}

Subroutine {\tt cntc\_setflags} allows for the detailed configuration of
contact problems, such as the unit convention used and the setting of
control digits. Configuration flags have been given `magic numbers' that
are obtained from {\tt cntc\_initlibrary} (Matlab) or {\tt caddon\_flags\-.inc}
(Fortran/C). For instance CONTACT's {\tt O}-digit is configured using flag
1984, which is the value of parameter {\tt CNTC\_ic\_output} (Fortran/C) or
{\tt CNTC.ic\_output} (Matlab):
\begin{alltt}\small
    numflg    = 1;              % configure O = 3 in the CONTACT library
    flags(1)  = CNTC.ic_output;
    values(1) = 3;
    cntc_setflags(ire, icp, numflg, flags, values);
\end{alltt}
When using just a single contact problem (${\tt ire}={\tt icp}=1$), this
may be abbreviated as:
\begin{alltt}\small
    cntc_setflags(1, 1, 1, CNTC.ic_output, 3);
\end{alltt}
A distinction is made between flags that can be set independently per
contact problem versus flags that are the same for all contact problems.
The latter ones are configured through {\tt cntc\_\-set\-glo\-bal\-flags}
(paragraph \ref{sec:cntc_preparations}). Subroutine {\tt cntc\_\-set\-flags}
will call {\tt cntc\_\-set\-glo\-bal\-flags} for these flags when necessary.

\paragraph{cntc\_setmetadata}

The meta-data provided here are for output-purposes only, i.e.\ they don't
affect the calculation. The data provided here are stored in the 
{\tt mat}-file for use during postprocessing.

\paragraph{cntc\_setsolverflags}

This subroutine configures the control digit {\tt G} for the
iterative solvers, together with the corresponding input parameters as
described in Section \ref{sec:iter_const}. Additionally, this routine allows
configuration of the accuracy with which sensitivities are computed.

\paragraph{cntc\_setmaterialparameters}

This subroutine configures the material parameters of Section
\ref{sec:matcns}: basic elasticity parameters $G, \nu$, needed always, and
added parameters for visco-elastic materials (${\tt M}=1$, Section
\ref{sec:visc_elast}), the Modified Fastsim algorithm (${\tt M}=2$ or 3,
Section \ref{sec:fastsim}), and the interfacial layer of ${\tt M}=4$
(Section \ref{sec:intfc_layer}).

\paragraph{cntc\_setfrictionmethod}

This subroutine configures the friction parameters corresponding to the
{\tt L}-digit, and to the {\tt V}-digit in module 1 (Section
\ref{sec:fric_dscrp}).

\paragraph{cntc\_sethertzcontact}

As explained in Section \ref{sec:pot_con}, a distinction is made between
Hertzian and non-Hertzian geometries. In the former case the user does not
have to specify the element sizes {\tt DX}, {\tt DY} nor the extent of the
potential contact area. These will be derived from the curvatures and/or
semi-axes provided, using options ${\tt IPOTCN}=-6$ to $-1$ as described
in Sections \ref{sec:hertz3d}--\ref{sec:sdec}.

\paragraph{cntc\_setpotcontact}

Subroutine {\tt cntc\_setpotcontact} provides non-Hertzian options
${\tt IPOTCN}=1$ to $4$ (Section \ref{sec:pot_con}). The undeformed
distance is consequently described using {\tt cntc\_set\-un\-de\-formed\-distc},
which provides the various options of {\tt IBASE} as described in Section
\ref{sec:ibase}.  When ${\tt IBASE}=9$, the Fortran/C interface requires a
one-dimensional array {\tt h(npot)} with {\tt npot=mx*my}, with index {\tt
ix} running fastest. In Matlab this data can also be provided as a
two-dimensional array {\tt h(my,mx)}.

\paragraph{cntc\_settangentialforces}

The total tangential forces {\tt FX} and {\tt FY} may be specified instead
of the creepages {\tt CKSI} and {\tt CETA}. This requires that the {\tt
F}-digit is set to 1 or 2 using {\tt cntc\_set\-flags}. The force values
entered here are the total forces divided by the static maximum
${\tt FSTAT}\cdot{\tt FN}$.

\subsection{Configuring wheel/rail contact problems (module 1)}

The configuration of wheel/rail contact problems (module 1) re-uses several
routines defined above for module 3, setting data for all contact patches
at once using ${\tt icp}=-1$. Additional routines are defined for input
data that are specific to the wheel/rail contact module.
\begin{alltt}\small
cntc_setprofileinputfname   - set a wheel or rail profile via a filename
cntc_setprofileinputvalues  - set a wheel or rail profile using a table
cntc_getprofilevalues       - retrieve w/r profile after smoothing

cntc_settrackdimensions     - set the track geometry for a w/r problem (\ref{sec:track_geom})
cntc_setwheelsetdimensions  - set wheelset geometry specification (\ref{sec:wheelset_geom})
cntc_setwheelsetposition    - set wheelset position specification (\ref{sec:wheelset_geom})
cntc_setwheelsetvelocity    - set wheelset velocity specification (\ref{sec:wheelset_geom})
cntc_setwheelsetflexibility - set wheelset flexibility specification
\end{alltt}

\paragraph{cntc\_setprofileinputfname/values}

Each wheel/rail problem may hold up to four profiles, for two wheels and
two rails. These are configured one by one using the {\tt setprofile}
routines, providing appropriate options for their interpretation.
\begin{description}
\item[\tt iparam(1) - itype]: 0 for rails, 1 for wheels, $-1$ (default)
        for auto-detect on the basis of the filename extension ({\tt prr}
        or {\tt ban} for rails, {\tt prw} or {\tt whl} for wheels);
\item[\tt iparam(2)]: not used;
\item[\tt iparam(3) - mirrory]: $-1$ or 0 (default) for no mirroring, 
        1 for mirroring $y$-values;
\item[\tt iparam(4) - mirrorz]: 0 (default) for automatic mirroring if
        needed, $-1$ for no mirroring, 1 for mirroring $z$-values;
\item[\tt iparam(5) - errhndl]: configuration of error handling.
        $-2$ to continue as much as possible, suppressing error and warning
        messages; $-1$ to suppress warning messages; $0$ warn and continue
        (default); $1$ signal errors and abort.
\item[\tt iparam(6) - ismooth]: selection of the smoothing
        method: $0$ for original smoothing spline (default, for now), $1$
        for weighted smoothing spline with 2nd order penalty, $2$ for
        the weighted B-spline approach with 3rd order penalty.
\item[\tt rparam(1) - sclfac]: scaling factor to convert input data
        to $\bunit{mm}$, e.g.\ $10^3$ for data given in $\bunit{m}$. If ${\tt
        sclfac}\le 0$ (default), this will be obtained from the active unit
        convention (Section \ref{sec:units}).
\item[\tt rparam(2) - smooth]: smoothness parameter $\lambda$ as
        discussed in Section \ref{sec:track_geom}, with smoothing disabled
        if $\lambda\le 0$ (default).
\item[\tt rparam(3) - maxomit]: fraction; signal error if more
        than {\tt maxomit} of the profile points are removed during
        profile cleanup. Default $0.5$. Set to 1 to disable this error.
\item[\tt rparam(4) - zigthrs]: angle threshold for zig-zag pattern
        detection. Default $\pi/2\unit{rad}$. Should be larger than
        $\pi/4$, set to $\ge\pi$ to disable zig-zag detection.
\item[\tt rparam(5) - kinkhigh]: angle threshold $\delta\alpha_{high}$ for
        kink detection. Default $\pi/6\unit{rad}$. Set to $\ge\pi$ to disable
        kink detection.
\item[\tt rparam(6) - kinklow]: angle threshold for neighbouring points at
        kink detection. Default value $\delta\alpha_{high}/5$.
\item[\tt rparam(7) - kinkwid]: half-width of window used for kink detection.
        Default: using profile points within $2\unit{mm}$ on either side of
        each possible kink location.
\end{description}
Additional configuration parameters are read from (Simpack) {\tt prr} and
{\tt prw} files. No further scaling should then be applied (${\tt
sclfac}=1$). Simpack's approximation smoothing value is disregarded,
smoothing is implemented in a different way in CONTACT.

If a rail or wheel profile could not be found or could not be processed
correctly, the error code {\tt -32} will be issued ({\tt CNTC\_err\_profil}
of {\tt caddon\_flags.inc}). 

\paragraph{cntc\_getprofilevalues}

Two different versions of subroutine {\tt cntc\_getprofilevalues} are
provided with slightly different interfaces. Subroutine {\tt
cntc\_getprofilevalues} provides the old interface that was used up
to release 23.1 for backwards compatibility reasons. Subroutine {\tt
cntc\_\-get\-pro\-file\-values\_new} adds extensions for checking
CONTACT's spline approximation.

{\scriptsize\begin{alltt}
!--original code, works with library versions 18.1 -- 24.2:
   ! set itask, iparam, ...
   call cntc_getprofilevalues(ire, itask, 1, iparam, lenarr, val) 
\end{alltt}}

This code may be updated as follows:
{\scriptsize\begin{alltt}
!--intermediate code, works with library versions 18.1 -- 24.1:
   ! set itask, iparam = (/ itype, isampl /), rparam = (/ ds_out /), ...
   if (ifcver.le.2319) then
      call cntc_getprofilevalues(ire, itask, 1, iparam, lenarr, val) 
   else
      call cntc_getprofilevalues\red{_new}(ire, itask, 2, iparam, 1, rparam, lenarr, val) 
   endif
\end{alltt}}

In version 25.1, subroutine {\tt cntc\_getprofilevalues} will be updated
according to the new interface. Using this version, the caller code can be
updated as follows:

{\scriptsize\begin{alltt}
!--intermediate code, works with library versions 23.2 and newer:
   ! set itask, iparam = (/ itype, isampl /), rparam = (/ ds_out /), ...
   if (ifcver.le.2499) then
      call cntc_getprofilevalues\red{_new}(ire, itask, 2, iparam, 1, rparam, lenarr, val) 
   else
      call cntc_getprofilevalues\red{(}ire, itask, 2, iparam, 1, rparam, lenarr, val) 
   endif
\end{alltt}}

Once version 24.1 is no longer needed, the switch may be removed to reach
the final situation:

{\scriptsize\begin{alltt}
!--final code, works with library versions 25.1 and newer:
   ! set itask, iparam = (/ itype, isampl /), rparam = (/ ds_out /), ...
   call cntc_getprofilevalues\red{(}ire, itask, 2, iparam, 1, rparam, lenarr, val) 
\end{alltt}}

\paragraph{cntc\_settrackdimensions}

Two different versions of subroutine {\tt cntc\_settrackdimensions} are
provided with slightly different interfaces. Subroutine {\tt
cntc\_settrackdimensions\_old} provides the old interface that was used up
to release 21.1 for backwards compatibility reasons. Subroutine {\tt
cntc\_settrackdimensions\_new} adds extensions for absolute rail placement.

{\scriptsize\begin{alltt}
!--original code, works with versions 18.1 -- 22.2:
   params = (/ gaugwd, gaught, cant, 0d0 /)
   call cntc_settrackdimensions(ire, 1, params, 4) 
\end{alltt}}

This code may be updated as follows:
{\scriptsize\begin{alltt}
!--intermediate code, works with versions 22.1 -- 24.1:
   if (ifcver.le.2199) then
      params = (/ gaugwd, gaught, cant, 0d0 /)
      call cntc_settrackdimensions\red{_old}(ire, 1, params, 4) 
   else
      if (gaught.gt.0d0) then
         params = (/ \red{gaught}, \red{gaugsq}, gaugwd, cant, 0d0 /)
      else
         params = (/ \red{gaught}, \red{raily0}, \red{railz0}, cant, 0d0 /)
      endif
      call cntc_settrackdimensions\red{_new}(ire, 1, params, \red{5}) 
   endif
\end{alltt}}

In version 23.1, subroutine {\tt cntc\_settrackdimensions} links to the new
interface. Using this version, the caller code can be updated to the final
situation:

{\scriptsize\begin{alltt}
!--final code, works with versions 23.1 and newer:
   if (gaught.gt.0d0) then
      params = (/ gaught, gaugsq, gaugwd, cant, 0d0 /)
   else
      params = (/ gaught, raily0, railz0, cant, 0d0 /)
   endif
   call cntc_settrackdimension\red{s(}ire, 1, params, 5) 
\end{alltt}}

\paragraph{cntc\_setwheelsetdimensions, position, velocity, flexibility}

The specification of a wheelset needs geometry parameters for the proper
placement of the wheel profile with respect to the wheelset center,
position variables placing the wheelset in the track coordinate system,
velocities as needed for the calculation of creepages, and optionally
flexible wheelset deviations adding to position and velocity data.
These aspects are governed by the ${\tt E}_1$-digit of page
\pageref{e1-digit} and the parameters defined in Section 
\ref{sec:wheelset_geom}. 

The parameters are configured using four {\tt setwheelset*} routines that
all take the ${\tt E}_1$-digit as input. The same value can be used in
successive calls, e.g.\ using ${\tt E}_1=5$ in four successive calls, to set
the position, velocity, dimensions and flexibilities. Each of the routines
considers its own aspect only. That is, if you call {\tt 
cntc\_setwheelsetposition} using ${\tt E}_1=1$, this does not clear
flexibilities that were set previously by {\tt 
cntc\_setwheelsetflexibility} with ${\tt E}_1=5$.

\paragraph{cntc\_setpotcontact}

In wheel/rail contact, subroutine {\tt cntc\_setpotcontact} is re-used to
set the grid sizes {\tt DX}, {\tt DS} and combination/separation parameters
{\tt A\_SEP}, {\tt D\_SEP} and {\tt D\_COMB} (Section \ref{sec:wr_potcon}).

\subsection{Solving the contact problem}

\begin{alltt}\small
cntc_calculate                - perform actual calculation
\end{alltt}

After the preparations are complete, the actual calculation is started by
calling {\tt cntc\_\-cal\-cu\-late}. This will solve the contact problem
(module 3) or contact problems (module 1) and store the results in
CONTACT's internal memory. Outputs may be written to the {\tt out}-file and
one or more {\tt mat}-files will be created if so configured in the control
digits.

\subsection{Convencience function in Matlab}

\begin{alltt}\small
cntc_getcpresults             - get results of a single contact patch
                                in the form used by loadcase and plot3d
\end{alltt}

A function {\tt cntc\_getcpresults.m} is provided in Matlab that currently
has no counterpart in Fortran, C and Python. This function will retrieve
inputs and outputs from a wheel/rail contact problem from the CONTACT
library and create a structure that can be used directly with {\tt plot3d}
(Section \ref{sec:plot3d}). The profiles {\tt prr} and {\tt prw} are
included in the structure returned and can be omitted calling {\tt plot3d}.
\begin{alltt}\small
   sol = cntc_getcpresults(iwhe, icp);

   opt = plot3d;
   opt.typplot  = 'rw_rear';
   opt.field    = 'pn';
   opt.rw_surfc = 'both';
   plot3d(sol, opt);
\end{alltt}

\subsection{Global outputs for wheel/rail contact (module 1)}
\label{sec:global_output1}

In wheel/rail contact (module 1), a number of values may be retrieved for
the overall configuration.
\begin{alltt}\small
cntc_getwheelsetposition    - get the wheelset position parameters
cntc_getwheelsetvelocity    - get the wheelset velocity parameters
cntc_getglobalforces        - get total forces in track and wheelset coords
cntc_getnumcontactpatches   - get the number of separate contact patches
cntc_getcontactlocation     - get the location of one contact patch
\end{alltt}

\paragraph{cntc\_getglobalforces}

This routine returns the total forces and moments in overall horizontal and
vertical coordinate directions. Forces and moments are provided relative to
the track, wheelset, rail profile and wheel profile systems.  Moments are
computed at the rail or wheel profile markers.  Results can be retrieved
for each contact patch separately (${\tt icp}>0$), or summed over the
contact patches (${\tt icp}=-1$).  Forces and moments are defined {\em
on\/} the output-body, by which the sign depends on the unit convention
used (Section \ref{sec:units}).

\paragraph{cntc\_getcontactlocation}

This routine provides the location of the contact reference point of a
contact patch {\tt icp} in terms of the different coordinate systems. Up to
14 output values can be provided, if permitted by the length of the array
provided (1--4: {\tt [xyz]cp\_tr}, {\tt deltcp\_tr}, 5--9: {\tt
[xyzs]cp\_r}, {\tt deltcp\_r}, 10--14: {\tt [xyzs]cp\_w}, {\tt deltcp\_w}),
see page \pageref{pg:contact_refpos} for further information.

\subsection{Global outputs per basic contact problem (modules 1 \& 3)}
\label{sec:global_output3}

Output data may be retrieved for each contact patch separately, using the
contact local coordinate convention, using the following routines:
\begin{alltt}\small
cntc_getpotcontact         - get parameters of potential contact area (\ref{sec:pot_con})
cntc_getcontactforces      - get normal/tangential forces (\ref{sec:kincns}, \ref{sec:global_outpt})
cntc_getpenetration        - get approach/penetration (\ref{sec:kincns})
cntc_getcreepages          - get creepages (\ref{sec:kincns})
cntc_getcontactpatchareas  - get size of contact area (-)
cntc_getmaximumpressure    - get maximum pressure (-)
cntc_getmaximumtraction    - get maximum shear stress (-)
cntc_getmaximumtemperature - get maximum surface temperatures (-)
cntc_getsensitivities      - get sensitivities of forces wrt. creepages (-)
cntc_getcalculationtime    - get calculation time used (-)
\end{alltt}

\paragraph{cntc\_getpotcontact}

The potential contact area is set automatically by CONTACT in module 1 or
when using a Hertzian option. The parameters may then be retrieved
according to the format of ${\tt ipotcn}=3$ (Section \ref{sec:pot_con}),
using {\tt mx}, {\tt my}, {\tt xc1}, {\tt yc1}, {\tt dx} and {\tt dy}. The
coordinates of the element centers are then easily formed as
\begin{alltt}\small
  xcentr = xc1 +  [0:mx-1] * dx;     ycentr = yc1 +  [0:my-1] * dy;
\end{alltt}
The corners of the elements are
\begin{alltt}\small
  xcornr = xc1 + ([0:mx]-0.5) * dx;  ycornr = yc1 + ([0:my]-0.5) * dy;
\end{alltt}

\paragraph{cntc\_getcontactforces}

This routine delivers the total forces and moments on a single contact
patch ${\tt icp}>0$. The forces and moments are defined along the contact
local normal and tangential directions (Section \ref{sec:kincns}).
The signs depend on the unit convention selected (Section \ref{sec:units}),
acting {\em on\/} the output-body.

The forces and moments are aggregated at the contact reference position of
the patch.  Note that the tangential forces provided are the {\em true
forces\/} ($N$) instead of the {\em relative values\/} to the static
maximum value.

\paragraph{cntc\_getcreepages}

The values of {\tt CKSI}, {\tt CETA}, {\tt CPHI} are returned. In rolling
problems these are the creepages (Section \ref{sec:kincns_roll}), in shifts
(${\tt T}=1$) they are shift distances (Section \ref{sec:kincns_shift}).
{\tt CKSI} and {\tt CETA} are computed by the program when using ${\tt
F}=1$ or $2$. {\tt CPHI} is the value that was input before.

\paragraph{cntc\_getcontactpatchareas}

The area of contact, adhesion and slip areas is computed by counting the
number or elements in each state and multiplying by $\delta x\cdot \delta
y$.

\paragraph{cntc\_getmaximumtraction}

This subroutine determines the maximum tangential traction
over all elements of the contact area, $\sqrt{p_x^2+p_y^2}$.

\paragraph{cntc\_getsensitivities}

Sensitivities are computed when the {\tt S2}-digit `{\tt SENS}' is set to
2 or 3. This uses small perturbations of the `input variables', i.e.\ the
approach $\delta$ and creepages $\xi, \eta, \phi$. The resulting equations are
solved with maximally {\tt mxsens} iterations up to a relative tolerance
{\tt epsens}. Then the sensitivities of the `outputs' ($F_n, F_x, F_y,
M_z$) are computed using a finite difference approach. This results in a
sensitivity matrix {\tt sens} of $n_{out}$ rows with $n_{in}$ columns. In
Fortran/C this is presented as a 1D array where the columns are presented
consecutively.

\subsection{Detailed outputs of the contact problem}

Detailed outputs are presented by the following routines:
\begin{alltt}\small
cntc_getelementdivision    - get elementwise adhesion/slip/plast areas (\ref{sec:solut_arrays})
cntc_getfielddata          - get elementwise output values (\ref{sec:solut_arrays})
cntc_gettractions          - get elementwise tractions (\ref{sec:solut_arrays})
cntc_getdisplacements      - get elementwise displacement differences (\ref{sec:solut_arrays})
cntc_getmicroslip          - get elementwise micro-slip velocity (\ref{sec:solut_arrays})\magenta{
cntc_getrcfindex           - get elementwise RCF index (-).}
\end{alltt}
These subroutines provide access to the detailed results for all elements
of the contact area.

In the interface for Fortran/C the values are provided as
one-dimensional arrays of {\tt npot=mx*my} elements. For instance the
displacement differences {\tt US} are provided in three arrays {\tt
un(npot)}, {\tt ux(npot)} and {\tt uy(npot)}. 

In the Matlab-interface, these arrays are reshaped to two-dimensional
arrays of size {\tt (my,mx)}. The value for the discretization element at
column {\tt ix} in grid row {\tt iy} is thus obtained as {\tt un(iy,ix)}.
The whole array is easily plotted in Matlab using
\begin{alltt}\small
  surf(xcornr, ycornr, un); shading flat;
\end{alltt}
This uses {\tt xcornr} and {\tt ycornr} as obtained with {\tt
cntc\_getpotcontact} (Section \ref{sec:global_output3}).

\paragraph{cntc\_getelementdivision} Provides array {\tt IGS}. For each
element a code 0, 1 or 2 is provided, indicating that the element is in the
exterior, adhesion or slip area respectively.

\paragraph{cntc\_getfielddata} Provides various arrays selected via the
{\tt ifld} input, e.g.\ {\tt CNTC\_fld\_pn} for {\tt PN}, {\tt
CNTC\_fld\_temp1} for {\tt TEMP1}, etc.

\paragraph{cntc\_gettractions} Provides array {\tt PS}, via its columns
{\tt PN}, {\tt PX} and {\tt PY}. Tractions are defined {\em on\/} the
output-body as per the unit convention used (Section \ref{sec:units}).  

\paragraph{cntc\_getmicroslip} Provides array {\tt S}, via its columns
{\tt SX} and {\tt SY}. The micro-slip is defined as the relative velocity
(${\tt T}=1$: shift distance) {\em of\/} the output-body {\em relative
to\/} the other body.

\paragraph{cntc\_getdisplacements} Provides array {\tt US}, via its columns
{\tt UN}, {\tt UX} and {\tt UY}. The displacement differences are defined
as the elastic displacements {\em for\/} the output-body {\em minus\/} that
of the other body.

\magenta{
\paragraph{cntc\_getrcfindex} Provides array {\tt RCF}, an elementwise
RCF index. The calculation requires that the shear strength $k$ is provided
along the rail surface, using an extended form of the Miniprof profile
(additional column {\tt 'K'}).  The RCF index is computed as
\begin{eqnarray}
    I\in E &:& rcf_I = -0.5 \nonumber \\
    I\in C &:& rcf_I = \max\left( -0.5, \frac{ \|\vec{p}_{I\tau}\| - k_I }
                              { \max(\epsilon, p_{In}) } \right) .
\end{eqnarray}
The value of $-0.5$ signals that there's no risk of surface-initiated RCF
damage for an element $I$. This is used to ignore elements with small
pressure.
}

\subsection{Finalization}

Finally three subroutines are provided for cleaning up after a calculation.
Especially {\tt cntc\_\-close\-lib\-rary} cleans up all data-structures,
closes open files and unloads the library from memory.

\begin{alltt}\small
cntc_resetcalculationtime  - reset timers
cntc_finalize              - cleanup for one result element
cntc_closelibrary          - finalize, cleanup and unload the library
\end{alltt}
Subroutine {\tt cntc\_finalize} will automatically call {\tt
cntc\_finalizelast} if there are no more result elements remaining. This
closes the output file for the experiment. Making further calls after this,
subroutine {\tt cntc\_initializefirst} will be called again, removing the
previous contents of the out-file.

\section{Calculation of subsurface stresses}
\label{sec:clib_subs}

The calculation of subsurface stresses works with 3D `blocks' of ${\tt
nx}\cdot {\tt ny}\cdot {\tt nz}$ points. One or more of such blocks can
be defined, before or after the solution of surface contact problems
(Section \ref{sec:clib_interface}).

\begin{alltt}\small
subs_addblock      - define a 3D grid for subsurface stress computation
subs_calculate     - perform actual subsurface stress calculation
subs_getblocksize  - get the number of points used in one block
subs_getresults    - get detailed outputs of subsurface stress calculation
\end{alltt}

\paragraph{subs\_addblock}

Each contact problem (result element) can hold up to 10 blocks, numbered
consecutively from 1 to {\tt nblk}. These must be added in increasing
order: $1, 2, \ldots$. Existing blocks are discarded when re-using a
block number ${\tt iblk}\le {\tt nblk}$. That is, defining
`block 1' anew will clear the whole list and set new values for
${\tt iblk}=1$. Likewise, defining `block 3' anew will keep the
existing blocks 1--2 and discard all blocks thereafter.

In module 1, blocks may be defined for each contact patch separately (${\tt
icp}>0$), or for the wheel/rail contact problem as a whole (${\tt icp}=-1$).
The two methods may be combined, with blocks defined for some contact
patches (e.g.\ ${\tt icp}=2$) and for the wheel/rail problem as a whole.
The latter option then serves as a fall-back for contact patches
where no specific block data are given.

Blocks are defined via ${\tt ISUBS}=1\text{--}9$ as described in Section
\ref{sec:subsurf_inp}. The $xyz$-coordinates given are interpreted as
$xsn$-coordinates, using the contact local reference system.

\paragraph{subs\_calculate}

A separate calculation routine is provided to activate the subsurface
stress calculation. This routine requires that {\tt cntc\_calculate}
has been used first, to solve the contact problem.
\begin{itemize}
\item An `on-line' way of working is to configure ({\tt addblock}) the
        subsurface problem together with the surface contact problem, 
        then calling {\tt cntc\_calculate} and {\tt subs\_calculate} directly
        after another.
\item An `off-line' way of working is to solve the surface problem first
        ({\tt cntc\_calculate}), then define ({\tt addblock}) and compute
        the blocks ({\tt subs\_calculate}) on the basis of the surface
        results, or even re-define (iterate) the subsurface problem, for
        instance to zoom in on a region where the largest values are found.
\end{itemize}

\paragraph{subs\_getblocksize}

Linked to the size of the potential contact area, the size of the
blocks may be unknown in advance. This size can then be inquired with {\tt
subs\_getblocksize}, to get the proper array-size for the subsurface
results.

\paragraph{subs\_getresults}

For each block of points, a table is computed with all the relevant output
variables. The relevant columns of this table may be retrieved using {\tt
subs\_getresults}. The columns are defined as follows:
\begin{itemize}
\item columns 1--3: $[xyz]$ coordinates of the points;
\item columns 4--6: displacements $u_x, u_y, u_z$;
\item columns 7--9: hydrostatic, von Mises and Tresca-stresses 
        $\sigma_{hyd}$, $\sigma_{vm}$, $\sigma_{tr}$;
\item columns 10--12: principal stresses $\sigma_1, \sigma_2, \sigma_3$;
\item columns 13--21: components of the stress tensor: $\sigma_{xx},
        \sigma_{yx}, \ldots, \sigma_{zz}$.
\end{itemize}
The precise meaning of these is specified in Section \ref{sec:subsurf_out}.

\section{Examples for the CONTACT library}

\subsection{Calculation of creep force curves revisited}
\label{sec:clib_tract}

An example of the usage of the CONTACT library from Matlab is provided in
{\tt matlab\_\-tract\-curv.m}. This performs the same calculations as the {\tt
tractcurv}-example presented in Section \ref{sec:ex_tractcurv}. 

The code largely speaks for itself and is explained further through the
comments. Four parts may be distinguished:
\begin{enumerate}
\item Initialization of the library;
\item Configuring of the fixed part of the contact problem;
\item Looping over all cases to be computed;
\item Plotting the results.
\end{enumerate} 
The cases are computed in the same order as in the input-file {\tt
tractcurv.inp}, and are even independent of each other. Therefore it
suffices to use just one `contact problem' {\tt icp=1} on one
`result element' {\tt iwhe=1}. It would be equally valid to use two
`contact problems' for the cases with/without interfacial layer, on
the same result element or using different result elements.
\begin{alltt}\small
% creepages: a list of values for creating a creep-force curve

cksi = [ 0.00001 0.0004 0.0008 0.0012     0.2250 0.2500 ];  % [-]
ceta = 0; % [-]
cphi = 0; % [rad/mm]

for iksi = 1:length(cksi)

   % set creepages according to next value from cksi
   cntc_setcreepages(iwhe, icp, cksi(iksi), ceta, cphi);

   % compute the contact problem
   ierror = cntc_calculate(iwhe, icp);

   % get forces on upper body (1) (CONTACT unit convention)
   [fn, fx, fy, mz] = cntc_getcontactforces(iwhe, icp);
   fx_list(iksi) = fx;
end
\end{alltt}
The main body of the script just loops over all the creep combinations to
be computed. Storing the results in an array {\tt fx\_list}, these can be
plotted directly against the inputs {\tt cksi}. 
The results are the same as shown in Figure \ref{fig:tractcurv}.

\subsection{Calculation of wheel/rail contact}
\label{sec:clib_mbench}

The usage of the CONTACT library for wheel/rail contact (module 1) is
illustrated in the example {\tt matlab\_mbench.m}. This computes the same
cases as in the Manchester benchmark example of Section
\ref{sec:ex_mbench}.

\subsection{Calculation of subsurface stresses}
\label{sec:clib_ex_subs}

The calculation of subsurface stresses is shown in {\tt matlab\_subsurf.m}. 
This computes the same cases as in the {\tt subsurf}-example of Section
\ref{sec:ex_subsurf}, creating the pictures of Figures \ref{fig:subsurf1} and
\ref{fig:subsurf2}.

\color{black}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Referenties
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

% \renewcommand{\bibname}{Xeferenties}
\addcontentsline{toc}{chapter}{\bibname}

\bibliographystyle{plain}
\bibliography{ug_contact}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bijlagen
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\appendix

\chapter{Specification of in- and output-files}
\label{chp:fileformats}

\section{Files used by CONTACT}

The files concerned with the program are:
\begin{description}
\item[{\tt <experim>.inp}]  : input file for the contact problem
        (\ref{sec:inputfile}) and also for calculation of subsurface
        stresses (\ref{sec:spec_subsinp});
\item[{\tt <profile>.<ext>}] : input for rail ({\tt prr}, {\tt ban})
        and wheel profiles ({\tt prw}, {\tt whl}) as discussed in Section
        \ref{sec:profiles};
\item[{\tt <varprof>.slcs}] : input for variable rail profiles as used for
        switches and crossings (\ref{sec:spec_slcs});
\item[\tt <inflcf>.txt] : input for numerical influence coefficients
        (\ref{sec:spec_inflcf});
\item[{\tt <experim>.out}]  : output file;
\item[{\tt <experim>.<ncase>.mat}]  : tractions file, for communication
        with Matlab (\ref{sec:spec_mat});
\item[{\tt <experim>.<ncase>.subs}] : subsurface stresses file, for
        communication with Matlab (\ref{sec:spec_subs}).
\end{description}

\section{Specification of the input file {\tt <experim>.inp}}
\label{sec:inputfile}

In this section we specify the input file {\tt <experim>.inp} that is used
with input options ${\tt imode}=2$ and 3 (Section \ref{sec:term_based}). If
the program finds text on a place where it expects digits, or reals instead
of integers, it will stop with an error message. When you are searching for
the cause of such an error, notice that
\begin{itemize}
\item modifying control digits can imply that other variables will be
        read or not. {\tt T}=1 (shift) has no extra input, {\tt T}=3 (rolling)
        requires \var{CHI}, \var{DQ} and \var{VELOC}.
\end{itemize}

General rules for the input file and its specification are as follows:
\begin{itemize}
\item real values can be written in any format such as {\tt 0.35} or {\tt
        3.5E-1};
\item angles may be given in degrees or radians, for instance using
        {\tt 180d} or {\tt 3.1416r}. Radians are assumed if no postfix is
        given;
\item logicals must be denoted with {\tt T}, {\tt t}, {\tt F} or {\tt f};
\item string values (filenames) are enclosed in single quotes and may not
        contain quotes in the string: \verb+'My Documents\CONTACT\examples'+;
\item comments are indicated by a percent sign `{\tt \%}'. They can start
        anywhere in a line and end at the end-of-line;
\item the maximum length of each line is 256 characters, with maximally 50
        items per line. Empty lines are skipped, just as lines containing
        comments only;
\item for a group of variables, such as `{\tt CHI  DQ  VELOC}',
        the values must be presented in the same order as in the
        specification, separated by comma's and/or blanks;
\item newlines may also be used to separate values, i.e.\ groups of values
        may be entered using multiple lines;
\item some data values are optional. These are indicated in curly braces
        {\tt \{\}}. They must be entered on the same line as the preceding,
        mandatory value. Newlines cannot be used in this case;
\item when a group or array of values is read, all \underline{remaining text}
        on the final input-line \underline{is ignored}. This may be used to
        add comments without the {\tt \%}-sign;
\item some blocks are needed only in certain circumstances. They are
        enclosed in square brackets {\tt []}, preceded by a condition in
        the specification;
\item some blocks can be repeated. They are enclosed in {\tt []} and are
        preceded by a stop-condition;
\item if you change the meaning of the input (e.g.\ ${\tt IPOTCN}=-1
        \rightarrow {\tt IPOTCN}=-3$), you should adjust the comments as
        well ({\tt MX,MY,A1,B1,SCALE} $\rightarrow$ {\tt MX,MY,AA,BB,SCALE}),
        in order not to confuse yourself;
\item This also applies for the {\tt N}- ({\tt PEN} or {\tt FN} for
        ${\tt N}=0$ or 1) and {\tt F}-digits ({\tt CKSI}, {\tt CETA} for
        ${\tt F}=0$, {\tt FX}, {\tt CETA} for ${\tt F}=1$ or {\tt FX},
        {\tt FY} for ${\tt F}=2$): make sure that the comment stays up to
        date.
\end{itemize}
Globally, the file consists of a series of module calls with their input.
Module 0 (STOP) has no input. The input of the other modules are subdivided
in a number of cases. We confine ourselves to the input for one case of
wheel/rail contact using module 1 and one case of basic contact with module 3.

\subsection{Module 1 -- wheel/rail contact}

The input for one case of wheel/rail contact consists of:
\begin{alltt}\small
% Control integers, see section \ref{sec:controldigits}:

\magenta{ }CPBTNFS  \magenta{   }  (\magenta{        }CONFIG, PVTIME, BOUND , TANG  , NORM  , FORCE , STRESS)
\magenta{ }VLDCMZE  \magenta{\{M\}}  (\magenta{        }VARFRC, FRCLAW, DISCNS, INFLCF, MATER , ZTRACK, EWHEEL\magenta{,
                                                                        MATER2})
\magenta{X}HGIAOWR  \magenta{   }  (\magenta{XFLOW , }HEAT  , GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW  , RETURN)

\magenta{% Parameters for additional debug output

if X=1: [ PSFLCIN \{R\} ] (PROFIL, SMOOTH, FORCE, LOCATE, CPATCH, INFLCF, NMDBG,
                                                                        READLN)

}% Parameters for the iterative solution algorithms (section \ref{sec:iter_const}):

if G<>1:      [ MAXGS   MAXIN   MAXNR   MAXOUT  EPS   \{NPOT\_MAX\}   ]
if G=2,3:     [ OMEGAH  OMEGAS  INISLP  OMGSLP        ]
if G=4:       [ INISLP  OMGSLP                        ]
\magenta{if G=5:       [ FDECAY  BETATH  KDOWFB  D\_IFC   D\_LIN   D\_CNS   D\_SLP   POW\_S ]
}
% Friction description (section \ref{sec:fric_dscrp}):
%      L=0 --> Coulomb friction with constant coefficient of friction
%      L=2 --> velocity dependent friction with linear/const formula
%      L=3 --> velocity dependent friction with rational formula
%      L=4 --> velocity dependent friction with exponential formula
%      L=6 --> temperature dependent friction with piecewise linear formula

if VARFRC=0:
      if L=0: [ FSTAT  FKIN                                ]
      if L=2: [ FKIN   FLIN1  SABSH1  FLIN2  SABSH2        ]
      if L=3: [ FKIN   FRAT1  SABSH1  FRAT2  SABSH2        ]
      if L=4: [ FKIN   FEXP1  SABSH1  FEXP2  SABSH2        ]
      if L=6: [ FREF   TREF   DFHEAT  DTHEAT               ]
if VARFRC=1:  [ NVF                                        ]
      if L=0: [ ALPHA  FSTAT  FKIN                         ], NVF times
      if L=2: [ ALPHA  FKIN   FLIN1  SABSH1  FLIN2  SABSH2 ], NVF times
      if L=3: [ ALPHA  FKIN   FRAT1  SABSH1  FRAT2  SABSH2 ], NVF times
      if L=4: [ ALPHA  FKIN   FEXP1  SABSH1  FEXP2  SABSH2 ], NVF times
      if L=6: [ ALPHA  FREF   TREF   DFHEAT  DTHEAT        ], NVF times
if L=2,3,4,6: [ MEMDST MEM\_S0                              ]

% Information needed for influence coefficients,
% particularly the material parameters (section \ref{sec:matcns}):

if INFLCF>=2:
      if INFLCF=4: [ IF\_METH  VARIANT               ]
                     POISS1  POISS2  GG1     GG2
\magenta{      if BOUND =1: [ FLXZ                           ]
}      if MATER =1: [ FG1     FG2       VT1     VT2  ]
      if MATER =2: [ FLX     K0\_MF   ALFAMF  BETAMF ]
      if MATER =3: [         K0\_MF   ALFAMF  BETAMF ]
      if MATER =4: [ GG3     LAYTHK  TAU\_C0  K\_TAU  ]

% Material parameters for \magenta{damping and }temperature calculation (section \ref{sec:matcns}):

\magenta{if M2=2:     [ CDAMPN   CDAMPT   DFNMAX   DFTMAX   ]
}if H=3:      [ BKTEMP1  HEATCP1  LAMBDA1  DENS1           
               BKTEMP2  HEATCP2  LAMBDA2  DENS2    ]
if H=3, M=4: [ BETAPL                              ]

% Information needed for the grid discretization (section \ref{sec:wr_potcon}):

if D>=2:     [ DX    DS   DQREL   A\_SEP   D\_SEP   D\_COMB  \{D\_TURN\} ]

% Information on the track geometry (section \ref{sec:track_geom}) \& rail profile (section \ref{sec:profiles}):

if Z=1,3:
      if CONFIG=0,1:  [  GAUGHT    GAUGSQ   GAUGWD   CANT     ]  if GAUGHT >  0
                 or:  [  GAUGHT    RAILY0   RAILZ0   CANT     ]  if GAUGHT <= 0
      if CONFIG=4,5:  [  GAUGHT    GAUGSQ   GAUGWD   NOMRADR  ]  if GAUGHT >  0
                 or:  [  GAUGHT    RAILY0   RAILZ0   NOMRADR  ]  if GAUGHT <= 0

if Z=3:        [ 'RFNAME'  MIRRORY  SCLFAC    SMOOTH  \{MIRRORZ\}  \{PRFOPT\} ]
if PRFOPT>=1:  [  ISMOOTH  ZIGTHRS  KINKHIGH  KINKLOW  KINKWID ]
\magenta{if PRFOPT>=2:  [  ERRHND   MAXOMIT  ]}
if Z=2,3:      [  DYRAIL   DZRAIL   DROLLR    VYRAIL   VZRAIL   VROLLR  ]
\magenta{if Z=2,3, F=3: [  KYRAIL   FYRAIL   KZRAIL    FZRAIL                    ]}

% Information on wheelset geometry (section \ref{sec:wheelset_geom}) \& wheel profile (section \ref{sec:profiles}):

if E=3,5:      [  FBDIST   FBPOS     NOMRADW   ] 
if E=3,5:      [ 'WFNAME'  MIRRORY   SCLFAC    SMOOTH  \{MIRRORZ\}  \{PRFOPT\} ]
if PRFOPT>=1:  [  ISMOOTH  ZIGTHRS   KINKHIGH  KINKLOW  KINKWID ]
\magenta{if PRFOPT>=2:  [  ERRHND   MAXOMIT  ]}

% Information on the wheelset state (section \ref{sec:wheelset_geom}):

if CONFIG=0,1, E>=1: [ S\_WS    Y\_WS    Z\_INP  ROLL    YAW    PITCH    ]
if CONFIG=4,5, E>=1: [ X\_WS    Y\_WS    Z\_INP  ROLL    YAW    PITCH    ]
   with  N=0:\magenta{  } Z\_INP = Z\_WS,   N=1: Z\_INP = FZ\_WS

if T=0,2,3:
if CONFIG=0,1, E>=2: [ VS\_WS   VY\_WS   VZ\_WS  VROLL   VYAW   V\_INP    ]
if CONFIG=4,5, E>=2: [ RPITCH  VY\_WS   VZ\_WS  VROLL   VYAW   V\_INP    ]
   with  F=0\magenta{,3}: V\_INP = VPITCH, \magenta{F=1: V\_INP = FX\_WS, F=2: V\_INP = MY\_WS}
if T=1, CONFIG=0,1, E>=2: 
          [ SHFT\_SWS   SHFT\_YWS  SHFT\_ZWS  SHFT\_ROL  SHFT\_YAW  SHFT\_WPIT ]
if T=1, CONFIG=4,5, E>=2: 
          [ SHFT\_RPIT  SHFT\_YWS  SHFT\_ZWS  SHFT\_ROL  SHFT\_YAW  SHFT\_WPIT ]

% Information on flexible wheelset deviations (section \ref{sec:wheelset_geom}):

if E>=4:    [ DXWHL    DYWHL    DZWHL    DROLLW   DYAWW    DPITCHW 
              VXWHL    VYWHL    VZWHL    VROLLW   VYAWW    VPITCHW    ]

% Subsurface stress calculation (section \ref{sec:subsurf}):

if S=2,3: [ subsurface points (see below) ]
\end{alltt}
This input is illustrated in the {\tt mbench\_a22\_left} example in the
{\tt examples} directory.

\color{black}


\subsection{Module 3 -- basic Hertzian/non-Hertzian contact}

For module 3, the input for one case consists of:
\begin{alltt}\small
% Control integers, see section \ref{sec:controldigits}:

\magenta{ } PBTNFS      \magenta{        }       (PVTIME, BOUND , TANG  , NORM  , FORCE , STRESS)
\magenta{ } LDCMZE\magenta{  \{M\}   }             (FRCLAW, DISCNS, INFLCF, MATER , RZNORM, EXRHS \magenta{,
                                                                      MATER2})
\magenta{X}HGIAOWR     (\magenta{XFLOW , }HEAT  , GAUSEI, IESTIM, MATFIL, OUTPUT, FLOW  , RETURN)

\magenta{% Parameters for additional debug output

if X=1: [ PSFLCIN \{R\} ] (PROFIL, SMOOTH, FORCE, LOCATE, CPATCH, INFLCF, NMDBG,
                                                                        READLN)

}% Parameters for the iterative solution algorithms (section \ref{sec:iter_const}):

if G=0,2,3,4: [ MAXGS   MAXIN   MAXNR   MAXOUT  EPS     ]
if G=2,3:     [ OMEGAH  OMEGAS  INISLP  OMGSLP          ]
if G=4:       [ INISLP  OMGSLP                          ]
\magenta{if G=5:       [ FDECAY  BETATH  KDOWFB  D\_IFC   D\_LIN   D\_CNS   D\_SLP   POW\_S ]
}
% Kinematics description (section \ref{sec:kincns}):
% Note: PEN  is needed when N=0,      FN when N=1
%       CKSI is needed when F=0,      FX when F=1 or 2
%       CETA is needed when F=0 or 1, FY when F=2

PEN/FN  CKSI/FX  CETA/FY  CPHI   \{SPINXO   SPINYO\}

% Friction description (section \ref{sec:fric_dscrp}):
%      L=0 --> Coulomb friction with static/kinetic coefficients
%      L=2 --> velocity dependent friction with linear/const formula
%      L=3 --> velocity dependent friction with rational formula
%      L=4 --> velocity dependent friction with exponential formula
%      L=6 --> temperature dependent friction with piecewise linear formula

if VARFRC=0:
      if L=0: [ FSTAT  FKIN                                ]
      if L=2: [ FKIN   FLIN1  SABSH1  FLIN2  SABSH2        ]
      if L=3: [ FKIN   FRAT1  SABSH1  FRAT2  SABSH2        ]
      if L=4: [ FKIN   FEXP1  SABSH1  FEXP2  SABSH2        ]
      if L=6: [ FREF   TREF   DFHEAT  DTHEAT               ]
if L=2,3,4,6: [ MEMDST MEM\_S0                              ]

% Information needed for influence coefficients,
% particularly the rolling direction and step size (section \ref{sec:kincns}),
% and the geometry/material configuration (section \ref{sec:matcns}):

if C>=2:\magenta{
      if T<=1 & M=5: [ DT                   ]}
      if T>1: [ CHI  DQ   VELOC             ]
      if C=4: [ IF\_METH   VARIANT   NN
                Y(I), ALPHA(I), I=1,NN      ]
      if C=9: [ 'CFNAME'                    ]
                POISS 1, 2   GG 1, 2
\magenta{      if B=1: [ FLXZ                        ]
}      if M=1: [ FG 1, 2   VT 1, 2           ]
      if M=2: [ FLX  K0\_MF   ALFAMF  BETAMF ]
      if M=3: [      K0\_MF   ALFAMF  BETAMF ]
      if M=4: [ GG3  LAYTHK  TAU\_C0  K\_TAU  ]

% Material parameters for \magenta{damping and }temperature calculation (section \ref{sec:matcns}):

\magenta{if M2=2:     [ CDAMPN   CDAMPT   DFNMAX   DFTMAX ]
}if H=3:      [ BKTEMP1  HEATCP1  LAMBDA1  DENS1           
               BKTEMP2  HEATCP2  LAMBDA2  DENS2  ]
if H=3, M=4: [ BETAPL                            ]

% Information needed for the grid discretization (section \ref{sec:pot_con}).
% Hertzian options when IPOTCN<0 (sections \ref{sec:hertz3d}, \ref{sec:hertz2d}, \ref{sec:sdec}), direct
% specification of potential contact area when IPOTCN>0 (section \ref{sec:nonhzvar}).

if D=2: IPOTCN
      if IPOTCN=-1: [ MX  MY  A1  B1   SCALE ]
      if IPOTCN=-2: [ MX  MY  A1  AOB  SCALE ]
      if IPOTCN=-3: [ MX  MY  AA  BB   SCALE ]
      if IPOTCN=-4: [ MX  MY  A1  BB   SCALE ]
      if IPOTCN=-5: [ MX  MY  AA  BB   SCALE ]
      if IPOTCN=-6: [ MX  MY  AA  BNEG BPOS SCALE ]
      if IPOTCN= 1: [ MX  MY  XL  YL   DX   DY  ]
      if IPOTCN= 2: [ MX  MY  XL  YL   XH   YH  ]
      if IPOTCN= 3: [ MX  MY  XC1 YC1  DX   DY  ]
      if IPOTCN= 4: [ MX  MY  XC1 YC1  XCM  YCM ]

% Information for the undeformed distance calculation, when not using
% a Hertzian option above (section \ref{sec:ibase}):

if Z>1 & IPOTCN>0: IBASE   IPLAN
      if IBASE= 1:  [ B1   B2   B3   B4   B5   B6            ]
      if IBASE= 2:  [ NN   XM   RM   Y1   DY1
                      B(k), k=1..NN                          ]
      if IBASE= 3:  [ B1   B2   B3   B4   B5   B6   B7   B8  ]
      if IBASE= 9:  [ H(I), I=1,NPOT                         ]
      if IPLAN= 2:  [ PL1  PL2  PL3  PL4  PL5  PL6           ]
      if IPLAN= 3:  [ XL1  XH1  YL1  YH1  XL2  XH2  YL2  YH2 ]
\magenta{      if IPLAN= 4:  [ NPATCH
                      YSEP(I),  I=1,NPATCH-1
                     (FAC(I,J), J=I+1,NPATCH), I=1,NPATCH-1  ]
}
\magenta{% Variable friction per grid row IY (section \ref{sec:varfrc}):

if VARFRC=2:
      if L=0: [ FSTAT  FKIN                                ], MY times
      if L=2: [ FKIN   FLIN1  SABSH1  FLIN2  SABSH2        ], MY times
      if L=3: [ FKIN   FRAT1  SABSH1  FRAT2  SABSH2        ], MY times
      if L=4: [ FKIN   FEXP1  SABSH1  FEXP2  SABSH2        ], MY times
      if L=6: [ FREF   TREF   DFHEAT  DTHEAT               ], MY times
      if L=2,3,4,6: [ MEMDST MEM\_S0                        ]
}

% Kinematics, extra terms to tangential right hand side (section \ref{sec:kincns}):

if E=9: [ EXRHS(I,2), EXRHS(I,3), I=1,NPOT    ]

% Subsurface stress calculation (section \ref{sec:subsurf}):

if S=2,3: [ subsurface points (see below) ]
\end{alltt}

\section{Specification of the file {\tt <varprof>.slcs/.slcw}}
\label{sec:spec_slcs}

The input of variable rail profiles in so-called `slices files' ({\tt
.slcs}) starts with general configuration parameters. After this follows
the list of filenames per slice, followed by the optional information on
`features' and `parts' in lateral direction.

\begin{alltt}\small
% General parameters and counters

S_OFFSET   S_SCALE
NSLC
NFEAT      NKINK      NACCEL
S_METHOD

% Slice positions and filenames per slice

[ S_SLC     RFNAME ],  NSLC times

% Feature information per slice

if (NKINK >0)  [ P_KINK(J),  J=1,NKINK    ]
if (NACCEL>0)  [ P_ACCEL(J), J=1,NACCEL   ]
if (NFEAT >1)  [ S_SLC  [ S_F(J), J=1,NFEAT ] ],  NSLC times
\end{alltt}
The positions of kinks and accelerations are entered each as one `group of
values'. They may be presented on a single line of input or may be separated
by newlines as discussed in Section \ref{sec:inputfile}.

The slices filenames and feature information use a group of values
per slice. Newlines are optional within each slice and mandatory between
consecutive slices. 

The structure is the same for out-of-round wheels using `wheel slices'
({\tt .slcw}) files, using {\tt TH\_\-OFF\-SET} instead of {\tt S\_OFFSET},
{\tt TH\_SCALE} instead of {\tt S\_SCALE}, {\tt TH\_METHOD} instead of {\tt
S\_METHOD}, and {\tt TH\_SLC} instead of {\tt S\_SLC}.

\section{Specification of the file of numerical influence coefficients}
\label{sec:spec_inflcf}

A file of numerical influence coefficients may be provided for conformal
contact situations, with name {\tt CFNAME}, using control digit
${\tt C}_3=9$, as discussed in Section \ref{sec:num_infl}. This concerns
the coefficients $C_{IiJj}$ of the tractions-displacements relation:
\begin{equation}\label{eq:ui_sum_Cij_pj}
    u_i(\vec{x}_I) = \frac{1}{G} \sum_{j\in\{n,x,y\}}\sum_{J=1}^N
        C_{IiJj}(\vec{x}_I,\vec{x}_J) \, p_j(\vec{x}_J), \;\;\;
        \mbox{ for } I\in\{1\cdots N\}, \; i\in \{n,x,y\}.
\end{equation}
By expansion of the element numbers $I=(i_x,i_y), J=(j_x,j_y)$, this gives
an array $C(i_x,i_y,i,j_x,j_y,j)$ with six dimensions. This is reduced to five
dimensions by assuming $C(i_x,:,:,j_x,:,:)=C'(i_x-j_x,:,:,:,:)$ for all
pairs $i_x,j_x$. Another dimension may be removed in situations with
(near) constant curvature, cf.\ ${\tt if\_meth}=0$ in Section
\ref{sec:num_infl}, assuming $C'(:,i_y,:,j_y,:)=C''(:,i_y-j_y,:,:)$.

There are two types of files, with a single `matrix' $C''$ for all
loadings, or $m_y$ separate matrices, slices $C'(:,:,:,j_y,:)$, for
loadings at points $j_y=1\cdots m_y$.
\begin{alltt}
   nmatrix   iaconvex
   lquasid   xyzorder
   lsymmx    lsymmy
   mxfile    myfile   dxfile  dyfile
   % empty/comment line
   % empty/comment line
   for imatrix = 1 to nmatrix: [
      if nmatrix>1: [
         % empty/comment line
         imatrix  xcentr  ycentr
      ]
      for iyofs = -my+1 to my-1: [
         % empty/comment line
         % empty/comment line
         for ixofs = 0 to mx-1: [
            ixofs   xrel   Czz  Czx  Czy   Cxz  Cxx  Cxy   Cyz  Cyx  Cyy 
         ]
      ]
   ]
\end{alltt}
The counters {\tt ixofs}, {\tt iyofs} stand for the offsets $i_x-j_x$ and
$i_y-j_y$, with the loaded element placed at $j_x=j_y=0$. Each matrix has
the biggest values for {\tt Cxx}, {\tt Cyy}, {\tt Czz} at ${\tt ixofs}=
{\tt iyofs}=0$.

The software requires non-quasi-identical input (9 coefficients $i,j$) in
$zxy$-order. Data should be using symmetry in $x$ and not in $y$. The
parameters {\tt lquasid}, {\tt xyzorder}, {\tt lsymmx}, {\tt lsymmy} are
provided for future extension.
The number of comment lines must be exactly as shown in the specification.

The grid employed in the file can have different numbers of rows and
columns than the grid in CONTACT. If the file grid is smaller, the
influence coefficients are padded with zeros. This creates inaccuracies in
the simulation. If the file grid is larger than the grid used in the
current case being computed, the additional values from the file will be
discarded.

\section{Subsurface-stress input in the file {\tt <experim>.inp}}
\label{sec:spec_subsinp}

The input of the subsurface points in {\tt <experim>.inp} starts with the
control digits {\tt A} and {\tt O}, governing the writing of the
Matlab-file {\tt <experim>.<case>.subs} and the level of output to the {\tt
out}-file (Section \ref{sec:subsurf_control}). This line appears once
irrespective of how many blocks of points are used.
\begin{alltt}\small
    if S=2,3: [ MATFIL, OUTPUT ]
\end{alltt}
Next follow one or more blocks of ${\tt NX}\cdot{\tt NY}\cdot{\tt NZ}$
points. The presence of more blocks is signalled by the integer
digit {\tt ISUBS}. In a way this is comparable to the {\tt MODULE} number:
calculations continue until ${\tt ISUBS}=0$. The input of one block
consists of the following lines (see section \ref{sec:subsurf_inp}):
\begin{alltt}\small
    if S=3: [ 
       ISUBS
       if ISUBS=1 or 5:   no input for IX,IY - all elements selected
       if ISUBS=2 or 6: [ IXL IXINC IXH  
                          IYL IYINC IYH      ]
       if ISUBS=3 or 7: [ NX  NY
                          IX(i), i=1,..,NX
                          IY(j), j=1,..,NY   ]
       if ISUBS=1,2,3:  [ NZ  ZL  DZ         ]
       if ISUBS=5,6,7:  [ NZ
                          Z(iz), iz=1,..,NZ  ]
       if ISUBS=9:      [ NX  NY  NZ
                          X(i),  i=1,..,NX
                          Y(j),  j=1,..,NY
                          Z(k),  k=1,..,NZ   ]
       if ISUBS=0:      last block complete, no more input
    ]
\end{alltt}

\section{Specification of the file {\tt <experim>.<case>.mat}}
\label{sec:spec_mat}

This file is written for each case with {\tt A}-digit $\ge 1$ and contains
the detailed outputs of the case. The case number `{\tt <case>}' is
written in 4 or 6 digits or omitted for case-numbers above one million.

The file is used in the plot-programs {\tt loadcase.m}, {\tt plot2d.m} and
{\tt plot3d.m} (Section \ref{sec:plot_surf}).

Results can be stored for elements inside the contact area only
(${\tt A}=1$) or all elements of the potential contact area (${\tt
A}=2$). The first few lines contain several extra variables that are needed
for the pictures. All lines lines have an equal number of columns. There
are $11\text{--}15$ columns, depending on the presence of plasticity and
temperature in the calculations.
\begin{alltt}\small
 line  1: % comment line, describing wheel and rail markers
 line  2:   Tim   Sws   Xw    Yw      ...                 ...   (dum)  Fmt
 line  3: % comment line, describing contact reference position
 line  4:   Xcp   Ycp   Zcp   Deltcp  ...
 line  5: % comment line, describing grid discretisation variables
 line  6:   Mx    My    Xl    Yl    Dx    Dy   Chi   Dq  ...
 line  7: % comment line, describing the material parameters used
 line  8:   Tdigit Mdigit Gg1    Gg2    Poiss1 Poiss2
 line  9: % comment line, describing the friction law used
 line 10:   Ldigit  (dum)  Veloc  (if L=0:) Fstat  Fkin
 line 11: % comment line, describing columns of the table
 for all elements in the (potential) contact area:
   i  Igs(i)  H(i)  Mu(i)  Pn(i)  Px(i)  Py(i)  Un(i)  Ux(i)  Uy(i)  SRel(i) ...
                            [ TauCrt(i) UplsX(i) UplsY(i) ] [ Temp1(i) Temp2(i)]
 where:
   i        = element number. For element (ix,iy), i = ix + mx*(iy-1)
   Igs(i)   = state, 0=Exter, 1=Adhes, 2=Slip
   H(i)     = undeformed distance in element i
   Mu(i)    = actual friction coefficient in element i
   Pn,Px,Py = normal/tangential tractions in element i
   Un,Ux,Uy = normal/tangential displacement differences in element i
   SRel(i)  = magnitude of the relative slip velocity in element i
   TauCrt   = plasticity bound in element i
   Uplsx,y  = tangential plastic displacements in element i
   Temp1,2  = optional surface temperature of bodies 1, 2 at element i
\end{alltt}
Note: in the computation of shifts (${\tt T}=1$) instead of rolling
(${\tt T}\ge 2$), the shift distance {\tt Shft} is stored instead of
{\tt Srel}.

\section{Specification of the file {\tt <experim>.<case>.subs}}
\label{sec:spec_subs}

This file is used by the Matlab script {\tt plotstrs.m}. It contains 8
or 14 data columns depending on whether the full stress tensor is
exported or not, see the {\tt A}-digit on page \pageref{a-digit}. For each
block of subsurface points the file contains the following lines:
\begin{alltt}\small
  line 1: % comment line, describing variables on second line
  line 2:   Nx  Ny  Nz
  line 3: % comment line, describing columns of the table
  for all Nx.Ny.Nz subsurface points of the block:
     line 3+k:  X   Y   Z   UX   UY   UZ   SIGHYD  SIGVM [ ...
                                 SIGXX  SIGXY  SIGXZ  SIGYY SIGYZ  SIGZZ ]
  X,Y,Z    = coordinates of the point where stresses are calculated
  Un,Ux,Uy = normal/tangential displacements in subsurface point k
  SigHyd   = mean hydrostatic stress sigma_hyd = I_1/3
  SigVM    = von Mises stress sigma_vm = sqrt(3*J_2)
  Sigxx,...,Sigzz = components of the stress tensor
\end{alltt}
Refer to Sections \ref{sec:solut_arrays} and \ref{sec:subsurf} for the
description of these output quantities.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Overview of computational model
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Overview of the computational model}
\label{chp:comput_model}

The program CONTACT is meant for:
\begin{itemize}
\item 3D homogeneous bodies of (linearly) elastic and viscoelastic
        materials, that may be different for the two contacting bodies,
\item with concentrated contact, i.e.\ where the resulting geometries are
        essentially flat, in and near the contact zone, but not necessarily
        Hertzian,
\item with dry (Coulomb) friction or boundary lubricated situations
        (third body layer, falling friction, friction memory effects),
\item solving shifts as well as rolling, transient as well as steady state
        problems, with creepages and/or total forces prescribed,
\item solving for the surface tractions first, but capable of computing the
        elastic field in the interiors of the bodies as well.
\end{itemize}
High-level functions are provided for wheel-rail contacts in `module 1'.
This is based on wheel and rail profiles and corresponding dimensions and
states. In this case, CONTACT performs analysis of the contact geometry
problem, identifying contact patches and computing the creepage
\cite{Vollebregt2020b-wrgeom,Vollebregt2020c-distr-force}. Low-level
functions are provided in `module 3' that are more general by nature but
may be harder to use.

\section{The role of contact in multi-body dynamics}

The main purpose of CONTACT is to assess the total forces between
contacting bodies in different circumstances. These forces are needed to
compute the dynamic behavior of mechanical systems, with rail vehicle
dynamics the most important exponent for steel on steel contacts. For
instance, when a train moves through a curve, the contact
point on the outer rail shifts towards the rail gauge corner where the
surface is inclined with respect to the horizontal plane. This changes the
direction of the contact force, which facilitates steering of the vehicle
through the curve.

\begin{figure}[bt]
\centering
\psfig{figure=fig/cntc_fric_spring_dashpot_var,width=3.5in,trim=110
                130 80 140,clip=}
\caption{\em Schematization of the wheel-rail rolling contact forces:
acting mainly as a variable spring in normal direction, Hertzian or
non-Hertzian, and like a variable spring and dashpot tangentially, that
breaks loose if a large a force is required.}
\label{fig:dashpot}
\end{figure}

It's important to realize that the physical phenomena at play differ
greatly between normal and tangent directions, which introduces strong {\em
anisotropy\/} in the contact problem (Figure \ref{fig:dashpot}). In normal
direction, one body is pressed onto the other. It tries to push
through the other, and this is resisted strongly by the cohesive forces
inside the other bodies' material. The force by which the bodies are
pressed together causes (elastic) deformation to occur. The bodies' centers
seem to approach each other, by which it may seem as if penetration of the
bodies occurs. If the force is released then the elastic deformation
diminishes, and the bodies' centers are separating again. Consequently
it is said that normal contact behaves like a spring. The stiffness of this
spring is variable, dependent not only on the material and geometry but
also on the contact load. There may be material damping as well, which
would give a small dashpot {\em parallel\/} to the spring. Whether this
damping is important or not depends on the materials used and the frequencies
that are of concern.

Tangential contact is different in the sense that it allows for large
displacements to occur between the two surfaces, with friction being the
main physical phenomenon. If a small tangential force is applied to one
body then it may deform slightly such that some tangential displacement seems
to occur. This is like an elastic spring, i.e.\ the displacement is undone
when the force is released. If the applied force is larger, then there may
also be some micro-slip between the surfaces in the contact interface. This
leads to some energy loss, i.e.\ this displacement is not undone upon
releasing the force. This is indicated by the vertical arrow in Figure
\ref{fig:dashpot}, indicating the reference position against which the
spring is pushing. Finaly, if the external force is large, compared to
the normal load that presses the bodies together, then gross sliding
occurs, amounting to further displacement of the vertical arrow.

Tangential contact behaves differently between sliding and rolling. In
sliding circumstances, the same material particles remain in contact during
the overall motion. In this case, only so much elastic deformation can
build up, after which no more displacement can occur (low/medium force) or
gross sliding must set in (large force). During rolling, fresh material
enters the contact all the time, allowing for some overall displacement to
go on continuously. This introduces the so-called {\em creep phenomenon\/},
an apparent sliding velocity between the two surfaces. This creeping can be
schematised using the dashpot shown in Figure \ref{fig:dashpot}, {\em in
series\/} with the tangential elasticity.

Creepage and tangential force are related to another in a complex,
non-linear way. In steady state rolling and at low creepage, the force and
percentual creepage are related according to the linear theory of Kalker
\cite{Kalker1967,Kalker1990}. At larger creepages the creep force saturates
at the friction maximum, upon which full sliding occurs, leading to the
well-known creep versus creep force curve (see for instance Figure
\ref{fig:tractcurv}). Note that in steady state rolling, the tangential
contact spring is held at constant elongation.  Hence the creep-force curve
describes the variable dashpot of Figure \ref{fig:dashpot}. The tangential
contact spring comes into play during non-steady scenarios, and may then
lead to tangential {\em rocking\/} to occur \cite{Vollebregt2015b-iavsd2015,
Vollebregt2017a-iavsd2017}.

\section{Overall problem versus the contact problem}

The geometry of the wheel-rail contact problem is introduced in Figure
\ref{fig:bent_rail}. In graph (a), the overall geometry is shown: the
rolling wheel, with radius $R$, forward velocity $V$ and angular velocity
$\omega$, positioned somewhere on a rail. The rail is bent due to forces
exerted on it at the sleepers ($F_{s1}, F_{s2}$) and at the wheel-rail
interface ($F_w$). In this picture the wheel and rail are considered rigid.
The wheel is moved down such that penetration with the rail occurs. This is
shown in detail in Figure \ref{fig:bent_rail} (b), stretched vertically.
The distance by which the wheel is shifted down equals the maximum
penetration and is called the {\em approach\/}, $\delta_n$. The configuration
shown in this figure is referred to as the `undeformed state'.

\begin{figure}[bt]
\centering
\psfig{figure=fig/bent_rail,width=6.2in,clip=}
\caption{\em Illustration of the wheel-rail contact problem 
\cite{Vollebregt2012a-quasistd}. (a): overall geometry. (b): wheel and rail
geometries in so-called undeformed states. (c): wheel and rail geometries
in the deformed state with corresponding deformations and contact area.
Note: graphs (b) and (c) are stretched vertically.}
\label{fig:bent_rail}
\end{figure}

It is the purpose of multibody simulations to analyse the dynamic behaviour
of such a system: to find the position and speed of the wheel and the bending
of the rail as a result of all forces in the system, i.e.\
the forces $F_r(t)$ and $F_w(t)$ exerted on the wheel and the rail as
function of time. These forces result from the elastic deformations in the
contact patch, and can be found as a function of the wheel and rail
geometries and the approach $\delta_n(t)$. This is illustrated in
Figure~\ref{fig:bent_rail} (b). At each time instance one obtains from the
multibody simulation the positions and so-called `undeformed' shapes of
the contacting bodies, and is asked for the resulting reaction forces in
the contact patch.

The elastic deformations and resulting contact patch are illustrated in
Figure~\ref{fig:bent_rail} (c). The normal pressure between the surfaces is
compressive and vanishes outside the contact area. Its integral over the
contact area is the total force $F_w=-F_r$ that is sought for. It pushes
the wheel surface upwards and the rail surface down. If the wheel and rail
have identical elastic parameters then their local deformations are equal
and opposite functions of position $x$ and time $t$, and the maximum
deformation is $\pm\delta_n/2$. Due to the strength of the material, the
deformations also extend outside the contact area, even though there is no
pressure working there.

A typical size for the contact between steel wheel and rails is $10\times
10\unit{mm}$, and the corresponding approach is $0.01\unit{mm}$. The elastic
deformations decrease with $1/r$, with $r$ the distance to the contact area,
and the stresses and strains decrease in proportion to $1/r^2$. Therefore
the stresses and strains are negligible at distances of a few centimeters
outside the contact patch. This is the reason why the overall multi-body
simulation and local contact problems may be decoupled \cite{Kalker1990}.

\begin{figure}[bt]
\centering
\psfig{figure=fig/bent_tang,height=2.1in,clip=}
\hspace{5mm}
\psfig{figure=fig/creep_phenom,height=2.1in,clip=}
\caption{\em Left: illustration of the creepage $\xi$, i.e.\ the relative
velocity difference $(V+\omega R)/V$. Right: particles that move through the contact area (from right
to left) tend to adhere to the opposite surface first, are strained more
and more until local sliding (micro-slip) sets in.}
\label{fig:bent_tang}
\end{figure}

If the profiles of rail and wheel are smooth, quadratic surfaces then the
normal pressure can be solved via Hertz' theory. In case of other shapes
(e.g.\ varying curvatures, including roughness) CONTACT's non-Hertzian
capabilities come into play. Next the tangential forces have to be obtained
as well. These cause {\em creepage\/} between wheel and rail, as
illustrated in Figure \ref{fig:bent_tang}, left. When a tractive force
(torque $M$) is aplied on a railway wheel, a small difference arises
between the overall forward velocity $V$ and circumferential velocity
$\omega R$ (note: $\omega<0$ for a wheel moving in positive $x$-direction).
The relative difference is the (longitudinal) creepage $\xi=(V+\omega R)/V$.
It is restricted by the friction force $F_w$ acting on the wheel.

This overall creeping motion of the wheel tries to drag the wheel surface
particles over the rail, i.e.\ it can be seen as an average amount of slip.
This relative movement is resisted by frictional shear stresses in the
contact interface. If the circumferential speed of wheel particles is
larger than the forward velocity ($\xi<0$, $\omega R<-V$), the net
tangential force on the wheel is pointing forward ($F_w>0$) and accelerates
the train. On the other hand, if the train is braking ($F_w<0$), then the
circumferential velocity is lower than the forward velocity ($\omega R>-V$,
$\xi>0$). Note that the situation is more complicated in reality, where
lateral creepage $\eta$ between wheel and rail may occur. Also, rotation of
the wheel about the normal direction occurs (a cone rolling over a plane
makes a circular trajectory), which is described by spin creepage $\phi$.
These combined creepages lead to combined forces $F_x, F_y$ and the spin
moment $M_z$.

Figure \ref{fig:bent_tang} (right) shows what happens to surface particles
when they traverse through the contact area. They are free of stress when
entering the contact area at the right side, the leading edge of the
contact area. There they adhere to a particle of the opposing surface. Next
they are strained by the overall motion difference between the two bodies.
This introduces shear stresses, which increase until the local traction
bound is exceeded and local slip sets in. This process is in different
stages for different parts of the contact area.

If the overall motion of the bodies is constant, then an overall steady
state may be attained. Here the state of each surface particle is varying
in time, but the overall distribution can be constant. This is formalised
by using a coordinate system that is moving along with the contact patch.

\section{Contact-fixed and world-fixed coordinate systems}
\label{sec:coordsys}

\begin{figure}[bt]
\centering
\psfig{figure=fig/moving_coordsys,width=4.2in,clip=}
\caption{\em Schematic example illustrating non-stationary rolling of a
wheel with some irregularities on a rail.}
\label{fig:moving_coordsys}
\end{figure}

A typical geometrical configuration is presented in Figure
\ref{fig:moving_coordsys}. This example concerns a wheel with some
irregularities at two different instances in time. In the time-period shown
in the picture the wheel rotates over an angle of $140^\circ$. At the same
time it moves forward in positive $x$-direction with velocity $V$. Under
rolling conditions we have $V\approx -\omega R$, i.e.\ the creepage is
small, at most a few percent. On the other hand when $V+\omega R$ is
rather large compared to $V$, we have sliding or `rolling with sliding'
circumstances.

The picture shows different coordinate systems for the different time
instances. At time $t'$ the coordinate system $O'x'y'z'$ is used, at time $t$
the coordinate system is $Oxyz$. This is the {\em contact-fixed\/}
coordinate system. In this example the $y$- and $z$-directions stay the same,
but generally these may vary over time too. Particularly the $z$-axis is
required to be normal to the two bodies' surfaces. An important aspect of
this coordinate system is that particles of the bodies' surfaces move
through the contact area with velocity $-V$. On the other hand, the
bodies themselves appear to be fixed with respect to the coordinate system.

An alternative approach is used in sliding or rolling with sliding
circumstances. In such a case there need not be a rolling velocity $V$.
Then a {\em world-fixed\/} coordinate system is used. In terms of Figure
\ref{fig:moving_coordsys} this consists of using coordinate system $O'x'y'z'$
for time $t'$ as well as for time $t$. In this description the axle moves
forward with velocity $V$, whereas particles in the contact area more or
less stay at the same coordinate.

When modeling two rollers in a machine the situation is a little different.
In that case the contact-fixed coordinate system is also a world-fixed one.
The coordinate system to be used for sliding problems should then be a
moving one, defined such that the particles in contact are almost
stationary with respect to the coordinates used. This then defines `{\em
material-fixed\/} coordinates'.  A complete description of particles,
coordinates and velocities is given in \cite{Kalker1990}.

\section{Using local coordinates}

The consequence of anisotropy (Figure \ref{fig:dashpot}) is that contact
phenomena must be studied in suitably defined coordinates, with
$n$-direction aligned with the normal to the contact plane. This is a
complicating factor for wheel-rail contact analysis, due to the contact
angle $\delta$ that arises when the contact moves from the wheel tread
towards the flange, as illustrated in Figure \ref{fig:s1002_init_cp_6mm}.
Note that $z_{tr}$ and $n$ are defined positive downwards, which makes the
rail the upper body.

\begin{figure}[bt]
\centering
\psfig{figure=fig/init_cp_left_6_0mm,width=3.2in,trim=45 220 85 270,clip=}
\psfig{figure=fig/init_cp_right6_0mm,width=3.2in,trim=45 220 85 270,clip=}
\caption{\em Initial contact points for left and right wheels at wheelset
lateral displacement $y_{ws}=6\unit{mm}$, yaw $\psi_{ws}=0^\circ$ (Manchester
contact benchmark, see Section \ref{sec:ex_mbench}).}
\label{fig:s1002_init_cp_6mm}
\end{figure}

The planar contact approach used in CONTACT relies on a so-called `contact
reference point' \cite{Vollebregt2020b-wrgeom}. This serves as the origin
for the local coordinate system, and as the `spin center' for spin creepage
\cite{Vollebregt2018a-sdec}. The contact reference point can be set to the
geometric point of contact (initial contact position). Alternatives are to
use the center of gravity of the interpenetration area
\cite{Vollebregt2011b-iavsd2011}, or the pressure center of gravity
\cite{Vollebregt2018a-sdec}.

The steps for solving a contact problem are then:
\begin{enumerate}
\item Locate a contact patch, for instance using the initial contact
        position, and define the `contact reference';
\item Determine the normal direction common to the contacting surfaces, and
        define the tangent contact plane;
\item Determine the contact geometry (esp.\ the undeformed distance
        function) and kinematics (so-called rigid slip velocity) relative to the
        contact plane;
\item Solve the normal and tangential contact problems;
\item Convert results to the global coordinates.
\end{enumerate}
Planar contact coordinates are designated as $[\bar{x},\bar{s},\bar{n}]^T$,
or as $[x,s,n]^T$ or $[x,y,z]^T$ if there's no ambiguity on the
interpretation.

All the steps are automated for wheel-rail contact analysis as discussed in
Chapter \ref{chp:module1}.  For other applications, the user takes care of
the necessary conversions and preparations (steps 1--3 and 5), and uses
CONTACT for step 4, the pure contact problem.

\section{Conformal contact}

Conformal contact deals with curved contact patches, where the surface
normal direction changes from one side of the contact patch to the other,
see Figure \ref{fig:worn_profile}. This arises when two conditions are met
\cite{Vollebregt2018b-corrigendum}:
\begin{enumerate}
\item the lateral radius of curvature $R_y$ is small in the contact area,
        such that the normal direction changes rapidly along the profile,
        and
\item the shapes of the two bodies are conforming, such that the contact is
        wide enough to pick up this change in normal direction.
\end{enumerate}
In Figure \ref{fig:worn_profile}, the normal direction changes orientation
by $41^\circ$ over a distance of $7\unit{mm}$, because the radius of curvature
goes down to less than $10\unit{mm}$. This leads to conformal contact if the
flange root of the wheel has a radius $R_{wy}>-10.2$ or $>-10.5\unit{mm}$,
depending on the total load on the contact \cite{Vollebregt2018b-corrigendum}.

The conformal contact approach works similarly to the planar approach
described above:
\begin{enumerate}
\item Determine a suitable `contact reference position', to be used a.o.\
        for presenting aggregate outputs;
\item Determine the curved contact surface, and the corresponding normal
        and tangent directions, varying along the contact surface;
\item Determine the contact geometry (esp.\ the undeformed distance
        function) and kinematics (rigid slip velocity), relative to the
        curved contact surface;
\item Solve the normal and tangential contact problems, with elastic
        deformations computed according to the conformal shapes;
\item Present the results in terms of a global coordinate reference.
\end{enumerate}
This conformal contact approach is described elegantly using generalised
curvilinear coordinates $[\tilde{x},\tilde{s},\tilde{n}]^T$, with
$\tilde{n}=0$ in the contact plane.

All the steps are automated for wheel-rail contact analysis as discussed in
Chapter \ref{chp:module1}. For other applications, the user takes care of
the necessary conversions and preparations (steps 1--3 and 5), and uses
CONTACT for step 4, the pure contact problem.

\section{Formulation of the contact problem}
\label{sec:contin_form}

The contact problem consists of determining the various aspects of the
deformed state: the contact area, the distribution of surface tractions
(pressures and frictional shear stresses), the deformations, and the
stresses inside the materials. These are the result of a complex interaction
between:
\begin{enumerate}
\item the overall motion (approach in normal direction and tangential
        creepage),
\item the elastic deformation of the two bodies (local motion), and
\item the friction processes (interaction between surface particles).
\end{enumerate}

\subsection{Continuum mechanics}

When the bodies are brought into contact, stresses
$\vecsigma^{(a)}(\vec{x},t)$, strains $\veceps^{(a)}(\vec{x},t)$
and displacements $\vec{u}^{(a)}(\vec{x},t)$ arise in the bodies and at
their surfaces. These are related by Newton's second law and the material
behaviour. For instance, assuming linear elasticity, these relations read
\begin{equation}\label{eq:lin_elasticity}
  \rho^{(a)}\,\ddot{\vec{u}}^{(a)} =
                \nabla\cdot\vecsigma^{(a)} + \vec{f}^{(a)}, \;\;\;
  \vecsigma^{(a)} = {\sf C}^{(a)} : \veceps^{(a)} , \;\;\;
  \veceps^{(a)} = \frac{1}{2}\left[ \nabla\vec{u}^{(a)} +
                        (\nabla\vec{u}^{(a)})^T \right] .
\end{equation}
Here $a=1,2$ is the body number, with $a=1$ for the upper body ($z>0$).
$\vec{f}^{(a)}$ represents body forces, $\rho^{(a)}$ is the mass density, and
${\sf C}^{(a)}$ is a fourth-order stiffness tensor. The first equality of
(\ref{eq:lin_elasticity}) is the equation of motion (Newton),
the second equality describes the material behaviour according to Hooke's
law, and the latter is the strain-displacement relation. These equalities
must hold everywhere in the bodies' interiors $\vec{x}\in\Omega^{(a)}$,
where suitable boundary conditions are required on $\partial\Omega^{(a)}$.

\subsection{Surface quantitities}

In formulating the contact problem, we are particularly interested in the
surface quantities: the displacement $\vec{u}^{(a)}(\vec{x})$ of the
surface particles $\vec{x}$ of bodies $a=1,2$ ($z\approx 0$) and the surface
tractions
\begin{equation}
   \vec{p}^{(a)}(\vec{x}) = \sigma(\vec{x})\cdot\vec{n}^{(a)}(\vec{x}),
\end{equation}
with $\vec{n}^{(a)}(\vec{x})$ the outer normal on body $a$ at $\vec{x}$.
Now, since $\vec{p}^{(2)}(\vec{x})=-\vec{p}^{(1)}(\vec{x})$ for all surface
positions $\vec{x}$ where the bodies are in contact, we may eliminate
$\vec{p}^{(2)}$ and consider a single variable $\vec{p}(\vec{x})=
\vec{p}^{(1)}(\vec{x})$ for the contact area. Furthermore, the
displacements enter the contact problem mainly through their differences.
Therefore, we introduce the so-called {\em displacement difference\/}
$\vec{u}(\vec{x})$ at position $\vec{x}$:
\begin{equation}\label{eq:displ_diff}
   \vec{u}(\vec{x}) = \vec{u}^{(1)}(\vec{x}) -\vec{u}^{(2)}(\vec{x}).
\end{equation}

The quantities introduced above are tensors ($\vecsigma, \veceps$) and
vectors ($\vec{x}, \vec{u}, \vec{p}$) in three-dimensional space. We assume
that the contact area $C$ is in the plane
$Oxy$,\footnote{\label{foot:conformal}For simplicity we do not consider
conformal contact situations here. For information on this consult the
paper \cite{Vollebregt2014d-conformal} that describes the extensions with
respect to the half-space approach.} such that
$\vec{n}^{(a)}= [0,0,(-1)^a]^T$, and concentrate on the surface points
$\vec{x}=[x,y,0]^T$. In the following we often deal with the normal
and tangential vector components separately. The normal coordinate direction
is indicated with subscript $n$ and the tangential directions by $t$.
The normal pressure (scalar function) and tangential tractions (2-vectors)
are denoted by
\begin{equation}
   p_n(x,y) = \vec{p}(\vec{x})^T \vec{n}, \;\;
   \vec{p}_t(\vec{x}) = [p_x(x,y), p_y(x,y)]^T .
\end{equation}
The normal and tangential components of the displacement difference are
indicated similarly by $u_n$ and $\vec{u}_t$.

\subsection{The half-space approach}

The program CONTACT is based on an {\em influence function method\/} or {\em
boundary element method\/}, which in our case is also called the {\em
half-space approach\/}.\footnotemark[1]
The elasticity equations (\ref{eq:lin_elasticity})
for the interiors of the two contacting bodies are converted to equations for
their bounding surfaces. The main resulting equation is the relation between
surface tractions $\vec{p}$ and displacements $\vec{u}$:
\begin{eqnarray}
\lefteqn{\mbox{the tractions-displacement relation:}} \nonumber \\
  & \mbox{\hspace{4cm}} & \vec{u}(\vec{x},t) =
        \int_{\vec{x}'\in C} \mat{A}(\vec{x},\vec{x}') \,
                \vec{p}(\vec{x}',t) \, dC          \label{eq:u_int_A_p}
\end{eqnarray}
This relation depends on the constitutive equations that describe the
material behaviour, as well as on the geometries of the bodies.

In CONTACT the following assumptions are made \cite{Kalker1990}:
\begin{itemize}
\item the bodies are formed of linearly elastic materials, and are
        homogeneous,
\item the contact area is essentially flat and small with respect to
        typical dimensions of the bodies' geometries,
\item no sharp variations exist in the geometries of the bodies,
\item inertial effects ($\rho\,\ddot{\vec{u}}$) are small with respect to
        the contact stresses ($\nabla\cdot\vecsigma$) and may be ignored.
\end{itemize}
These assumptions allow for using the so-called {\em half-space approach\/}.
The actual response of the bodies to the surface loading is approximated by
that of the elastic half-space, which was presented in analytical form by
Boussinesq and Cerruti. With the half-space solution the contact problem
is brought into surface-mechanical form. In this form, no reference is made
to the stresses $\vecsigma$, strains $\veceps$, and displacements $\vec{u}$
in the bodies' interiors.

\subsection{The contact conditions}

Two important quantities of the contact problem are:
\begin{eqnarray}
\mbox{normal problem} : \hspace{40mm} && \nonumber \\
        \mbox{deformed distance } &&  \hspace{-3mm} e := h + u_n
                \label{eq:def_dist} \\
\mbox{tangential problem} : \hspace{35mm} && \nonumber \\
        \mbox{relative slip velocity} && \hspace{-3mm}
                \vec{s}_t := \vec{w}_t + \dot{\vec{u}}_t / V
                \label{eq:def_slip}
\end{eqnarray}
The function $h(x,y)$ describes the profiles of the two bodies as well
as the approach denoted by $\delta_n$. The relative rigid slip
$\vec{w}_t$ describes the velocity by which the surfaces move with respect
to each other in the undeformed state. Together with the time derivative of
the displacements ($\dot{\vec{u}}$) this yields the slip velocity $\vec{s}_t$
of two opposing particles of the two bodies with respect to each other.

With these quantities the contact problem is to determine the contact
region $C$, its subdivision into adhesion and slip areas $H$ and $S$, and the
tractions $p_n, \vec{p}_t$ such that the following contact conditions are
satisfied:
\begin{eqnarray}
\mbox{normal problem} : \hspace{32mm} &&     \nonumber\\
  \mbox{in exterior $E$} :      && \hspace{-3mm} e > 0, \; p_n = 0
                                                \label{eq:norm_ext} \\
  \mbox{in contact $C=H\cup S$} : && \hspace{-3mm} e = 0, \; p_n \ge 0
                                                \label{eq:norm_int} \\
\mbox{tangential problem} : \hspace{27mm} && \nonumber\\
  \mbox{in exterior $E$} :      && \hspace{-3mm}
           \vec{s}_t \mbox{ free}, \; \vec{p}_t = \vec{0},
                                                \label{eq:tang_ext} \\
  \mbox{in adhesion $H$} :      && \hspace{-3mm}
           \|\vec{s}_t\| = 0, \; \|\vec{p}_t\| \le g,
                                                \label{eq:tang_adhes} \\
  \mbox{in slip $S$} :          && \hspace{-3mm}
           \|\vec{s}_t\| > 0, \; \vec{p}_t =
                                -g \,\vec{s}_t/\|\vec{s}_t\|,
                                                \label{eq:tang_slip} \\
  \mbox{Coulomb friction} :   && \hspace{-3mm}
     g(\vec{x},t) = \mu \, p_n(\vec{x},t) \; .\label{eq:tract_bound}
\end{eqnarray}
These contact conditions state that:
\begin{itemize}
\item The bodies cannot interpenetrate in the deformed state: the distance
        between their surfaces is non-negative;
\item The normal pressure is compressive, attraction between the surfaces
        is ignored;
\item The exterior area is free of traction (the effect of auxiliary forces
        may be computed beforehand and incorporated in the geometry, i.e.\
        $h$);
\item The frictional shear stress cannot be larger than a space-varying
        maximum, the traction bound $g$;
\item No slip occurs where the tangential traction falls below the traction
        bound;
\item If there is slip then the tractions are on the traction bound and
        opposite to the slip direction.
\end{itemize}
These contact conditions can be seen as a complex set of boundary conditions
for the solid mechanics problems (\ref{eq:lin_elasticity}) for bodies $a=1,2$.
The deformations in the two bodies' interiors cannot be solved independently
but are connected, via their overall position and motion ($\delta_n, h, 
\vec{w}_t$), the deformation ($\vec{p}, \vec{u}$, equation 
(\ref{eq:u_int_A_p})) and the precise conditions used at the mutual interface
(equations (\ref{eq:def_dist})--(\ref{eq:tract_bound})).

\begin{table}[p]
\begin{tabular}{lp{140mm}}
$\vec{x}, \vec{y}$ & locations in 3D space, typically of the form
                $[x,y,0]^T$ for points in the contact area
                $C$. Also used to identify particles of the bodies; \\[0.5ex]
$C, H, S$     & contact area, adhesion area, slip area;\\[0.5ex]
$\vec{u}(\vec{x})$ & displacement difference $\vec{u}^{(1)}(\vec{x})
                -\vec{u}^{(2)}(\vec{x})$, with body 1 the upper body with
                $z>0$; \\[0.5ex]
$\vec{u}^{(a)}(\vec{x})$ & displacement vector of the particle of body
                $a$ (1, 2) that is at location $\vec{x}$ in the undeformed
                state; \\[0.5ex]
$u_i^{(a)}(\vec{x})$ & $i^{th}$ (scalar) component of the displacement
                vector $\vec{u}^{(a)}(\vec{x})$; \\[0.5ex]
$i, j$        & coordinate directions 1, 2, 3, with the first of these being
                normal to the contact area ($n$-, $z$-direction), the second
                the longitudinal (rolling) direction ($x$), and the third
                perpendicular to both ($y$-direction); \\[0.5ex]
$\alpha$      & tangential coordinate direction: 2, 3 or $x$, $y$; \\[0.5ex]
$\vec{p}(\vec{x})$ & surface traction (vector) acting on body 1 at position
                $\vec{x}$; \\[0.5ex]
$\mat{A}(\vec{x},\vec{x}')$ & $3\times 3$ matrix of influence functions;
                \\[0.5ex]
$A_{ij}(\vec{x},\vec{x}')$ & influence function, describing the displacement
                difference in $i$-direction at $\vec{x}$ arising due to a unit
                load in $j$-direction at $\vec{x}'$; \\[0.5ex]
$h(\vec{x})$  & distance between the surfaces of the two bodies in normal
                direction in the undeformed state at location $\vec{x}$
                (positive: gap, negative: interpenetration); \\[0.5ex]
$e(\vec{x})$  & distance between the two bodies in the deformed state; \\[0.5ex]
$\dot{\vec{u}}(\vec{x})$ & material (particle fixed) time derivative of
                the displacement difference $\vec{u}(\vec{x})$; \\[0.5ex]
$\vec{s}_t$   & relative (tangential) slip velocity of two opposing particles
                of the bodies with respect to each other; \\[0.5ex]
$g$           & traction bound, maximum tangential traction (magnitude) that
                can be sustained with the surfaces adhering together; \\[1.5ex]

$\delta x, \delta y$ & the sizes in $x$- and $y$-directions of the
                rectangular discretisation elements; \\[0.5ex]
$\vec{x}_I$   & location of the center of discretisation element $I$; \\[0.5ex]
$I, J$        & 1D (\var{i}) or 2D (\var{(ix,iy)}) numbers of the
                discretisation elements (see equation (\ref{eq:1d_index}));
                \\[0.5ex]
$\vec{u}_{I}$ & shorthand notation for $\vec{u}(\vec{x}_I)$, displacement
                diff.\ at the center of element $I$; \\[0.5ex]
$u_{In}, \vec{u}_{It}$ & shorthand notations for $u_n(\vec{x}_I)$ and
                $\vec{u}_t(\vec{x}_I)$, (scalar) normal and (2-vector)
                tangential displacement differences at center of element
                $I$; \\[0.5ex]
$u_{I\alpha}$ & shorthand notation for $u_\alpha(\vec{x}_I)$, (scalar)
                displacement difference in direction $\alpha$ ($x$ or $y$)
                at center of element $I$; \\[0.5ex]
$t, t', \delta t$ & time instances, time step; \\[0.5ex]
$V$           & in rolling problems: the rolling speed, in shifts $V=1$; \\[0.5ex]
$\delta q$    & geometrical time step size: distance traversed per time
                step; \\[0.5ex]
\end{tabular}
\caption{\em Overview of notations and conventions used in this document.}
\label{tbl:notations}
\end{table}

\section{Discretisation of the problem}

In CONTACT, a calculation starts by defining a potential contact area that
encompasses the true contact area. This potential contact area is
discretised into $N=m_x\cdot m_y$ rectangular elements of size $\delta x
\cdot \delta y$ (see Figure \ref{fig:potcon_discr}). The surface tractions
are approximated by piecewise constant functions per
element.\footnote{Bilinear elements are provided also, with little benefit
over a piecewise constant discretization \cite{Vollebregt2009a-cm2009,
Wekken2019a-subsurf}.} This leads to
\begin{equation}\label{eq:ui_sum_Aij_pj}
    u_i(\vec{x}_I) = \sum_{j\in\{n,x,y\}}\sum_{J=1}^N
        A_{IiJj}(\vec{x}_I,\vec{x}_J) \, p_j(\vec{x}_J), \;\;\;
        \mbox{ for } I\in\{1\cdots N\}, \; i\in \{n,x,y\}.
\end{equation}
Here $\vec{x}_I$ and $\vec{x}_J$ stand for the coordinates of rectangular
elements $I$ and $J$. $A_{IiJj}$ stands for the influence coefficients. These
are obtained by integrating (\ref{eq:u_int_A_p}) over a single element $J$
with respect to an observation point at $\vec{x}_I$, which can be done
analytically \cite{Kalker1990}. Due to the choice for rectangular elements,
the influence coefficients $A_{IiJj}$ are identical for all pairs $I,J$ for
which the relative positions are the same.

The slip $\vec{s}_t$ at the surface of the contacting bodies involves
a time-derivative. It is discretised using a `previous time instance'
$t'$, with $\delta t=t-t'$. A related quantity is the traversed distance
per time step $\delta q = V\cdot \delta t$, with $V$ the rolling speed.
$\delta q$ is also called the `time step' for brevity.
The displacements at the previous time instance are denoted by $\vec{u}'$.

The shift (distance) $\vec{S}_t$ is the slip aggregated over a time
step $\vec{s}_t\cdot\delta q=V\vec{s}_t\cdot\delta t$. It is discretised using
a particle fixed, Lagrangian approach. In this approach the shift is
expressed as the sum of rigid shift plus deformation shift, where the
deformation shift is the change in deformation of two contacting particles
over a time step from $t'$ to $t$.
\begin{equation}\label{eq:discr_shift}
   \vec{S}_{It} = \vec{W}_{It} + \vec{u}_{It} - \vec{u}'_{It}, \;\;\;
        \mbox{ for } I\in\{1\cdots N\}.
\end{equation}
Here $\vec{W}_{It}$ is the rigid shift of the bodies, in rolling problems the
creepage integrated over a time step $\delta t$. $\vec{u}_{It}$ is the current
tangential deformation difference $\vec{u}^{(1)}_{It}-\vec{u}^{(2)}_{It}$ of
two contacting particles at element $I$. And $\vec{u}'_{It}$ is the
deformation difference of the same particles one time step earlier, at
the position where they resided at time $t'$.

\section{Fast or detailed solution}
\label{sec:fast_detailed}

The full algorithms of CONTACT are relatively slow due to the dense
matrix-vector products of Equation (\ref{eq:ui_sum_Aij_pj}). This is
cumbersome in case many time steps need to be solved, such as in a
vehicle dynamics simulation. Approximate algorithms are provided for
this situation.

For the normal contact problem, CONTACT provides the KPEC-method
(Kik-Piotrowski with Ellipse Correction),
a variant of the algorithm of Kik and Piotrowski \cite{Kik1996,
Piotrowski2008}. The shape of the contact area is approximated using the
virtual interpenetration function. Different from Kik and Piotrowski's scaling,
$\epsilon_{kp}=0.55$, we use variable scaling $\epsilon_{kpec}(y)$ based
on Hertz' theory, with exact agreement for elliptic contact patches. This
provides a shape correction in a way that fits with the discretization
used in CONTACT. The pressure distribution is approximated the same as in
the KP-method, and is solved in the same way. 
An implementation of the ANALYN method is also provided \cite{Sichani2014b}.
For the tangential contact problem, CONTACT provides an implementation of
Modified FASTSIM \cite{Spiryagin2013}.

Using these fast algorithms, one may benefit from CONTACT's detailed
contact search algorithms without jeopardizing the speed of the simulation.
One can use fast algorithms during model building and one's day-to-day
work, in regular cases. The full algorithms may be used once in a while,
to check the validity of simplifications, for the final simulation, and in
the most demanding situations.

\section{Specification of a case}

With the formulations chosen as described above, a contact problem is
specified completely with the following inputs:
\begin{itemize}
\item a coordinate system with positive $z$ ($n$) direction normal to the
        contact plane and pointing into the upper body, body 1. In
        rolling problems this is a contact-fixed coordinate system,
        in sliding problems (shifts) material-fixed coordinates are
        used (Section \ref{sec:coordsys});
\item the potential contact region, a rectangular area in the plane $z=0$
        that encompasses the true contact region, and its discretisation
        step sizes $\delta x,\delta y$ or number of elements $m_x,m_y$
        (Figure \ref{fig:potcon_discr});
\item in rolling problems: the rolling velocity $V$, direction $\chi$
        (`{\tt chi}') and `time step size' $\delta q=V\,\delta t$.
        Note: recent modifications of the program more or less require
        that $\chi=0^\circ$ or $180^\circ$, i.e.\ rolling takes place in
        positive or negative $x$-direction;
\item the material parameters $G^{(a)}, \nu^{(a)}$ for elastic materials
        for the two bodies $a=1,2$ and additional parameters for viscoelastic
        materials that are included in the influence function
        $\mat{A}(\vec{x},\vec{y})$;
\item the undeformed distance $h(\vec{x})$ between the surfaces, i.e.\ their
        separation in the direction normal to the contact area, up to a
        constant value, the approach $\delta_n$;
\item either the approach $\delta_n$ or the total normal force $F_n$;
\item the rigid slip $\vec{w}_t$:
        the relative movement of opposing particles
        in tangential directions $x,y$ in the undeformed state. These are
        characterized by creepages $\xi$ ({\tt ksi}) and $\eta$ ({\tt eta})
        in $x$- and $y$-directions respectively, and the spin creepage
        $\phi$ ({\tt phi}) with respect to the $z$-axis of the local
        coordinate system. Alternatively to the creepages total forces
        may be prescribed. An extra term to this rigid slip may be
        provided as well;
\item configuration parameters for the solution processes, such as
        switching to KPEC and Modified FASTSIM, the required solution
        accuracy, number of iterations required, and so on.
\end{itemize}
These quantities are easily recognized in the variables that are specified
in the user input, which are described in detail in Chapter
\ref{chp:module3}.

Some of these inputs are hard to obtain, like an appropriate contact
reference plane in wheel/rail contact situations, and the corresponding
undeformed distance and creepage situation. This is alleviated by the
extensions of Chapter \ref{chp:module1} for wheel/rail contact.

\magenta{
\chapter{Wheel and rail profiles}


\section{Requirements for rail profiles}

\begin{figure}[bt]
\centering
\psfig{figure=fig/rail_profiles,width=5.8in,trim=150 45 130 50,clip=}
\caption{\em Variety of rail profiles that should be supported.}
\label{fig:rail_profiles}
\end{figure}

Wheel and rail profiles come in many varieties. This is illustrated in Figure
\ref{fig:rail_profiles} using a selection of possible rail profiles.
\begin{itemize}
\item The rail profile can be provided before (a) or after applying the
        cant angle (b).
\item The profile coordinate origin can be chosen at the top of the
        rail (a), at the gauge face (c), or anywhere else (d, f).
\item The profiles could be measured for the rail on the left side of the
        track (d) or for the right side (b).
\item The profiles could be measured with $z$ positive upwards (e) or
        downwards (a).
\item Lateral positions could be increasing monotonically (a), or could be
        decreasing at some points (d, e, f, h), creating multi-valued functions.
\item Rails could consist of multiple sections, particularly at switches
        and crossings (f), or when using a guard rail (g).
\item For testing purposes, rails could be defined as circular arcs (i)
        or planar sections (j).
\item The height of the rail side face could be too small for the gauge width
        computation (j).
\item The left-most point in the rail needed for the gauge width computation
        may occur above the gauge measuring height (d).
\item The highest part of the rail isn't always the most relevant for
        contact analysis (groove: k).
\item Profiles may contain sharp corners (k), that must be dealt with
        appropriately in operations like smoothing and interpolation.
\item The profiles could be measured in $[mm]$, $[m]$ or $[in]$, etc.
\end{itemize}
Users want to be able to define a profile just once and then use this
definition on both sides of a rail vehicle. This can be dealt with by
mirroring the profile inside the program, creating a left-side profile from
a right-sided one, or by mirroring the problem, solving a left-side problem
through an equivalent right-side problem. It looks like both strategies can
work well, with no compelling argument in favour of one or the other. The
two strategies each have their own complications and disadvantages. In
CONTACT we choose to mirror the problem instead of the profile. All
profiles will be stored as right-side profiles.

(The distinction between left and right sides comes from working with
wheelsets as the basis of operation. If we'd focused on single wheels then
the side would be immaterial.)

(An important part of our project is to find the right level of
aggregation to step in. We don't want to deal with vehicles or bogies, we
could work on wheelsets or on single wheels only, we cannot go smaller,
must consider whole wheels.)

\section{Requirements for wheel profiles}

\begin{figure}[bt]
\centering
\psfig{figure=fig/wheel_profiles,width=5.8in,trim=150 70 130 60,clip=}
\caption{\em Variety of wheel profiles that should be supported.}
\label{fig:wheel_profiles}
\end{figure}

A variety of wheel profiles is shown in Figure \ref{fig:wheel_profiles}.
\begin{itemize}
\item Profiles can be given for right (a) or left wheels (b).
\item The profile coordinate origin can be placed at the tape circle line
        (a, b), at the flange back (c), or anywhere else (d).
\item The profiles can be given with $z$ positive downwards (a, b, c) or
        upwards (d).
\item A wheel may have one (a--d), no (e--h), or two flanges (i).
\item For testing purposes, wheels may be defined with a circular
        cross-section (e) or as a flat/conical section (f).
\item Idealized two-dimensional contacts require a logarithmical drop at
        the sides (g), to avoid pressure concentration.
\item Profiles may have nearly or exactly vertical sides at the back of
        the flange (a--d, i) or at the sides of a roller (i).
\end{itemize}
Wheel profiles can be narrower or wider than the rail profile. In case of a
grooved rail profile (Figure \ref{fig:rail_profiles} (k)), a narrow
circular wheel (Figure \ref{fig:wheel_profiles} (e)) may have its lowest
$z$-values larger than the lowest $z$ on the rail. In that case, the wheel
profile may not be extended by constant extrapolation.

}

\end{document}

